<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>SwiftUI 管理多視窗的 WindowGroup &amp; 多視窗的資料存取問題</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">SwiftUI 管理多視窗的 WindowGroup &amp; 多視窗的資料存取問題</h1>
</header>
<section data-field="subtitle" class="p-summary">
開發 SwiftUI App 時，我們主要在遵從 App 的型別裡指定 App 的第一個畫面。如以下例子，變數 body 裡 WindowGroup 包含的 ContentView 將是 App 的第一個畫面。
</section>
<section data-field="body" class="e-content">
<section name="45e6" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="d413" id="d413" class="graf graf--h3 graf--leading graf--title">SwiftUI 管理多視窗的 WindowGroup &amp; 多視窗的資料存取問題</h3><figure name="a1ad" id="a1ad" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="1*YURZ3s3yPLEtXHpf_t7Dbw.png" data-width="1048" data-height="984" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*YURZ3s3yPLEtXHpf_t7Dbw.png"></figure><p name="e129" id="e129" class="graf graf--p graf-after--figure">開發 SwiftUI App 時，我們主要在遵從 App 的型別裡指定 App 的第一個畫面。如以下例子，變數 body 裡 WindowGroup 包含的 ContentView 將是 App 的第一個畫面。</p><pre name="39e0" id="39e0" class="graf graf--pre graf-after--p"><a href="http://twitter.com/main" data-href="http://twitter.com/main" class="markup--anchor markup--pre-anchor" title="Twitter profile for @main" rel="noopener" target="_blank">@main</a><br>struct DemoApp: App {<br>    <br>    var body: some Scene {<br>        WindowGroup {<br>            ContentView()<br>        }<br>    }<br>}</pre><p name="43ca" id="43ca" class="graf graf--p graf-after--pre">body 的型別是 some Scene，而 WindowGroup 遵從 Scene，它將負責管理多個視窗。什麼意思呢? 在 iPadOS &amp; macOS，一個 App 可能有多個視窗，比方以下的 iPad 開了兩個 Safari 視窗，我們可以在左邊買 iPhone 12，右邊研究 SwiftUI。(ps: iOS 比較弱一點，只會有一個視窗。)</p><figure name="b783" id="b783" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*HHu5lfhdDaxDaf2_4y9XfA.png" data-width="2020" data-height="1628" src="https://cdn-images-1.medium.com/max/800/1*HHu5lfhdDaxDaf2_4y9XfA.png"></figure><p name="21c7" id="21c7" class="graf graf--p graf-after--figure">WindowGroup 怎麼管理多個視窗呢 ? 讓我們瞧瞧它的 init。</p><pre name="ccac" id="ccac" class="graf graf--pre graf-after--p">public init(@ViewBuilder content: () -&gt; Content)</pre><p name="87a0" id="87a0" class="graf graf--p graf-after--pre">參數 content 執行後將回傳視窗裡顯示的 view。當 App 啟動生成第一個視窗或是之後新增視窗時，它將呼叫 content，得到視窗要顯示的 view。因為若 App 有三個視窗，以下 WindowGroup 後的 closure 程式將執行三次，產生三個 ContentView。</p><pre name="c2e3" id="c2e3" class="graf graf--pre graf-after--p"><a href="http://twitter.com/main" data-href="http://twitter.com/main" class="markup--anchor markup--pre-anchor" title="Twitter profile for @main" rel="noopener" target="_blank">@main</a><br>struct DemoApp: App {<br>    <br>    var body: some Scene {<br>        WindowGroup <strong class="markup--strong markup--pre-strong">{<br>            ContentView()<br>        }</strong><br>    }<br>}</pre><p name="456c" id="456c" class="graf graf--p graf-after--pre">了解 WindowGroup 管理多視窗的原理後，接著讓我們認識多視窗的資料存取問題。我們將舉兩個例子，一個是多視窗存取同一份資料，一個是每個視窗有各自獨立的資料。</p><h3 name="e43f" id="e43f" class="graf graf--h3 graf-after--p">多視窗存取同一份資料</h3><p name="c080" id="c080" class="graf graf--p graf-after--h3">資料 NumberData 的定義如下。</p><pre name="e3d4" id="e3d4" class="graf graf--pre graf-after--p">class NumberData: ObservableObject {<br>    <a href="http://twitter.com/Published" data-href="http://twitter.com/Published" class="markup--anchor markup--pre-anchor" title="Twitter profile for @Published" rel="noopener" target="_blank">@Published</a> var value = 0<br>}</pre><p name="1813" id="1813" class="graf graf--p graf-after--pre">在遵從 App 的型別裡宣告儲存資料的 numberData，然後呼叫 environmentObject 讓 ContentView 能存取資料。</p><pre name="de31" id="de31" class="graf graf--pre graf-after--p">import SwiftUI</pre><pre name="8f14" id="8f14" class="graf graf--pre graf-after--pre"><a href="http://twitter.com/main" data-href="http://twitter.com/main" class="markup--anchor markup--pre-anchor" title="Twitter profile for @main" rel="noopener" target="_blank">@main</a><br>struct DemoApp: App {<br><strong class="markup--strong markup--pre-strong">    </strong><a href="http://twitter.com/StateObject" data-href="http://twitter.com/StateObject" class="markup--anchor markup--pre-anchor" title="Twitter profile for @StateObject" rel="noopener" target="_blank"><strong class="markup--strong markup--pre-strong">@StateObject</strong></a><strong class="markup--strong markup--pre-strong"> private var numberData = NumberData()<br></strong>    <br>    var body: some Scene {<br>        WindowGroup {<br>            ContentView()<br><strong class="markup--strong markup--pre-strong">                .environmentObject(numberData)<br></strong>        }<br>    }<br>}</pre><p name="d0ed" id="d0ed" class="graf graf--p graf-after--pre">ContentView 將顯示 numberData 的數字圖片，點選數字時將換圖。</p><pre name="52ae" id="52ae" class="graf graf--pre graf-after--p">import SwiftUI</pre><pre name="6c99" id="6c99" class="graf graf--pre graf-after--pre">struct ContentView: View {<br><strong class="markup--strong markup--pre-strong">    </strong><a href="http://twitter.com/EnvironmentObject" data-href="http://twitter.com/EnvironmentObject" class="markup--anchor markup--pre-anchor" title="Twitter profile for @EnvironmentObject" rel="noopener" target="_blank"><strong class="markup--strong markup--pre-strong">@EnvironmentObject</strong></a><strong class="markup--strong markup--pre-strong"> var numberData: NumberData<br></strong>    <br>    var body: some View {<br>        Image(systemName: &quot;\(numberData.value).circle&quot;)<br>            .resizable()<br>            .scaledToFit()<br>            .onTapGesture {<br>                numberData.value = Int.random(in: 1...50)<br>            }<br>    }<br>}</pre><p name="62d1" id="62d1" class="graf graf--p graf-after--pre">在 iPad 執行 App，App 順利地顯示數字圖片，點選數字後也會隨機更換另一個數字。</p></div><div class="section-inner sectionLayout--outsetRow" data-paragraph-count="3"><figure name="5eba" id="5eba" class="graf graf--figure graf--layoutOutsetRow is-partialWidth graf-after--p" style="width: 33.333%;"><img class="graf-image" data-image-id="1*QPevn0QtfWHlnZRFe8fXoQ.png" data-width="1640" data-height="2360" src="https://cdn-images-1.medium.com/max/400/1*QPevn0QtfWHlnZRFe8fXoQ.png"></figure><figure name="a8be" id="a8be" class="graf graf--figure graf--layoutOutsetRowContinue is-partialWidth graf-after--figure" style="width: 33.333%;"><img class="graf-image" data-image-id="1*Q4aMFvToIkkmLsa7aATvdA.png" data-width="1640" data-height="2360" src="https://cdn-images-1.medium.com/max/400/1*Q4aMFvToIkkmLsa7aATvdA.png"></figure><figure name="2b7d" id="2b7d" class="graf graf--figure graf--layoutOutsetRowContinue is-partialWidth graf-after--figure" style="width: 33.333%;"><img class="graf-image" data-image-id="1*4rNVlB6FTAOuawn39ZhsKw.png" data-width="1640" data-height="2360" src="https://cdn-images-1.medium.com/max/400/1*4rNVlB6FTAOuawn39ZhsKw.png"></figure></div><div class="section-inner sectionLayout--insetColumn"><p name="00af" id="00af" class="graf graf--p graf-after--figure">接著讓我們新增第二個視窗。從 iPad 底部往上拖曳，開啟 Dock。在 Dock 上按住我們開發的 App icon，然後將它拖離 Dock，移到螢幕的右側。</p></div><div class="section-inner sectionLayout--outsetRow" data-paragraph-count="3"><figure name="7927" id="7927" class="graf graf--figure graf--layoutOutsetRow is-partialWidth graf-after--p" style="width: 34.152%;"><img class="graf-image" data-image-id="1*ae3WnmOjgFae-PmCBvIYgw.png" data-width="1640" data-height="2360" src="https://cdn-images-1.medium.com/max/600/1*ae3WnmOjgFae-PmCBvIYgw.png"></figure><figure name="e112" id="e112" class="graf graf--figure graf--layoutOutsetRowContinue is-partialWidth graf-after--figure" style="width: 32.875%;"><img class="graf-image" data-image-id="1*SqqPJ9Zl1pPMMMx_zRfZFA.png" data-width="864" data-height="1292" src="https://cdn-images-1.medium.com/max/400/1*SqqPJ9Zl1pPMMMx_zRfZFA.png"></figure><figure name="e115" id="e115" class="graf graf--figure graf--layoutOutsetRowContinue is-partialWidth graf-after--figure" style="width: 32.973%;"><img class="graf-image" data-image-id="1*rKJMN5R9n7kiu_S11IkbIA.png" data-width="866" data-height="1290" src="https://cdn-images-1.medium.com/max/400/1*rKJMN5R9n7kiu_S11IkbIA.png"></figure></div><div class="section-inner sectionLayout--insetColumn"><p name="75e9" id="75e9" class="graf graf--p graf-after--figure">神奇的事發生了。新增的視窗也是數字 8，不是 NumberData 一開始的初始值 0。當我們點選左側或右側的數字時，兩邊的數字也會同步更新，永遠顯示同一個數字。</p></div><div class="section-inner sectionLayout--outsetRow" data-paragraph-count="3"><figure name="217f" id="217f" class="graf graf--figure graf--layoutOutsetRow is-partialWidth graf-after--p" style="width: 33.333%;"><img class="graf-image" data-image-id="1*Pc-hCre6n0Vy-5x-h5y8Kw.png" data-width="1640" data-height="2360" src="https://cdn-images-1.medium.com/max/400/1*Pc-hCre6n0Vy-5x-h5y8Kw.png"></figure><figure name="68e0" id="68e0" class="graf graf--figure graf--layoutOutsetRowContinue is-partialWidth graf-after--figure" style="width: 33.333%;"><img class="graf-image" data-image-id="1*T-50zxwvlYSKLqbGGBKaRg.png" data-width="1640" data-height="2360" src="https://cdn-images-1.medium.com/max/400/1*T-50zxwvlYSKLqbGGBKaRg.png"></figure><figure name="85ad" id="85ad" class="graf graf--figure graf--layoutOutsetRowContinue is-partialWidth graf-after--figure" style="width: 33.333%;"><img class="graf-image" data-image-id="1*6pryiiZ7QpcD7U70MBal8A.png" data-width="1640" data-height="2360" src="https://cdn-images-1.medium.com/max/400/1*6pryiiZ7QpcD7U70MBal8A.png"></figure></div><div class="section-inner sectionLayout--insetColumn"><p name="8991" id="8991" class="graf graf--p graf-after--figure">為什麼會這樣呢 ? 因為我們在 DemoApp 裡生成 NumberData，它只會生成一次。之後 App 新增視窗產生新的 ContentView 時，存取的將是同一份 NumberData。</p><pre name="dd83" id="dd83" class="graf graf--pre graf-after--p"><a href="http://twitter.com/main" data-href="http://twitter.com/main" class="markup--anchor markup--pre-anchor" title="Twitter profile for @main" rel="noopener" target="_blank">@main</a><br>struct DemoApp: App {<br><strong class="markup--strong markup--pre-strong">    </strong><a href="http://twitter.com/StateObject" data-href="http://twitter.com/StateObject" class="markup--anchor markup--pre-anchor" title="Twitter profile for @StateObject" rel="noopener" target="_blank"><strong class="markup--strong markup--pre-strong">@StateObject</strong></a><strong class="markup--strong markup--pre-strong"> private var numberData = NumberData()<br></strong>    <br>    var body: some Scene {<br>        WindowGroup {<br>            ContentView()<br>                .environmentObject(numberData)<br>        }<br>    }<br>}</pre><h3 name="19a7" id="19a7" class="graf graf--h3 graf-after--pre">每個視窗有各自獨立的資料</h3><p name="b5f9" id="b5f9" class="graf graf--p graf-after--h3">如果你不想多視窗共享同一份資料，想要每個視窗有各自獨立的資料，則要把生成 NumberData 的程式放到 view 裡，比方我們將它放到 ContentView，因此當 App 新增視窗生成新的 ContentView 時，也會產生新的 NumberData。</p><pre name="f5a1" id="f5a1" class="graf graf--pre graf-after--p">struct ContentView: View {<br><strong class="markup--strong markup--pre-strong">    </strong><a href="http://twitter.com/StateObject" data-href="http://twitter.com/StateObject" class="markup--anchor markup--pre-anchor" title="Twitter profile for @StateObject" rel="noopener" target="_blank"><strong class="markup--strong markup--pre-strong">@StateObject</strong></a><strong class="markup--strong markup--pre-strong"> private var numberData = NumberData()</strong></pre><pre name="cd7a" id="cd7a" class="graf graf--pre graf-after--pre">var body: some View {<br>        Image(systemName: &quot;\(numberData.value).circle&quot;)<br>            .resizable()<br>            .scaledToFit()<br>            .onTapGesture {<br>                numberData.value = Int.random(in: 1...50)<br>            }<br>    }<br>}</pre><p name="a9a7" id="a9a7" class="graf graf--p graf-after--pre">將 DemoApp 裡 numberData 的相關程式移除。</p><pre name="0bed" id="0bed" class="graf graf--pre graf-after--p"><a href="http://twitter.com/main" data-href="http://twitter.com/main" class="markup--anchor markup--pre-anchor" title="Twitter profile for @main" rel="noopener" target="_blank">@main</a><br>struct DemoApp: App {<br>    <br>    var body: some Scene {<br>        WindowGroup {<br>            ContentView()<br>        }<br>    }<br>}</pre><p name="06c5" id="06c5" class="graf graf--p graf-after--pre">執行 App，兩個視窗的數字不再同步了。</p><figure name="bc6f" id="bc6f" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*AzScxCdxQJtWdZx5izG1rQ.png" data-width="1640" data-height="2360" src="https://cdn-images-1.medium.com/max/800/1*AzScxCdxQJtWdZx5izG1rQ.png"></figure><h3 name="caba" id="caba" class="graf graf--h3 graf-after--figure">參考連結</h3><p name="ecbe" id="ecbe" class="graf graf--p graf-after--h3">App Structure and Behavior</p><div name="4cea" id="4cea" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://developer.apple.com/documentation/swiftui/app-structure-and-behavior" data-href="https://developer.apple.com/documentation/swiftui/app-structure-and-behavior" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/swiftui/app-structure-and-behavior"><strong class="markup--strong markup--mixtapeEmbed-strong">Apple Developer Documentation</strong><br><em class="markup--em markup--mixtapeEmbed-em">Edit description</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/swiftui/app-structure-and-behavior" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="82859b5638b88289696369243ea4ebcd"></a></div><p name="6c6d" id="6c6d" class="graf graf--p graf-after--mixtapeEmbed">WindowGroup</p><div name="b442" id="b442" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://developer.apple.com/documentation/swiftui/windowgroup" data-href="https://developer.apple.com/documentation/swiftui/windowgroup" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/swiftui/windowgroup"><strong class="markup--strong markup--mixtapeEmbed-strong">Apple Developer Documentation</strong><br><em class="markup--em markup--mixtapeEmbed-em">Edit description</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/swiftui/windowgroup" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="f1ebdf8819f337abbc5ae2089ca22b30"></a></div><p name="3af4" id="3af4" class="graf graf--p graf-after--mixtapeEmbed">App</p><div name="93c0" id="93c0" class="graf graf--mixtapeEmbed graf-after--p graf--trailing"><a href="https://developer.apple.com/documentation/swiftui/app" data-href="https://developer.apple.com/documentation/swiftui/app" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/swiftui/app"><strong class="markup--strong markup--mixtapeEmbed-strong">Apple Developer Documentation</strong><br><em class="markup--em markup--mixtapeEmbed-em">Edit description</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/swiftui/app" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="3546d909a8bc0325a89608cc3c52d3e7"></a></div></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@apppeterpan" class="p-author h-card">彼得潘的 iOS App Neverland</a> on <a href="https://medium.com/p/9342ee260896"><time class="dt-published" datetime="2021-06-28T07:43:54.539Z">June 28, 2021</time></a>.</p><p><a href="https://medium.com/@apppeterpan/swiftui-%E7%AE%A1%E7%90%86%E5%A4%9A%E8%A6%96%E7%AA%97%E7%9A%84-windowgroup-%E5%A4%9A%E8%A6%96%E7%AA%97%E7%9A%84%E8%B3%87%E6%96%99%E5%AD%98%E5%8F%96%E5%95%8F%E9%A1%8C-9342ee260896" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on November 16, 2025.</p></footer></article></body></html>