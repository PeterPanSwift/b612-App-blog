<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>顯示 alert 前檢查出問題的頁面是否正顯示著，利用 viewIfLoaded?.window &amp; presentedViewController</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">顯示 alert 前檢查出問題的頁面是否正顯示著，利用 viewIfLoaded?.window &amp; presentedViewController</h1>
</header>
<section data-field="subtitle" class="p-summary">
開發 iOS App 時，我們時常使用 alert 顯示錯誤訊息，比方網路資料抓不到時顯示 alert 告訴使用者網路連線有問題。
</section>
<section data-field="body" class="e-content">
<section name="bf99" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="0edc" id="0edc" class="graf graf--h3 graf--leading graf--title">顯示 alert 前檢查出問題的頁面是否正顯示著，利用 viewIfLoaded?.window &amp; presentedViewController</h3><p name="f591" id="f591" class="graf graf--p graf-after--h3">開發 iOS App 時，我們時常使用 alert 顯示錯誤訊息，比方網路資料抓不到時顯示 alert 告訴使用者網路連線有問題。</p><p name="5a9d" id="5a9d" class="graf graf--p graf-after--p">不過顯示 alert 前最好先檢查一下出問題的頁面是否正顯示著，否則有可能造成 alert 顯示在錯誤的頁面。為什麼呢 ? 以下我們舉個網路抓資料的例子說明。</p><p name="4e13" id="4e13" class="graf graf--p graf-after--p">以下是使用者虎克船長的操作過程:</p><ul class="postList"><li name="bd52" id="bd52" class="graf graf--li graf-after--p">虎克打開 App，顯示 A 頁面， A 頁面顯示時會抓取網路上的資料，然後將資料顯示在表格上。</li><li name="012a" id="012a" class="graf graf--li graf-after--li">沒耐心的虎克在 A 頁面尚末抓到資料時就點選 button 切換到下一頁的 B 頁面。</li><li name="87c9" id="87c9" class="graf graf--li graf-after--li">此時很不幸的後台剛好出問題，造成 A 頁面的資料抓不到，於是 App 貼心地跳出 alert 告訴使用者。</li></ul><p name="a173" id="a173" class="graf graf--p graf-after--li">因此產生了一個奇怪的現象，虎克明明在 B 頁面，但是他卻看到了 A 頁面抓不到資料的 alert。</p><p name="8fab" id="8fab" class="graf graf--p graf-after--p">為了避免這樣的問題，我們在顯示 alert 前最好先檢查出問題 controller 的 <code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">viewIfLoaded?.window &amp; presentedViewController</strong></code>。若是 viewIfLoaded?.window 有值，而且 presentedViewController 為 nil，表示它的畫面目前正顯示著，現在顯示 alert 正是時候。否則的話表示 App 已經切換到其它頁面，不適合顯示 alert。</p><h3 name="8a30" id="8a30" class="graf graf--h3 graf-after--p">範例說明</h3><h4 name="f730" id="f730" class="graf graf--h4 graf-after--h3">storyboard 畫面</h4><p name="5ab8" id="5ab8" class="graf graf--p graf-after--h4">點選下一頁 button 將跳到下一頁。</p><figure name="6467" id="6467" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*5dGPCFMEp9KK2ghO9YGogw.png" data-width="1854" data-height="1114" src="https://cdn-images-1.medium.com/max/800/1*5dGPCFMEp9KK2ghO9YGogw.png"></figure><h4 name="0a41" id="0a41" class="graf graf--h4 graf-after--figure">第一頁 ViewController 的程式</h4><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="73aa" id="73aa" class="graf graf--pre graf-after--h4 graf--preV2"><span class="pre--content"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewController</span>: <span class="hljs-title class_">UIViewController</span> {<br />    <br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {<br />        <span class="hljs-keyword">super</span>.viewDidLoad()<br />        <span class="hljs-type">DispatchQueue</span>.main.asyncAfter(deadline: .now() <span class="hljs-operator">+</span> <span class="hljs-number">10</span>) {<br />            <span class="hljs-keyword">self</span>.displayAlert()<br />        }<br />    }<br />    <br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">displayAlert</span>() {<br />        <span class="hljs-keyword">let</span> alert <span class="hljs-operator">=</span> <span class="hljs-type">UIAlertController</span>(title: <span class="hljs-string">&quot;Error&quot;</span>, message: <span class="hljs-literal">nil</span>, preferredStyle: .alert)<br />        alert.addAction(<span class="hljs-type">UIAlertAction</span>(title: <span class="hljs-string">&quot;Dismiss&quot;</span>, style: .default, handler: <span class="hljs-literal">nil</span>))<br />        present(alert, animated: <span class="hljs-literal">true</span>)<br />    }<br />}</span></pre><p name="baee" id="baee" class="graf graf--p graf-after--pre">為了模擬抓資料錯誤的情況，我們設定 10 秒後顯示錯誤訊息的 alert。執行 App，切換到第二頁後，我們發現 alert 果然出現在第二頁。但是它是第一頁的錯誤訊息，所以我們不想看到它。</p><figure name="c677" id="c677" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*_sv5jeNhoaucu9hjpEzvVQ.png" data-width="1170" data-height="2532" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*_sv5jeNhoaucu9hjpEzvVQ.png"></figure><h3 name="8125" id="8125" class="graf graf--h3 graf-after--figure">解法: 檢查 <strong class="markup--strong markup--h3-strong">viewIfLoaded?.window</strong></h3><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="f3fa" id="f3fa" class="graf graf--pre graf-after--h3 graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">displayAlert</span>() {<br />        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword">_</span> <span class="hljs-operator">=</span> viewIfLoaded<span class="hljs-operator">?</span>.window <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }<br />        <span class="hljs-keyword">let</span> alert <span class="hljs-operator">=</span> <span class="hljs-type">UIAlertController</span>(title: <span class="hljs-string">&quot;Error&quot;</span>, message: <span class="hljs-literal">nil</span>, preferredStyle: .alert)<br />        alert.addAction(<span class="hljs-type">UIAlertAction</span>(title: <span class="hljs-string">&quot;Dismiss&quot;</span>, style: .default, handler: <span class="hljs-literal">nil</span>))<br />        present(alert, animated: <span class="hljs-literal">true</span>)<br />}</span></pre><p name="548d" id="548d" class="graf graf--p graf-after--pre">顯示 alert 前先檢查 <code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">viewIfLoaded?.window</strong></code>。若是它有值，表示它的畫面目前正顯示著，現在顯示 alert 正是時候。若是它為 nil，表示使用者已經切換到其它頁面，因此不適合顯示 alert。</p><p name="4335" id="4335" class="graf graf--p graf-after--p">ps: 為什麼使用 viewIfLoaded?.window，而不是 view.window 呢 ? 因為讀取 view 會有副作用，如果原本 view 沒有載入，controller 會呼叫 loadView 載入 view。讀取 viewIfLoaded 則不會有副作用，若是 view 沒有載入，viewIfLoaded 將得到 nil。</p><h3 name="4ec2" id="4ec2" class="graf graf--h3 graf-after--p">present modally 顯示的頁面</h3><p name="128f" id="128f" class="graf graf--p graf-after--h3">不過若是下一頁是用 present modally 顯示，而且原本的頁面有露出一點點， viewIfLoaded?.window 的檢查方式將失效，因為此時 viewIfLoaded?.window 還是能讀到值。</p><figure name="031b" id="031b" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*sWGhvmGY0m7dLeBD-ZCepQ.png" data-width="1170" data-height="2532" src="https://cdn-images-1.medium.com/max/800/1*sWGhvmGY0m7dLeBD-ZCepQ.png"></figure><p name="3819" id="3819" class="graf graf--p graf-after--figure">此問題有以下幾種解法</p><ul class="postList"><li name="9f6b" id="9f6b" class="graf graf--li graf-after--p">解法 1</li></ul><p name="2a23" id="2a23" class="graf graf--p graf-after--li">若是新的畫面已經被 present，我們再從之前畫面的 controller present alert 其實是不會有作用的，因為只有最後一個被 present 的 controller 能夠再 present 下一頁，所以不會有 alert 出現在錯誤頁面的問題。</p><ul class="postList"><li name="4e88" id="4e88" class="graf graf--li graf-after--p">解法 2</li></ul><p name="97ad" id="97ad" class="graf graf--p graf-after--li">檢查出問題 controller 的 presentedViewController，若是有值即表示目前已切換到其它頁面。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="0cf3" id="0cf3" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">displayAlert</span>() {<br />        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword">_</span> <span class="hljs-operator">=</span> viewIfLoaded<span class="hljs-operator">?</span>.window,<br />              presentedViewController <span class="hljs-operator">==</span> <span class="hljs-literal">nil</span> <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }<br />        <span class="hljs-keyword">let</span> alert <span class="hljs-operator">=</span> <span class="hljs-type">UIAlertController</span>(title: <span class="hljs-string">&quot;Error&quot;</span>, message: <span class="hljs-literal">nil</span>, preferredStyle: .alert)<br />        alert.addAction(<span class="hljs-type">UIAlertAction</span>(title: <span class="hljs-string">&quot;Dismiss&quot;</span>, style: .default, handler: <span class="hljs-literal">nil</span>))<br />        present(alert, animated: <span class="hljs-literal">true</span>)<br />}</span></pre><h3 name="0a30" id="0a30" class="graf graf--h3 graf-after--pre">參考資料</h3><p name="890f" id="890f" class="graf graf--p graf-after--h3">‎Develop in Swift Data Collections 的 Unit 2 的 Guided Project: Restaurant。</p><div name="cdc6" id="cdc6" class="graf graf--mixtapeEmbed graf-after--p graf--trailing"><a href="https://books.apple.com/tw/book/develop-in-swift-data-collections/id6468968766?l=en-GB" data-href="https://books.apple.com/tw/book/develop-in-swift-data-collections/id6468968766?l=en-GB" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://books.apple.com/tw/book/develop-in-swift-data-collections/id6468968766?l=en-GB"><strong class="markup--strong markup--mixtapeEmbed-strong">‎Develop in Swift Data Collections</strong><br><em class="markup--em markup--mixtapeEmbed-em">Students expand on the knowledge and skills they developed in Develop in Swift Fundamentals by extending their work in…</em>books.apple.com</a><a href="https://books.apple.com/tw/book/develop-in-swift-data-collections/id6468968766?l=en-GB" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="78d885ca96cb34318cb082ba9b854d8f" data-thumbnail-img-id="0*wVvV8hrK0FEGzDZa" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*wVvV8hrK0FEGzDZa);"></a></div></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@apppeterpan" class="p-author h-card">彼得潘的 iOS App Neverland</a> on <a href="https://medium.com/p/6981f3b746f4"><time class="dt-published" datetime="2021-12-14T06:12:03.162Z">December 14, 2021</time></a>.</p><p><a href="https://medium.com/@apppeterpan/%E9%A1%AF%E7%A4%BA-alert-%E5%89%8D%E6%AA%A2%E6%9F%A5%E5%87%BA%E5%95%8F%E9%A1%8C%E7%9A%84%E9%A0%81%E9%9D%A2%E6%98%AF%E5%90%A6%E6%AD%A3%E9%A1%AF%E7%A4%BA%E8%91%97-6981f3b746f4" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on November 16, 2025.</p></footer></article></body></html>