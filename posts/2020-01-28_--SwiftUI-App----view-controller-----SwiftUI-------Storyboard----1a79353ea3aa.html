<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>在 SwiftUI App 加入 view controller &amp; 從 SwiftUI 畫面切換到 Storyboard 畫面</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">在 SwiftUI App 加入 view controller &amp; 從 SwiftUI 畫面切換到 Storyboard 畫面</h1>
</header>
<section data-field="subtitle" class="p-summary">
SwiftUI 有很多很棒很炫的功能，幫助我們更容易地開發 iOS App，不過因為它才剛出生，所以一些傳統 iOS App 常用的 UI 元件還不支援，比方它缺少以下這些元件:
</section>
<section data-field="body" class="e-content">
<section name="e708" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="abbf" id="abbf" class="graf graf--h3 graf--leading graf--title">在 SwiftUI App 加入 view controller &amp; 從 SwiftUI 畫面切換到 Storyboard 畫面</h3><figure name="9dc0" id="9dc0" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="1*AwC16s1t4z1BKMi_GeQfMQ.jpeg" data-width="1566" data-height="1246" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*AwC16s1t4z1BKMi_GeQfMQ.jpeg"></figure><p name="033f" id="033f" class="graf graf--p graf-after--figure">SwiftUI 有很多很棒很炫的功能，幫助我們更容易地開發 iOS App，不過因為它才剛出生，所以一些傳統 iOS App 常用的 UI 元件還不支援，比方它缺少以下這些元件:</p><ul class="postList"><li name="3046" id="3046" class="graf graf--li graf-after--p">像 UIKit UIImagePickerController 一樣拍照選照片的元件。</li><li name="c58f" id="c58f" class="graf graf--li graf-after--li">像 SafariServices SFSafariViewController 一樣顯示網頁的元件。</li></ul><p name="1830" id="1830" class="graf graf--p graf-after--li">所以 SwiftUI App 要放棄拍照 ＆ 網頁功能了嗎 ? 別擔心，我們可以將 view controller 包裝成 SwiftUI view，讓它假裝成 SwiftUI view，混入 SwiftUI 的世界裡，甚至從 SwiftUI 畫面切換到 Storyboard 的 controller 畫面，就像最近彼得潘戴上黑武士的頭盔闖進星際大戰的世界。</p><figure name="d761" id="d761" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*qiWgItiiftL1PQkWr431TQ.jpeg" data-width="720" data-height="960" src="https://cdn-images-1.medium.com/max/800/1*qiWgItiiftL1PQkWr431TQ.jpeg"></figure><h3 name="c6ea" id="c6ea" class="graf graf--h3 graf-after--figure">將 view controller 包裝成 SwiftUI view 的步驟</h3><p name="307c" id="307c" class="graf graf--p graf-after--h3">將 view controller 包裝成 SwiftUI view 的方法跟將 UIKit view 包裝成 SwiftUI view 的方法類似，還不清楚的朋友可先參考以下連結的說明，再閱讀接下來的說明。</p><div name="0486" id="0486" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%9C%A8-swiftui-app-%E5%8A%A0%E5%85%A5-uikit-view-f74b70282487" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%9C%A8-swiftui-app-%E5%8A%A0%E5%85%A5-uikit-view-f74b70282487" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%9C%A8-swiftui-app-%E5%8A%A0%E5%85%A5-uikit-view-f74b70282487"><strong class="markup--strong markup--mixtapeEmbed-strong">在 SwiftUI App 加入 UIKit View，比方網頁和地圖</strong><br><em class="markup--em markup--mixtapeEmbed-em">SwiftUI 有很多很棒很炫的功能，幫助我們更容易地開發 iOS App，不過因為它才剛出生，所以一些傳統 iOS App 常用的 UI 元件還不支援，比方它缺少以下這些元件:</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%9C%A8-swiftui-app-%E5%8A%A0%E5%85%A5-uikit-view-f74b70282487" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="77a1e88573456859783eb5c1720418f5" data-thumbnail-img-id="1*C9PSbuuuX71WyI3f9jpQGg.jpeg" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*C9PSbuuuX71WyI3f9jpQGg.jpeg);"></a></div><p name="e87c" id="e87c" class="graf graf--p graf-after--mixtapeEmbed">將 view controller 包裝成 SwiftUI view 包含以下步驟:</p><ol class="postList"><li name="3b37" id="3b37" class="graf graf--li graf-after--p">以 struct 定義 SwiftUI view 的型別，遵從 protocol <code class="markup--code markup--li-code"><strong class="markup--strong markup--li-strong">UIViewControllerRepresentable</strong></code>。</li><li name="fdf5" id="fdf5" class="graf graf--li graf-after--li">在 SwiftUI view 的型別裡定義 function <code class="markup--code markup--li-code"><strong class="markup--strong markup--li-strong">makeUIViewController</strong></code>，回傳 view controller，此 function 將在 SwiftUI view 生成時呼叫。</li></ol><p name="e466" id="e466" class="graf graf--p graf-after--li">3. 在 SwiftUI view 的型別裡定義 function <code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">updateUIViewController</strong></code>，修改 controller 的內容，此 function 將在 SwiftUI view 畫面更新時呼叫。</p><p name="051d" id="051d" class="graf graf--p graf-after--p">4. 若要在生成 SwiftUI view 時傳入資料，請在 SwiftUI view 的型別裡宣告儲存資料的 property。(optional)</p><p name="b338" id="b338" class="graf graf--p graf-after--p">5. 若要實現 delegate &amp; data source 等進階功能，請搭配 <code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">coordinator</strong></code>。(optional)</p><p name="1edd" id="1edd" class="graf graf--p graf-after--p">6. 若需要預覽，請定義遵從 protocol <code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">PreviewProvider</strong></code> 的型別。</p><h3 name="3d9c" id="3d9c" class="graf graf--h3 graf-after--p">將 SFSafariViewController 包裝成 SwiftUI view</h3><p name="cf6a" id="cf6a" class="graf graf--p graf-after--h3">接下來就讓我們以顯示網頁的 SFSafariViewController 為例，將它變成能在 SwiftUI App 顯示的 SwiftUI view。</p><h3 name="3b28" id="3b28" class="graf graf--h3 graf-after--p">以 struct 定義包裝 UI 元件的 SwiftUI view 型別，遵從 protocol <strong class="markup--strong markup--h3-strong">UIViewControllerRepresentable</strong></h3><p name="a4f5" id="a4f5" class="graf graf--p graf-after--h3">按 cmd + n 新增 Swift File，import SwiftUI &amp; SafariServices(因為待會將用到 SFSafariViewController)，以 struct 定義遵從 protocol UIViewControllerRepresentable 的 SafariView。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="8de3" id="8de3" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> SwiftUI<br /><span class="hljs-keyword">import</span> SafariServices<br /><br /><span class="hljs-keyword">struct</span> <span class="hljs-title class_">SafariView</span>: <span class="hljs-title class_">UIViewControllerRepresentable</span> {<br /><br />}</span></pre><h3 name="d8b4" id="d8b4" class="graf graf--h3 graf-after--pre"><strong class="markup--strong markup--h3-strong">宣告儲存網址的 property url</strong></h3><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="b816" id="b816" class="graf graf--pre graf-after--h3 graf--preV2"><span class="pre--content"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">SafariView</span>: <span class="hljs-title class_">UIViewControllerRepresentable</span> {<br />    <br />    <span class="hljs-keyword">let</span> url: <span class="hljs-type">URL</span><br />}</span></pre><h3 name="ed49" id="ed49" class="graf graf--h3 graf-after--pre">產生遵從 protocol UIViewControllerRepresentable 需定義的相關 function</h3><p name="8f89" id="8f89" class="graf graf--p graf-after--h3">由於我們尚未定義 protocol UIViewControllerRepresentable 的相關 function，此時會產生紅色錯誤。</p><figure name="ac80" id="ac80" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*EpjhtTa3n243WAMqrk-qDw.jpeg" data-width="1456" data-height="326" src="https://cdn-images-1.medium.com/max/800/1*EpjhtTa3n243WAMqrk-qDw.jpeg"></figure><p name="2980" id="2980" class="graf graf--p graf-after--figure">點選 Fix 後，Xcode 會幫我們加入 <code class="markup--code markup--p-code">typealias UIViewControllerType =</code> ，請在 = 後補上 SwiftUI view 想呈現的畫面的 controller 型別。</p><figure name="78a1" id="78a1" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*3sxDKNzFCi-U0eF0FnfSuw.jpeg" data-width="1030" data-height="380" src="https://cdn-images-1.medium.com/max/800/1*3sxDKNzFCi-U0eF0FnfSuw.jpeg"></figure><p name="b373" id="b373" class="graf graf--p graf-after--figure">在此我們填入 SFSafariViewController，然後再次點選 Xcode 的 Fix，自動產生 function makeUIViewController &amp; updateUIViewController。</p><figure name="d214" id="d214" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*CrIJnA9VzUIHIQkoG7JI0Q.jpeg" data-width="1462" data-height="878" src="https://cdn-images-1.medium.com/max/800/1*CrIJnA9VzUIHIQkoG7JI0Q.jpeg"></figure><p name="f9f2" id="f9f2" class="graf graf--p graf-after--figure">makeUIViewController(context:) 回傳的元件為 SafariView 顯示的畫面。由於我們剛剛在 typealias 裡填入 SFSafariViewController，因此 Xcode 知道 makeUIViewController(context:) 要回傳的型別是 SFSafariViewController。</p><h3 name="edf0" id="edf0" class="graf graf--h3 graf-after--p">定義 function makeUIViewController &amp; updateUIViewController</h3><p name="3560" id="3560" class="graf graf--p graf-after--h3">我們須在 makeUIViewController(context:) 裡回傳型別 SFSafariViewController 的物件， 因此我們在裡面利用 url 產生 SFSafariViewController 物件。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="070c" id="070c" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">makeUIViewController</span>(<span class="hljs-params">context</span>: <span class="hljs-type">Context</span>) -&gt; <span class="hljs-type">SFSafariViewController</span> {<br />     <span class="hljs-type">SFSafariViewController</span>(url: url)<br />}</span></pre><p name="6023" id="6023" class="graf graf--p graf-after--pre">那麼另一個 updateUIViewController(_:context:) function 呢 ? 它將在 SwiftUI view 畫面更新時被呼叫，不過現在我們先目標顯示網頁，顯示後不須更新，所以 updateUIViewController(_:context:) 不須寫任何程式。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="84ad" id="84ad" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">updateUIViewController</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">uiViewController</span>: <span class="hljs-type">SFSafariViewController</span>, <span class="hljs-params">context</span>: <span class="hljs-type">Context</span>) {<br />        <br />}</span></pre><p name="8176" id="8176" class="graf graf--p graf-after--pre">經過以上修改後，SafariView.swift 的程式如下。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="6516" id="6516" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> SwiftUI<br /><span class="hljs-keyword">import</span> SafariServices<br /><br /><span class="hljs-keyword">struct</span> <span class="hljs-title class_">SafariView</span>: <span class="hljs-title class_">UIViewControllerRepresentable</span> {<br />    <br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">makeUIViewController</span>(<span class="hljs-params">context</span>: <span class="hljs-type">Context</span>) -&gt; <span class="hljs-type">SFSafariViewController</span> {<br />        <span class="hljs-type">SFSafariViewController</span>(url: url)<br />    }<br />    <br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">updateUIViewController</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">uiViewController</span>: <span class="hljs-type">SFSafariViewController</span>, <span class="hljs-params">context</span>: <span class="hljs-type">Context</span>) {<br />        <br />    }<br />    <span class="hljs-keyword">typealias</span> <span class="hljs-type">UIViewControllerType</span> <span class="hljs-operator">=</span> <span class="hljs-type">SFSafariViewController</span><br />    <span class="hljs-keyword">let</span> url: <span class="hljs-type">URL</span><br />}</span></pre><h3 name="0494" id="0494" class="graf graf--h3 graf-after--pre"><strong class="markup--strong markup--h3-strong">定義預覽 SafariView 的 preview 型別</strong></h3><p name="ba39" id="ba39" class="graf graf--p graf-after--h3">從 Xcode menu 點選 Editor &gt; Create Preview。</p><figure name="ce22" id="ce22" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*HwYJUcZ56WiTP9jA4QxRLA.png" data-width="786" data-height="698" src="https://cdn-images-1.medium.com/max/800/1*HwYJUcZ56WiTP9jA4QxRLA.png"></figure><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="9174" id="9174" class="graf graf--pre graf-after--figure graf--preV2"><span class="pre--content"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Previews_SafariView_Previews</span>: <span class="hljs-title class_">PreviewProvider</span> {<br />    <span class="hljs-keyword">static</span> <span class="hljs-keyword">var</span> previews: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {<br />        <span class="hljs-type">Text</span>(<span class="hljs-string">&quot;Hello, World!&quot;</span>)<br />    }<br />}</span></pre><p name="89a0" id="89a0" class="graf graf--p graf-after--pre">將 previews 的內容從 Text 改成 SafariView。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="13b9" id="13b9" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Previews_SafariView_Previews</span>: <span class="hljs-title class_">PreviewProvider</span> {<br />    <span class="hljs-keyword">static</span> <span class="hljs-keyword">var</span> previews: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {<br />        <span class="hljs-type">SafariView</span>(url: <span class="hljs-type">URL</span>(string: <span class="hljs-string">&quot;https://medium.com/@apppeterpan&quot;</span>)<span class="hljs-operator">!</span>)<br />    }<br />}</span></pre><p name="19a7" id="19a7" class="graf graf--p graf-after--pre">SafariView 宣告了 property url，因此我們在 preview 程式裡生成 SafariView 必須傳入 url，指定網頁的網址，在此我們輸入彼得潘 medium blog 的網址。</p><figure name="f712" id="f712" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*eBzYo9P44CDw9K9gbDP5-w.png" data-width="574" data-height="1100" src="https://cdn-images-1.medium.com/max/800/1*eBzYo9P44CDw9K9gbDP5-w.png"></figure><h3 name="9851" id="9851" class="graf graf--h3 graf-after--figure"><strong class="markup--strong markup--h3-strong">顯示 SafariView</strong></h3><p name="4f99" id="4f99" class="graf graf--p graf-after--h3">現在我們已經可在 SwiftUI 的世界顯示網頁了，因為我們有包裝了 SFSafariViewController，假扮成 SwiftUI view 的 SafariView，讓我們試試顯示彼得潘超想買的 AirPods Pro 網頁吧。</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="php" name="0062" id="0062" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">struct ContentView: View {<br />    @State <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> showWebpage = <span class="hljs-literal">false</span><br />    <span class="hljs-keyword">var</span> body: some View {<br />        <br />        <span class="hljs-title function_ invoke__">Button</span>(<span class="hljs-string">&quot;show webpage&quot;</span>) {<br />            showWebpage = <span class="hljs-literal">true</span><br />        }<br />        .<span class="hljs-title function_ invoke__">sheet</span>(<span class="hljs-attr">isPresented</span>: <span class="hljs-variable">$showWebpage</span>) {<br />            <span class="hljs-title function_ invoke__">SafariView</span>(<span class="hljs-attr">url</span>: <span class="hljs-title function_ invoke__">URL</span>(<span class="hljs-attr">string</span>: <span class="hljs-string">&quot;https://www.apple.com/tw/airpods-pro/&quot;</span>)!)<br />        }<br />    }<br />}</span></pre><figure name="6c85" id="6c85" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*1qAcc3IcA0AFCLKsuhHfug.png" data-width="1192" data-height="1124" src="https://cdn-images-1.medium.com/max/800/1*1qAcc3IcA0AFCLKsuhHfug.png"></figure><h3 name="1f7b" id="1f7b" class="graf graf--h3 graf-after--figure">從 SafariView 呼叫 modifier，調整網頁的大小形狀</h3><p name="64af" id="64af" class="graf graf--p graf-after--h3">SafariView 就是 SwiftUI view，所以它可以呼叫許多 SwiftUI 的 modifier。比方以下例子我們從 SafariView 呼叫 frame &amp; clipShape，指定它的大小和形狀。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="021a" id="021a" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ContentView</span>: <span class="hljs-title class_">View</span> {<br />    <span class="hljs-meta">@State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> showWebpage <span class="hljs-operator">=</span> <span class="hljs-literal">false</span><br />    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {<br />        <br />        <span class="hljs-type">Button</span>(<span class="hljs-string">&quot;show webpage&quot;</span>) {<br />            showWebpage <span class="hljs-operator">=</span> <span class="hljs-literal">true</span><br />        }<br />        .sheet(isPresented: <span class="hljs-variable">$showWebpage</span>) {<br />            <span class="hljs-type">SafariView</span>(url: <span class="hljs-type">URL</span>(string: <span class="hljs-string">&quot;https://www.apple.com/tw/airpods-pro/&quot;</span>)<span class="hljs-operator">!</span>)<br />                .frame(width: <span class="hljs-number">300</span>, height: <span class="hljs-number">300</span>)<br />                .clipShape(<span class="hljs-type">Circle</span>())<br />        }<br />    }<br />}</span></pre><p name="f156" id="f156" class="graf graf--p graf-after--pre">SafariView 變成圓形的網頁了。</p><figure name="3855" id="3855" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*lFapNMRpEeNIkJ1yOAI06Q.png" data-width="574" data-height="1116" src="https://cdn-images-1.medium.com/max/800/1*lFapNMRpEeNIkJ1yOAI06Q.png"></figure><h3 name="5946" id="5946" class="graf graf--h3 graf-after--figure">將 AVPlayerViewController 包裝成 SwiftUI view &amp; 利用 updateUIViewController 更新</h3><p name="2828" id="2828" class="graf graf--p graf-after--h3">有時我們希望 SwiftUI view 生成後還能更新改變，此時正是剛剛失落的 function updateUIViewController 派上用場的時候。接著我們試試將 播放影片的 AVPlayerViewController 包裝成 SwiftUI view，測試點選 button 隨機播放電影的例子。</p><p name="d6f6" id="d6f6" class="graf graf--p graf-after--p">ps: 播放影片建議使用 SwiftUI 的 VideoPlayer 會更容易，在這裡為了說明 updateUIViewController，因此使用 AVPlayerViewController。</p><h3 name="e5dd" id="e5dd" class="graf graf--h3 graf-after--p"><strong class="markup--strong markup--h3-strong">將播放影片的 AVPlayerViewController 包裝成 SwiftUI view</strong></h3><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="2f26" id="2f26" class="graf graf--pre graf-after--h3 graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> SwiftUI<br /><span class="hljs-keyword">import</span> AVKit<br /><br /><span class="hljs-keyword">struct</span> <span class="hljs-title class_">PlayerView</span>: <span class="hljs-title class_">UIViewControllerRepresentable</span> {<br />    <br />    <span class="hljs-keyword">var</span> urlString: <span class="hljs-type">String</span><br />    <br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">makeUIViewController</span>(<span class="hljs-params">context</span>: <span class="hljs-type">Context</span>) -&gt; <span class="hljs-type">AVPlayerViewController</span> {<br />        <span class="hljs-keyword">let</span> controller <span class="hljs-operator">=</span> <span class="hljs-type">AVPlayerViewController</span>()<br />        controller.player <span class="hljs-operator">=</span> <span class="hljs-type">AVPlayer</span>()<br />        <span class="hljs-keyword">return</span> controller<br />    }<br />    <br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">updateUIViewController</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">uiViewController</span>: <span class="hljs-type">AVPlayerViewController</span>, <span class="hljs-params">context</span>: <span class="hljs-type">Context</span>) {<br />        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> url <span class="hljs-operator">=</span> <span class="hljs-type">URL</span>(string: urlString) {<br />            <span class="hljs-keyword">let</span> item <span class="hljs-operator">=</span> <span class="hljs-type">AVPlayerItem</span>(url: url)<br />            uiViewController.player<span class="hljs-operator">?</span>.replaceCurrentItem(with: item)<br />        }<br />        <br />    }<br />    <br />    <span class="hljs-keyword">typealias</span> <span class="hljs-type">UIViewControllerType</span> <span class="hljs-operator">=</span> <span class="hljs-type">AVPlayerViewController</span><br />    <br />    <br />}</span></pre><p name="7eae" id="7eae" class="graf graf--p graf-after--pre">說明:</p><p name="f990" id="f990" class="graf graf--p graf-after--p">我們在 function makeUIViewController 裡產生 AVPlayerViewController &amp; AVPlayer，但實際播放的電影則在 function updateUIViewController 設定。</p><p name="ad51" id="ad51" class="graf graf--p graf-after--p">我們從 urlString 產生的 AVPlayerItem，然後從 updateUIViewController 的參數 uiViewController 讀取 AVPlayerViewController，透過它呼叫 replaceCurrentItem 設定播放的電影。</p><h3 name="e1b9" id="e1b9" class="graf graf--h3 graf-after--p"><strong class="markup--strong markup--h3-strong">利用 PlayerView 播放電影</strong></h3><p name="7c5a" id="7c5a" class="graf graf--p graf-after--h3">假設 array urls 裡儲存彼得潘最愛的約會電影網址，真愛每一天 &amp; 生命中的美好缺憾。</p></div><div class="section-inner sectionLayout--outsetRow" data-paragraph-count="2"><figure name="e60b" id="e60b" class="graf graf--figure graf--layoutOutsetRow is-partialWidth graf-after--p" style="width: 51.336%;"><img class="graf-image" data-image-id="1*d7bUEy6p8W8UziaZEYcvlw.jpeg" data-width="222" data-height="340" src="https://cdn-images-1.medium.com/max/800/1*d7bUEy6p8W8UziaZEYcvlw.jpeg"></figure><figure name="e783" id="e783" class="graf graf--figure graf--layoutOutsetRowContinue is-partialWidth graf-after--figure" style="width: 48.664%;"><img class="graf-image" data-image-id="1*zGDzetdvlC7TwKyMAU58Nw.jpeg" data-width="208" data-height="336" src="https://cdn-images-1.medium.com/max/600/1*zGDzetdvlC7TwKyMAU58Nw.jpeg"></figure></div><div class="section-inner sectionLayout--insetColumn"><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="34a1" id="34a1" class="graf graf--pre graf-after--figure graf--preV2"><span class="pre--content"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ContentView</span>: <span class="hljs-title class_">View</span> {<br />    <br />    <span class="hljs-keyword">let</span> urls <span class="hljs-operator">=</span> [<br />        <span class="hljs-string">&quot;https://video-ssl.itunes.apple.com/itunes-assets/Video111/v4/a8/17/ad/a817adba-e586-ef27-95ff-5039b67b5709/mzvf_8830173944917680013.640x354.h264lc.U.p.m4v&quot;</span>,<br />        <span class="hljs-string">&quot;https://video-ssl.itunes.apple.com/itunes-assets/Video118/v4/e5/e4/9a/e5e49a1e-4c65-48b8-bd46-633daa976710/mzvf_2765762855115952106.640x458.h264lc.U.p.m4v&quot;</span><br />    ]<br />    <br />    <span class="hljs-meta">@State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> urlString <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span><br />    <br />    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {<br />        <span class="hljs-type">VStack</span> {<br />            <span class="hljs-type">PlayerView</span>(urlString: urlString)<br />            <br />            <span class="hljs-type">Button</span>(<span class="hljs-string">&quot;給我一部約會電影&quot;</span>) {<br />                urlString <span class="hljs-operator">=</span> urls.randomElement()<span class="hljs-operator">!</span><br />            }<br />        }<br />    }<br />}<br /><br /><br /><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ContentView_Previews</span>: <span class="hljs-title class_">PreviewProvider</span> {<br />    <span class="hljs-keyword">static</span> <span class="hljs-keyword">var</span> previews: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {<br />        <span class="hljs-type">ContentView</span>()<br />    }<br />}</span></pre><p name="4584" id="4584" class="graf graf--p graf-after--pre">說明:</p><p name="a152" id="a152" class="graf graf--p graf-after--p">點選 button 時將隨機的電影網址存入 urlString，如果 urlString 內容有改變，將觸發畫面更新，呼叫 PlayerView 的 updateUIViewController 改變播放的電影。</p><p name="174e" id="174e" class="graf graf--p graf-after--p">對於 makeUIViewController &amp; updateUIViewController 何時會執行好奇的朋友，可試試加入 print 觀察。當 ContentView 畫面顯示時，它在顯示 PlayerView 時將生成 PlayerView，然後呼叫 makeUIViewController &amp; updateUIViewController。接著當我們點選 button 時，若網址不變，影片不須更新，PlayerView 將不受任何影響。當網址改變，需要顯示另一個影片時，則會呼叫 updateUIViewController。</p><figure name="0e52" id="0e52" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*4Wj1cUG_n0-M_pHx8ABf8Q.png" data-width="560" data-height="1088" src="https://cdn-images-1.medium.com/max/800/1*4Wj1cUG_n0-M_pHx8ABf8Q.png"></figure><h3 name="ae18" id="ae18" class="graf graf--h3 graf-after--figure">包裝 storyboard，xib 或程式設計的 controller 畫面</h3><p name="95fd" id="95fd" class="graf graf--p graf-after--h3">我們除了可以將 iOS SDK 內建的 view controller 包裝成 SwiftUI view，也可以包裝自訂的 view controller。換句話說，我們從 storyboard，xib 或程式設計的 controller 畫面都可以變成 SwiftUI view，加到 SwiftUI App 裡。</p><p name="2fed" id="2fed" class="graf graf--p graf-after--p">比方我們以阿丁同學的七彩彼得潘 App 為例，將她在 storyboard 設計的 view controller 畫面變成 SwiftUI view。</p><div name="481e" id="481e" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E6%95%99%E5%AE%A4/13-%E8%AA%BF%E8%89%B2%E5%A4%A7%E5%B8%AB-%E4%B8%83%E5%BD%A9%E5%BD%BC%E5%BE%97%E6%BD%98-681bbddbaed5" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E6%95%99%E5%AE%A4/13-%E8%AA%BF%E8%89%B2%E5%A4%A7%E5%B8%AB-%E4%B8%83%E5%BD%A9%E5%BD%BC%E5%BE%97%E6%BD%98-681bbddbaed5" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E6%95%99%E5%AE%A4/13-%E8%AA%BF%E8%89%B2%E5%A4%A7%E5%B8%AB-%E4%B8%83%E5%BD%A9%E5%BD%BC%E5%BE%97%E6%BD%98-681bbddbaed5"><strong class="markup--strong markup--mixtapeEmbed-strong">#13 — 調色大師：七彩彼得潘</strong><br><em class="markup--em markup--mixtapeEmbed-em">\\\\\\\\\\\\\\\\\\\\\彼得潘不上課跑去夜店啦!!!//////////////////<br> （造謠）</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E6%95%99%E5%AE%A4/13-%E8%AA%BF%E8%89%B2%E5%A4%A7%E5%B8%AB-%E4%B8%83%E5%BD%A9%E5%BD%BC%E5%BE%97%E6%BD%98-681bbddbaed5" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="bd03a5853a8253d61fe677d9fa6a0ef5" data-thumbnail-img-id="1*oNdU-OVZZ4pxyOGVrt897w.png" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*oNdU-OVZZ4pxyOGVrt897w.png);"></a></div><figure name="39f0" id="39f0" class="graf graf--figure graf-after--mixtapeEmbed"><img class="graf-image" data-image-id="1*DVvdREHr9tFtu8haxDbGpQ.jpeg" data-width="1600" data-height="880" src="https://cdn-images-1.medium.com/max/800/1*DVvdREHr9tFtu8haxDbGpQ.jpeg"></figure><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="046c" id="046c" class="graf graf--pre graf-after--figure graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> SwiftUI<br /><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ViewControllerView</span>: <span class="hljs-title class_">UIViewControllerRepresentable</span> {<br />    <br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">makeUIViewController</span>(<span class="hljs-params">context</span>: <span class="hljs-type">Context</span>) -&gt; <span class="hljs-type">ViewController</span> {<br />        <span class="hljs-type">UIStoryboard</span>(name: <span class="hljs-string">&quot;Main&quot;</span>, bundle: <span class="hljs-literal">nil</span>).instantiateViewController(identifier: <span class="hljs-string">&quot;ViewController&quot;</span>) <span class="hljs-keyword">as!</span> <span class="hljs-type">ViewController</span><br />    }<br />    <br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">updateUIViewController</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">uiViewController</span>: <span class="hljs-type">ViewController</span>, <span class="hljs-params">context</span>: <span class="hljs-type">Context</span>) {<br />    }<br />  <br />    <span class="hljs-keyword">typealias</span> <span class="hljs-type">UIViewControllerType</span> <span class="hljs-operator">=</span> <span class="hljs-type">ViewController</span><br />}</span></pre><p name="1566" id="1566" class="graf graf--p graf-after--pre">說明:</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="6f42" id="6f42" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-type">UIStoryboard</span>(name: <span class="hljs-string">&quot;Main&quot;</span>, bundle: <span class="hljs-literal">nil</span>).instantiateViewController(identifier: <span class="hljs-string">&quot;ViewController&quot;</span>) <span class="hljs-keyword">as!</span> <span class="hljs-type">ViewController</span></span></pre><p name="7d10" id="7d10" class="graf graf--p graf-after--pre">利用 storyboard 的 instantiateViewController(withIdentifier:) 生成 controller，傳入 controller 的 ID 指定想生成的 controller。</p><p name="1525" id="1525" class="graf graf--p graf-after--p">controller ID 的設定方法如下:</p><ul class="postList"><li name="8744" id="8744" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">點選 storyboard 裡的 controller。</strong></li></ul><figure name="da46" id="da46" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*49OW0YZTxhlkjhX7jmVQvQ.jpeg" data-width="1112" data-height="900" src="https://cdn-images-1.medium.com/max/800/1*49OW0YZTxhlkjhX7jmVQvQ.jpeg"></figure><div name="1c36" id="1c36" class="graf graf--mixtapeEmbed graf-after--figure"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%A6%82%E4%BD%95%E9%BB%9E%E9%81%B8-storyboard-%E8%A3%A1%E7%9A%84-view-controller-%E7%89%A9%E4%BB%B6-76aa0be6205f" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%A6%82%E4%BD%95%E9%BB%9E%E9%81%B8-storyboard-%E8%A3%A1%E7%9A%84-view-controller-%E7%89%A9%E4%BB%B6-76aa0be6205f" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%A6%82%E4%BD%95%E9%BB%9E%E9%81%B8-storyboard-%E8%A3%A1%E7%9A%84-view-controller-%E7%89%A9%E4%BB%B6-76aa0be6205f"><strong class="markup--strong markup--mixtapeEmbed-strong">如何點選 storyboard 裡的 view controller 物件</strong><br><em class="markup--em markup--mixtapeEmbed-em">世界上每個東西都有它的顏色，在 storyboard 裡看到黃色的東西，有很大的可能是 view controller 物件。</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%A6%82%E4%BD%95%E9%BB%9E%E9%81%B8-storyboard-%E8%A3%A1%E7%9A%84-view-controller-%E7%89%A9%E4%BB%B6-76aa0be6205f" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="0077b4b54b5efcb7afa4f90b46ac85c1" data-thumbnail-img-id="1*ytMhJ0o9nO1dbS0mHM7-oA.jpeg" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*ytMhJ0o9nO1dbS0mHM7-oA.jpeg);"></a></div><ul class="postList"><li name="c81a" id="c81a" class="graf graf--li graf-after--mixtapeEmbed"><strong class="markup--strong markup--li-strong">從 Storyboard ID 欄位設定 controller 的 ID。</strong></li></ul><p name="4398" id="4398" class="graf graf--p graf-after--li">切換到 Identity inspector 頁面，從 Storyboard ID 欄位設定 controller 的 ID。此 ID 可自由取名，只要別跟其它 controller 的 ID 同名即可，通常我們會讓 Storyboard ID 跟 controller 的類別同名。</p><figure name="42c4" id="42c4" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*s-Hcim81fX67Din6K7GvgQ.jpeg" data-width="528" data-height="486" src="https://cdn-images-1.medium.com/max/800/1*s-Hcim81fX67Din6K7GvgQ.jpeg"></figure><h3 name="25dc" id="25dc" class="graf graf--h3 graf-after--figure">One more thing, Coordinator</h3><p name="a546" id="a546" class="graf graf--p graf-after--h3">開發 SwiftUI App 時，我們較少用到 delegate &amp; data source，不過傳統的 UIKit 元件卻常依靠 delegate &amp; data source 實現一些功能，比方 UIImagePickerController 利用 delegate 讀取拍攝的照片。</p><p name="58ea" id="58ea" class="graf graf--p graf-after--p graf--trailing">類似 delegate &amp; data source 這類進階的功能必須依靠 coordinator 實現，有興趣的朋友可進一步查詢相關介紹，彼得潘未來也會再撰寫文章說明。</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@apppeterpan" class="p-author h-card">彼得潘的 iOS App Neverland</a> on <a href="https://medium.com/p/1a79353ea3aa"><time class="dt-published" datetime="2020-01-28T15:18:55.751Z">January 28, 2020</time></a>.</p><p><a href="https://medium.com/@apppeterpan/%E5%9C%A8-swiftui-app-%E5%8A%A0%E5%85%A5-view-controller-1a79353ea3aa" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on November 16, 2025.</p></footer></article></body></html>