<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>class &amp; struct 的記憶體位置和大小</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">class &amp; struct 的記憶體位置和大小</h1>
</header>
<section data-field="subtitle" class="p-summary">
在 Swift 裡，class 是 reference type，struct 是 value type，他們有個很大的差別，發生在我們利用 = 指定內容的時候。例如以下例子，當 Baby 是 refernece type，cuteBaby2 = cuteBaby1…
</section>
<section data-field="body" class="e-content">
<section name="2ee1" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="6dbe" id="6dbe" class="graf graf--h3 graf--leading graf--title">class &amp; struct 的記憶體位置和大小</h3><p name="b464" id="b464" class="graf graf--p graf-after--h3">在 Swift 裡，class 是 reference type，struct 是 value type，他們有個很大的差別，發生在我們利用 = 指定內容的時候。例如以下例子，當 Baby 是 refernece type，cuteBaby2 = cuteBaby1 時，兩個變數將儲存同一個物件的記憶體位置，指到同一個寶寶。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="850f" id="850f" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Baby</span> {<br />   <span class="hljs-keyword">var</span> height <span class="hljs-operator">=</span> <span class="hljs-number">60</span><br />   <span class="hljs-keyword">var</span> weight <span class="hljs-operator">=</span> <span class="hljs-number">10.5</span><br />}<br /><br /><span class="hljs-keyword">var</span> cuteBaby1 <span class="hljs-operator">=</span> <span class="hljs-type">Baby</span>()<br /><span class="hljs-keyword">var</span> cuteBaby2 <span class="hljs-operator">=</span> cuteBaby1</span></pre><figure name="5430" id="5430" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*OV4HlnRLX-tBdt9uVBJfKg.jpeg" data-width="1946" data-height="1154" src="https://cdn-images-1.medium.com/max/800/1*OV4HlnRLX-tBdt9uVBJfKg.jpeg"></figure><p name="b597" id="b597" class="graf graf--p graf-after--figure">但是當 Baby 是 value type，cuteBaby2 = cuteBaby1 時，將會複製產生另一個寶寶，cuteBaby1 和 cuteBaby2 分別儲存不同的寶寶。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="6912" id="6912" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Baby</span> {<br />   <span class="hljs-keyword">var</span> height <span class="hljs-operator">=</span> <span class="hljs-number">60</span><br />   <span class="hljs-keyword">var</span> weight <span class="hljs-operator">=</span> <span class="hljs-number">10.5</span><br />}<br /><br /><span class="hljs-keyword">var</span> cuteBaby1 <span class="hljs-operator">=</span> <span class="hljs-type">Baby</span>()<br /><span class="hljs-keyword">var</span> cuteBaby2 <span class="hljs-operator">=</span> cuteBaby1</span></pre><figure name="4d1a" id="4d1a" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*qh33z1n5rBkqV7pCS-980w.jpeg" data-width="1162" data-height="596" src="https://cdn-images-1.medium.com/max/800/1*qh33z1n5rBkqV7pCS-980w.jpeg"></figure><p name="e530" id="e530" class="graf graf--p graf-after--figure">接下來我們將實際印出它們的記憶體位置和大小，了解他們的差異。</p><blockquote name="3e37" id="3e37" class="graf graf--blockquote graf-after--p">印出物件的記憶體位置</blockquote><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="ae8c" id="ae8c" class="graf graf--pre graf-after--blockquote graf--preV2"><span class="pre--content"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Baby</span> {<br />   <span class="hljs-keyword">var</span> height <span class="hljs-operator">=</span> <span class="hljs-number">60</span><br />   <span class="hljs-keyword">var</span> weight <span class="hljs-operator">=</span> <span class="hljs-number">10</span><br />}<br /><br /><span class="hljs-keyword">var</span> cuteBaby1 <span class="hljs-operator">=</span> <span class="hljs-type">Baby</span>()<br /><span class="hljs-keyword">var</span> cuteBaby2 <span class="hljs-operator">=</span> cuteBaby1<br /><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;cuteBaby1&quot;</span>, <span class="hljs-type">ObjectIdentifier</span>(cuteBaby1))<br /><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;cuteBaby2&quot;</span>, <span class="hljs-type">ObjectIdentifier</span>(cuteBaby2))</span></pre><p name="1c1f" id="1c1f" class="graf graf--p graf-after--pre">利用 ObjectIdentifier 可取得變數(常數)儲存的物件記憶體位置。</p><blockquote name="6e8b" id="6e8b" class="graf graf--blockquote graf-after--p">結果</blockquote><figure name="6e10" id="6e10" class="graf graf--figure graf-after--blockquote"><img class="graf-image" data-image-id="1*333O-FfMuaj273bSK_Y2Dg.jpeg" data-width="972" data-height="194" src="https://cdn-images-1.medium.com/max/800/1*333O-FfMuaj273bSK_Y2Dg.jpeg"></figure><p name="de2c" id="de2c" class="graf graf--p graf-after--figure">果然，cuteBaby1 和 cuteBaby 2 儲存的物件記憶體位置是一樣的 !</p><blockquote name="4efb" id="4efb" class="graf graf--blockquote graf-after--p">印出 class 的大小</blockquote><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="3ad4" id="3ad4" class="graf graf--pre graf-after--blockquote graf--preV2"><span class="pre--content"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Baby</span> {<br />   <span class="hljs-keyword">var</span> height <span class="hljs-operator">=</span> <span class="hljs-number">60</span><br />   <span class="hljs-keyword">var</span> weight <span class="hljs-operator">=</span> <span class="hljs-number">10</span><br />   <span class="hljs-keyword">var</span> age <span class="hljs-operator">=</span> <span class="hljs-number">1</span><br />}<br /><br /><span class="hljs-type">MemoryLayout</span>&lt;<span class="hljs-type">Baby</span>&gt;.size</span></pre><p name="1495" id="1495" class="graf graf--p graf-after--pre">利用 MemoryLayout 可取得型別佔的記憶體大小。</p><blockquote name="4265" id="4265" class="graf graf--blockquote graf-after--p">結果</blockquote><figure name="28d9" id="28d9" class="graf graf--figure graf-after--blockquote"><img class="graf-image" data-image-id="1*BEy105I17sxXpi5butNKDw.jpeg" data-width="668" data-height="514" src="https://cdn-images-1.medium.com/max/800/1*BEy105I17sxXpi5butNKDw.jpeg"></figure><p name="5a40" id="5a40" class="graf graf--p graf-after--figure">因為 class 是 reference type，儲存的是物件的記憶體位置，因此不管 class 裡有多少東西，我們得到的數字都會是一樣的，儲存記憶體位置只需要 8 bytes。</p><blockquote name="2886" id="2886" class="graf graf--blockquote graf-after--p">印出物件真正的大小</blockquote><p name="bd40" id="bd40" class="graf graf--p graf-after--blockquote">那有沒有辦法取得物件真正的大小呢 ? 其實是有的，透過 function class_getInstanceSize 即可取得。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="0155" id="0155" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> Foundation<br /><br /><span class="hljs-keyword">class</span> <span class="hljs-title class_">Baby</span> {<br />   <span class="hljs-keyword">var</span> height <span class="hljs-operator">=</span> <span class="hljs-number">60</span><br />   <span class="hljs-keyword">var</span> weight <span class="hljs-operator">=</span> <span class="hljs-number">10</span><br />   <span class="hljs-keyword">var</span> age <span class="hljs-operator">=</span> <span class="hljs-number">1</span><br />}<br /><br />class_getInstanceSize(<span class="hljs-type">Baby</span>.<span class="hljs-keyword">self</span>)</span></pre><blockquote name="d6d9" id="d6d9" class="graf graf--blockquote graf-after--pre">結果</blockquote><figure name="8ecc" id="8ecc" class="graf graf--figure graf-after--blockquote"><img class="graf-image" data-image-id="1*m4SIce1cYzOl1OdMQaOUNg.jpeg" data-width="842" data-height="212" src="https://cdn-images-1.medium.com/max/800/1*m4SIce1cYzOl1OdMQaOUNg.jpeg"></figure><p name="6a97" id="6a97" class="graf graf--p graf-after--figure">剛剛的例子，我們印出的大小會是 40。我們有三個整數型別的 property，而整數型別需要 8 bytes，因此 8 * 3 應該是 24。那為什麼結果會是 40 呢 ? 因為 Swift 的 class 是建構在 Objective-C 的 class 之上，所以還要加上 Objective-C class 16 bytes 的 metadata。</p><blockquote name="38cb" id="38cb" class="graf graf--blockquote graf-after--p">印出 struct 的大小</blockquote><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="32de" id="32de" class="graf graf--pre graf-after--blockquote graf--preV2"><span class="pre--content"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Baby</span> {<br />   <span class="hljs-keyword">var</span> height <span class="hljs-operator">=</span> <span class="hljs-number">60</span><br />   <span class="hljs-keyword">var</span> weight <span class="hljs-operator">=</span> <span class="hljs-number">10</span><br />   <span class="hljs-keyword">var</span> age <span class="hljs-operator">=</span> <span class="hljs-number">1</span><br />}<br /><br /><span class="hljs-type">MemoryLayout</span>&lt;<span class="hljs-type">Baby</span>&gt;.size</span></pre><blockquote name="96da" id="96da" class="graf graf--blockquote graf-after--pre">結果</blockquote><figure name="f7a6" id="f7a6" class="graf graf--figure graf-after--blockquote"><img class="graf-image" data-image-id="1*AwK1CVtsjA9DFGcEQCdyDA.jpeg" data-width="658" data-height="540" src="https://cdn-images-1.medium.com/max/800/1*AwK1CVtsjA9DFGcEQCdyDA.jpeg"></figure><p name="576b" id="576b" class="graf graf--p graf-after--figure">相反的， struct 是 value type，資料直接存在裡面，因此它的記憶體大小和 { } 裡宣告的東西成正比。在 Baby 例子裡，我們有三個整數型別的 property，因此 Baby 的大小是 24 bytes。</p><blockquote name="fb4a" id="fb4a" class="graf graf--blockquote graf-after--p">印出變數(常數)的記憶體位置</blockquote><p name="241a" id="241a" class="graf graf--p graf-after--blockquote">變數和常數都會佔據記憶體位置。不管是 class 還是 struct，你都可透過 withUnsafePointer 取得它的記憶體位置。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="e31a" id="e31a" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Baby</span> {<br />   <span class="hljs-keyword">var</span> height <span class="hljs-operator">=</span> <span class="hljs-number">60</span><br />   <span class="hljs-keyword">var</span> weight <span class="hljs-operator">=</span> <span class="hljs-number">10.5</span><br />}<br /><br /><span class="hljs-keyword">var</span> cuteBaby1 <span class="hljs-operator">=</span> <span class="hljs-type">Baby</span>()<br /><span class="hljs-built_in">withUnsafePointer</span>(to: <span class="hljs-operator">&amp;</span>cuteBaby1) {<br />   <span class="hljs-built_in">print</span>(<span class="hljs-variable">$0</span>)<br />}</span></pre><p name="c186" id="c186" class="graf graf--p graf-after--pre">文章內容為彼得潘的 Swift 程式設計入門新增章節 ，<strong class="markup--strong markup--p-strong">12–7 class &amp; struct 的記憶體位置和大小。</strong></p><div name="38d8" id="38d8" class="graf graf--mixtapeEmbed graf-after--p graf--trailing"><a href="http://swiftbook.strikingly.com" data-href="http://swiftbook.strikingly.com" class="markup--anchor markup--mixtapeEmbed-anchor" title="http://swiftbook.strikingly.com"><strong class="markup--strong markup--mixtapeEmbed-strong">彼得潘的 Swift 程式設計入門</strong><br><em class="markup--em markup--mixtapeEmbed-em">本書搭配全新的 Swift 4、Xcode 9 和 iOS 11 SDK，以各種生動有趣的實例帶領讀者由淺入深認識 Swift，並在 Xcode 全新打造的練功樂園 playground 盡情敞佯，學習關於 Swift…</em>swiftbook.strikingly.com</a><a href="http://swiftbook.strikingly.com" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="fc2e5dddacd017ff26e6a0f6a524c76a" data-thumbnail-img-id="0*RKtNMESxkyFrdrZO." style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*RKtNMESxkyFrdrZO.);"></a></div></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@apppeterpan" class="p-author h-card">彼得潘的 iOS App Neverland</a> on <a href="https://medium.com/p/8ed0f1aaf051"><time class="dt-published" datetime="2018-01-30T07:07:01.734Z">January 30, 2018</time></a>.</p><p><a href="https://medium.com/@apppeterpan/%E5%8F%96%E5%BE%97-swift-%E7%89%A9%E4%BB%B6%E7%9A%84%E8%A8%98%E6%86%B6%E9%AB%94%E4%BD%8D%E7%BD%AE-8ed0f1aaf051" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on November 16, 2025.</p></footer></article></body></html>