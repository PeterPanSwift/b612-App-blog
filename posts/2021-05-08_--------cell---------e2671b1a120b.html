<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>防止重覆利用的 cell 顯示之前的照片</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">防止重覆利用的 cell 顯示之前的照片</h1>
</header>
<section data-field="subtitle" class="p-summary">
當我們使用 table view 或 collection view 時，cell 重覆利用的特性可以帶給更好的效能。不過當 cell 上顯示的照片是非同步抓取，比方從網路抓取，或是利用 PHCachingImageManager…
</section>
<section data-field="body" class="e-content">
<section name="2521" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="eea4" id="eea4" class="graf graf--h3 graf--leading graf--title">防止重覆利用的 cell 顯示之前的照片</h3><p name="7aef" id="7aef" class="graf graf--p graf-after--h3">當我們使用 table view 或 collection view 時，cell 重覆利用的特性可以帶給更好的效能。不過當 cell 上顯示的照片是非同步抓取，比方從網路抓取，或是利用 PHCachingImageManager 從使用者的相簿抓取時，需要特別注意照片顯示的問題。</p><p name="aada" id="aada" class="graf graf--p graf-after--p">當照片是非同步抓取時，由於照片抓取需要時間，使用者將看到 cell 先顯示之前的圖片，然後才更新成正確的圖片。為了防止重覆利用的 cell 顯示之前的照片，我們最好在抓到照片前，先讓它顯示預設的照片，或是將它清空。</p><p name="b962" id="b962" class="graf graf--p graf-after--p">那麼設定預設照片，或是將照片清空的程式，該寫在哪裡呢？有以下兩種做法。</p><h3 name="e6a9" id="e6a9" class="graf graf--h3 graf-after--p">方法 1: 在 dequeueReusableCell 得到 cell 後先將 cell 的照片清空或設成預設照片</h3><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="c9f2" id="c9f2" class="graf graf--pre graf-after--h3 graf--preV2"><span class="pre--content"><span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">tableView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">tableView</span>: <span class="hljs-type">UITableView</span>, <span class="hljs-params">cellForRowAt</span> <span class="hljs-params">indexPath</span>: <span class="hljs-type">IndexPath</span>) -&gt; <span class="hljs-type">UITableViewCell</span> {<br />        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> cell <span class="hljs-operator">=</span> tableView.dequeueReusableCell(withIdentifier: <span class="hljs-string">&quot;<span class="hljs-subst">\(MovieTableViewCell.<span class="hljs-keyword">self</span>)</span>&quot;</span>, for: indexPath) <span class="hljs-keyword">as?</span> <span class="hljs-type">MovieTableViewCell</span> <span class="hljs-keyword">else</span> {<br />            <span class="hljs-keyword">return</span> <span class="hljs-type">UITableViewCell</span>()<br />        }<br />        cell.coverImageView.image <span class="hljs-operator">=</span> <span class="hljs-literal">nil</span><br />        <br />        <span class="hljs-comment">// fetch image</span><br />        <span class="hljs-comment">// set coverImageView after get image </span><br />        <br />        <span class="hljs-keyword">return</span> cell<br />}</span></pre><h3 name="a69a" id="a69a" class="graf graf--h3 graf-after--pre">方法 2: 在 cell 的 prepareForReuse 裡將照片清空或設成預設照片</h3><p name="3595" id="3595" class="graf graf--p graf-after--h3">在 cell 被重覆利用前，cell 的 function prepareForReuse 將被觸發，我們可在其中設定 cell 的預設狀態。</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="5bf4" id="5bf4" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MovieTableViewCell</span>: <span class="hljs-title class_">UITableViewCell</span> {<br />    <br />    <span class="hljs-keyword">@IBOutlet</span> <span class="hljs-keyword">var</span> coverImageView: <span class="hljs-type">UIImageView</span>!<br /><br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">prepareForReuse</span>() {<br />        <span class="hljs-keyword">super</span>.prepareForReuse()<br />        coverImageView.image <span class="hljs-operator">=</span> <span class="hljs-literal">nil</span><br />    }<br />}</span></pre><div name="313d" id="313d" class="graf graf--mixtapeEmbed graf-after--pre"><a href="https://developer.apple.com/documentation/uikit/uitableviewcell/1623223-prepareforreuse" data-href="https://developer.apple.com/documentation/uikit/uitableviewcell/1623223-prepareforreuse" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/uikit/uitableviewcell/1623223-prepareforreuse"><strong class="markup--strong markup--mixtapeEmbed-strong">prepareForReuse() | Apple Developer Documentation</strong><br><em class="markup--em markup--mixtapeEmbed-em">Prepares a reusable cell for reuse by the table view&#39;s delegate.</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/uikit/uitableviewcell/1623223-prepareforreuse" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="83f0bd0a1ca2504d4eda22882b2ef461" data-thumbnail-img-id="0*RmD7L_fIJqjBDA2s" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*RmD7L_fIJqjBDA2s);"></a></div><h3 name="c532" id="c532" class="graf graf--h3 graf-after--mixtapeEmbed">參考範例</h3><p name="1d74" id="1d74" class="graf graf--p graf-after--h3">Apple 的 Browsing and Modifying Photo Albums</p><div name="0167" id="0167" class="graf graf--mixtapeEmbed graf-after--p graf--trailing"><a href="https://developer.apple.com/documentation/photokit/browsing_and_modifying_photo_albums" data-href="https://developer.apple.com/documentation/photokit/browsing_and_modifying_photo_albums" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/photokit/browsing_and_modifying_photo_albums"><strong class="markup--strong markup--mixtapeEmbed-strong">Browsing and Modifying Photo Albums | Apple Developer Documentation</strong><br><em class="markup--em markup--mixtapeEmbed-em">Help users organize their photos into albums and browse photo collections in a grid-based layout using PhotoKit.</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/photokit/browsing_and_modifying_photo_albums" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="d7e395565b31d41bb6b529c24cd9c7c2" data-thumbnail-img-id="0*U3-Ff1RTMcSlppUB" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*U3-Ff1RTMcSlppUB);"></a></div></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@apppeterpan" class="p-author h-card">彼得潘的 iOS App Neverland</a> on <a href="https://medium.com/p/e2671b1a120b"><time class="dt-published" datetime="2021-05-08T13:49:54.213Z">May 8, 2021</time></a>.</p><p><a href="https://medium.com/@apppeterpan/%E9%98%B2%E6%AD%A2%E9%87%8D%E8%A6%86%E5%88%A9%E7%94%A8%E7%9A%84-cell-%E9%A1%AF%E7%A4%BA%E4%B9%8B%E5%89%8D%E7%9A%84%E7%85%A7%E7%89%87-e2671b1a120b" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on September 17, 2025.</p></footer></article></body></html>