<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>在 SwiftUI App 加入 UIKit View，比方網頁</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">在 SwiftUI App 加入 UIKit View，比方網頁</h1>
</header>
<section data-field="subtitle" class="p-summary">
SwiftUI 有很多很棒很炫的功能，幫助我們更容易地開發 iOS App，不過因為它才剛出生，所以一些傳統 iOS App 常用的 UI 元件還不支援，比方它缺少以下這些元件:
</section>
<section data-field="body" class="e-content">
<section name="f5af" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="6459" id="6459" class="graf graf--h3 graf--leading graf--title">在 SwiftUI App 加入 UIKit View，比方網頁</h3><figure name="6a86" id="6a86" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="1*UNgO9T_XpHisTW6G565EZg.jpeg" data-width="1650" data-height="1236" src="https://cdn-images-1.medium.com/max/800/1*UNgO9T_XpHisTW6G565EZg.jpeg"></figure><p name="cbc8" id="cbc8" class="graf graf--p graf-after--figure">SwiftUI 有很多很棒很炫的功能，幫助我們更容易地開發 iOS App，不過因為它才剛出生，所以一些傳統 iOS App 常用的 UI 元件還不支援，比方它缺少像 WebKit WKWebView 一樣顯示網頁的元件。</p><p name="e32b" id="e32b" class="graf graf--p graf-after--p">所以 SwiftUI App 要放棄網頁功能了嗎 ? 別擔心，我們可以將傳統的 UI 元件包裝成 SwiftUI view，讓它假裝成 SwiftUI view，混入 SwiftUI 的世界裡，就像最近彼得潘戴上黑武士的頭盔闖進星際大戰的世界。</p><figure name="8241" id="8241" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*0EpNfZOYy0tFsOeLIBsYBw.jpeg" data-width="720" data-height="960" src="https://cdn-images-1.medium.com/max/800/1*0EpNfZOYy0tFsOeLIBsYBw.jpeg"></figure><p name="3c43" id="3c43" class="graf graf--p graf-after--figure">為了將傳統的 UI 元件包裝成 SwiftUI view，我們必須以 struct 定義 SwiftUI view 的型別，讓它遵從 protocol <code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">UIViewRepresentable</strong></code>，然後定義 protocol UIViewRepresentable 的相關 function，在裡面產生傳統的 UI 元件。</p><h3 name="6d6c" id="6d6c" class="graf graf--h3 graf-after--p">將顯示網頁的 WKWebView 包裝成 SwiftUI view</h3><p name="036c" id="036c" class="graf graf--p graf-after--h3">接下來讓我們以顯示網頁的 WKWebView 為例，將它變成能在 SwiftUI App 顯示的 SwiftUI view。</p><h3 name="47e1" id="47e1" class="graf graf--h3 graf-after--p"><strong class="markup--strong markup--h3-strong">以 struct 定義包裝 UI 元件的 SwiftUI view 型別，遵從 protocol UIViewRepresentable</strong></h3><p name="b1d6" id="b1d6" class="graf graf--p graf-after--h3">按 cmd + n 新增 Swift File。</p><figure name="5fa4" id="5fa4" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*FETpLhAqos6YFpKYP0fTmw.png" data-width="1420" data-height="1028" src="https://cdn-images-1.medium.com/max/800/1*FETpLhAqos6YFpKYP0fTmw.png"></figure><p name="c2aa" id="c2aa" class="graf graf--p graf-after--figure">將包裝 WKWebView 的 SwiftUI View 取名為 WebView。</p><figure name="1608" id="1608" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*aNpJqYie_BsNEvk6Bd4fHg.png" data-width="1604" data-height="936" src="https://cdn-images-1.medium.com/max/800/1*aNpJqYie_BsNEvk6Bd4fHg.png"></figure><p name="2f0d" id="2f0d" class="graf graf--p graf-after--figure">import SwiftUI &amp; WebKit(因為待會將用到 WKWebView)，以 struct 定義遵從 protocol UIViewRepresentable 的 WebView。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="3a93" id="3a93" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> SwiftUI<br /><span class="hljs-keyword">import</span> WebKit<br /><br /><span class="hljs-keyword">struct</span> <span class="hljs-title class_">WebView</span>: <span class="hljs-title class_">UIViewRepresentable</span> {<br />    <br />}</span></pre><p name="a56a" id="a56a" class="graf graf--p graf-after--pre">UIViewRepresentable 的 representable 是代表的意思，遵從 protocol UIViewRepresentable 暗示此 struct 定義的型別是一種包含 UIView 元件的 SwiftUI view，所以它可以包裝 UICollectionView，WKWebView，MKMapView 等 UI 元件，待會我們將用它包裝 WKWebView。</p><h3 name="3654" id="3654" class="graf graf--h3 graf-after--p"><strong class="markup--strong markup--h3-strong">產生遵從 protocol UIViewRepresentable 需定義的相關 function</strong></h3><p name="4d06" id="4d06" class="graf graf--p graf-after--h3">由於我們尚未定義 protocol UIViewRepresentable 的相關 function，此時會產生紅色錯誤。</p><figure name="61fe" id="61fe" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*_ieuLhSWuqxQX1Dq6ZbsMw.jpeg" data-width="1814" data-height="460" src="https://cdn-images-1.medium.com/max/800/1*_ieuLhSWuqxQX1Dq6ZbsMw.jpeg"></figure><p name="d9f9" id="d9f9" class="graf graf--p graf-after--figure">點選 Fix 後，Xcode 會幫我們加入 <code class="markup--code markup--p-code">typealias UIViewType =</code> ，請在 = 後補上 SwiftUI view 想呈現的畫面的型別。</p><figure name="a75b" id="a75b" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*S5J4cqqU2MH3_XrnPZ9uSg.jpeg" data-width="1086" data-height="226" src="https://cdn-images-1.medium.com/max/800/1*S5J4cqqU2MH3_XrnPZ9uSg.jpeg"></figure><p name="a24e" id="a24e" class="graf graf--p graf-after--figure">在此我們填入 WKWebView。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="2d71" id="2d71" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">typealias</span> <span class="hljs-type">UIViewType</span> <span class="hljs-operator">=</span> <span class="hljs-type">WKWebView</span></span></pre><p name="abdb" id="abdb" class="graf graf--p graf-after--pre">此時還是會有紅色錯誤，因為 protocol UIViewRepresentable 的 function 還未定義。請耐心地再按一次 Fix 修正。</p><figure name="c390" id="c390" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*U00wQSBlK45BsUD2-nYEIg.jpeg" data-width="1828" data-height="372" src="https://cdn-images-1.medium.com/max/800/1*U00wQSBlK45BsUD2-nYEIg.jpeg"></figure><p name="adc7" id="adc7" class="graf graf--p graf-after--figure">Xcode 將幫我們補上遵從 protocol UIViewRepresentable 需定義的兩個 function，makeUIView(context:) &amp; updateUIView(_:context:)。</p><figure name="1834" id="1834" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*f6SVHw596qZOr9HG_WSfyQ.jpeg" data-width="1198" data-height="612" src="https://cdn-images-1.medium.com/max/800/1*f6SVHw596qZOr9HG_WSfyQ.jpeg"></figure><p name="8061" id="8061" class="graf graf--p graf-after--figure">makeUIView(context:) 回傳的元件即為 WebView 顯示的畫面。由於我們剛剛在 typealias 裡填入 WKWebView，因此 Xcode 知道 makeUIView(context:) 要回傳的型別是 WKWebView。</p><h3 name="d43f" id="d43f" class="graf graf--h3 graf-after--p"><strong class="markup--strong markup--h3-strong">定義 function makeUIView &amp; updateUIView</strong></h3><p name="25e7" id="25e7" class="graf graf--p graf-after--h3">我們須在 makeUIView(context:) 裡回傳型別 WKWebView 的物件， 因此我們在裡面產生 WKWebView 物件，設定它載入彼得潘最愛的書小王子的網頁。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="adbe" id="adbe" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">makeUIView</span>(<span class="hljs-params">context</span>: <span class="hljs-type">Context</span>) -&gt; <span class="hljs-type">WKWebView</span> {<br />        <span class="hljs-keyword">let</span> webView <span class="hljs-operator">=</span> <span class="hljs-type">WKWebView</span>()<br />        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> url <span class="hljs-operator">=</span> <span class="hljs-type">URL</span>(string: <span class="hljs-string">&quot;https://www.thelittleprince.com&quot;</span>) {<br />            <span class="hljs-keyword">let</span> request <span class="hljs-operator">=</span> <span class="hljs-type">URLRequest</span>(url: url)<br />            webView.load(request)<br />        }<br />        <span class="hljs-keyword">return</span> webView<br />}</span></pre><figure name="99b6" id="99b6" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*Hv0SnFpHDaYFu-cyVBfXQg.jpeg" data-width="2338" data-height="1258" src="https://cdn-images-1.medium.com/max/800/1*Hv0SnFpHDaYFu-cyVBfXQg.jpeg"></figure><p name="af57" id="af57" class="graf graf--p graf-after--figure">那麼另一個 updateUIView(_:context:) function 呢 ? 它將在 SwiftUI view 畫面更新時被呼叫，不過現在我們先目標固定顯示小王子，看它千遍也不厭，所以 updateUIView(_:context:) 不需寫任何程式。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="db6e" id="db6e" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">updateUIView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">uiView</span>: <span class="hljs-type">WKWebView</span>, <span class="hljs-params">context</span>: <span class="hljs-type">Context</span>) {<br /><br />}</span></pre><h3 name="9e6b" id="9e6b" class="graf graf--h3 graf-after--pre"><strong class="markup--strong markup--h3-strong">定義預覽 WebView 的 preview 型別</strong></h3><p name="d220" id="d220" class="graf graf--p graf-after--h3">從 Xcode menu 點選 Editor &gt; Create Preview。</p><figure name="fdc1" id="fdc1" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*HwYJUcZ56WiTP9jA4QxRLA.png" data-width="786" data-height="698" src="https://cdn-images-1.medium.com/max/800/1*HwYJUcZ56WiTP9jA4QxRLA.png"></figure><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="72c5" id="72c5" class="graf graf--pre graf-after--figure graf--preV2"><span class="pre--content"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Previews_WebView_Previews</span>: <span class="hljs-title class_">PreviewProvider</span> {<br />    <span class="hljs-keyword">static</span> <span class="hljs-keyword">var</span> previews: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {<br />        <span class="hljs-type">Text</span>(<span class="hljs-string">&quot;Hello, World!&quot;</span>)<br />    }<br />}</span></pre><p name="762a" id="762a" class="graf graf--p graf-after--pre">將 previews 的內容從 Text 改成 WebView。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="9c75" id="9c75" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Previews_WebView_Previews</span>: <span class="hljs-title class_">PreviewProvider</span> {<br />    <span class="hljs-keyword">static</span> <span class="hljs-keyword">var</span> previews: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {<br />        <span class="hljs-type">WebView</span>()<br />    }<br />}</span></pre><p name="ef50" id="ef50" class="graf graf--p graf-after--pre">由於網頁要連網抓資料，因此我們要點選三角形的 live preview 按鈕執行後才能顯示網頁。</p><figure name="2aa7" id="2aa7" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*jZSroaT36X_xgMt1u1eCOw.png" data-width="560" data-height="1104" src="https://cdn-images-1.medium.com/max/800/1*jZSroaT36X_xgMt1u1eCOw.png"></figure><h3 name="434c" id="434c" class="graf graf--h3 graf-after--figure"><strong class="markup--strong markup--h3-strong">顯示 WebView</strong></h3><p name="d77e" id="d77e" class="graf graf--p graf-after--h3">現在我們已經可在 SwiftUI 的世界顯示網頁了，因為我們有包裝了 WKWebView，假扮成 SwiftUI view 的 WebView。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="dc5c" id="dc5c" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ContentView</span>: <span class="hljs-title class_">View</span> {<br />    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {<br />       <span class="hljs-type">WebView</span>()<br />    }<br />}</span></pre><figure name="3e8a" id="3e8a" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*jZSroaT36X_xgMt1u1eCOw.png" data-width="560" data-height="1104" src="https://cdn-images-1.medium.com/max/800/1*jZSroaT36X_xgMt1u1eCOw.png"></figure><h3 name="e301" id="e301" class="graf graf--h3 graf-after--figure">從 WebView 呼叫 modifier，調整網頁的大小形狀</h3><p name="3ffe" id="3ffe" class="graf graf--p graf-after--h3">剛剛我們的 ContentView 只有顯示 WebView，因此它霸氣地佔滿整個螢幕。我們也可以控制它的大小，因為 WebView 就是 SwiftUI view，所以它可以呼叫許多 SwiftUI 的 modifier。</p><p name="ff3a" id="ff3a" class="graf graf--p graf-after--p">比方以下例子我們在 VStack 裡容納 Image &amp; WebView，將 WebView 的高度指定為 300。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="1fa4" id="1fa4" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ContentView</span>: <span class="hljs-title class_">View</span> {<br />    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {<br />        <span class="hljs-type">VStack</span> {<br />            <span class="hljs-type">Image</span>(systemName: <span class="hljs-string">&quot;star&quot;</span>)<br />                .resizable()<br />                .scaledToFit()<br />            <span class="hljs-type">WebView</span>()<br />                .frame(height: <span class="hljs-number">300</span>)<br />        }<br />    }<br />}</span></pre><figure name="5c84" id="5c84" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*6hAS21qjPR0b7e_vIDEbCQ.png" data-width="558" data-height="1104" src="https://cdn-images-1.medium.com/max/800/1*6hAS21qjPR0b7e_vIDEbCQ.png"></figure><p name="6320" id="6320" class="graf graf--p graf-after--figure">顯示圓形的網頁也不是問題，從 WebView 呼叫 clipShape 即可。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="d45d" id="d45d" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {<br />    <span class="hljs-type">WebView</span>()<br />       .frame(width: <span class="hljs-number">400</span>, height: <span class="hljs-number">400</span>)<br />       .clipShape(<span class="hljs-type">Circle</span>())<br />}</span></pre><figure name="8d6b" id="8d6b" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*vEY2bPOlWM5dY-EEVqEbmA.png" data-width="548" data-height="1088" src="https://cdn-images-1.medium.com/max/800/1*vEY2bPOlWM5dY-EEVqEbmA.png"></figure><h3 name="43b3" id="43b3" class="graf graf--h3 graf-after--figure">搭配 property 控制 web view 顯示的網頁</h3><p name="35ac" id="35ac" class="graf graf--p graf-after--h3">雖然小王子很可愛，不過也許有天我們會厭倦，能不能在產生 WebView 時傳入網址，讓它顯示我們想看的網頁呢 ?</p><p name="8bf3" id="8bf3" class="graf graf--p graf-after--p">當然可以，我們可以在 WebView 裡宣告儲存資料的 property，然後在生成 WebView 時傳入內容，比方以下例子宣告儲存網址的 urlString。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="dfab" id="dfab" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">WebView</span>: <span class="hljs-title class_">UIViewRepresentable</span> {<br />    <br />    <span class="hljs-keyword">let</span> urlString: <span class="hljs-type">String</span><br />    <br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">makeUIView</span>(<span class="hljs-params">context</span>: <span class="hljs-type">Context</span>) -&gt; <span class="hljs-type">WKWebView</span> {<br />        <span class="hljs-keyword">let</span> webView <span class="hljs-operator">=</span> <span class="hljs-type">WKWebView</span>()<br />        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> url <span class="hljs-operator">=</span> <span class="hljs-type">URL</span>(string: urlString) {<br />            <span class="hljs-keyword">let</span> request <span class="hljs-operator">=</span> <span class="hljs-type">URLRequest</span>(url: url)<br />            webView.load(request)<br />        }<br />       <br />        <span class="hljs-keyword">return</span> webView<br />    }</span></pre><p name="0a22" id="0a22" class="graf graf--p graf-after--pre">生成 WebView 時傳入每天回家老婆都在裝死的預告連結。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="2e9e" id="2e9e" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-type">WebView</span>(urlString: <span class="hljs-string">&quot;https://www.youtube.com/watch?v=JsX2lsLxLBI&quot;</span>)</span></pre><figure name="7af9" id="7af9" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*LvvvDQIvFtqHfF9o9EOjhw.png" data-width="554" data-height="1086" src="https://cdn-images-1.medium.com/max/800/1*LvvvDQIvFtqHfF9o9EOjhw.png"></figure><h3 name="e9ae" id="e9ae" class="graf graf--h3 graf-after--figure">利用 updateUIView 更新網頁</h3><p name="12fc" id="12fc" class="graf graf--p graf-after--h3">有時我們會希望 SwiftUI view 生成後還能更新改變，此時正是剛剛失落的 function updateUIView 派上用場的時候。</p><p name="42a7" id="42a7" class="graf graf--p graf-after--p">接著就讓我們試試點選 button 隨機顯示網頁的功能吧。假設 array urls 裡分別是樂高彼得潘 &amp; 虎克船長的網址。</p><figure name="8f2c" id="8f2c" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*3EXHayep219cVREgrgwqfQ.jpeg" data-width="1682" data-height="694" src="https://cdn-images-1.medium.com/max/800/1*3EXHayep219cVREgrgwqfQ.jpeg"></figure><p name="17cd" id="17cd" class="graf graf--p graf-after--figure">在 ContentView 裡利用 VStack 包含 WebView &amp; Button，然後每次點選 button 時從 array urls 裡亂數其中一個網址顯示吧。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="0f5b" id="0f5b" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ContentView</span>: <span class="hljs-title class_">View</span> {<br />    <br />    <span class="hljs-keyword">let</span> urls <span class="hljs-operator">=</span> [<br />      <span class="hljs-string">&quot;https://ideascdn.lego.com/media/generate/lego_ci/608d9427-2606-4384-b5e9-77fd3c7b30e7/resize:800:450&quot;</span>,   <br />      <span class="hljs-string">&quot;https://ideascdn.lego.com/media/generate/lego_ci/f88a8415-09c3-4dcb-bba4-e7720afdc3c0/resize:800:450&quot;</span><br />    ]<br />    <br />    <span class="hljs-meta">@State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> urlString <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span><br />    <br />    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {<br />        <span class="hljs-type">VStack</span> {<br />            <span class="hljs-type">WebView</span>(urlString: urlString)<br />            <span class="hljs-type">Button</span>(<span class="hljs-string">&quot;給我一個好看的網頁&quot;</span>) {<br />                urlString <span class="hljs-operator">=</span> urls.randomElement()<span class="hljs-operator">!</span><br />            }<br />        }<br />    }<br />}<br />    <br /><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ContentView_Previews</span>: <span class="hljs-title class_">PreviewProvider</span> {<br />        <span class="hljs-keyword">static</span> <span class="hljs-keyword">var</span> previews: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {<br />            <span class="hljs-type">ContentView</span>()<br />        }<br />}</span></pre><p name="6d0a" id="6d0a" class="graf graf--p graf-after--pre">修改 WebView 的 makeUIView &amp; updateUIView。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="0ed6" id="0ed6" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">WebView</span>: <span class="hljs-title class_">UIViewRepresentable</span> {<br />    <br />    <span class="hljs-keyword">let</span> urlString: <span class="hljs-type">String</span><br />    <br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">makeUIView</span>(<span class="hljs-params">context</span>: <span class="hljs-type">Context</span>) -&gt; <span class="hljs-type">WKWebView</span> {<br />        <span class="hljs-keyword">let</span> webView <span class="hljs-operator">=</span> <span class="hljs-type">WKWebView</span>()<br />        <span class="hljs-keyword">return</span> webView<br />    }<br />    <br />    <br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">updateUIView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">uiView</span>: <span class="hljs-type">WKWebView</span>, <span class="hljs-params">context</span>: <span class="hljs-type">Context</span>) {<br />        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> url <span class="hljs-operator">=</span> <span class="hljs-type">URL</span>(string: urlString) {<br />            <span class="hljs-keyword">let</span> request <span class="hljs-operator">=</span> <span class="hljs-type">URLRequest</span>(url: url)<br />            uiView.load(request)<br />        }<br />    }<br />    <br />    <span class="hljs-keyword">typealias</span> <span class="hljs-type">UIViewType</span> <span class="hljs-operator">=</span> <span class="hljs-type">WKWebView</span><br />}</span></pre><p name="4d1a" id="4d1a" class="graf graf--p graf-after--pre">此時 makeUIView 只有生成 WKWebView，我們改在 updateUIView 才載入網頁。到時候點選 button，ContentView 的 urlString 改變時將觸發畫面更新，於是讓 WebView 的 function updateUIView 被呼叫，載入新的網頁內容。</p><figure name="e78f" id="e78f" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*6OcI3_ihj7D-tXm1UXCAww.png" data-width="1718" data-height="1132" src="https://cdn-images-1.medium.com/max/800/1*6OcI3_ihj7D-tXm1UXCAww.png"></figure><p name="f697" id="f697" class="graf graf--p graf-after--figure">對於 makeUIView &amp; updateUIView 何時會執行好奇的朋友，可試試加入 print 觀察。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="0b3b" id="0b3b" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">makeUIView</span>(<span class="hljs-params">context</span>: <span class="hljs-type">Context</span>) -&gt; <span class="hljs-type">WKWebView</span> {<br />            <span class="hljs-keyword">let</span> webView <span class="hljs-operator">=</span> <span class="hljs-type">WKWebView</span>()<br />            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;makeUIView&quot;</span>, webView)<br />            <span class="hljs-keyword">return</span> webView<br />}<br />        <br /><span class="hljs-keyword">func</span> <span class="hljs-title function_">updateUIView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">uiView</span>: <span class="hljs-type">WKWebView</span>, <span class="hljs-params">context</span>: <span class="hljs-type">Context</span>) {<br />            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;updateUIView&quot;</span>, uiView)<br />            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> url <span class="hljs-operator">=</span> <span class="hljs-type">URL</span>(string: urlString) {<br />                <span class="hljs-keyword">let</span> request <span class="hljs-operator">=</span> <span class="hljs-type">URLRequest</span>(url: url)<br />                uiView.load(request)<br />            }<br />}</span></pre><p name="f2da" id="f2da" class="graf graf--p graf-after--pre">當 ContentView 畫面顯示時，它在顯示裡面的 WebView 時將生成 WebView，然後呼叫 makeUIView &amp; updateUIView。</p><pre name="dc83" id="dc83" class="graf graf--pre graf-after--p">makeUIView &lt;WKWebView: 0x7fa88d80c400; frame = (0 0; 0 0); layer = &lt;CALayer: 0x6000008fbd60&gt;&gt;<br>updateUIView &lt;WKWebView: 0x7fa88d80c400; frame = (0 0; 0 0); layer = &lt;CALayer: 0x6000008fbd60&gt;&gt;</pre><p name="c7d9" id="c7d9" class="graf graf--p graf-after--pre">接著當我們點選 button 時，若網址不變，網頁不需更新，WebView 將不受任何影響。當網址改變，需要顯示另一個網頁時，則會呼叫 updateUIView。</p><pre name="6e96" id="6e96" class="graf graf--pre graf-after--p">updateUIView &lt;WKWebView: 0x7fa88d80c400; frame = (0 0; 414 789.5); layer = &lt;CALayer: 0x6000008fbd60&gt;&gt;</pre><p name="3b45" id="3b45" class="graf graf--p graf-after--pre">從以上 updateUIView 列印訊息顯示的 WKWebView 記憶體位置，我們也可看出 updateUIView 的參數 uiView 正是當初 makeUIView 產生的 WKWebView。</p><h3 name="fe01" id="fe01" class="graf graf--h3 graf-after--p">One more thing, Coordinator</h3><p name="d2d2" id="d2d2" class="graf graf--p graf-after--h3">開發 SwiftUI App 時，我們較少用到 delegate &amp; data source，不過傳統的 UIKit 元件卻常依靠 delegate &amp; data source 實現一些功能，比方 MKMapView 利用 delegate 設定地圖標記的圖案。</p><p name="2db7" id="2db7" class="graf graf--p graf-after--p">類似 delegate &amp; data source 這類進階的功能必須依靠 coordinator 實現，有興趣的朋友可進一步查詢相關說明，彼得潘未來也會再撰寫文章說明。</p><h3 name="eb99" id="eb99" class="graf graf--h3 graf-after--p">將 UI 元件包裝成 SwiftUI view 的步驟整理</h3><ol class="postList"><li name="6105" id="6105" class="graf graf--li graf-after--h3">以 struct 定義 SwiftUI view 的型別，遵從 protocol <code class="markup--code markup--li-code"><strong class="markup--strong markup--li-strong">UIViewRepresentable</strong></code>。</li><li name="fa77" id="fa77" class="graf graf--li graf-after--li">在 SwiftUI view 的型別裡定義 function <code class="markup--code markup--li-code"><strong class="markup--strong markup--li-strong">makeUIView</strong></code>，回傳傳統的 UI 元件，此 function 將在 SwiftUI view 生成時呼叫。</li></ol><p name="3fbe" id="3fbe" class="graf graf--p graf-after--li">3. 在 SwiftUI view 的型別裡定義 function <code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">updateUIView</strong></code>，修改 UI 元件的內容，此 function 將在 SwiftUI view 畫面更新時呼叫。</p><p name="ff0d" id="ff0d" class="graf graf--p graf-after--p">4. 若要在生成 SwiftUI view 時傳入資料，請在 SwiftUI view 的型別裡宣告儲存資料的 property。(optional)</p><p name="9c93" id="9c93" class="graf graf--p graf-after--p">5. 若要實現 delegate &amp; data source 等進階功能，請搭配 <code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">coordinator</strong></code>。(optional)</p><p name="6c0f" id="6c0f" class="graf graf--p graf-after--p graf--trailing">6. 若需要預覽，請定義遵從 protocol <code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">PreviewProvider</strong></code> 的型別。</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@apppeterpan" class="p-author h-card">彼得潘的 iOS App Neverland</a> on <a href="https://medium.com/p/f74b70282487"><time class="dt-published" datetime="2020-01-22T14:30:22.515Z">January 22, 2020</time></a>.</p><p><a href="https://medium.com/@apppeterpan/%E5%9C%A8-swiftui-app-%E5%8A%A0%E5%85%A5-uikit-view-f74b70282487" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on September 17, 2025.</p></footer></article></body></html>