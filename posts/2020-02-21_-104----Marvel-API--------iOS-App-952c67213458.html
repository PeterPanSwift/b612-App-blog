<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>#104 利用 Marvel API 開發漫威的  iOS App</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">#104 利用 Marvel API 開發漫威的  iOS App</h1>
</header>
<section data-field="subtitle" class="p-summary">
常常看到同學們寫 iOS App 作業時以漫威為主題，比方製作蜘蛛人，鋼鐵人的相關 App。不過漫威的角色和圖片那麼多，一個個輸入到程式裡實在有點辛苦，最近研究了一下，Marvel 大大早為我們準備 API，方便我們存取 Marvel 豐富的資料庫，開發有趣的 App…
</section>
<section data-field="body" class="e-content">
<section name="d975" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="f10a" id="f10a" class="graf graf--h3 graf--leading graf--title">#104 利用 Marvel API 開發漫威的 iOS App</h3></div><div class="section-inner sectionLayout--outsetColumn"><figure name="bcf2" id="bcf2" class="graf graf--figure graf--layoutOutsetCenter graf-after--h3"><img class="graf-image" data-image-id="1*kOXwECAUXSzmuFqaz2Oplg.jpeg" data-width="2444" data-height="1136" data-is-featured="true" src="https://cdn-images-1.medium.com/max/1200/1*kOXwECAUXSzmuFqaz2Oplg.jpeg"></figure></div><div class="section-inner sectionLayout--insetColumn"><p name="6472" id="6472" class="graf graf--p graf-after--figure">常常看到同學們寫 iOS App 作業時以漫威為主題，比方製作蜘蛛人，鋼鐵人的相關 App。不過漫威的角色和圖片那麼多，一個個輸入到程式裡實在有點辛苦，最近研究了一下，Marvel 大大早為我們準備 API，方便我們存取 Marvel 豐富的資料庫，開發有趣的 App 和網站。接下來就讓我們一步步認識如何開發串接 Marvel API 的 iOS App。</p><div name="5fe9" id="5fe9" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://developer.marvel.com" data-href="https://developer.marvel.com" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.marvel.com"><strong class="markup--strong markup--mixtapeEmbed-strong">Marvel Developer Portal</strong><br><em class="markup--em markup--mixtapeEmbed-em">The Marvel developer portal gives Marvel fans, partners and other technologists access to an array of powerful APIs…</em>developer.marvel.com</a><a href="https://developer.marvel.com" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="197a2bc534dcdcc04f22d531788e1692"></a></div><h3 name="d9a2" id="d9a2" class="graf graf--h3 graf-after--mixtapeEmbed">註冊帳號</h3><p name="0d47" id="0d47" class="graf graf--p graf-after--h3">為了使用 Marvel API，我們必須先註冊帳號，取得像無限手套一樣厲害的 public key &amp; private key。有了它我們才能串接 API，取得 Marvel 裡英雄人物的資訊和帥氣圖片。</p><p name="85bc" id="85bc" class="graf graf--p graf-after--p">請連到 Marvel Login 的頁面點選 CREATE AN ACCOUNT 註冊帳號。</p><div name="2132" id="2132" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://www.marvel.com/signin" data-href="https://www.marvel.com/signin" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://www.marvel.com/signin"><strong class="markup--strong markup--mixtapeEmbed-strong">Marvel Login | Sign In To Marvel Unlimited, Insider, &amp; Marvel.com</strong><br><em class="markup--em markup--mixtapeEmbed-em">Sign in to your Marvel accounts including Marvel.com. Marvel Unlimited, &amp; Marvel Insider.</em>www.marvel.com</a><a href="https://www.marvel.com/signin" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="195e1ff1cc6c0f852af90241d1a6d495"></a></div><figure name="7773" id="7773" class="graf graf--figure graf-after--mixtapeEmbed"><img class="graf-image" data-image-id="1*7YM8oiPvXOYwiu5b4c3i-Q.jpeg" data-width="838" data-height="982" src="https://cdn-images-1.medium.com/max/800/1*7YM8oiPvXOYwiu5b4c3i-Q.jpeg"></figure><figure name="2797" id="2797" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*xGCGyFCqsrvWGPDmIfHklg.jpeg" data-width="798" data-height="1232" src="https://cdn-images-1.medium.com/max/800/1*xGCGyFCqsrvWGPDmIfHklg.jpeg"></figure><p name="f347" id="f347" class="graf graf--p graf-after--figure">註冊帳號後請到 email 收信，點選 CONFIRM NOW 完成帳號的註冊。</p><figure name="0387" id="0387" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*5xfsqRQxn8_AIZsmy1BUaw.jpeg" data-width="1238" data-height="1170" src="https://cdn-images-1.medium.com/max/800/1*5xfsqRQxn8_AIZsmy1BUaw.jpeg"></figure><h3 name="8d3b" id="8d3b" class="graf graf--h3 graf-after--figure"><strong class="markup--strong markup--h3-strong">連到 Marvel Developer Portal</strong></h3><p name="a338" id="a338" class="graf graf--p graf-after--h3">想學少林武功必須到少林寺，想學習串接 Marvel API 則須前往 Marvel Developer Portal (Developer Portal 的意思是開發入口網站)。</p><div name="0fe8" id="0fe8" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://developer.marvel.com" data-href="https://developer.marvel.com" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.marvel.com"><strong class="markup--strong markup--mixtapeEmbed-strong">Marvel Developer Portal</strong><br><em class="markup--em markup--mixtapeEmbed-em">The Marvel developer portal gives Marvel fans, partners and other technologists access to an array of powerful APIs…</em>developer.marvel.com</a><a href="https://developer.marvel.com" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="197a2bc534dcdcc04f22d531788e1692"></a></div><p name="6e97" id="6e97" class="graf graf--p graf-after--mixtapeEmbed">點選 GET STARTED。</p><figure name="bc15" id="bc15" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*snJ1CubkgfM898jgvxKiKA.jpeg" data-width="2200" data-height="942" src="https://cdn-images-1.medium.com/max/800/1*snJ1CubkgfM898jgvxKiKA.jpeg"></figure><h3 name="8eb6" id="8eb6" class="graf graf--h3 graf-after--figure">同意 Marvel API TERMS OF USE</h3><p name="f560" id="f560" class="graf graf--p graf-after--h3">勾選 I ACCEPT THE TERM AND CONDITIONS ABOVE。</p><figure name="0082" id="0082" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*mC5fI5zmYkn5jsKXnwHxWA.jpeg" data-width="2058" data-height="908" src="https://cdn-images-1.medium.com/max/800/1*mC5fI5zmYkn5jsKXnwHxWA.jpeg"></figure><figure name="c505" id="c505" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*VoBPe2l0y2qPR61vEjq4rg.jpeg" data-width="2054" data-height="792" src="https://cdn-images-1.medium.com/max/800/1*VoBPe2l0y2qPR61vEjq4rg.jpeg"></figure><h3 name="bd5c" id="bd5c" class="graf graf--h3 graf-after--figure">取得 public key &amp; private key</h3><p name="9090" id="9090" class="graf graf--p graf-after--h3">複製以下頁面的 public key &amp; private key，它們是讓我們使用 Marvel API 的萬能鑰匙。</p><figure name="c290" id="c290" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*jwzYIQ8jmteKuiSEkubWaQ.jpeg" data-width="1046" data-height="1192" src="https://cdn-images-1.medium.com/max/800/1*jwzYIQ8jmteKuiSEkubWaQ.jpeg"></figure><p name="abe6" id="abe6" class="graf graf--p graf-after--figure">如果不小心忘記 public key &amp; private key，可從 My Developer Account 頁面查詢。</p><figure name="913b" id="913b" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*hwTyjmWPKw8mwK3oqbIigQ.jpeg" data-width="1836" data-height="648" src="https://cdn-images-1.medium.com/max/800/1*hwTyjmWPKw8mwK3oqbIigQ.jpeg"></figure><h3 name="cd98" id="cd98" class="graf graf--h3 graf-after--figure">Marvel API Documentation</h3><p name="0813" id="0813" class="graf graf--p graf-after--h3">連到 API Documentation 網頁，查看 Marvel 琳琅滿目的 API。</p><div name="2a3c" id="2a3c" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://developer.marvel.com/docs" data-href="https://developer.marvel.com/docs" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.marvel.com/docs"><strong class="markup--strong markup--mixtapeEmbed-strong">Marvel Developer Portal - Interactive Documentation</strong><br><em class="markup--em markup--mixtapeEmbed-em">The panel below displays documentation all endpoints, parameters and error messages available to the Marvel API. For a…</em>developer.marvel.com</a><a href="https://developer.marvel.com/docs" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="65cd834612850c6723717f5190d57c21"></a></div><figure name="9699" id="9699" class="graf graf--figure graf-after--mixtapeEmbed"><img class="graf-image" data-image-id="1*fsCO-tNe2zA_n3i26Rs29w.jpeg" data-width="1768" data-height="1136" src="https://cdn-images-1.medium.com/max/800/1*fsCO-tNe2zA_n3i26Rs29w.jpeg"></figure><p name="a968" id="a968" class="graf graf--p graf-after--figure">Marvel 貼心地讓我們在網頁上測試 API，因此我們可從網頁測試感興趣的 API 後再開始寫程式。</p><p name="5c99" id="5c99" class="graf graf--p graf-after--p">不過我們必須登入網站後才能在網頁上測試，因此如果發現網頁顯示 <code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">You do not have an API key</strong></code> 的紅色錯誤，請先點選右上方的 Get a Key 登入。</p><figure name="34ca" id="34ca" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*K03wdb21azEr5BZLqgGJAg.jpeg" data-width="1746" data-height="1210" src="https://cdn-images-1.medium.com/max/800/1*K03wdb21azEr5BZLqgGJAg.jpeg"></figure><h3 name="0214" id="0214" class="graf graf--h3 graf-after--figure">測試角色清單 API</h3><p name="e538" id="e538" class="graf graf--p graf-after--h3">接下來讓我們試試取得角色清單，利用 API <code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">GET /v1/public/characters </strong></code>。</p><figure name="c685" id="c685" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*5JgHR6GnpP4-CdDhUt0YNQ.jpeg" data-width="1680" data-height="754" src="https://cdn-images-1.medium.com/max/800/1*5JgHR6GnpP4-CdDhUt0YNQ.jpeg"></figure><p name="da96" id="da96" class="graf graf--p graf-after--figure">此 API 可以不設定任何參數，所以我們可直接點選 <code class="markup--code markup--p-code">Try it out! </code>測試。</p><figure name="df3d" id="df3d" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*KMEWcYcbIt4SkLCTf0XsBw.jpeg" data-width="1026" data-height="792" src="https://cdn-images-1.medium.com/max/800/1*KMEWcYcbIt4SkLCTf0XsBw.jpeg"></figure><figure name="6a45" id="6a45" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*j3Mot0kHDtGXCE2hNzg12Q.jpeg" data-width="998" data-height="800" src="https://cdn-images-1.medium.com/max/800/1*j3Mot0kHDtGXCE2hNzg12Q.jpeg"></figure><p name="9379" id="9379" class="graf graf--p graf-after--figure">此 API 將回傳 Marvel 的角色清單，比方以下 JSON 我們看到了厲害的 3-D Man。(其實彼得潘也不認識他，只能假設他很厲害。)</p><figure name="eaf8" id="eaf8" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*BD0vCzG9HAUyHC-1czWKHQ.jpeg" data-width="928" data-height="468" src="https://cdn-images-1.medium.com/max/800/1*BD0vCzG9HAUyHC-1czWKHQ.jpeg"></figure><h3 name="9e16" id="9e16" class="graf graf--h3 graf-after--figure">組合圖片網址</h3><p name="1e51" id="1e51" class="graf graf--p graf-after--h3">Marvel API 裡最珍貴的東西非圖片莫屬，因此我們得研究以下連結了解如何組合出圖片的網址。</p><div name="267e" id="267e" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://developer.marvel.com/documentation/images" data-href="https://developer.marvel.com/documentation/images" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.marvel.com/documentation/images"><strong class="markup--strong markup--mixtapeEmbed-strong">Images in the Marvel Comics API</strong><br><em class="markup--em markup--mixtapeEmbed-em">Marvel comics are famous for their iconic images, and we have provided a number of options for developers in order to…</em>developer.marvel.com</a><a href="https://developer.marvel.com/documentation/images" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="6509b9c06e1624ea093d8f262b7b30af" data-thumbnail-img-id="0*67-LaRzhJs3uSj2t" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*67-LaRzhJs3uSj2t);"></a></div><p name="7b99" id="7b99" class="graf graf--p graf-after--mixtapeEmbed">Marvel 提供了各種尺寸的圖片規格，方便我們選擇 App 想要的圖片尺寸。</p><figure name="3eef" id="3eef" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*nFB33-UyMAIrVVupCkzAIQ.jpeg" data-width="1782" data-height="1280" src="https://cdn-images-1.medium.com/max/800/1*nFB33-UyMAIrVVupCkzAIQ.jpeg"></figure><p name="9462" id="9462" class="graf graf--p graf-after--figure">比方剛剛 JSON 裡 3-D Man thumbnail 欄位的 path &amp; extension 包含了圖片網址的資訊。</p><figure name="8abc" id="8abc" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*BD0vCzG9HAUyHC-1czWKHQ.jpeg" data-width="928" data-height="468" src="https://cdn-images-1.medium.com/max/800/1*BD0vCzG9HAUyHC-1czWKHQ.jpeg"></figure><p name="a8cd" id="a8cd" class="graf graf--p graf-after--figure">我們可利用以下五個元素組合出網址。</p><figure name="65d6" id="65d6" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*p5uNIrvrYH8gUkMrxtTOMg.jpeg" data-width="1296" data-height="254" src="https://cdn-images-1.medium.com/max/800/1*p5uNIrvrYH8gUkMrxtTOMg.jpeg"></figure><p name="a1bd" id="a1bd" class="graf graf--p graf-after--figure">我們想要名為 <code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">standard_xlarge</strong></code>，200 * 200px 的正方形圖片。</p><figure name="44ea" id="44ea" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*NlCF2VM3KYdrDbKEVCEzHA.jpeg" data-width="1202" data-height="632" src="https://cdn-images-1.medium.com/max/800/1*NlCF2VM3KYdrDbKEVCEzHA.jpeg"></figure><p name="4b27" id="4b27" class="graf graf--p graf-after--figure">因此 3-D Man 的大頭照網址是 <a href="http://i.annihil.us/u/prod/marvel/i/mg/c/e0/535fecbbb9784" data-href="http://i.annihil.us/u/prod/marvel/i/mg/c/e0/535fecbbb9784" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">http://i.annihil.us/u/prod/marvel/i/mg/c/e0/535fecbbb9784</a> + / + standard_xlarge + . + jpg，變成</p><pre name="5199" id="5199" class="graf graf--pre graf-after--p"><a href="http://i.annihil.us/u/prod/marvel/i/mg/c/e0/535fecbbb9784/standard_xlarge.jpg" data-href="http://i.annihil.us/u/prod/marvel/i/mg/c/e0/535fecbbb9784/standard_xlarge.jpg" class="markup--anchor markup--pre-anchor" rel="nofollow noopener" target="_blank">http://i.annihil.us/u/prod/marvel/i/mg/c/e0/535fecbbb9784/standard_xlarge.jpg</a></pre><figure name="dab6" id="dab6" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*had747G7a0hbRctZdOoZ4w.jpeg" data-width="200" data-height="200" src="https://cdn-images-1.medium.com/max/800/1*had747G7a0hbRctZdOoZ4w.jpeg"></figure><p name="5065" id="5065" class="graf graf--p graf-after--figure">我們也可以取得原始的圖片，不指定 variant name，此時圖片網址變成</p><pre name="accb" id="accb" class="graf graf--pre graf-after--p"><a href="http://i.annihil.us/u/prod/marvel/i/mg/c/e0/535fecbbb9784.jpg" data-href="http://i.annihil.us/u/prod/marvel/i/mg/c/e0/535fecbbb9784.jpg" class="markup--anchor markup--pre-anchor" rel="nofollow noopener noopener" target="_blank">http://i.annihil.us/u/prod/marvel/i/mg/c/e0/535fecbbb9784.jpg</a></pre><figure name="4330" id="4330" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*3fdnkBnwaGC2P0p2Z70TiQ.jpeg" data-width="850" data-height="850" src="https://cdn-images-1.medium.com/max/800/1*3fdnkBnwaGC2P0p2Z70TiQ.jpeg"></figure><h3 name="537d" id="537d" class="graf graf--h3 graf-after--figure">串接 Marvel API</h3><p name="cab1" id="cab1" class="graf graf--p graf-after--h3">Marvel API 的網址開頭如下</p><pre name="75bb" id="75bb" class="graf graf--pre graf-after--p"><a href="https://gateway.marvel.com" data-href="https://gateway.marvel.com" class="markup--anchor markup--pre-anchor" rel="nofollow noopener" target="_blank">https://gateway.marvel.com</a></pre><p name="1c83" id="1c83" class="graf graf--p graf-after--pre">因此剛剛取得角色清單的 API GET /v1/public/characters 的網址為</p><pre name="41d0" id="41d0" class="graf graf--pre graf-after--p"><a href="https://gateway.marvel.com/v1/public/characters" data-href="https://gateway.marvel.com/v1/public/characters" class="markup--anchor markup--pre-anchor" rel="nofollow noopener" target="_blank">https://gateway.marvel.com/v1/public/characters</a></pre><p name="77b0" id="77b0" class="graf graf--p graf-after--pre">不過事情沒那麼簡單，當我們在 Postman 輸入以下網址測試時將發生錯誤，JSON 回應 You must provide a user key.。</p><figure name="e3a1" id="e3a1" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*mPzsdfbVH4I5SWgotVMN0Q.jpeg" data-width="1802" data-height="758" src="https://cdn-images-1.medium.com/max/800/1*mPzsdfbVH4I5SWgotVMN0Q.jpeg"></figure><p name="fac5" id="fac5" class="graf graf--p graf-after--figure">Why ! 難道是我們看的 Marvel 電影不夠多，不夠忠誠嗎 ?</p><p name="cb09" id="cb09" class="graf graf--p graf-after--p">別擔心，就算你只看盜版的 Marvel 電影還是可以使用 Marvel API，只要你搭配前面提到的 public key &amp; private key。</p><p name="b006" id="b006" class="graf graf--p graf-after--p">搭配的方法請參考以下網頁 Authorizing and Signing Requests 的說明。</p><div name="c4e1" id="c4e1" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://developer.marvel.com/documentation/authorization" data-href="https://developer.marvel.com/documentation/authorization" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.marvel.com/documentation/authorization"><strong class="markup--strong markup--mixtapeEmbed-strong">Authorizing and Signing Requests</strong><br><em class="markup--em markup--mixtapeEmbed-em">We want to ensure that calls made with your keys come from your applications. In order to help keep your keys from…</em>developer.marvel.com</a><a href="https://developer.marvel.com/documentation/authorization" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="e30a1d49b9375719f06f39a37b603520"></a></div><p name="f3c5" id="f3c5" class="graf graf--p graf-after--mixtapeEmbed">其中最重要的說明是以下這段文字，我們必須在 API 網址裡包含 ts，apiKey &amp; hash 三個參數。</p><figure name="5fa8" id="5fa8" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*lsFXtQpNGDY42rvZSC91nQ.jpeg" data-width="1858" data-height="498" src="https://cdn-images-1.medium.com/max/800/1*lsFXtQpNGDY42rvZSC91nQ.jpeg"></figure><ul class="postList"><li name="051f" id="051f" class="graf graf--li graf-after--figure"><strong class="markup--strong markup--li-strong">ts</strong></li></ul><p name="2201" id="2201" class="graf graf--p graf-after--li">隨著每次發送 API 改變的字串，通常會設為發送 API 時的 timestamp 時間。</p><ul class="postList"><li name="0626" id="0626" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">apiKey</strong></li></ul><p name="31fc" id="31fc" class="graf graf--p graf-after--li">public key</p><ul class="postList"><li name="4d58" id="4d58" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">hash</strong></li></ul><p name="039b" id="039b" class="graf graf--p graf-after--li">md5 雜湊 ts + privateKey + publicKey 生成的字串。</p><h3 name="0550" id="0550" class="graf graf--h3 graf-after--p">md5 雜湊程式說明</h3><p name="502e" id="502e" class="graf graf--p graf-after--h3">Marvel 為了驗證我們是擁有 publicKey &amp; privateKey，能夠使用 Marvel API 的天選之人，它要求我們在 API 裡包含以 md5 雜湊 ts + privateKey + publicKey 生成的雜湊值(hash value)，如此它的後台即可從傳送的 hash 檢查我們是否擁有合法的 publicKey &amp; privateKey。</p><p name="0f58" id="0f58" class="graf graf--p graf-after--p">比方以下範例利用 iOS SDK 裡 CryptoKit 提供的 MD5 生成 Marvel API 需要的 hash 字串。</p><pre name="6a2e" id="6a2e" class="graf graf--pre graf-after--p">import CryptoKit<br>import Foundation</pre><pre name="7e84" id="7e84" class="graf graf--pre graf-after--pre">let ts = Date().timeIntervalSinceReferenceDate<br>let privateKey = &quot;9811a11111&quot;<br>let publicKey = &quot;2368fe&quot;<br><strong class="markup--strong markup--pre-strong">let md5InputData = &quot;\(ts)\(privateKey)\(publicKey)&quot;.data(using: .utf8)!</strong><br><strong class="markup--strong markup--pre-strong">let digest = Insecure.MD5.hash(data: md5InputData)<br>let hashString = digest.map {<br>    String(format: &quot;%02x&quot;, $0)<br>}.joined()</strong></pre><p name="02a6" id="02a6" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">結果</strong></p><p name="1e85" id="1e85" class="graf graf--p graf-after--p">產生的雜湊值 hashString 如下:</p><pre name="69c5" id="69c5" class="graf graf--pre graf-after--p">55c06bd40ace562cc81202a6d38e8749</pre><p name="b2d3" id="b2d3" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">說明</strong></p><pre name="146c" id="146c" class="graf graf--pre graf-after--p">import CryptoKit</pre><p name="e4b5" id="e4b5" class="graf graf--p graf-after--pre">加入提供 md5 雜湊功能的 CryptoKit。(ps: CryptoKit 是 iOS 13 的 framework，若要支援舊版請採用其它寫法。)</p><pre name="36b7" id="36b7" class="graf graf--pre graf-after--p">let md5InputData = &quot;\(ts)\(privateKey)\(publicKey)&quot;.data(using: .utf8)!</pre><pre name="dbd7" id="dbd7" class="graf graf--pre graf-after--pre">let digest = Insecure.MD5.hash(data: md5InputData)</pre><p name="661f" id="661f" class="graf graf--p graf-after--pre">Marvel API 要求以 md5 雜湊 ts + privateKey + publicKey 生成後台檢查的雜湊值，因此我們先將 <code class="markup--code markup--p-code">&quot;\(ts)\(privateKey)\(publicKey)&quot;</code> 組合的字串變成以 utf8 編碼的 Data，然後再用 Insecure.MD5 的 hash function 生成包含雜湊值的 digest(訊息摘要)。</p><p name="b6e2" id="b6e2" class="graf graf--p graf-after--p">ps: 從名字 Insecure.MD5 我們可知 MD5 比較不安全，Apple 在網頁裡建議採用其它比較安全的方法，比方 SHA512。不過在此我們只能採用 MD5，因為 Marvel API 要求使用 MD5。</p><div name="8f22" id="8f22" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://developer.apple.com/documentation/cryptokit/insecure/md5" data-href="https://developer.apple.com/documentation/cryptokit/insecure/md5" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/cryptokit/insecure/md5"><strong class="markup--strong markup--mixtapeEmbed-strong">Insecure.MD5</strong><br><em class="markup--em markup--mixtapeEmbed-em">Declaration The Insecure.MD5 hash implements the protocol to produce an MD5 digest (). You can compute the digest by…</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/cryptokit/insecure/md5" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="97b7b772e8fb3c11c1a7fed2aa0346c6"></a></div><p name="cdd0" id="cdd0" class="graf graf--p graf-after--mixtapeEmbed"><strong class="markup--strong markup--p-strong">結果:</strong></p><p name="322b" id="322b" class="graf graf--p graf-after--p">如下圖所示，從 Playground 右邊顯示的結果，我們發現產生的 digest 顯示為<code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong"> MD5 digest: cbca46573e29f23ed9cada18512cb2ae</strong></code>。</p><figure name="6fae" id="6fae" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*mLyIn4gLkDZMRDNxphTCrg.jpeg" data-width="2220" data-height="398" src="https://cdn-images-1.medium.com/max/800/1*mLyIn4gLkDZMRDNxphTCrg.jpeg"></figure><p name="604e" id="604e" class="graf graf--p graf-after--figure">其中的 <code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">4abd16e4a94567684425bb98a0e75302</strong></code> 即為 MD5 產生的雜湊值。但是 function hash 回傳的型別是 Insecure.MD5.Digest，我們要如何取得字串 4abd16e4a94567684425bb98a0e75302 呢?</p><p name="bf91" id="bf91" class="graf graf--p graf-after--p">我們可用 function map 將 digest 的每個 byte 變成十六進位字串組合的 array，然後再用 joined 將 array 裡的字串合併。</p><pre name="e30e" id="e30e" class="graf graf--pre graf-after--p">let hashString = digest.map {<br>    String(format: &quot;%02x&quot;, $0)<br>}.joined()</pre><p name="717c" id="717c" class="graf graf--p graf-after--pre">結果</p><figure name="3924" id="3924" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*47WnGgcwr8Tj6iEjBvEohg.jpeg" data-width="1594" data-height="212" src="https://cdn-images-1.medium.com/max/800/1*47WnGgcwr8Tj6iEjBvEohg.jpeg"></figure><p name="c690" id="c690" class="graf graf--p graf-after--figure">對以上程式有點疑惑的朋友，可從以下程式看到 map 產生的結果為十六進位字串組合的 array。</p><pre name="6f9a" id="6f9a" class="graf graf--pre graf-after--p">digest.map {<br>    String(format: &quot;%02x&quot;, $0)<br>}</pre><p name="61fd" id="61fd" class="graf graf--p graf-after--pre">結果</p><pre name="e8bc" id="e8bc" class="graf graf--pre graf-after--p">[&quot;55&quot;, &quot;c0&quot;, &quot;6b&quot;, &quot;d4&quot;, &quot;0a&quot;, &quot;ce&quot;, &quot;56&quot;, &quot;2c&quot;, &quot;c8&quot;, &quot;12&quot;, &quot;02&quot;, &quot;a6&quot;, &quot;d3&quot;, &quot;8e&quot;, &quot;87&quot;, &quot;49&quot;]</pre><p name="25ed" id="25ed" class="graf graf--p graf-after--pre">其中的<code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong"> %02x</strong></code> 是為了讓產生的十六進位字串固定 2 個字元，只有一個字元時補 0。若是使用 <code class="markup--code markup--p-code">String(format: &quot;%x&quot;, $0)</code>，剛剛 array 裡的 0a &amp; 02 將變成只有 a &amp; 2。</p><pre name="7e06" id="7e06" class="graf graf--pre graf-after--p">[&quot;55&quot;, &quot;c0&quot;, &quot;6b&quot;, &quot;d4&quot;, <strong class="markup--strong markup--pre-strong">&quot;a&quot;</strong>, &quot;ce&quot;, &quot;56&quot;, &quot;2c&quot;, &quot;c8&quot;, &quot;12&quot;, <strong class="markup--strong markup--pre-strong">&quot;2&quot;</strong>, &quot;a6&quot;, &quot;d3&quot;, &quot;8e&quot;, &quot;87&quot;, &quot;49&quot;]</pre><h3 name="11ff" id="11ff" class="graf graf--h3 graf-after--pre">撰寫 Swift 程式串接 Marvel API</h3><p name="5dd6" id="5dd6" class="graf graf--p graf-after--h3">學會使用 MD5 產生 Marvel API 需要的 hash 後，我們已經突破最困難的部分，可以開始串接 Marvel API 抓取角色清單。(ps: 範例裡的 privateKey &amp; publicKey 是假的，請換成自己帳號的 privateKey &amp; publicKey。)</p><pre name="2e18" id="2e18" class="graf graf--pre graf-after--p">import CryptoKit<br>import Foundation</pre><pre name="a21a" id="a21a" class="graf graf--pre graf-after--pre">let ts = Date().timeIntervalSinceReferenceDate<br>let privateKey = &quot;0ab7a1111117ae3&quot;<br>let publicKey = &quot;958211111d6e230c&quot;<br>let md5InputData = &quot;\(ts)\(privateKey)\(publicKey)&quot;.data(using: .utf8)!<br>let digest = Insecure.MD5.hash(data: md5InputData)<br>let hashString = digest.map {<br>    String(format: &quot;%02x&quot;, $0)<br>}.joined()</pre><pre name="c363" id="c363" class="graf graf--pre graf-after--pre"><strong class="markup--strong markup--pre-strong">let urlString = &quot;</strong><a href="http://gateway.marvel.com/v1/public/characters?ts=%5C%28ts%29&amp;apikey=%5C%28publicKey%29&amp;hash=%5C%28hashString%29" data-href="http://gateway.marvel.com/v1/public/characters?ts=\(ts)&amp;apikey=\(publicKey)&amp;hash=\(hashString)" class="markup--anchor markup--pre-anchor" rel="nofollow noopener" target="_blank"><strong class="markup--strong markup--pre-strong">https://gateway.marvel.com/v1/public/characters?ts=\(ts)&amp;apikey=\(publicKey)&amp;hash=\(hashString)</strong></a><strong class="markup--strong markup--pre-strong">&quot;</strong><br>if let url = URL(string: urlString) {<br>    URLSession.shared.dataTask(with: url) { (data, response, error) in<br>        if let data = data, let content = String(data: data, encoding: .utf8) {<br>            print(content)<br>        }<br>    }.resume()<br>}</pre><p name="fe63" id="fe63" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">說明</strong></p><pre name="2d89" id="2d89" class="graf graf--pre graf-after--p">let urlString = &quot;<a href="http://gateway.marvel.com/v1/public/characters?ts=%5C%28ts%29&amp;apikey=%5C%28publicKey%29&amp;hash=%5C%28hashString%29" data-href="http://gateway.marvel.com/v1/public/characters?ts=\(ts)&amp;apikey=\(publicKey)&amp;hash=\(hashString)" class="markup--anchor markup--pre-anchor" rel="nofollow noopener" target="_blank">https://gateway.marvel.com/v1/public/characters?ts=\(ts)&amp;apikey=\(publicKey)&amp;hash=\(hashString)</a>&quot;</pre><p name="a3e2" id="a3e2" class="graf graf--p graf-after--pre">在 Marvel API 網址裡加入參數 ts，apikey &amp; hash。</p><p name="76d0" id="76d0" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">結果</strong></p><figure name="2b78" id="2b78" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*L7BEtjrmRGGI-1lYF5JONw.jpeg" data-width="1024" data-height="1078" src="https://cdn-images-1.medium.com/max/800/1*L7BEtjrmRGGI-1lYF5JONw.jpeg"></figure><p name="06ba" id="06ba" class="graf graf--p graf-after--figure">成功取得 JSON 後，我們即可用 JSONDecoder 將它轉成我們自訂的型別，顯示在 App 畫面上。</p><div name="b6d9" id="b6d9" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-swift-4-%E7%9A%84-jsondecoder-%E5%92%8C-codable-%E8%A7%A3%E6%9E%90-json-%E5%92%8C%E7%94%9F%E6%88%90%E8%87%AA%E8%A8%82%E5%9E%8B%E5%88%A5%E8%B3%87%E6%96%99-ee793622629e" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-swift-4-%E7%9A%84-jsondecoder-%E5%92%8C-codable-%E8%A7%A3%E6%9E%90-json-%E5%92%8C%E7%94%9F%E6%88%90%E8%87%AA%E8%A8%82%E5%9E%8B%E5%88%A5%E8%B3%87%E6%96%99-ee793622629e" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-swift-4-%E7%9A%84-jsondecoder-%E5%92%8C-codable-%E8%A7%A3%E6%9E%90-json-%E5%92%8C%E7%94%9F%E6%88%90%E8%87%AA%E8%A8%82%E5%9E%8B%E5%88%A5%E8%B3%87%E6%96%99-ee793622629e"><strong class="markup--strong markup--mixtapeEmbed-strong">利用 JSONDecoder 和 Codable 解析 JSON 和生成自訂型別資料</strong><br><em class="markup--em markup--mixtapeEmbed-em">抓取網路上的 JSON 資料並不是太困難的事，但是如果想要解析它，甚至是把它變成方便 App 使用的自訂型別，卻需要寫許多程式碼才能實現。因此從前一些解析 JSON 和將 JSON 變成自訂型別的第三方套件大受歡迎，不過在 Swift…</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-swift-4-%E7%9A%84-jsondecoder-%E5%92%8C-codable-%E8%A7%A3%E6%9E%90-json-%E5%92%8C%E7%94%9F%E6%88%90%E8%87%AA%E8%A8%82%E5%9E%8B%E5%88%A5%E8%B3%87%E6%96%99-ee793622629e" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="a1068ad2918bf3673e0459e185327c1a" data-thumbnail-img-id="1*l-tGFvpI-VyDff3rAGlYUQ.png" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*l-tGFvpI-VyDff3rAGlYUQ.png);"></a></div><p name="cc08" id="cc08" class="graf graf--p graf-after--mixtapeEmbed">ps: 有個小地方要注意一下，剛剛 API 回傳的 JSON 裡有些網址以 http 開頭，然而 iOS App 正常情況下只能連 https，除非另外特別設定。因此請記得將 JSON 裡用到的網址，比方圖片的網址改成 https 開頭。</p><div name="9bca" id="9bca" class="graf graf--mixtapeEmbed graf-after--p graf--trailing"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E9%80%8F%E9%81%8E-urlcomponents-%E5%B0%87-http-%E7%9A%84%E7%B6%B2%E5%9D%80%E6%94%B9%E6%88%90-https-c1e0425138ac" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E9%80%8F%E9%81%8E-urlcomponents-%E5%B0%87-http-%E7%9A%84%E7%B6%B2%E5%9D%80%E6%94%B9%E6%88%90-https-c1e0425138ac" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E9%80%8F%E9%81%8E-urlcomponents-%E5%B0%87-http-%E7%9A%84%E7%B6%B2%E5%9D%80%E6%94%B9%E6%88%90-https-c1e0425138ac"><strong class="markup--strong markup--mixtapeEmbed-strong">透過 URLComponents 將 http 的網址改成 https</strong><br><em class="markup--em markup--mixtapeEmbed-em">使用 URLSession 抓取資料時，為了安全性的考量，Apple 限制我們只能抓取 https 的資料，因此以下 http 連結的圖片將無法抓取。</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E9%80%8F%E9%81%8E-urlcomponents-%E5%B0%87-http-%E7%9A%84%E7%B6%B2%E5%9D%80%E6%94%B9%E6%88%90-https-c1e0425138ac" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="c263113f03027e43700da12088ac0141" data-thumbnail-img-id="1*erbh_CMlpE_9dYUMHXgstQ.png" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*erbh_CMlpE_9dYUMHXgstQ.png);"></a></div></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@apppeterpan" class="p-author h-card">彼得潘的 iOS App Neverland</a> on <a href="https://medium.com/p/952c67213458"><time class="dt-published" datetime="2020-02-21T08:53:21.197Z">February 21, 2020</time></a>.</p><p><a href="https://medium.com/@apppeterpan/104-%E5%88%A9%E7%94%A8-marvel-api-%E9%96%8B%E7%99%BC%E6%BC%AB%E5%A8%81%E7%9A%84-ios-app-952c67213458" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on September 17, 2025.</p></footer></article></body></html>