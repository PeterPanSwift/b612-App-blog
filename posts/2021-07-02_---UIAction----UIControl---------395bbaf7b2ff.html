<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>利用 UIAction 設定 UIControl 元件觸發的程式</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">利用 UIAction 設定 UIControl 元件觸發的程式</h1>
</header>
<section data-field="subtitle" class="p-summary">
在 iOS UIKit 的世界，大部分可以操控的元件，比方 button，slider &amp; date picker 都繼承 UIControl，因此當我們從程式設定它們操作時觸發的程式時，通常會呼叫 UIControl 的…
</section>
<section data-field="body" class="e-content">
<section name="ad34" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="bdd4" id="bdd4" class="graf graf--h3 graf--leading graf--title">利用 UIAction 設定 UIControl 元件觸發的程式</h3><figure name="b931" id="b931" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="1*NrIYnlb6ByWfFbVhL82bFQ.png" data-width="1420" data-height="812" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*NrIYnlb6ByWfFbVhL82bFQ.png"></figure><p name="d95b" id="d95b" class="graf graf--p graf-after--figure">在 iOS UIKit 的世界，大部分可以操控的元件，比方 button，slider &amp; date picker 都繼承 UIControl，因此當我們從程式設定它們操作時觸發的程式時，通常會呼叫 UIControl 的 <code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">addTarget(_:action:for:)</strong></code>，例如以下例子設定 button 點選時印出 buttonTap。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="677a" id="677a" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewController</span>: <span class="hljs-title class_">UIViewController</span> {<br />    <br />    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">buttonTap</span>() {<br />        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;buttonTap&quot;</span>)<br />    }<br />    <br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {<br />        <span class="hljs-keyword">super</span>.viewDidLoad()<br />        <span class="hljs-comment">// Do any additional setup after loading the view.</span><br />        <br />        <span class="hljs-keyword">let</span> button <span class="hljs-operator">=</span> <span class="hljs-type">UIButton</span>(type: .system)<br />        button.frame <span class="hljs-operator">=</span> <span class="hljs-type">CGRect</span>(x: <span class="hljs-number">10</span>, y: <span class="hljs-number">100</span>, width: <span class="hljs-number">200</span>, height: <span class="hljs-number">100</span>)<br />        <span class="hljs-keyword">var</span> config <span class="hljs-operator">=</span> <span class="hljs-type">UIButton</span>.<span class="hljs-type">Configuration</span>.filled()<br />        config.title <span class="hljs-operator">=</span> <span class="hljs-string">&quot;我是 button&quot;</span><br />        config.cornerStyle <span class="hljs-operator">=</span> .capsule<br />        button.configuration <span class="hljs-operator">=</span> config<br />        button.addTarget(<span class="hljs-keyword">self</span>, action: <span class="hljs-keyword">#selector</span>(buttonTap), for: .touchUpInside)<br />        view.addSubview(button)<br />    }<br />}</span></pre><figure name="0629" id="0629" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*e8_b5R0pWovB85_UQFNI-A.png" data-width="364" data-height="204" src="https://cdn-images-1.medium.com/max/800/1*e8_b5R0pWovB85_UQFNI-A.png"></figure><p name="cf46" id="cf46" class="graf graf--p graf-after--figure">呼叫 addTarget(_:action:for:) 有幾個小小的缺點:</p><ul class="postList"><li name="c06b" id="c06b" class="graf graf--li graf-after--p">必須傳入 selector，function 定義前要加上 ＠objc。</li><li name="5afa" id="5afa" class="graf graf--li graf-after--li">button 點選做的事情必須寫在另一個 function。有些人比較喜歡 closure 的語法，因為它能讓 button 點選做的事情寫在 button 產生的程式附近。</li></ul><p name="cfdb" id="cfdb" class="graf graf--p graf-after--li">在 iOS 14，UIControl 多了一些新功能，我們可以使用 closure 的語法定義元件觸發的程式，而且也不用寫 @objc 了。</p><h3 name="1dc4" id="1dc4" class="graf graf--h3 graf-after--p">利用 UIAction 設定 button 點選觸發的程式 － init(frame:primaryAction:)</h3><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="6776" id="6776" class="graf graf--pre graf-after--h3 graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> button <span class="hljs-operator">=</span> <span class="hljs-type">UIButton</span>(frame: <span class="hljs-type">CGRect</span>(x: <span class="hljs-number">10</span>, y: <span class="hljs-number">100</span>, width: <span class="hljs-number">200</span>, height: <span class="hljs-number">100</span>), primaryAction: <span class="hljs-type">UIAction</span>(handler: { action <span class="hljs-keyword">in</span><br />     <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;buttonTap&quot;</span>)<br />}))<br /><span class="hljs-keyword">var</span> config <span class="hljs-operator">=</span> <span class="hljs-type">UIButton</span>.<span class="hljs-type">Configuration</span>.filled()<br />config.title <span class="hljs-operator">=</span> <span class="hljs-string">&quot;我是 button&quot;</span><br />config.cornerStyle <span class="hljs-operator">=</span> .capsule<br />button.configuration <span class="hljs-operator">=</span> config<br />view.addSubview(button)</span></pre><p name="f9e2" id="f9e2" class="graf graf--p graf-after--pre">在 iOS 14 UIControl 多了一個新的 initializer <code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">init(frame:primaryAction:)</strong></code>，而 UIButton 繼承 UIControl，因此產生 UIButton 時，我們可以傳入參數 frame &amp; primaryAction。primaryAction 的型別是 UIAction，產生 UIAction 時我們在參數 handler 傳入 closure，closure 的程式將在元件的主要事件發生時執行。對 button 來說，它的主要事件是點擊，因此我們點擊 button 時將印出 buttonTap。</p><h3 name="51f6" id="51f6" class="graf graf--h3 graf-after--p">UIAction 設定標題和圖片</h3><p name="be6e" id="be6e" class="graf graf--p graf-after--h3">產生 UIAction 時，我們也可以設定標題和圖片，以下例子利用 UIAction 設定 button 的標題和圖片。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="be82" id="be82" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> button <span class="hljs-operator">=</span> <span class="hljs-type">UIButton</span>(frame: <span class="hljs-type">CGRect</span>(x: <span class="hljs-number">10</span>, y: <span class="hljs-number">100</span>, width: <span class="hljs-number">200</span>, height: <span class="hljs-number">100</span>), primaryAction: <span class="hljs-type">UIAction</span>(title: <span class="hljs-string">&quot;我是 button&quot;</span>, image: <span class="hljs-type">UIImage</span>(systemName: <span class="hljs-string">&quot;star&quot;</span>), handler: { action <span class="hljs-keyword">in</span><br />    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;buttonTap&quot;</span>)<br />}))<br /><span class="hljs-keyword">var</span> config <span class="hljs-operator">=</span> <span class="hljs-type">UIButton</span>.<span class="hljs-type">Configuration</span>.filled()<br />config.cornerStyle <span class="hljs-operator">=</span> .capsule<br />button.configuration <span class="hljs-operator">=</span> config<br />view.addSubview(button)</span></pre><figure name="6802" id="6802" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*kBqQ3X8Ng8ZR5DjfiitStw.png" data-width="352" data-height="200" src="https://cdn-images-1.medium.com/max/800/1*kBqQ3X8Ng8ZR5DjfiitStw.png"></figure><h3 name="538d" id="538d" class="graf graf--h3 graf-after--figure">UIAction closure 的記憶體問題</h3><p name="7781" id="7781" class="graf graf--p graf-after--h3">傳入 UIAction 的 closure 需注意記憶體問題。以下例子 closure 裡存取 self，因此加上 capture list <code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">[unowned self]</strong></code>。若是沒有加 <code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">[unowned self]</strong></code>，controller 將永遠無法死掉。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="4507" id="4507" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewController</span>: <span class="hljs-title class_">UIViewController</span> {<br />    <br />    <span class="hljs-keyword">var</span> number <span class="hljs-operator">=</span> <span class="hljs-number">0</span><br /><br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {<br />        <span class="hljs-keyword">super</span>.viewDidLoad()<br />        <br />        <span class="hljs-keyword">let</span> button <span class="hljs-operator">=</span> <span class="hljs-type">UIButton</span>(frame: <span class="hljs-type">CGRect</span>(x: <span class="hljs-number">10</span>, y: <span class="hljs-number">100</span>, width: <span class="hljs-number">200</span>, height: <span class="hljs-number">100</span>), primaryAction: <span class="hljs-type">UIAction</span>(handler: { [<span class="hljs-keyword">unowned</span> <span class="hljs-keyword">self</span>] action <span class="hljs-keyword">in</span><br />            <span class="hljs-keyword">self</span>.number <span class="hljs-operator">=</span> <span class="hljs-type">Int</span>.random(in: <span class="hljs-number">1</span><span class="hljs-operator">...</span><span class="hljs-number">100</span>)<br />        }))<br />        <span class="hljs-keyword">var</span> config <span class="hljs-operator">=</span> <span class="hljs-type">UIButton</span>.<span class="hljs-type">Configuration</span>.filled()<br />        config.title <span class="hljs-operator">=</span> <span class="hljs-string">&quot;我是 button&quot;</span><br />        config.cornerStyle <span class="hljs-operator">=</span> .capsule<br />        button.configuration <span class="hljs-operator">=</span> config<br />        view.addSubview(button)<br />    }<br />}</span></pre><p name="bb77" id="bb77" class="graf graf--p graf-after--pre">iOS 還有很多元件也繼承 UIControl，因此它們都可透過 init(frame:primaryAction:) 產生。換句話說，我們也可以用 UIAction 設定它們主要事件觸發的程式。接下來讓我們多看幾個例子。</p><h3 name="0afe" id="0afe" class="graf graf--h3 graf-after--p">在 UIAction 裡利用 sender 存取元件 — 以 UISlider 為例</h3><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="44fb" id="44fb" class="graf graf--pre graf-after--h3 graf--preV2"><span class="pre--content"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewController</span>: <span class="hljs-title class_">UIViewController</span> {<br />    <br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {<br />        <span class="hljs-keyword">super</span>.viewDidLoad()<br />        <br />        <span class="hljs-keyword">let</span> slider <span class="hljs-operator">=</span> <span class="hljs-type">UISlider</span>(frame: <span class="hljs-type">CGRect</span>(x: <span class="hljs-number">10</span>, y: <span class="hljs-number">100</span>, width: <span class="hljs-number">200</span>, height: <span class="hljs-number">30</span>), primaryAction: <span class="hljs-type">UIAction</span>(handler: { action <span class="hljs-keyword">in</span><br />            <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> slider <span class="hljs-operator">=</span> action.sender <span class="hljs-keyword">as?</span> <span class="hljs-type">UISlider</span> <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }<br />            <span class="hljs-built_in">print</span>(slider.value)<br />        }))<br />        view.addSubview(slider)<br />    }<br />}</span></pre><p name="f5e3" id="f5e3" class="graf graf--p graf-after--pre">slider 滑動時將觸發 UIAction 的 handler。為了在 closure 裡讀取 slider 的 value，我們透過 action.sender 存取 slider。action 的 sender 是事件作用的元件，因此在剛剛的例子裡，sender 就是 slider。</p><h3 name="5cee" id="5cee" class="graf graf--h3 graf-after--p">搭配型別 [UIAction] 的 array — 以 <strong class="markup--strong markup--h3-strong">UISegmentedControl</strong> 為例</h3><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="de63" id="de63" class="graf graf--pre graf-after--h3 graf--preV2"><span class="pre--content"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewController</span>: <span class="hljs-title class_">UIViewController</span> {<br />    <br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {<br />        <span class="hljs-keyword">super</span>.viewDidLoad()<br />        <br />        <span class="hljs-keyword">let</span> genders <span class="hljs-operator">=</span> [<span class="hljs-string">&quot;Man&quot;</span>, <span class="hljs-string">&quot;Woman&quot;</span>]<br />        <span class="hljs-keyword">let</span> segmentedControl <span class="hljs-operator">=</span> <span class="hljs-type">UISegmentedControl</span>(frame: <span class="hljs-type">CGRect</span>(x: <span class="hljs-number">10</span>, y: <span class="hljs-number">100</span>, width: <span class="hljs-number">200</span>, height: <span class="hljs-number">31</span>), actions: genders.map { gender <span class="hljs-keyword">in</span><br />            <span class="hljs-type">UIAction</span>(title: gender) { action <span class="hljs-keyword">in</span><br />                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;select <span class="hljs-subst">\(gender)</span>&quot;</span>)<br />            }<br />        })<br />        segmentedControl.selectedSegmentIndex <span class="hljs-operator">=</span> <span class="hljs-number">0</span><br />        view.addSubview(segmentedControl)<br />    }<br />}</span></pre><p name="e36b" id="e36b" class="graf graf--p graf-after--pre">產生 UISegmentedControl 時傳入型別 [UIAction] 的 array，由 UIAction 的數量和標題決定 UISegmentedControl 的 segment 數量和標題。除此之外，在 UIAction 的 closure 裡我們也能方便地得到使用者選取的資料，比方以上例子的 gender。</p><figure name="fc6c" id="fc6c" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*Ra3hnuYqZQXX1R5PXcODBA.png" data-width="356" data-height="90" src="https://cdn-images-1.medium.com/max/800/1*Ra3hnuYqZQXX1R5PXcODBA.png"></figure><h3 name="1149" id="1149" class="graf graf--h3 graf-after--figure">設定某事件觸發的程式 — addAction(_:for:)</h3><p name="2e07" id="2e07" class="graf graf--p graf-after--h3">剛剛介紹的例子都在產生元件時傳入 UIAction，UIAction 的 closure 程式將在元件的主要事件發生時觸發，也難怪參數的名字叫 primaryAction。</p><p name="23d2" id="23d2" class="graf graf--p graf-after--p">那如果我們想設定其它事件呢 ? 比方 UITextField 的 editingDidEndOnExit，return 鍵按下的事件呢 ?</p><p name="ad90" id="ad90" class="graf graf--p graf-after--p">我們可以透過 <code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">addAction(_:for:)</strong></code> 加入對應某事件的 UIAction。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="12ee" id="12ee" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">addAction</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">action</span>: <span class="hljs-type">UIAction</span>, <span class="hljs-params">for</span> <span class="hljs-params">controlEvents</span>: <span class="hljs-type">UIControl</span>.<span class="hljs-type">Event</span>)</span></pre><p name="a013" id="a013" class="graf graf--p graf-after--pre">以下例子在 UITextField 的 editingDidEndOnExit 事件加入 UIAction。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="5c34" id="5c34" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewController</span>: <span class="hljs-title class_">UIViewController</span> {<br />    <br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {<br />        <span class="hljs-keyword">super</span>.viewDidLoad()<br />        <br />        <span class="hljs-keyword">let</span> textField <span class="hljs-operator">=</span> <span class="hljs-type">UITextField</span>(frame: <span class="hljs-type">CGRect</span>(x: <span class="hljs-number">10</span>, y: <span class="hljs-number">100</span>, width: <span class="hljs-number">200</span>, height: <span class="hljs-number">34</span>))<br />        textField.borderStyle <span class="hljs-operator">=</span> .roundedRect<br />        textField.addAction(<span class="hljs-type">UIAction</span>(handler: { <span class="hljs-keyword">_</span> <span class="hljs-keyword">in</span><br />        }), for: .editingDidEndOnExit)<br />        view.addSubview(textField)<br />    }<br />}</span></pre><p name="54aa" id="54aa" class="graf graf--p graf-after--pre">當 return 鍵按下時，鍵盤將收起來。值得注意的，此處 UIAction 的 closure 就算什麼都不寫也能收鍵盤，若要另外呼叫 view.endEditing(true) 收鍵盤也可以。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="5363" id="5363" class="graf graf--pre graf-after--p graf--trailing graf--preV2"><span class="pre--content">textField.addAction(<span class="hljs-type">UIAction</span>(handler: { [<span class="hljs-keyword">unowned</span> <span class="hljs-keyword">self</span>] action <span class="hljs-keyword">in</span><br />   <span class="hljs-keyword">self</span>.view.endEditing(<span class="hljs-literal">true</span>)<br />}), for: .editingDidEndOnExit)</span></pre></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@apppeterpan" class="p-author h-card">彼得潘的 iOS App Neverland</a> on <a href="https://medium.com/p/395bbaf7b2ff"><time class="dt-published" datetime="2021-07-02T12:50:30.422Z">July 2, 2021</time></a>.</p><p><a href="https://medium.com/@apppeterpan/%E5%88%A9%E7%94%A8-uiaction-%E8%A8%AD%E5%AE%9A-uicontrol-%E5%85%83%E4%BB%B6-%E8%A7%B8%E7%99%BC%E7%9A%84%E7%A8%8B%E5%BC%8F-395bbaf7b2ff" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on November 16, 2025.</p></footer></article></body></html>