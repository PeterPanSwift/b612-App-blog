<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Swift iOS App 的圖片上傳，以 remove.bg &amp; Imgur API 為例</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Swift iOS App 的圖片上傳，以 remove.bg &amp; Imgur API 為例</h1>
</header>
<section data-field="subtitle" class="p-summary">
網路上有很多幫助我們練習串接後台的第三方 API，不過如果想做到圖片上傳，相關的 API 就比較少了。彼得潘研究了一下，發現以下兩個 API 特別適合初學者練習圖片上傳的相關技術。
</section>
<section data-field="body" class="e-content">
<section name="1840" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="a88f" id="a88f" class="graf graf--h3 graf--leading graf--title">Swift iOS App 的圖片上傳，以 remove.bg &amp; Imgur API 為例</h3><figure name="5ea8" id="5ea8" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="1*3sWT7Krsjpo0P_5YlHjtTg.jpeg" data-width="1740" data-height="1128" src="https://cdn-images-1.medium.com/max/800/1*3sWT7Krsjpo0P_5YlHjtTg.jpeg"></figure><p name="ef28" id="ef28" class="graf graf--p graf-after--figure">網路上有很多適合練習串接後台的第三方 API，不過如果想上傳圖片，相關的 API 就比較少了。彼得潘研究了一下，發現以下兩個 API 特別適合初學者練習圖片上傳的相關技術。</p><ul class="postList"><li name="4e50" id="4e50" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">remove.bg</strong></li></ul><p name="6c71" id="6c71" class="graf graf--p graf-after--li">將圖片上傳去背的 API，可練習 multipart/form-data，application/json &amp; application/x-www-form-urlencoded 三種上傳的資料格式，以及 binary，base64 &amp; 圖片網址三種圖片格式。</p><ul class="postList"><li name="4b6a" id="4b6a" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">Imgur</strong></li></ul><p name="c43c" id="c43c" class="graf graf--p graf-after--li">將圖片存到雲端的 API，適合製作需要使用者上傳圖片的 App 應用。</p><p name="8f2a" id="8f2a" class="graf graf--p graf-after--p">接下來就讓我們以 remove.bg &amp; Imgur API 開發 SwiftUI &amp; UIKit App，一步步認識圖片上傳的相關技術吧。</p><h3 name="4095" id="4095" class="graf graf--h3 graf-after--p">將圖片去背的 <strong class="markup--strong markup--h3-strong">remove.bg</strong> API</h3><p name="17f7" id="17f7" class="graf graf--p graf-after--h3">remove.bg 提供強大的圖片去背功能。</p><div name="e24d" id="e24d" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://www.remove.bg" data-href="https://www.remove.bg" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://www.remove.bg"><strong class="markup--strong markup--mixtapeEmbed-strong">Remove Background from Image - remove.bg</strong><br><em class="markup--em markup--mixtapeEmbed-em">made with ♥ by All trademarks, service marks, trade names, product names, logos and trade dress appearing on our…</em>www.remove.bg</a><a href="https://www.remove.bg" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="fb2816ce25f0af3a34ec079009fc6322" data-thumbnail-img-id="0*Gjc-DlW2A6zVL6gW" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*Gjc-DlW2A6zVL6gW);"></a></div><p name="cbff" id="cbff" class="graf graf--p graf-after--mixtapeEmbed">我們可從網站上傳圖片，將彼得潘 &amp; 小王子在 B612 星球的合照去背。</p><figure name="2f17" id="2f17" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*dc3Z3gsit7FPUN-wEq6wuw.jpeg" data-width="1134" data-height="678" src="https://cdn-images-1.medium.com/max/800/1*dc3Z3gsit7FPUN-wEq6wuw.jpeg"></figure><figure name="8704" id="8704" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*OSV7Fbwfc7lVosNXhZ4Tgw.jpeg" data-width="1062" data-height="1218" src="https://cdn-images-1.medium.com/max/800/1*OSV7Fbwfc7lVosNXhZ4Tgw.jpeg"></figure><p name="ea80" id="ea80" class="graf graf--p graf-after--figure">如此神奇的去背功能，我們的 App 也可以擁有，因為 remove.bg 提供了去背 API。</p><div name="e332" id="e332" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://www.remove.bg/api" data-href="https://www.remove.bg/api" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://www.remove.bg/api"><strong class="markup--strong markup--mixtapeEmbed-strong">Background Removal API - remove.bg</strong><br><em class="markup--em markup--mixtapeEmbed-em">Get your API Key.Your first 50 API calls per month are on us (see Pricing).</em>www.remove.bg</a><a href="https://www.remove.bg/api" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="9fc7db7a5fa3a98fbadcd9db3d27322a" data-thumbnail-img-id="0*BrEL9slgT4K2FGFO" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*BrEL9slgT4K2FGFO);"></a></div><h3 name="cbc3" id="cbc3" class="graf graf--h3 graf-after--mixtapeEmbed">註冊帳號</h3><p name="5f9c" id="5f9c" class="graf graf--p graf-after--h3">為了使用 API，我們必須先註冊帳號。</p><div name="a46f" id="a46f" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://www.remove.bg/users/sign_in" data-href="https://www.remove.bg/users/sign_in" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://www.remove.bg/users/sign_in"><strong class="markup--strong markup--mixtapeEmbed-strong">Login - remove.bg</strong><br><em class="markup--em markup--mixtapeEmbed-em">made with ♥ by All trademarks, service marks, trade names, product names, logos and trade dress appearing on our…</em>www.remove.bg</a><a href="https://www.remove.bg/users/sign_in" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="2ac43c106990dd093bc2a27de19b4b90" data-thumbnail-img-id="0*dF7tkUdNJ7axIQfC" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*dF7tkUdNJ7axIQfC);"></a></div><h3 name="ec90" id="ec90" class="graf graf--h3 graf-after--mixtapeEmbed">取得 API key</h3><p name="f094" id="f094" class="graf graf--p graf-after--h3">有了 API key 才能串接 remove.bg API。請連到 API 的介紹頁面，點選 Get API Key。</p><div name="6505" id="6505" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://www.remove.bg/api" data-href="https://www.remove.bg/api" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://www.remove.bg/api"><strong class="markup--strong markup--mixtapeEmbed-strong">Background Removal API — remove.bg</strong><br><em class="markup--em markup--mixtapeEmbed-em">Get your API Key.Your first 50 API calls per month are on us (see Pricing).</em>www.remove.bg</a><a href="https://www.remove.bg/api" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="9fc7db7a5fa3a98fbadcd9db3d27322a" data-thumbnail-img-id="0*BrEL9slgT4K2FGFO" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*BrEL9slgT4K2FGFO);"></a></div><figure name="7a48" id="7a48" class="graf graf--figure graf-after--mixtapeEmbed"><img class="graf-image" data-image-id="1*417rVqeGr_l4FVQQsUlkdQ.jpeg" data-width="1522" data-height="964" src="https://cdn-images-1.medium.com/max/800/1*417rVqeGr_l4FVQQsUlkdQ.jpeg"></figure><p name="acfd" id="acfd" class="graf graf--p graf-after--figure">點選 API Key 旁的 Show，複製 API Key 的內容。</p><figure name="1643" id="1643" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*8gUKSFp9oPLSHqNC1cJFMw.jpeg" data-width="1676" data-height="728" src="https://cdn-images-1.medium.com/max/800/1*8gUKSFp9oPLSHqNC1cJFMw.jpeg"></figure><figure name="fe7e" id="fe7e" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*neN9HY5o_aDfbUhTnD9l_Q.jpeg" data-width="1684" data-height="484" src="https://cdn-images-1.medium.com/max/800/1*neN9HY5o_aDfbUhTnD9l_Q.jpeg"></figure><p name="fcb7" id="fcb7" class="graf graf--p graf-after--figure">為什麼需要 API key 呢 ? 因為這些第三方 API 通常需知道是誰使用 API。如下圖所示，remove.bg 免費的帳號一個月可去背 50 張圖片，所以它將利用 API key 做記錄和判斷。</p><figure name="ce2f" id="ce2f" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*2pH5pqwzUUcehpqCJjoMhA.jpeg" data-width="1288" data-height="1060" src="https://cdn-images-1.medium.com/max/800/1*2pH5pqwzUUcehpqCJjoMhA.jpeg"></figure><figure name="de07" id="de07" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*e2Qxs5fUfqTZNHYORuLpvQ.jpeg" data-width="1410" data-height="1160" src="https://cdn-images-1.medium.com/max/800/1*e2Qxs5fUfqTZNHYORuLpvQ.jpeg"><figcaption class="imageCaption">從網頁可了解目前還可以使用的 API 數量</figcaption></figure><h3 name="75fc" id="75fc" class="graf graf--h3 graf-after--figure">上傳資料的多種格式(Content Type)</h3><p name="2c58" id="2c58" class="graf graf--p graf-after--h3">上傳資料時，有許多不同的資料格式，比方 <code class="markup--code markup--p-code">multipart/form-data</code>，<code class="markup--code markup--p-code">application/json</code> &amp; <code class="markup--code markup--p-code">application/x-www-form-urlencoded</code> 。令人開心的，remove.bg API 三種格式都支援，我們可從 HTTP Header 的 Content-Type 設定，等下我們將一一示範。</p><figure name="202f" id="202f" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*CLMSne0ExxXuVzGsTo1xEg.jpeg" data-width="940" data-height="790" src="https://cdn-images-1.medium.com/max/800/1*CLMSne0ExxXuVzGsTo1xEg.jpeg"></figure><h3 name="250a" id="250a" class="graf graf--h3 graf-after--figure">上傳的圖片格式</h3><p name="a938" id="a938" class="graf graf--p graf-after--h3">上傳圖片時，圖片要先轉換成特定格式才能上傳，比方變成 binary，base64-encoded string &amp; 網址。令人開心的， remove.bg API 三種格式都支援。實在太幸運了，我們可以一次學到多種方法。</p><p name="6660" id="6660" class="graf graf--p graf-after--p">採用 multipart/form-data 上傳時，我們可選擇以下三種圖片格式:</p><ul class="postList"><li name="4160" id="4160" class="graf graf--li graf-after--p">binary 格式的圖片，對應的欄位名是 image_file。</li><li name="a8e8" id="a8e8" class="graf graf--li graf-after--li">base64-encoded string 格式的圖片，對應的欄位名是 image_file_b64。</li><li name="67d9" id="67d9" class="graf graf--li graf-after--li">指定圖片的網址，對應的欄位名是 image_url。</li></ul><figure name="d875" id="d875" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*6BlbxQCj3esnELJqyDv2Qw.jpeg" data-width="1132" data-height="1080" src="https://cdn-images-1.medium.com/max/800/1*6BlbxQCj3esnELJqyDv2Qw.jpeg"></figure><p name="1cb9" id="1cb9" class="graf graf--p graf-after--figure">採用 application/json 或 application/x-www-form-urlencoded 時，我們只有兩種選擇，上傳圖片的 base64-encoded 字串或指定圖片的網址。</p></div><div class="section-inner sectionLayout--outsetRow" data-paragraph-count="2"><figure name="9946" id="9946" class="graf graf--figure graf--layoutOutsetRow is-partialWidth graf-after--p" style="width: 50.19%;"><img class="graf-image" data-image-id="1*Pp-P0JjwtRAj4fsZbQ4TQQ.jpeg" data-width="1108" data-height="1050" src="https://cdn-images-1.medium.com/max/600/1*Pp-P0JjwtRAj4fsZbQ4TQQ.jpeg"></figure><figure name="4c69" id="4c69" class="graf graf--figure graf--layoutOutsetRowContinue is-partialWidth graf-after--figure" style="width: 49.81%;"><img class="graf-image" data-image-id="1*DAd36_5ORLNrboSbGHQkoQ.jpeg" data-width="1106" data-height="1056" src="https://cdn-images-1.medium.com/max/600/1*DAd36_5ORLNrboSbGHQkoQ.jpeg"></figure></div><div class="section-inner sectionLayout--insetColumn"><h3 name="d733" id="d733" class="graf graf--h3 graf-after--figure">回傳的去背圖片格式(Accept)</h3><p name="3708" id="3708" class="graf graf--p graf-after--h3">API 回傳的資料有 <code class="markup--code markup--p-code">image/*</code> &amp; <code class="markup--code markup--p-code">application/json</code> 兩種格式可選擇，我們可從 HTTP Header 的 <code class="markup--code markup--p-code">Accept</code> 設定。image/* 將回傳 binary 格式的圖片，application/json 則會回傳 base64-encoded string 格式的圖片。</p></div><div class="section-inner sectionLayout--outsetRow" data-paragraph-count="2"><figure name="9aef" id="9aef" class="graf graf--figure graf--layoutOutsetRow is-partialWidth graf-after--p" style="width: 52.858%;"><img class="graf-image" data-image-id="1*iTf7M3o1yiNQhh2IidmMJg.jpeg" data-width="1014" data-height="616" src="https://cdn-images-1.medium.com/max/800/1*iTf7M3o1yiNQhh2IidmMJg.jpeg"></figure><figure name="5399" id="5399" class="graf graf--figure graf--layoutOutsetRowContinue is-partialWidth graf-after--figure" style="width: 47.142%;"><img class="graf-image" data-image-id="1*-rQG8-d_jJ7Q-13TD72hQw.jpeg" data-width="1016" data-height="692" src="https://cdn-images-1.medium.com/max/600/1*-rQG8-d_jJ7Q-13TD72hQw.jpeg"></figure></div><div class="section-inner sectionLayout--insetColumn"><h3 name="54cb" id="54cb" class="graf graf--h3 graf-after--figure">準備去背的圖片</h3><p name="28a5" id="28a5" class="graf graf--p graf-after--h3">彼得潘 &amp; 小王子在 B612 星球的合照。</p><figure name="d8c8" id="d8c8" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*ozeDyM2scSwzBHev0Nc2EQ.jpeg" data-width="954" data-height="380" src="https://cdn-images-1.medium.com/max/800/1*ozeDyM2scSwzBHev0Nc2EQ.jpeg"></figure><p name="c5c6" id="c5c6" class="graf graf--p graf-after--figure">經過了前面漫長的準備，終於可以開始寫程式了。接下來就讓我們實驗各種有趣的圖片上傳方法吧。</p><h3 name="800d" id="800d" class="graf graf--h3 graf-after--p">測試 1: 以 multipart/form-data 上傳 binary 的圖片，然後得到 binary 的圖片，搭配 <strong class="markup--strong markup--h3-strong">Alamofire 套件</strong></h3><figure name="b218" id="b218" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="1*6BlbxQCj3esnELJqyDv2Qw.jpeg" data-width="1132" data-height="1080" src="https://cdn-images-1.medium.com/max/800/1*6BlbxQCj3esnELJqyDv2Qw.jpeg"></figure><p name="2c97" id="2c97" class="graf graf--p graf-after--figure">使用 iOS SDK 內建的 URLSession 上傳 multipart/form-data 的資料需要寫許多程式，比 JSON 格式複雜許多。因此我們先示範使用套件 Alamofire 上傳，待會再示範使用內建的 URLSession。</p><div name="5e6f" id="5e6f" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://github.com/Alamofire/Alamofire" data-href="https://github.com/Alamofire/Alamofire" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://github.com/Alamofire/Alamofire"><strong class="markup--strong markup--mixtapeEmbed-strong">Alamofire/Alamofire</strong><br><em class="markup--em markup--mixtapeEmbed-em">Alamofire is an HTTP networking library written in Swift. In order to keep Alamofire focused specifically on core…</em>github.com</a><a href="https://github.com/Alamofire/Alamofire" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="0442cc705bd645f90ba378453a237103" data-thumbnail-img-id="0*r_44mRrDawcoRP34" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*r_44mRrDawcoRP34);"></a></div><ul class="postList"><li name="1f0b" id="1f0b" class="graf graf--li graf-after--mixtapeEmbed"><strong class="markup--strong markup--li-strong">使用 SPM 安裝 Alamofire。</strong></li></ul><div name="0b46" id="0b46" class="graf graf--mixtapeEmbed graf-after--li"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E4%BD%BF%E7%94%A8-spm-%E5%AE%89%E8%A3%9D%E7%AC%AC%E4%B8%89%E6%96%B9%E5%A5%97%E4%BB%B6-xcode-11-%E6%96%B0%E5%8A%9F%E8%83%BD-2c4ffcf85b4b" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E4%BD%BF%E7%94%A8-spm-%E5%AE%89%E8%A3%9D%E7%AC%AC%E4%B8%89%E6%96%B9%E5%A5%97%E4%BB%B6-xcode-11-%E6%96%B0%E5%8A%9F%E8%83%BD-2c4ffcf85b4b" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E4%BD%BF%E7%94%A8-spm-%E5%AE%89%E8%A3%9D%E7%AC%AC%E4%B8%89%E6%96%B9%E5%A5%97%E4%BB%B6-xcode-11-%E6%96%B0%E5%8A%9F%E8%83%BD-2c4ffcf85b4b"><strong class="markup--strong markup--mixtapeEmbed-strong">使用 SPM 安裝第三方套件 — Xcode 11 新功能</strong><br><em class="markup--em markup--mixtapeEmbed-em">開發 iOS App 時，我們有許多管理安裝第三方套件的方法，其中最為人熟知的三大套件管理天王為 CocoaPods，SPM(Swift Package Manager) &amp; Carthage。</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E4%BD%BF%E7%94%A8-spm-%E5%AE%89%E8%A3%9D%E7%AC%AC%E4%B8%89%E6%96%B9%E5%A5%97%E4%BB%B6-xcode-11-%E6%96%B0%E5%8A%9F%E8%83%BD-2c4ffcf85b4b" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="68d7ca0f1f357213624de0f00073e1ac" data-thumbnail-img-id="1*MsiitLtlD6QsFEh13mIVWA.jpeg" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*MsiitLtlD6QsFEh13mIVWA.jpeg);"></a></div><ul class="postList"><li name="603a" id="603a" class="graf graf--li graf-after--mixtapeEmbed"><strong class="markup--strong markup--li-strong">在 NetworkManager 裡定義取得去背圖片的 function removeImageBg。</strong></li></ul><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="c363" id="c363" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> UIKit<br /><span class="hljs-keyword">import</span> Alamofire<br /><br /><span class="hljs-keyword">struct</span> <span class="hljs-title class_">NetworkManager</span> {<br />    <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> shared <span class="hljs-operator">=</span> <span class="hljs-type">NetworkManager</span>()<br />    <br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">removeImageBg</span>(<span class="hljs-params">uiImage</span>: <span class="hljs-type">UIImage</span>, <span class="hljs-params">completion</span>: <span class="hljs-keyword">@escaping</span> (<span class="hljs-type">UIImage</span>?) -&gt; <span class="hljs-type">Void</span>) {<br />        <span class="hljs-keyword">let</span> headers: <span class="hljs-type">HTTPHeaders</span> <span class="hljs-operator">=</span> [<br />            <span class="hljs-string">&quot;X-Api-Key&quot;</span>: <span class="hljs-string">&quot;123&quot;</span>,<br />        ]<br />        <br />        <span class="hljs-type">AF</span>.upload(multipartFormData: { data <span class="hljs-keyword">in</span><br />            <span class="hljs-keyword">let</span> imageData <span class="hljs-operator">=</span> uiImage.jpegData(compressionQuality: <span class="hljs-number">0.9</span>)<br />            data.append(imageData<span class="hljs-operator">!</span>, withName: <span class="hljs-string">&quot;image_file&quot;</span>, fileName: <span class="hljs-type">UUID</span>().uuidString, mimeType: <span class="hljs-string">&quot;image/jpeg&quot;</span>)<br />            <br />        }, to: <span class="hljs-string">&quot;https://api.remove.bg/v1.0/removebg&quot;</span>, headers: headers).responseData { response <span class="hljs-keyword">in</span><br />            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> data <span class="hljs-operator">=</span> response.data, <br />               <span class="hljs-keyword">let</span> image <span class="hljs-operator">=</span> <span class="hljs-type">UIImage</span>(data: data) {<br />                completion(image)<br />            } <span class="hljs-keyword">else</span> {<br />                completion(<span class="hljs-literal">nil</span>)<br />            }<br />        }<br />    }<br />}</span></pre><p name="ce12" id="ce12" class="graf graf--p graf-after--pre">說明:</p><pre name="7efe" id="7efe" class="graf graf--pre graf-after--p"><a href="https://api.remove.bg/v1.0/removebg" data-href="https://api.remove.bg/v1.0/removebg" class="markup--anchor markup--pre-anchor" rel="nofollow noopener noopener" target="_blank">https://api.remove.bg/v1.0/removebg</a></pre><p name="9f45" id="9f45" class="graf graf--p graf-after--pre">remove.bg 的 API 網址</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="f432" id="f432" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> headers: <span class="hljs-type">HTTPHeaders</span> <span class="hljs-operator">=</span> [<br />    <span class="hljs-string">&quot;X-Api-Key&quot;</span>: <span class="hljs-string">&quot;123&quot;</span>,<br />]</span></pre><p name="aeb2" id="aeb2" class="graf graf--p graf-after--pre">在 HTTP Header 裡以 <code class="markup--code markup--p-code">X-Api-Key</code> 設定 API key，如此才能順利串接 API 去背圖片。(練習時記得將 API key 改成自己帳號的 API key，範例裡的 API key 是假的)</p><figure name="eef8" id="eef8" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*HGCjBJe4kny1XACEzjvpEQ.jpeg" data-width="654" data-height="342" src="https://cdn-images-1.medium.com/max/800/1*HGCjBJe4kny1XACEzjvpEQ.jpeg"></figure><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="55b2" id="55b2" class="graf graf--pre graf-after--figure graf--preV2"><span class="pre--content"><span class="hljs-type">AF</span>.upload(multipartFormData: { data <span class="hljs-keyword">in</span><br />      <span class="hljs-keyword">let</span> imageData <span class="hljs-operator">=</span> uiImage.jpegData(compressionQuality: <span class="hljs-number">0.9</span>)<br />      data.append(imageData<span class="hljs-operator">!</span>, withName: <span class="hljs-string">&quot;image_file&quot;</span>, fileName: <span class="hljs-type">UUID</span>().uuidString, mimeType: <span class="hljs-string">&quot;image/jpeg&quot;</span>)<br />            <br />},</span></pre><p name="ac98" id="ac98" class="graf graf--p graf-after--pre">利用 AF 的 upload function 搭配參數 multipartFormData 上傳 multipart/form-data 格式的資料。在 closure 裡我們先將 UIImage 變成 Data，然後利用 append function 將它添加到上傳的 data。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="fb52" id="fb52" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> data <span class="hljs-operator">=</span> response.data, <br />   <span class="hljs-keyword">let</span> image <span class="hljs-operator">=</span> <span class="hljs-type">UIImage</span>(data: data) {<br />   completion(image)<br />}</span></pre><p name="d8a6" id="d8a6" class="graf graf--p graf-after--pre">API 回傳的資料格式預設是 image/*，因此它將回傳 binary 格式的圖片。binary 格式表示 API 回傳給我們的 Data 就是圖片，可以直接用 UIImage(data: data) 生成圖片。</p><p name="678e" id="678e" class="graf graf--p graf-after--p">有了 function removeImageBg，接下來只要呼叫它即可取得去背的圖片，以下分別為 SwiftUI &amp; UIKit 的範例:</p><h3 name="9a0c" id="9a0c" class="graf graf--h3 graf-after--p">SwiftUI App 範例</h3><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="eea1" id="eea1" class="graf graf--pre graf-after--h3 graf--preV2"><span class="pre--content"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ContentView</span>: <span class="hljs-title class_">View</span> {<br />    <span class="hljs-keyword">let</span> originalImage <span class="hljs-operator">=</span> <span class="hljs-type">UIImage</span>(named: <span class="hljs-string">&quot;peter&quot;</span>)<span class="hljs-operator">!</span><br />    <span class="hljs-meta">@State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> transparentUIImage: <span class="hljs-type">UIImage</span>?<br />    <br />    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {<br />        <span class="hljs-type">Image</span>(uiImage: transparentUIImage <span class="hljs-operator">??</span> originalImage)<br />            .resizable()<br />            .scaledToFit()<br />            .onTapGesture {<br />                <span class="hljs-type">NetworkManager</span>.shared.removeImageBg(uiImage: originalImage) { resultImage <span class="hljs-keyword">in</span><br />                    transparentUIImage <span class="hljs-operator">=</span> resultImage<br />                }<br />            }<br />    }<br />}</span></pre><p name="b4d9" id="b4d9" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">結果</strong></p><p name="98af" id="98af" class="graf graf--p graf-after--p">點選圖片後，圖片變成去背。</p><figure name="5032" id="5032" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*l7SuDB8XJpYJihNOJbYqfw.png" data-width="1200" data-height="1180" src="https://cdn-images-1.medium.com/max/800/1*l7SuDB8XJpYJihNOJbYqfw.png"></figure><h3 name="da5d" id="da5d" class="graf graf--h3 graf-after--figure">UIKit App 範例</h3><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="93d1" id="93d1" class="graf graf--pre graf-after--h3 graf--preV2"><span class="pre--content"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewController</span>: <span class="hljs-title class_">UIViewController</span> {<br />    <span class="hljs-keyword">@IBOutlet</span> <span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> removeBgImageView: <span class="hljs-type">UIImageView</span>!<br />    <br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {<br />        <span class="hljs-keyword">super</span>.viewDidLoad()<br />        <br />        <span class="hljs-type">NetworkManager</span>.shared.removeImageBg(uiImage: removeBgImageView.image<span class="hljs-operator">!</span>) { resultImage <span class="hljs-keyword">in</span><br />            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> resultImage {<br />                <span class="hljs-keyword">self</span>.removeBgImageView.image <span class="hljs-operator">=</span> resultImage<br />            }<br />        }<br />        <br />    }    <br />}</span></pre><h3 name="2fdc" id="2fdc" class="graf graf--h3 graf-after--pre">包含多個資料的 multipart/form-data</h3><p name="8118" id="8118" class="graf graf--p graf-after--h3">multipart/form-data 格式的 multipart 告訴我們它可以包含多個 part，所以除了圖片之外，它還可以包含其它資料，甚至有些 API 還可以在 multipart 裡包含多張圖片。</p><p name="2f1e" id="2f1e" class="graf graf--p graf-after--p">以下例子的 multipart/form-data 包含了代表圖片的 image_file &amp; 設定圖片背景色的 bg_color，它的內容為顏色的十六進位 RGB 字串，比方 00ffff。</p><figure name="01e3" id="01e3" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*wdPjwB4cD-1Ok3hgAXvBpQ.jpeg" data-width="574" data-height="176" src="https://cdn-images-1.medium.com/max/800/1*wdPjwB4cD-1Ok3hgAXvBpQ.jpeg"></figure><ul class="postList"><li name="566e" id="566e" class="graf graf--li graf-after--figure"><strong class="markup--strong markup--li-strong">使用 Alamofire</strong></li></ul><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="b394" id="b394" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content"><span class="hljs-type">AF</span>.upload(multipartFormData: { data <span class="hljs-keyword">in</span><br />    <span class="hljs-keyword">let</span> imageData <span class="hljs-operator">=</span> uiImage.jpegData(compressionQuality: <span class="hljs-number">0.9</span>)<br />    data.append(imageData<span class="hljs-operator">!</span>, withName: <span class="hljs-string">&quot;image_file&quot;</span>, fileName: <span class="hljs-type">UUID</span>().uuidString, mimeType: <span class="hljs-string">&quot;image/jpeg&quot;</span>)<br />    <span class="hljs-keyword">let</span> color <span class="hljs-operator">=</span> <span class="hljs-string">&quot;00ffff&quot;</span>.data(using: .utf8)<span class="hljs-operator">!</span><br />    data.append(color, withName: <span class="hljs-string">&quot;bg_color&quot;</span>)     <br />}, to: <span class="hljs-string">&quot;https://api.remove.bg/v1.0/removebg&quot;</span>, headers: headers)</span></pre><ul class="postList"><li name="7e2a" id="7e2a" class="graf graf--li graf-after--pre"><strong class="markup--strong markup--li-strong">使用 URLSession</strong></li></ul><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="d0cf" id="d0cf" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> parameters: [<span class="hljs-type">String</span>: <span class="hljs-keyword">Any</span>] <span class="hljs-operator">=</span> [<br />    <span class="hljs-string">&quot;image_file&quot;</span>: uiImage,<br />    <span class="hljs-string">&quot;bg_color&quot;</span>: <span class="hljs-string">&quot;00ffff&quot;</span><br />]<br />request.createMultipartFormData(parameters: parameters)</span></pre><p name="ea5d" id="ea5d" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">結果</strong></p><figure name="6d8a" id="6d8a" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*-mkz1YCw7FXjaevcXRWkVA.png" data-width="1400" data-height="2700" src="https://cdn-images-1.medium.com/max/800/1*-mkz1YCw7FXjaevcXRWkVA.png"></figure><h3 name="bc1e" id="bc1e" class="graf graf--h3 graf-after--figure">測試 2: 以 multipart/form-data 上傳 binary 的圖片，然後得到 binary 的圖片，搭配 URLSession</h3><p name="0a7a" id="0a7a" class="graf graf--p graf-after--h3">喜歡自力自強不靠套件的朋友也可以使用 URLSession 上傳 multipart/form-data，只是程式會複雜許多。</p><ul class="postList"><li name="53fd" id="53fd" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">在 Extension Data 裡添加 function appendString</strong></li></ul><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="4e69" id="4e69" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content"><span class="hljs-keyword">extension</span> <span class="hljs-title class_">Data</span> {<br />    <span class="hljs-keyword">mutating</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">appendString</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">string</span>: <span class="hljs-type">String</span>) {<br />        append(string.data(using: .utf8)<span class="hljs-operator">!</span>)<br />    }<br />}</span></pre><ul class="postList"><li name="51b6" id="51b6" class="graf graf--li graf-after--pre"><strong class="markup--strong markup--li-strong">在 Extension URLRequest 裡定義建立 multipart/form-data 資料的 function createMultipartFormData</strong></li></ul><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="b9bf" id="b9bf" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content"><span class="hljs-keyword">extension</span> <span class="hljs-title class_">URLRequest</span> {<br />    <br />    <span class="hljs-keyword">mutating</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">createMultipartFormData</span>(<span class="hljs-params">parameters</span>: [<span class="hljs-params">String</span>: <span class="hljs-keyword">Any</span>]) {<br />        <span class="hljs-keyword">let</span> boundary <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Boundary-<span class="hljs-subst">\(UUID().uuidString)</span>&quot;</span><br />        <span class="hljs-keyword">var</span> postData <span class="hljs-operator">=</span> <span class="hljs-type">Data</span>()<br />        <br />        <span class="hljs-keyword">for</span> (key, value) <span class="hljs-keyword">in</span> parameters {<br />            postData.appendString(<span class="hljs-string">&quot;--<span class="hljs-subst">\(boundary)</span><span class="hljs-subst">\r</span><span class="hljs-subst">\n</span>&quot;</span>)<br />            postData.appendString(<span class="hljs-string">&quot;Content-Disposition:form-data; name=<span class="hljs-subst">\&quot;</span><span class="hljs-subst">\(key)</span><span class="hljs-subst">\&quot;</span>;&quot;</span>)<br />            <br />            <span class="hljs-keyword">switch</span> value {<br />            <span class="hljs-keyword">case</span> <span class="hljs-keyword">let</span> value <span class="hljs-keyword">as</span> <span class="hljs-type">String</span>:<br />                postData.appendString(<span class="hljs-string">&quot;<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\(value)</span><span class="hljs-subst">\r</span><span class="hljs-subst">\n</span>&quot;</span>)<br />            <span class="hljs-keyword">case</span> <span class="hljs-keyword">let</span> value <span class="hljs-keyword">as</span> <span class="hljs-type">UIImage</span>:<br />                <span class="hljs-keyword">let</span> imageData <span class="hljs-operator">=</span> value.jpegData(compressionQuality: <span class="hljs-number">0.9</span>)<span class="hljs-operator">!</span><br />                <span class="hljs-keyword">let</span> fileName <span class="hljs-operator">=</span> <span class="hljs-type">UUID</span>().uuidString<br />                postData.appendString(<span class="hljs-string">&quot;filename=<span class="hljs-subst">\&quot;</span><span class="hljs-subst">\(fileName)</span><span class="hljs-subst">\&quot;</span><span class="hljs-subst">\r</span><span class="hljs-subst">\n</span>&quot;</span>)<br />                postData.appendString(<span class="hljs-string">&quot;Content-Type: image/jpeg<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span><span class="hljs-subst">\r</span><span class="hljs-subst">\n</span>&quot;</span>)<br />                postData.append(imageData)<br />                postData.appendString(<span class="hljs-string">&quot;<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span>&quot;</span>)<br />            <span class="hljs-keyword">default</span>:<br />                <span class="hljs-keyword">break</span><br />            }<br />        }<br />        postData.appendString(<span class="hljs-string">&quot;--<span class="hljs-subst">\(boundary)</span>--<span class="hljs-subst">\r</span><span class="hljs-subst">\n</span>&quot;</span>)<br />        httpBody <span class="hljs-operator">=</span> postData<br />        setValue(<span class="hljs-string">&quot;multipart/form-data; boundary=<span class="hljs-subst">\(boundary)</span>&quot;</span>, forHTTPHeaderField: <span class="hljs-string">&quot;Content-Type&quot;</span>)<br />   }<br />    <br />}</span></pre><p name="b39c" id="b39c" class="graf graf--p graf-after--pre">相較於 Alamofire，以上的程式複雜許多，因為我們要自己組合出 multipart/form-data 的資料，加入 \r\n &amp; boundary 等在 multipart 裡用來分隔資料的字元，在此我們使用 <code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">&quot;Boundary-\(UUID().uuidString)&quot;</strong></code>當 boundary。</p><p name="bdbd" id="bdbd" class="graf graf--p graf-after--p">基本上 boundary 可使用任何字串，因此如果你暗戀某個女生，比方angelababy，你也可以用 angelababy 當 boundary。(ps: 嚴格來說 boundary 還是有一些限制，它不能超過 70 bytes，而且只能包含 7-bit US-ASCII 裡的字元。)</p><p name="9d18" id="9d18" class="graf graf--p graf-after--p">值得注意的，要記得設定 HTTP Header 的 Content-Type，並在裡面包含 boundary，如此後台才會知道我們上傳的格式是 multipart/form-data 和 boundary 的內容。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="b55f" id="b55f" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">setValue(<span class="hljs-string">&quot;multipart/form-data; boundary=<span class="hljs-subst">\(boundary)</span>&quot;</span>, forHTTPHeaderField: <span class="hljs-string">&quot;Content-Type&quot;</span>)</span></pre><ul class="postList"><li name="0437" id="0437" class="graf graf--li graf-after--pre"><strong class="markup--strong markup--li-strong">定義取得去背圖片的 function removeImageBg</strong></li></ul><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="c9cd" id="c9cd" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">NetworkManager</span> {<br />    <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> shared <span class="hljs-operator">=</span> <span class="hljs-type">NetworkManager</span>()<br />    <br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">removeImageBg</span>(<span class="hljs-params">uiImage</span>: <span class="hljs-type">UIImage</span>, <span class="hljs-params">completion</span>: <span class="hljs-keyword">@escaping</span> (<span class="hljs-type">UIImage</span>?) -&gt; <span class="hljs-type">Void</span>) {<br />       <br />        <span class="hljs-keyword">var</span> request <span class="hljs-operator">=</span> <span class="hljs-type">URLRequest</span>(url: <span class="hljs-type">URL</span>(string: <span class="hljs-string">&quot;https://api.remove.bg/v1.0/removebg&quot;</span>)<span class="hljs-operator">!</span>)<br />        request.httpMethod <span class="hljs-operator">=</span> <span class="hljs-string">&quot;post&quot;</span><br />        request.setValue(<span class="hljs-string">&quot;123&quot;</span>, forHTTPHeaderField: <span class="hljs-string">&quot;X-Api-Key&quot;</span>)<br />        <span class="hljs-keyword">let</span> parameters <span class="hljs-operator">=</span> [<br />            <span class="hljs-string">&quot;image_file&quot;</span>: uiImage<br />        ]<br />        request.createMultipartFormData(parameters: parameters)<br />        <span class="hljs-type">URLSession</span>.shared.dataTask(with: request) { data, response, error <span class="hljs-keyword">in</span><br />            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> data,<br />               <span class="hljs-keyword">let</span> image <span class="hljs-operator">=</span> <span class="hljs-type">UIImage</span>(data: data) {<br />                completion(image)<br />            } <span class="hljs-keyword">else</span> {<br />                completion(<span class="hljs-literal">nil</span>)<br />            }<br />        }.resume()<br />    }<br />}</span></pre><p name="2656" id="2656" class="graf graf--p graf-after--pre">將 multipart/form-data 欲上傳的資料存在 parameters 裡，然後呼叫 createMultipartFormData 將它轉換成 multipart/form-data 格式的 Data，存在 httpBody 裡。</p><p name="8e5c" id="8e5c" class="graf graf--p graf-after--p">剛剛的程式若要在 UIKit App 測試，呼叫 removeImageBg 取得去背圖片後，記得要切換到 main thread 才能更新 App 畫面。</p><h3 name="b86b" id="b86b" class="graf graf--h3 graf-after--p">測試 3: 以 multipart/form-data 上傳 binary 的圖片，然後得到 base64-encoded string 的圖片，搭配 Alamofire 套件</h3><p name="4b1c" id="4b1c" class="graf graf--p graf-after--h3">我們也可以設定 HTTP Header 的 <code class="markup--code markup--p-code">Accept</code> ，調整 API 回傳的資料格式。remove.bg 支援 <code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">image/*</strong></code> ＆ <code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">application/json</strong></code> 兩種格式，預設是 image/*。</p><p name="7309" id="7309" class="graf graf--p graf-after--p">接下來讓我們試試 application/json。從下圖的說明，我們得知 API 回傳的 JSON 資料裡，result_b64 欄位將帶有 <code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">base64-encoded string</strong></code> 格式的圖片</p><figure name="10f1" id="10f1" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*-rQG8-d_jJ7Q-13TD72hQw.jpeg" data-width="1016" data-height="692" src="https://cdn-images-1.medium.com/max/800/1*-rQG8-d_jJ7Q-13TD72hQw.jpeg"></figure><ul class="postList"><li name="7935" id="7935" class="graf graf--li graf-after--figure"><strong class="markup--strong markup--li-strong">定義 API 回傳的 JSON 對應的 Decodable 型別</strong></li></ul><p name="aede" id="aede" class="graf graf--p graf-after--li">雖然 JSON 裡的欄位是包含底線的 result_b64，但是我們宣告成 resultB64，因為待會 JSONDecoder 可以幫我們轉換。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="9c0f" id="9c0f" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ReturnImageData</span>: <span class="hljs-title class_">Decodable</span> {<br />    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">ResultB64</span>: <span class="hljs-title class_">Decodable</span> {<br />        <span class="hljs-keyword">let</span> resultB64: <span class="hljs-type">String</span><br />    }<br />    <br />    <span class="hljs-keyword">let</span> data: <span class="hljs-type">ResultB64</span><br />}</span></pre><ul class="postList"><li name="9b12" id="9b12" class="graf graf--li graf-after--pre"><strong class="markup--strong markup--li-strong">定義取得去背圖片的 function removeImageBg</strong></li></ul><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="002e" id="002e" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">removeImageBg</span>(<span class="hljs-params">uiImage</span>: <span class="hljs-type">UIImage</span>, <span class="hljs-params">completion</span>: <span class="hljs-keyword">@escaping</span> (<span class="hljs-type">UIImage</span>?) -&gt; <span class="hljs-type">Void</span>) {<br />        <br />       <span class="hljs-keyword">let</span> headers: <span class="hljs-type">HTTPHeaders</span> <span class="hljs-operator">=</span> [<br />           <span class="hljs-string">&quot;X-Api-Key&quot;</span>: <span class="hljs-string">&quot;123&quot;</span>,<br />           <span class="hljs-string">&quot;Accept&quot;</span>: <span class="hljs-string">&quot;application/json&quot;</span><br />       ]<br />       <span class="hljs-keyword">let</span> decoder <span class="hljs-operator">=</span> <span class="hljs-type">JSONDecoder</span>()<br />       decoder.keyDecodingStrategy <span class="hljs-operator">=</span> .convertFromSnakeCase<br />        <br />       <span class="hljs-type">AF</span>.upload(multipartFormData: { data <span class="hljs-keyword">in</span><br />           <span class="hljs-keyword">let</span> imageData <span class="hljs-operator">=</span> uiImage.jpegData(compressionQuality: <span class="hljs-number">0.9</span>)<br />           data.append(imageData<span class="hljs-operator">!</span>, withName: <span class="hljs-string">&quot;image_file&quot;</span>, fileName: <span class="hljs-type">UUID</span>().uuidString, mimeType: <span class="hljs-string">&quot;image/jpeg&quot;</span>)<br />           <br />       }, to: <span class="hljs-string">&quot;https://api.remove.bg/v1.0/removebg&quot;</span>, headers: headers).responseDecodable(of: <span class="hljs-type">ReturnImageData</span>.<span class="hljs-keyword">self</span>, queue: .main, decoder: decoder) { response <span class="hljs-keyword">in</span><br />           <span class="hljs-keyword">switch</span> response.result {<br />           <span class="hljs-keyword">case</span> .success(<span class="hljs-keyword">let</span> imageData):<br />               <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> data <span class="hljs-operator">=</span> <span class="hljs-type">Data</span>(base64Encoded: imageData.data.resultB64), <br />           <span class="hljs-keyword">let</span> image <span class="hljs-operator">=</span> <span class="hljs-type">UIImage</span>(data: data) {<br />                   completion(image)<br />               }<br />           <span class="hljs-keyword">case</span> .failure(<span class="hljs-keyword">_</span>):<br />               completion(<span class="hljs-literal">nil</span>)<br />           }<br />       }<br />    <br />}</span></pre><p name="119f" id="119f" class="graf graf--p graf-after--pre">利用 function responseDecodable 將回傳的 JSON 轉換成自訂的型別 ReturnImageData，然後從 case .success(let imageData) 的參數 imageData 讀取。</p><figure name="0255" id="0255" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*qqRBEub7KMifAGFVuQQt8Q.jpeg" data-width="1094" data-height="376" src="https://cdn-images-1.medium.com/max/800/1*qqRBEub7KMifAGFVuQQt8Q.jpeg"></figure><p name="6007" id="6007" class="graf graf--p graf-after--figure">字串型別的 imageData.data.resultB64 存著 base64-encoded string 格式的圖片，因此我們先用 <code class="markup--code markup--p-code">Data(base64Encoded: imageData.data.resultB64)</code> 將它變成 Data，然後再將 Data 變成 UIImage。</p><figure name="11aa" id="11aa" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*FT5I6QfdZWYN_OxGJfQWBQ.jpeg" data-width="1726" data-height="1054" src="https://cdn-images-1.medium.com/max/800/1*FT5I6QfdZWYN_OxGJfQWBQ.jpeg"></figure><div name="ea0f" id="ea0f" class="graf graf--mixtapeEmbed graf-after--figure"><a href="https://developer.apple.com/documentation/foundation/nsdata/1417833-init" data-href="https://developer.apple.com/documentation/foundation/nsdata/1417833-init" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/foundation/nsdata/1417833-init"><strong class="markup--strong markup--mixtapeEmbed-strong">init(base64Encoded:options:)</strong><br><em class="markup--em markup--mixtapeEmbed-em">Declaration A data object containing the Base64 decoded data. Returns if the data object could not be decoded. The…</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/foundation/nsdata/1417833-init" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="f9d07a1ca877fe14904568fd052dd831"></a></div><p name="d181" id="d181" class="graf graf--p graf-after--mixtapeEmbed">值得注意的，當圖片以 base64 格式回傳時，會比原本 binary 格式大，大約大了三十幾 %。</p><pre name="0251" id="0251" class="graf graf--pre graf-after--p">binary: 95554 bytes<br>包含 base64 的 JSON: 127434 bytes</pre><p name="b10c" id="b10c" class="graf graf--p graf-after--pre">ps:</p><ol class="postList"><li name="26be" id="26be" class="graf graf--li graf-after--p">對圖片的 base64 字串好奇的朋友，可參考以下圖片的範例。</li></ol><figure name="3859" id="3859" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*4paMTWBT8jB2IO2fJfnegg.jpeg" data-width="990" data-height="992" src="https://cdn-images-1.medium.com/max/800/1*4paMTWBT8jB2IO2fJfnegg.jpeg"></figure><p name="6aa0" id="6aa0" class="graf graf--p graf-after--figure">2. 有興趣的朋友也可以將 base64 字串貼到以下網站測試，它會將 base64 字串變成美美的圖片。</p><div name="e22b" id="e22b" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://codebeautify.org/base64-to-image-converter" data-href="https://codebeautify.org/base64-to-image-converter" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://codebeautify.org/base64-to-image-converter"><strong class="markup--strong markup--mixtapeEmbed-strong">Best Online Base64 to Image Decoder / Converter</strong><br><em class="markup--em markup--mixtapeEmbed-em">Converts base64 string into image. It&#39;s easy to use base64 image decoder which helps to decode picture and Download.</em>codebeautify.org</a><a href="https://codebeautify.org/base64-to-image-converter" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="c2df7d3069423997ab5caa77fea992ac" data-thumbnail-img-id="0*MSMFMq6woxtmj3JD" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*MSMFMq6woxtmj3JD);"></a></div><figure name="d01d" id="d01d" class="graf graf--figure graf-after--mixtapeEmbed"><img class="graf-image" data-image-id="1*zC9tPaD7Rfi4fPk9RYM7nQ.jpeg" data-width="2198" data-height="1232" src="https://cdn-images-1.medium.com/max/800/1*zC9tPaD7Rfi4fPk9RYM7nQ.jpeg"></figure><h3 name="c8f9" id="c8f9" class="graf graf--h3 graf-after--figure">測試 4: 以 application/json 上傳圖片的 base64 字串，然後得到 binary 的圖片</h3><p name="f3a5" id="f3a5" class="graf graf--p graf-after--h3">以 application/json 上傳時，在欄位 image_file_b64 指定圖片的 base64-encoded string。</p><figure name="dc2a" id="dc2a" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*Pp-P0JjwtRAj4fsZbQ4TQQ.jpeg" data-width="1108" data-height="1050" src="https://cdn-images-1.medium.com/max/800/1*Pp-P0JjwtRAj4fsZbQ4TQQ.jpeg"></figure><ul class="postList"><li name="13a0" id="13a0" class="graf graf--li graf-after--figure"><strong class="markup--strong markup--li-strong">定義上傳的 JSON 資料對應的 Encodable 型別</strong></li></ul><p name="3b92" id="3b92" class="graf graf--p graf-after--li">常數 imageFileB64 將儲存圖片的 base64-encoded string。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="c602" id="c602" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">UploadImageJSON</span>: <span class="hljs-title class_">Encodable</span> {<br />    <span class="hljs-keyword">let</span> imageFileB64: <span class="hljs-type">String</span><br />}</span></pre><ul class="postList"><li name="f3db" id="f3db" class="graf graf--li graf-after--pre"><strong class="markup--strong markup--li-strong">定義取得去背圖片的 function removeImageBg</strong></li></ul><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="978f" id="978f" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">removeImageBg</span>(<span class="hljs-params">uiImage</span>: <span class="hljs-type">UIImage</span>, <span class="hljs-params">completion</span>: <span class="hljs-keyword">@escaping</span> (<span class="hljs-type">UIImage</span>?) -&gt; <span class="hljs-type">Void</span>) {<br />    <span class="hljs-keyword">let</span> imageData <span class="hljs-operator">=</span> uiImage.jpegData(compressionQuality: <span class="hljs-number">0.9</span>)<br />    <span class="hljs-keyword">let</span> base64Str <span class="hljs-operator">=</span> imageData<span class="hljs-operator">!</span>.base64EncodedString()<br />    <span class="hljs-keyword">let</span> uploadImageJSON <span class="hljs-operator">=</span> <span class="hljs-type">UploadImageJSON</span>(imageFileB64: base64Str)<br />    <span class="hljs-keyword">let</span> encoder <span class="hljs-operator">=</span> <span class="hljs-type">JSONEncoder</span>()<br />    encoder.keyEncodingStrategy <span class="hljs-operator">=</span> .convertToSnakeCase<br />        <br />    <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> uploadData <span class="hljs-operator">=</span> <span class="hljs-keyword">try?</span> encoder.encode(uploadImageJSON) {<br />        <span class="hljs-keyword">let</span> url <span class="hljs-operator">=</span> <span class="hljs-type">URL</span>(string: <span class="hljs-string">&quot;https://api.remove.bg/v1.0/removebg&quot;</span>)<span class="hljs-operator">!</span><br />        <span class="hljs-keyword">var</span> request <span class="hljs-operator">=</span> <span class="hljs-type">URLRequest</span>(url: url)<br />        request.httpMethod <span class="hljs-operator">=</span> <span class="hljs-string">&quot;POST&quot;</span><br />        request.setValue(<span class="hljs-string">&quot;123&quot;</span>, forHTTPHeaderField: <span class="hljs-string">&quot;X-Api-Key&quot;</span>)<br />        request.setValue(<span class="hljs-string">&quot;application/json&quot;</span>, forHTTPHeaderField: <span class="hljs-string">&quot;Content-Type&quot;</span>)<br />        <span class="hljs-type">URLSession</span>.shared.uploadTask(with: request, from: uploadData) { data, response, error <span class="hljs-keyword">in</span><br />            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> data, <br />               <span class="hljs-keyword">let</span> image <span class="hljs-operator">=</span> <span class="hljs-type">UIImage</span>(data: data) {<br />                 completion(image)<br />            } <span class="hljs-keyword">else</span> {<br />                 completion(<span class="hljs-literal">nil</span>)<br />            }                <br />        }.resume() <br />    }<br />}</span></pre><p name="52f8" id="52f8" class="graf graf--p graf-after--pre">說明。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="092f" id="092f" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> imageData <span class="hljs-operator">=</span> uiImage.jpegData(compressionQuality: <span class="hljs-number">0.9</span>)<br /><span class="hljs-keyword">let</span> base64Str <span class="hljs-operator">=</span> imageData<span class="hljs-operator">!</span>.base64EncodedString()<br /><span class="hljs-keyword">let</span> uploadImageJSON <span class="hljs-operator">=</span> <span class="hljs-type">UploadImageJSON</span>(imageFileB64: base64Str)</span></pre><p name="92f0" id="92f0" class="graf graf--p graf-after--pre">由於 application/json 裡要包含圖片的 base64 字串，因此我們先用 jpegData 將 UIImage 變成 Data，然後用 base64EncodedString 將圖片從 Data 變成 base64 的 String，最後再生成準備上傳的 UploadImageJSON 物件。</p><figure name="65c7" id="65c7" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*ZvHL_cXf1n5rj7O_9qm6Ag.jpeg" data-width="1622" data-height="1128" src="https://cdn-images-1.medium.com/max/800/1*ZvHL_cXf1n5rj7O_9qm6Ag.jpeg"></figure><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="d0b2" id="d0b2" class="graf graf--pre graf-after--figure graf--preV2"><span class="pre--content">request.setValue(<span class="hljs-string">&quot;application/json&quot;</span>, forHTTPHeaderField: <span class="hljs-string">&quot;Content-Type&quot;</span>)</span></pre><p name="4484" id="4484" class="graf graf--p graf-after--pre">設定上傳的 Content-Type 為 application/json。</p><h3 name="0702" id="0702" class="graf graf--h3 graf-after--p"><strong class="markup--strong markup--h3-strong">測試 5: 以 application</strong>/<strong class="markup--strong markup--h3-strong">x</strong>-www-<strong class="markup--strong markup--h3-strong">form</strong>-<strong class="markup--strong markup--h3-strong">urlencoded 上傳圖片網址，</strong>然後得到 binary 的圖片</h3><p name="5980" id="5980" class="graf graf--p graf-after--h3">以 application/x-www-form-urlencoded 上傳，在欄位 image_url 指定圖片的網址。</p><figure name="aa7d" id="aa7d" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*DAd36_5ORLNrboSbGHQkoQ.jpeg" data-width="1106" data-height="1056" src="https://cdn-images-1.medium.com/max/800/1*DAd36_5ORLNrboSbGHQkoQ.jpeg"></figure><p name="1a9e" id="1a9e" class="graf graf--p graf-after--figure">比方我們試試帥氣的 spider man 圖片網址。</p><pre name="cf44" id="cf44" class="graf graf--pre graf-after--p"><a href="https://static.highsnobiety.com/thumbor/Q6NeReGHDI1KEJOEs5DGWsFbJOA=/fit-in/480x320/smart/static.highsnobiety.com/wp-content/uploads/2019/08/21111543/tom-holland-spider-man-fan-reacts-01.jpg" data-href="https://static.highsnobiety.com/thumbor/Q6NeReGHDI1KEJOEs5DGWsFbJOA=/fit-in/480x320/smart/static.highsnobiety.com/wp-content/uploads/2019/08/21111543/tom-holland-spider-man-fan-reacts-01.jpg" class="markup--anchor markup--pre-anchor" rel="nofollow noopener" target="_blank">https://static.highsnobiety.com/thumbor/Q6NeReGHDI1KEJOEs5DGWsFbJOA=/fit-in/480x320/smart/static.highsnobiety.com/wp-content/uploads/2019/08/21111543/tom-holland-spider-man-fan-reacts-01.jpg</a></pre><figure name="ef35" id="ef35" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*xjsUqi8nXmdTx8bEyjsxgA.jpeg" data-width="480" data-height="320" src="https://cdn-images-1.medium.com/max/800/1*xjsUqi8nXmdTx8bEyjsxgA.jpeg"></figure><ul class="postList"><li name="64eb" id="64eb" class="graf graf--li graf-after--figure"><strong class="markup--strong markup--li-strong">定義取得去背圖片的 function removeImageBg</strong></li></ul><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="2cb5" id="2cb5" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">removeImageBg</span>(<span class="hljs-params">urlString</span>: <span class="hljs-type">String</span>, <span class="hljs-params">completion</span>: <span class="hljs-keyword">@escaping</span> (<span class="hljs-type">UIImage</span>?) -&gt; <span class="hljs-type">Void</span>) {<br />        <br />        <span class="hljs-keyword">let</span> encodeString <span class="hljs-operator">=</span> <span class="hljs-string">&quot;image_url=<span class="hljs-subst">\(urlString)</span>&quot;</span><br />        <br />        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> uploadData <span class="hljs-operator">=</span> encodeString.data(using: .utf8) {<br />            <span class="hljs-keyword">let</span> url <span class="hljs-operator">=</span> <span class="hljs-type">URL</span>(string: <span class="hljs-string">&quot;https://api.remove.bg/v1.0/removebg&quot;</span>)<span class="hljs-operator">!</span><br />            <span class="hljs-keyword">var</span> request <span class="hljs-operator">=</span> <span class="hljs-type">URLRequest</span>(url: url)<br />            request.httpMethod <span class="hljs-operator">=</span> <span class="hljs-string">&quot;POST&quot;</span><br />            request.setValue(<span class="hljs-string">&quot;123&quot;</span>, forHTTPHeaderField: <span class="hljs-string">&quot;X-Api-Key&quot;</span>)<br />            request.setValue(<span class="hljs-string">&quot;application/x-www-form-urlencoded&quot;</span>, forHTTPHeaderField: <span class="hljs-string">&quot;Content-Type&quot;</span>)<br />            <span class="hljs-type">URLSession</span>.shared.uploadTask(with: request, from: uploadData) { data, response, error <span class="hljs-keyword">in</span><br />                    <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> data, <br />                       <span class="hljs-keyword">let</span> image <span class="hljs-operator">=</span> <span class="hljs-type">UIImage</span>(data: data) {<br />                        completion(image)<br />                    } <span class="hljs-keyword">else</span> {<br />                        completion(<span class="hljs-literal">nil</span>)<br />                    }                <br />            }.resume()<br />        }<br />        <br />}</span></pre><p name="bfa4" id="bfa4" class="graf graf--p graf-after--pre">說明</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="7c2e" id="7c2e" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> encodeString <span class="hljs-operator">=</span> <span class="hljs-string">&quot;image_url=<span class="hljs-subst">\(urlString)</span>&quot;</span><br />        <br /><span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> uploadData <span class="hljs-operator">=</span> encodeString.data(using: .utf8) {</span></pre><p name="c69c" id="c69c" class="graf graf--p graf-after--pre">application/x-www-form-urlencoded 的字串格式如下:</p><figure name="14ea" id="14ea" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*09cYtNcpn0Xah7budoWcBA.jpeg" data-width="642" data-height="160" src="https://cdn-images-1.medium.com/max/800/1*09cYtNcpn0Xah7budoWcBA.jpeg"></figure><p name="1080" id="1080" class="graf graf--p graf-after--figure">因此我們先組合出字串 encodeString 後，再將它變成以 utf8 編碼的 Data 上傳。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="f4d2" id="f4d2" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">request.setValue(<span class="hljs-string">&quot;application/x-www-form-urlencoded&quot;</span>, forHTTPHeaderField: <span class="hljs-string">&quot;Content-Type&quot;</span>)</span></pre><p name="ad0b" id="ad0b" class="graf graf--p graf-after--pre">設定上傳的 Content-Type 為 application/x-www-form-urlencoded。</p><p name="6070" id="6070" class="graf graf--p graf-after--p">呼叫 function removeImageBg，傳入 spider man 的圖片網址後，順利看到帥氣的去背 spider man。</p><figure name="4783" id="4783" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*q7HZZBgmVf5W1L6SvDU4Mg.jpeg" data-width="808" data-height="1478" src="https://cdn-images-1.medium.com/max/800/1*q7HZZBgmVf5W1L6SvDU4Mg.jpeg"></figure><h3 name="2fe0" id="2fe0" class="graf graf--h3 graf-after--figure">將圖片存到雲端的 Imgur API</h3><p name="1c84" id="1c84" class="graf graf--p graf-after--h3">網站 Imgur 佛心地提供免費的空間，讓我們可以自由地上傳圖片存到雲端。</p><div name="ae80" id="ae80" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://imgur.com" data-href="https://imgur.com" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://imgur.com"><strong class="markup--strong markup--mixtapeEmbed-strong">Imgur</strong><br><em class="markup--em markup--mixtapeEmbed-em">Discover the magic of the internet at Imgur, a community powered entertainment destination. Lift your spirits with…</em>imgur.com</a><a href="https://imgur.com" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="40cebce46825d4718d12e24a83aaba72" data-thumbnail-img-id="0*OSwVG92oaw5RadtT" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*OSwVG92oaw5RadtT);"></a></div><figure name="270f" id="270f" class="graf graf--figure graf-after--mixtapeEmbed"><img class="graf-image" data-image-id="1*Yu7Unw7oFzF282aYthIICw.jpeg" data-width="2486" data-height="1282" src="https://cdn-images-1.medium.com/max/800/1*Yu7Unw7oFzF282aYthIICw.jpeg"></figure><p name="13ba" id="13ba" class="graf graf--p graf-after--figure">這麼棒的功能，我們的 App 也可以享有，因為 Imgur 提供了圖片上傳的 API。</p><div name="0109" id="0109" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://apidocs.imgur.com" data-href="https://apidocs.imgur.com" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://apidocs.imgur.com"><strong class="markup--strong markup--mixtapeEmbed-strong">Imgur API</strong><br><em class="markup--em markup--mixtapeEmbed-em">image](https://i.imgur.com/n744BL9.png) ## API Status Status for the API can be found at…</em>apidocs.imgur.com</a><a href="https://apidocs.imgur.com" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="c19b56ed4bedda54807289cc29f87633" data-thumbnail-img-id="0*xZO8Z1GBTErbYts7" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*xZO8Z1GBTErbYts7);"></a></div><h3 name="c001" id="c001" class="graf graf--h3 graf-after--mixtapeEmbed">註冊帳號</h3><p name="97d5" id="97d5" class="graf graf--p graf-after--h3">為了使用 API，我們必須先註冊帳號。</p><div name="a968" id="a968" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://imgur.com/signin" data-href="https://imgur.com/signin" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://imgur.com/signin"><strong class="markup--strong markup--mixtapeEmbed-strong">Imgur</strong><br><em class="markup--em markup--mixtapeEmbed-em">Imgur is the easiest way to discover and enjoy the magic of the Internet.</em>imgur.com</a><a href="https://imgur.com/signin" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="a496aee6bcd80487b7c1550167470945" data-thumbnail-img-id="0*AnhrI1A0rJS6M1tQ" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*AnhrI1A0rJS6M1tQ);"></a></div><figure name="937f" id="937f" class="graf graf--figure graf-after--mixtapeEmbed"><img class="graf-image" data-image-id="1*_Ewr-DbNB4ThjigoqeKzKA.jpeg" data-width="610" data-height="538" src="https://cdn-images-1.medium.com/max/800/1*_Ewr-DbNB4ThjigoqeKzKA.jpeg"></figure><h3 name="97e1" id="97e1" class="graf graf--h3 graf-after--figure">Register App，取得 Client ID &amp; Client secret</h3><p name="2610" id="2610" class="graf graf--p graf-after--h3">除了註冊帳號，還要註冊 App 得到 Client ID 才能使用 API。</p><div name="be24" id="be24" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://api.imgur.com/oauth2/addclient" data-href="https://api.imgur.com/oauth2/addclient" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://api.imgur.com/oauth2/addclient"><strong class="markup--strong markup--mixtapeEmbed-strong">Imgur</strong><br><em class="markup--em markup--mixtapeEmbed-em">Imgur is the easiest way to discover and enjoy the magic of the Internet.</em>api.imgur.com</a><a href="https://api.imgur.com/oauth2/addclient" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="99ece8f60a0dd892205605645dcd0f1a" data-thumbnail-img-id="0*HItpJqOhPCTpnzjw" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*HItpJqOhPCTpnzjw);"></a></div><p name="a3fb" id="a3fb" class="graf graf--p graf-after--mixtapeEmbed">選擇 OAuth 2 authorization without a callback URL。</p><figure name="9e49" id="9e49" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*5ccijzkvCNVt3hM-fjGL0Q.jpeg" data-width="1232" data-height="1024" src="https://cdn-images-1.medium.com/max/800/1*5ccijzkvCNVt3hM-fjGL0Q.jpeg"></figure><p name="30b7" id="30b7" class="graf graf--p graf-after--figure">順利建立 App 後，我們將看到以下的 Client ID &amp; Client secret。</p><figure name="a3f2" id="a3f2" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*jyrwYMCKQ8XWupKj7fJaCQ.jpeg" data-width="1490" data-height="776" src="https://cdn-images-1.medium.com/max/800/1*jyrwYMCKQ8XWupKj7fJaCQ.jpeg"></figure><p name="1e4d" id="1e4d" class="graf graf--p graf-after--figure">請將 Client ID 記起來，待會發送 API 時會用到。若是不小心忘了，請登入 Imgur 網站後從右上方點選 Settings。</p><figure name="9789" id="9789" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*Q6oVdcc71nTHcjxM8xDk_A.jpeg" data-width="246" data-height="380" src="https://cdn-images-1.medium.com/max/800/1*Q6oVdcc71nTHcjxM8xDk_A.jpeg"></figure><p name="f875" id="f875" class="graf graf--p graf-after--figure">然後切換到 Applications 頁面查詢 App 的 Client ID。</p><figure name="12eb" id="12eb" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*i97DPDKT5hJcPIBbn9COYQ.jpeg" data-width="1604" data-height="516" src="https://cdn-images-1.medium.com/max/800/1*i97DPDKT5hJcPIBbn9COYQ.jpeg"></figure><h3 name="e8bc" id="e8bc" class="graf graf--h3 graf-after--figure">Search 圖片 API</h3><p name="49f3" id="49f3" class="graf graf--p graf-after--h3">Imgur 提供豐富的 API，除了圖片上傳，它還可以搜尋圖片，建立相簿，留言等。接下來就讓我們柿子挑軟的吃，先從 PostMan 測試 Gallery Search API 吧。</p><figure name="7b7d" id="7b7d" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*7r6KIEQ24beT8I3AdgDqmA.jpeg" data-width="1516" data-height="1220" src="https://cdn-images-1.medium.com/max/800/1*7r6KIEQ24beT8I3AdgDqmA.jpeg"></figure><p name="0b42" id="0b42" class="graf graf--p graf-after--figure">根據上圖的 API 說明，我們在 PostMan 輸入以下網址找尋可愛的貓。</p><pre name="3b2d" id="3b2d" class="graf graf--pre graf-after--p"><a href="https://api.imgur.com/3/gallery/search?q=cats" data-href="https://api.imgur.com/3/gallery/search?q=cats" class="markup--anchor markup--pre-anchor" rel="noopener" target="_blank">https://api.imgur.com/3/gallery/search?q=cats</a></pre><p name="8ce0" id="8ce0" class="graf graf--p graf-after--pre">記得要在 HTTP Header 的 Authorization 欄位加入 Client ID 才能串接 Imgur API，它的格式為</p><pre name="e617" id="e617" class="graf graf--pre graf-after--p">Client-ID YOUR_CLIENT_ID</pre><figure name="5494" id="5494" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*K7FQHCWRAsSKH-66Ckw1vg.jpeg" data-width="996" data-height="536" src="https://cdn-images-1.medium.com/max/800/1*K7FQHCWRAsSKH-66Ckw1vg.jpeg"></figure><p name="ed4d" id="ed4d" class="graf graf--p graf-after--figure">請將 YOUR_CLIENT_ID 替換成自己申請的 Client ID。</p><figure name="dbd6" id="dbd6" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*dynvrdnewUah8vxMNmUr-Q.jpeg" data-width="1852" data-height="544" src="https://cdn-images-1.medium.com/max/800/1*dynvrdnewUah8vxMNmUr-Q.jpeg"></figure><p name="8c4c" id="8c4c" class="graf graf--p graf-after--figure">順利地得到貓咪圖片的 JSON。</p><figure name="ab27" id="ab27" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*OOlDo75RRva4fhNZEJQKjg.jpeg" data-width="934" data-height="866" src="https://cdn-images-1.medium.com/max/800/1*OOlDo75RRva4fhNZEJQKjg.jpeg"></figure><p name="feca" id="feca" class="graf graf--p graf-after--figure">比方以下是可愛貓咪的網址。</p><pre name="37ec" id="37ec" class="graf graf--pre graf-after--p"><a href="https://i.imgur.com/oBKoluk.png" data-href="https://i.imgur.com/oBKoluk.png" class="markup--anchor markup--pre-anchor" rel="nofollow noopener" target="_blank">https://i.imgur.com/oBKoluk.png</a></pre><figure name="ce78" id="ce78" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*jYINgG1xiwvVnRJw1RLyKQ.png" data-width="640" data-height="854" src="https://cdn-images-1.medium.com/max/800/1*jYINgG1xiwvVnRJw1RLyKQ.png"></figure><h3 name="43c6" id="43c6" class="graf graf--h3 graf-after--figure">上傳圖片</h3><p name="9c4b" id="9c4b" class="graf graf--p graf-after--h3">接著就讓我們進入正題，撰寫上傳圖片的程式吧。首先研究下圖的 Image Upload API，發現資料上傳的格式是 multipart/form-data，圖片的欄位名稱是 image，然後先用 PostMan 測試圖片上傳。</p><figure name="6194" id="6194" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*O9xBmhDr6izWj5T0_oputg.jpeg" data-width="2398" data-height="1168" src="https://cdn-images-1.medium.com/max/800/1*O9xBmhDr6izWj5T0_oputg.jpeg"></figure><p name="8f75" id="8f75" class="graf graf--p graf-after--figure">成功用 PostMan 上傳圖片後，接著讓我們親手撰寫上傳圖片的程式。</p><ul class="postList"><li name="eabf" id="eabf" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">定義 API 回傳的 JSON 對應的 Decodable 型別。</strong></li></ul><p name="4815" id="4815" class="graf graf--p graf-after--li">API 回傳的 JSON 範例如下:</p><figure name="22d5" id="22d5" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*KpVFLpze0M_MfFCmeldrFg.jpeg" data-width="794" data-height="1098" src="https://cdn-images-1.medium.com/max/800/1*KpVFLpze0M_MfFCmeldrFg.jpeg"></figure><p name="bb70" id="bb70" class="graf graf--p graf-after--figure">我們只在乎圖片的網址，因此我們在 Data 裡只定義 link 欄位。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="734a" id="734a" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">UploadImageResult</span>: <span class="hljs-title class_">Decodable</span> {<br />    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">Data</span>: <span class="hljs-title class_">Decodable</span> {<br />        <span class="hljs-keyword">let</span> link: <span class="hljs-type">URL</span><br />    }<br />    <span class="hljs-keyword">let</span> data: <span class="hljs-type">Data</span><br />}</span></pre><ul class="postList"><li name="9ec8" id="9ec8" class="graf graf--li graf-after--pre"><strong class="markup--strong markup--li-strong">加入 Alamofire。</strong></li></ul><p name="c2a9" id="c2a9" class="graf graf--p graf-after--li">由於 Image Upload API 上傳資料的格式是麻煩的 multipart/form-data，所以我們使用 Alamofire 串接。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="13c3" id="13c3" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> Alamofire</span></pre><ul class="postList"><li name="e871" id="e871" class="graf graf--li graf-after--pre">定義上傳圖片的 function uploadImage。</li></ul><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="e800" id="e800" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">uploadImage</span>(<span class="hljs-params">uiImage</span>: <span class="hljs-type">UIImage</span>) {<br />        <span class="hljs-keyword">let</span> headers: <span class="hljs-type">HTTPHeaders</span> <span class="hljs-operator">=</span> [<br />            <span class="hljs-string">&quot;Authorization&quot;</span>: <span class="hljs-string">&quot;Client-ID 123&quot;</span>,<br />        ]<br />        <span class="hljs-type">AF</span>.upload(multipartFormData: { data <span class="hljs-keyword">in</span><br />            <span class="hljs-keyword">let</span> imageData <span class="hljs-operator">=</span> uiImage.jpegData(compressionQuality: <span class="hljs-number">0.9</span>)<br />            data.append(imageData<span class="hljs-operator">!</span>, withName: <span class="hljs-string">&quot;image&quot;</span>)<br />            <br />        }, to: <span class="hljs-string">&quot;https://api.imgur.com/3/image&quot;</span>, headers: headers).responseDecodable(of: <span class="hljs-type">UploadImageResult</span>.<span class="hljs-keyword">self</span>, queue: .main, decoder: <span class="hljs-type">JSONDecoder</span>()) { response <span class="hljs-keyword">in</span><br />            <span class="hljs-keyword">switch</span> response.result {<br />            <span class="hljs-keyword">case</span> .success(<span class="hljs-keyword">let</span> result):<br />                <span class="hljs-built_in">print</span>(result.data.link)<br />            <span class="hljs-keyword">case</span> .failure(<span class="hljs-keyword">let</span> error):<br />                <span class="hljs-built_in">print</span>(error)<br />            }<br />        }<br />}</span></pre><p name="7dfd" id="7dfd" class="graf graf--p graf-after--pre">API 的網址如下</p><pre name="6eba" id="6eba" class="graf graf--pre graf-after--p"><a href="https://api.imgur.com/3/upload" data-href="https://api.imgur.com/3/upload" class="markup--anchor markup--pre-anchor" rel="nofollow noopener noopener" target="_blank">https://api.imgur.com/3/</a>image</pre><p name="43c2" id="43c2" class="graf graf--p graf-after--pre">成功上傳時，我們呼叫 responseDecodable 將回傳的 JSON 轉換成自訂的型別 UploadImageResult，然後從 case .success(let result) 的 result 讀取，因此 result.data.link 即為圖片的網址。</p><figure name="7391" id="7391" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*l1gyYPlrsWQDiXq0LW6IEw.jpeg" data-width="1108" data-height="358" src="https://cdn-images-1.medium.com/max/800/1*l1gyYPlrsWQDiXq0LW6IEw.jpeg"></figure><p name="635d" id="635d" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">結果</strong></p><p name="37e1" id="37e1" class="graf graf--p graf-after--p">成功上傳，彼得潘和小王子合照的網址如下:</p><pre name="fe90" id="fe90" class="graf graf--pre graf-after--p">https://i.imgur.com/BKiAaiL.jpg</pre><figure name="518e" id="518e" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*C0dQidYNx9kmy1jIip85TA.jpeg" data-width="1208" data-height="1426" src="https://cdn-images-1.medium.com/max/800/1*C0dQidYNx9kmy1jIip85TA.jpeg"></figure><p name="7e6b" id="7e6b" class="graf graf--p graf-after--figure">ps: 對使用 URLSession 寫法上傳圖片到 Imgur 有興趣的朋友，也可以從網頁點選 Swift- URLSession 查看範例程式。</p><figure name="1f87" id="1f87" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*DWlpo1vMBH7rgKpIirTp6g.jpeg" data-width="2534" data-height="1318" src="https://cdn-images-1.medium.com/max/800/1*DWlpo1vMBH7rgKpIirTp6g.jpeg"></figure><h3 name="07c3" id="07c3" class="graf graf--h3 graf-after--figure">其它上傳圖片的 API</h3><ul class="postList"><li name="39f4" id="39f4" class="graf graf--li graf-after--h3">imgbb</li></ul><div name="ac1d" id="ac1d" class="graf graf--mixtapeEmbed graf-after--li"><a href="https://api.imgbb.com/" data-href="https://api.imgbb.com/" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://api.imgbb.com/"><strong class="markup--strong markup--mixtapeEmbed-strong">Upload Image - Free Image Hosting</strong><br><em class="markup--em markup--mixtapeEmbed-em">Free image hosting and sharing service, upload pictures, photo host. Offers integration solutions for uploading images…</em>api.imgbb.com</a><a href="https://api.imgbb.com/" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="e4f2014f1a57f9040f57b2220fac56be"></a></div><p name="abb2" id="abb2" class="graf graf--p graf-after--mixtapeEmbed">範例程式。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="9e63" id="9e63" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-type">AF</span>.upload(multipartFormData: { data <span class="hljs-keyword">in</span><br />    <span class="hljs-keyword">let</span> apiKey <span class="hljs-operator">=</span> <span class="hljs-string">&quot;123456&quot;</span><br />    data.append(apiKey.data(using: .utf8)<span class="hljs-operator">!</span>, withName: <span class="hljs-string">&quot;key&quot;</span>)<br />    <span class="hljs-keyword">let</span> imageData <span class="hljs-operator">=</span> <span class="hljs-type">UIImage</span>.fish.jpegData(compressionQuality: <span class="hljs-number">0.9</span>)<span class="hljs-operator">!</span><br />    data.append(imageData, withName: <span class="hljs-string">&quot;image&quot;</span>, fileName: <span class="hljs-string">&quot;test.jpg&quot;</span>)<br />}, to: <span class="hljs-string">&quot;https://api.imgbb.com/1/upload&quot;</span>).responseString { dataResponse <span class="hljs-keyword">in</span><br />    <span class="hljs-keyword">switch</span> dataResponse.result {<br />    <span class="hljs-keyword">case</span> .success(<span class="hljs-keyword">let</span> responseString):<br />        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Response: <span class="hljs-subst">\(responseString)</span>&quot;</span>)<br />    <span class="hljs-keyword">case</span> .failure(<span class="hljs-keyword">let</span> error):<br />        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Error: <span class="hljs-subst">\(error)</span>&quot;</span>)<br />    }<br />}</span></pre><h3 name="562a" id="562a" class="graf graf--h3 graf-after--pre">作品集</h3><div name="4b8c" id="4b8c" class="graf graf--mixtapeEmbed graf-after--h3 graf--trailing"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E6%95%99%E5%AE%A4/%E4%BD%9C%E6%A5%AD-55-mygallery-%E4%B8%8B-%E5%9C%96%E7%89%87%E4%B8%8A%E5%82%B3-%E4%B8%8B%E8%BC%89-%E8%88%87%E9%A1%AF%E7%A4%BA-e5cfc56c84bd" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E6%95%99%E5%AE%A4/%E4%BD%9C%E6%A5%AD-55-mygallery-%E4%B8%8B-%E5%9C%96%E7%89%87%E4%B8%8A%E5%82%B3-%E4%B8%8B%E8%BC%89-%E8%88%87%E9%A1%AF%E7%A4%BA-e5cfc56c84bd" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E6%95%99%E5%AE%A4/%E4%BD%9C%E6%A5%AD-55-mygallery-%E4%B8%8B-%E5%9C%96%E7%89%87%E4%B8%8A%E5%82%B3-%E4%B8%8B%E8%BC%89-%E8%88%87%E9%A1%AF%E7%A4%BA-e5cfc56c84bd"><strong class="markup--strong markup--mixtapeEmbed-strong">作業#55 — myGallery (下) －圖片上傳、下載、與顯示</strong><br><em class="markup--em markup--mixtapeEmbed-em">練習 Collection View、Airtable 圖片上傳與下載、AlamofireImage</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E6%95%99%E5%AE%A4/%E4%BD%9C%E6%A5%AD-55-mygallery-%E4%B8%8B-%E5%9C%96%E7%89%87%E4%B8%8A%E5%82%B3-%E4%B8%8B%E8%BC%89-%E8%88%87%E9%A1%AF%E7%A4%BA-e5cfc56c84bd" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="ef7307722da459edeff367997920e43c" data-thumbnail-img-id="1*WVqbEqkJLqFF9uvQGDsbbg.png" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*WVqbEqkJLqFF9uvQGDsbbg.png);"></a></div></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@apppeterpan" class="p-author h-card">彼得潘的 iOS App Neverland</a> on <a href="https://medium.com/p/5b1214b86438"><time class="dt-published" datetime="2020-02-18T14:27:01.655Z">February 18, 2020</time></a>.</p><p><a href="https://medium.com/@apppeterpan/swift-ios-app-%E7%9A%84%E5%9C%96%E7%89%87%E4%B8%8A%E5%82%B3-%E4%BB%A5-remove-bg-imgur-api-%E7%82%BA%E4%BE%8B-5b1214b86438" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on November 16, 2025.</p></footer></article></body></html>