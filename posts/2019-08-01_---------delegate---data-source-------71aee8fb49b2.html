<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>從第三方套件了解 delegate &amp; data source 如何被呼叫</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">從第三方套件了解 delegate &amp; data source 如何被呼叫</h1>
</header>
<section data-field="subtitle" class="p-summary">
iOS SDK 提供豐富的 API 幫助我們開發 App，很多功能都是透過 delegate 或 data source 實現。比方利用 UIImagePickerController 從相簿選照片時，當使用者選了照片後將呼叫 delegate 的 function…
</section>
<section data-field="body" class="e-content">
<section name="07a2" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="def1" id="def1" class="graf graf--h3 graf--leading graf--title">從第三方套件了解 delegate &amp; data source 如何被呼叫</h3><p name="e2e6" id="e2e6" class="graf graf--p graf-after--h3">iOS SDK 提供豐富的 API 幫助我們開發 App，很多功能都是透過 delegate 或 data source 實現。比方利用 UIImagePickerController 從相簿選照片時，當使用者選了照片後將呼叫 delegate 的 function imagePickerController(_:didFinishPickingMediaWithInfo:)，因此我們可定義此 function，從中取得照片。</p><div name="7bc2" id="7bc2" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://developer.apple.com/documentation/uikit/uiimagepickercontrollerdelegate/1619126-imagepickercontroller" data-href="https://developer.apple.com/documentation/uikit/uiimagepickercontrollerdelegate/1619126-imagepickercontroller" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/uikit/uiimagepickercontrollerdelegate/1619126-imagepickercontroller"><strong class="markup--strong markup--mixtapeEmbed-strong">imagePickerController(_:didFinishPickingMediaWithInfo:) | Apple Developer Documentation</strong><br><em class="markup--em markup--mixtapeEmbed-em">Tells the delegate that the user picked a still image or movie.</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/uikit/uiimagepickercontrollerdelegate/1619126-imagepickercontroller" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="7e92d0c97aaed52613ff40ae74a9cb23" data-thumbnail-img-id="0*BJ8vCXEYoYGU6My4" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*BJ8vCXEYoYGU6My4);"></a></div><p name="1a32" id="1a32" class="graf graf--p graf-after--mixtapeEmbed">然而初學者常會覺得奇怪，因為他看不到imagePickerController(_:didFinishPickingMediaWithInfo:) 被呼叫的程式。很可惜的我們永遠看不到，因為這是 Apple 寫的程式，他沒有公開。也許等哪天我們成為 Apple 的工程師就能看到了，但也可能永遠等不到那一天。</p><p name="b788" id="b788" class="graf graf--p graf-after--p">沒關係，網路上很多大大寫的第三方套件也運用了 delegate &amp; data source 的概念，接下來讓我們以觀看 Youtube 影片的 YoutubeKit 為例，偷看他是如何呼叫 delegate 的 function。</p><h3 name="deec" id="deec" class="graf graf--h3 graf-after--p">點選 Download ZIP 下載 YoutubeKit</h3><div name="4bb2" id="4bb2" class="graf graf--mixtapeEmbed graf-after--h3"><a href="https://github.com/rinov/YoutubeKit" data-href="https://github.com/rinov/YoutubeKit" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://github.com/rinov/YoutubeKit"><strong class="markup--strong markup--mixtapeEmbed-strong">rinov/YoutubeKit</strong><br><em class="markup--em markup--mixtapeEmbed-em">YoutubeKit is a video player that fully supports Youtube IFrame API and YoutubeDataAPI to easily create Youtube…</em>github.com</a><a href="https://github.com/rinov/YoutubeKit" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="24f72dcb22da6733de2cfc85139eb337"></a></div><figure name="8a98" id="8a98" class="graf graf--figure graf-after--mixtapeEmbed"><img class="graf-image" data-image-id="1*frxM_PPjiRCKFYIG3DApbw.jpeg" data-width="1858" data-height="1104" src="https://cdn-images-1.medium.com/max/800/1*frxM_PPjiRCKFYIG3DApbw.jpeg"></figure><h3 name="f9d7" id="f9d7" class="graf graf--h3 graf-after--figure">打開範例的專案</h3><p name="9ef3" id="9ef3" class="graf graf--p graf-after--h3">雙擊 Example 下的 YoutubeKit.xcworkspace。</p><figure name="b68a" id="b68a" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*MUpBe4pWDe9gdTidQ74cHQ.jpeg" data-width="872" data-height="486" src="https://cdn-images-1.medium.com/max/800/1*MUpBe4pWDe9gdTidQ74cHQ.jpeg"></figure><figure name="ed9a" id="ed9a" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*a5fwkrqa7cMcOTj6uv8aNg.jpeg" data-width="1912" data-height="678" src="https://cdn-images-1.medium.com/max/800/1*a5fwkrqa7cMcOTj6uv8aNg.jpeg"></figure><h3 name="745b" id="745b" class="graf graf--h3 graf-after--figure">研究範例程式</h3><p name="52cd" id="52cd" class="graf graf--p graf-after--h3">範例的主要程式寫在 ViewController.swift 裡，我們可從以下幾個關鍵的程式，看到它透過 delegate 客製功能。</p><ul class="postList"><li name="829c" id="829c" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">遵從 protocol YTSwiftyPlayerDelegate，定義 YTSwiftyPlayerDelegate 的 function。</strong></li></ul><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="3379" id="3379" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content"><span class="hljs-keyword">extension</span> <span class="hljs-title class_">ViewController</span>: <span class="hljs-title class_">YTSwiftyPlayerDelegate</span> {<br />   <span class="hljs-keyword">func</span> <span class="hljs-title function_">playerReady</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">player</span>: <span class="hljs-type">YTSwiftyPlayer</span>) {<br />      <span class="hljs-built_in">print</span>(<span class="hljs-keyword">#function</span>)<br />      <span class="hljs-comment">// After loading a video, player&#x27;s API is available.</span><br />      <span class="hljs-comment">// e.g. player.mute()</span><br />   }<br />   <span class="hljs-keyword">func</span> <span class="hljs-title function_">player</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">player</span>: <span class="hljs-type">YTSwiftyPlayer</span>, <span class="hljs-params">didUpdateCurrentTime</span> <span class="hljs-params">currentTime</span>: <span class="hljs-type">Double</span>) {<br />       <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;<span class="hljs-subst">\(<span class="hljs-keyword">#function</span>)</span>:<span class="hljs-subst">\(currentTime)</span>&quot;</span>)<br />   }<br />   <span class="hljs-keyword">func</span> <span class="hljs-title function_">player</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">player</span>: <span class="hljs-type">YTSwiftyPlayer</span>, <span class="hljs-params">didChangeState</span> <span class="hljs-params">state</span>: <span class="hljs-type">YTSwiftyPlayerState</span>) {<br />      <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;<span class="hljs-subst">\(<span class="hljs-keyword">#function</span>)</span>:<span class="hljs-subst">\(state)</span>&quot;</span>)<br />   }</span></pre><ul class="postList"><li name="ef0b" id="ef0b" class="graf graf--li graf-after--pre"><strong class="markup--strong markup--li-strong">將 controller 設為 player 的 delegate。</strong></li></ul><p name="af47" id="af47" class="graf graf--p graf-after--li">在 viewDidLoad 裡將 controller 設為 player 的 delegate 。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="9dad" id="9dad" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">player.delegate <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span></span></pre><h3 name="ab7a" id="ab7a" class="graf graf--h3 graf-after--pre">透過 delegate function 連播失戀情歌</h3><p name="4fa5" id="4fa5" class="graf graf--p graf-after--h3">失戀時最好的療傷方式就是連播失戀情歌，一邊聽一邊回憶當初在一起的甜蜜日子，因此接下來讓我們透過 delegate function 實現連播失戀情歌的功能。</p><ul class="postList"><li name="d350" id="d350" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">在 ViewController 裡宣告 property videos 儲存歌單，index 儲存目前播放第幾首歌。(array 從 0 開始)</strong></li></ul><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="5df7" id="5df7" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> videos <span class="hljs-operator">=</span> [<span class="hljs-string">&quot;0-4mm0e2h44&quot;</span>, <span class="hljs-string">&quot;Y2ge3KrdeWs&quot;</span>, <span class="hljs-string">&quot;L-YMr0cTH6s&quot;</span>]<br /><span class="hljs-keyword">var</span> index <span class="hljs-operator">=</span> <span class="hljs-number">0</span></span></pre><p name="7357" id="7357" class="graf graf--p graf-after--pre">0–4mm0e2h44 是退後，Y2ge3KrdeWs 是怎麼了，L-YMr0cTH6s 是街角的祝福，影片的 ID 可從網址得知。</p><figure name="3c0e" id="3c0e" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*QSbhNnuSKS0fOjlF5MtIZA.jpeg" data-width="1360" data-height="810" src="https://cdn-images-1.medium.com/max/800/1*QSbhNnuSKS0fOjlF5MtIZA.jpeg"></figure><figure name="5771" id="5771" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*VOp94DNmCQSeaI_1Bu-sDg.jpeg" data-width="1052" data-height="116" src="https://cdn-images-1.medium.com/max/800/1*VOp94DNmCQSeaI_1Bu-sDg.jpeg"></figure><ul class="postList"><li name="20ad" id="20ad" class="graf graf--li graf-after--figure"><strong class="markup--strong markup--li-strong">設定播放的第一首歌。</strong></li></ul><p name="b7f1" id="b7f1" class="graf graf--p graf-after--li">修改 function viewDidLoad，將播放的第一首歌改成 videos[index] 取出的 ID。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="50d4" id="50d4" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">player <span class="hljs-operator">=</span> <span class="hljs-type">YTSwiftyPlayer</span>(<br />   frame: <span class="hljs-type">CGRect</span>(x: <span class="hljs-number">0</span>, y: <span class="hljs-number">0</span>, width: <span class="hljs-number">640</span>, height: <span class="hljs-number">480</span>),<br />   playerVars: [.playsInline(<span class="hljs-literal">true</span>), .videoID(videos[index]), .loopVideo(<span class="hljs-literal">true</span>), .showRelatedVideo(<span class="hljs-literal">false</span>)])</span></pre><ul class="postList"><li name="e06e" id="e06e" class="graf graf--li graf-after--pre"><strong class="markup--strong markup--li-strong">定義 delegate function player(_:didChangeState state:)</strong></li></ul><p name="9c2e" id="9c2e" class="graf graf--p graf-after--li">YTSwiftyPlayerDelegate 的 function player(_:didChangeState state:) 將在影片播放狀態改變時被呼叫，比方影片播完後它將被呼叫，參數 state 為 ended，因此我們可在此 function 裡寫程式，播放下一首歌。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="f4d8" id="f4d8" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">player</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">player</span>: <span class="hljs-type">YTSwiftyPlayer</span>, <span class="hljs-params">didChangeState</span> <span class="hljs-params">state</span>: <span class="hljs-type">YTSwiftyPlayerState</span>) {<br />   <span class="hljs-keyword">if</span> state <span class="hljs-operator">==</span> .ended {<br />      index <span class="hljs-operator">+=</span> <span class="hljs-number">1</span><br />      index <span class="hljs-operator">=</span> index <span class="hljs-operator">%</span> videos.count<br />      player.loadVideo(videoID: videos[index])<br />   }<br />}</span></pre><h3 name="1373" id="1373" class="graf graf--h3 graf-after--pre">執行 App</h3><p name="bcae" id="bcae" class="graf graf--p graf-after--h3">如下圖所示，透過 delegate 的幫忙，<code class="markup--code markup--p-code">退後</code>播完後，<code class="markup--code markup--p-code">怎麼了</code>將自動開始播放，我們終於可以在半夜睡覺時重覆輪播失戀情歌了 ~</p></div><div class="section-inner sectionLayout--outsetRow" data-paragraph-count="2"><figure name="2ee7" id="2ee7" class="graf graf--figure graf--layoutOutsetRow is-partialWidth graf-after--p" style="width: 50%;"><img class="graf-image" data-image-id="1*TcPeO_TTeiXCMno3IwIAmw.jpeg" data-width="864" data-height="1492" src="https://cdn-images-1.medium.com/max/600/1*TcPeO_TTeiXCMno3IwIAmw.jpeg"></figure><figure name="c669" id="c669" class="graf graf--figure graf--layoutOutsetRowContinue is-partialWidth graf-after--figure" style="width: 50%;"><img class="graf-image" data-image-id="1*nwvMYm-lwJO9YLyL6Rrewg.jpeg" data-width="864" data-height="1492" src="https://cdn-images-1.medium.com/max/600/1*nwvMYm-lwJO9YLyL6Rrewg.jpeg"></figure></div><div class="section-inner sectionLayout--insetColumn"><h3 name="1522" id="1522" class="graf graf--h3 graf-after--figure">瞧瞧 delegate 的 function 在哪裡被呼叫</h3><p name="107b" id="107b" class="graf graf--p graf-after--h3">現在我們可以回頭來瞧瞧 function player(_:didChangeState state:) 是在何時被呼叫。</p><p name="9a38" id="9a38" class="graf graf--p graf-after--p">在 Find navigator 搜尋 didChangeState 後，我們發現它在 YTSwiftyPlayer.swift 裡被呼叫。</p><figure name="82ab" id="82ab" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*jyk5dBcM9-4uHx_K3qPbPw.jpeg" data-width="552" data-height="826" src="https://cdn-images-1.medium.com/max/800/1*jyk5dBcM9-4uHx_K3qPbPw.jpeg"></figure><p name="bee4" id="bee4" class="graf graf--p graf-after--figure">切換到 YTSwiftyPlayer.swift 後，在 function userContentController(_:didReceive:) 裡我們看到 YTSwiftyPlayer 透過 delegate 呼叫 player(_:didChangeState state:)。</p><figure name="d3d1" id="d3d1" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*bz0f2PuZC0td0pYKHfB8Tw.jpeg" data-width="1562" data-height="506" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*bz0f2PuZC0td0pYKHfB8Tw.jpeg"></figure><p name="5d8e" id="5d8e" class="graf graf--p graf-after--figure">若我們進一步研究 delegate 宣告的地方，將發現它是 optional，因此倘若我們沒有設定 YTSwiftyPlayer 的 delegate，也不用擔心程式出問題，只是那些呼叫 delegate function 的程式不會有任何作用，比方 <code class="markup--code markup--p-code">delegate?.player(self, didChangeState: playerState)</code> 會直接變成 nil，因為 optional chaining 發現 delegate 是 nil，就不會繼續呼叫 player(_:didChangeState state:)。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="1504" id="1504" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">open</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">YTSwiftyPlayer</span>: <span class="hljs-title class_">WKWebView</span> {<br />   <span class="hljs-keyword">open</span> <span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> delegate: <span class="hljs-type">YTSwiftyPlayerDelegate</span>?</span></pre><p name="02e3" id="02e3" class="graf graf--p graf-after--pre graf--trailing">從以上的例子，我們明白了 delegate 的 fuction 如何被呼叫。因此未來我們在使用 iOS SDK 的 delegate &amp; data source 時，也可以用類似的概念去想像背後的程式，想像它是在某個事情發生時呼叫 delegate &amp; data source 的 function。</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@apppeterpan" class="p-author h-card">彼得潘的 iOS App Neverland</a> on <a href="https://medium.com/p/71aee8fb49b2"><time class="dt-published" datetime="2019-08-01T08:50:30.807Z">August 1, 2019</time></a>.</p><p><a href="https://medium.com/@apppeterpan/%E5%BE%9E%E7%AC%AC%E4%B8%89%E6%96%B9%E5%A5%97%E4%BB%B6%E4%BA%86%E8%A7%A3-delegate-data-source-%E5%A6%82%E4%BD%95%E8%A2%AB%E5%91%BC%E5%8F%AB-71aee8fb49b2" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on September 17, 2025.</p></footer></article></body></html>