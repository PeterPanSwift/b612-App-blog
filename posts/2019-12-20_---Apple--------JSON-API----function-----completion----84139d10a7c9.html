<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>模仿 Apple 官方範例串接 JSON API，定義 function 型別的 completion 參數</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">模仿 Apple 官方範例串接 JSON API，定義 function 型別的 completion 參數</h1>
</header>
<section data-field="subtitle" class="p-summary">
Apple 的 App Development with Swift 第五章 Guided Project: Restaurant Menu 介紹了適合初學者參考的 JSON API 串接寫法，接下來就讓我們一步步介紹如何模仿抄襲 Apple 大大的範例吧。
</section>
<section data-field="body" class="e-content">
<section name="ef52" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="18a3" id="18a3" class="graf graf--h3 graf--leading graf--title">模仿 Apple 官方範例串接 JSON API，定義 function 型別的 completion 參數</h3><h3 name="d3a0" id="d3a0" class="graf graf--h3 graf-after--h3">Apple 最新的寫法搭配 Result type，請參考以下連結</h3><div name="2515" id="2515" class="graf graf--mixtapeEmbed graf-after--h3"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E6%A8%A1%E4%BB%BF-apple-%E5%AE%98%E6%96%B9%E7%AF%84%E4%BE%8B%E4%B8%B2%E6%8E%A5-json-api-%E5%AE%9A%E7%BE%A9-function-%E5%9E%8B%E5%88%A5%E7%9A%84-completion-%E5%8F%83%E6%95%B8-%E4%BD%BF%E7%94%A8-result-type-9b058c77df5d" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E6%A8%A1%E4%BB%BF-apple-%E5%AE%98%E6%96%B9%E7%AF%84%E4%BE%8B%E4%B8%B2%E6%8E%A5-json-api-%E5%AE%9A%E7%BE%A9-function-%E5%9E%8B%E5%88%A5%E7%9A%84-completion-%E5%8F%83%E6%95%B8-%E4%BD%BF%E7%94%A8-result-type-9b058c77df5d" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E6%A8%A1%E4%BB%BF-apple-%E5%AE%98%E6%96%B9%E7%AF%84%E4%BE%8B%E4%B8%B2%E6%8E%A5-json-api-%E5%AE%9A%E7%BE%A9-function-%E5%9E%8B%E5%88%A5%E7%9A%84-completion-%E5%8F%83%E6%95%B8-%E4%BD%BF%E7%94%A8-result-type-9b058c77df5d"><strong class="markup--strong markup--mixtapeEmbed-strong">模仿 Apple 官方範例串接 JSON API，定義 function 型別的 completion 參數 &amp; 使用 Result type</strong><br><em class="markup--em markup--mixtapeEmbed-em">Apple 的 Develop in Swift Data Collections 第二章 Guided Project: Restaurant 介紹適合初學者參考的 JSON API 串接寫法，接下來就讓我們一步步介紹如何模仿抄襲…</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E6%A8%A1%E4%BB%BF-apple-%E5%AE%98%E6%96%B9%E7%AF%84%E4%BE%8B%E4%B8%B2%E6%8E%A5-json-api-%E5%AE%9A%E7%BE%A9-function-%E5%9E%8B%E5%88%A5%E7%9A%84-completion-%E5%8F%83%E6%95%B8-%E4%BD%BF%E7%94%A8-result-type-9b058c77df5d" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="4402a63fe7c2782581dca6659ebbd8dd" data-thumbnail-img-id="1*hN-VWpM0r6KldfDtnBfztw.png" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*hN-VWpM0r6KldfDtnBfztw.png);"></a></div><h3 name="ba65" id="ba65" class="graf graf--h3 graf-after--mixtapeEmbed">舊版的寫法</h3><p name="972c" id="972c" class="graf graf--p graf-after--h3">Apple 的 App Development with Swift 第五章 Guided Project: Restaurant Menu 介紹了適合初學者參考的 JSON API 串接寫法，接下來就讓我們一步步介紹如何模仿抄襲 Apple 大大的範例吧。</p><figure name="b837" id="b837" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*QnlDhz8phaDG3yjDfdOS7A.jpeg" data-width="1058" data-height="1290" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*QnlDhz8phaDG3yjDfdOS7A.jpeg"></figure><h3 name="74e7" id="74e7" class="graf graf--h3 graf-after--figure">下載 ‎App Development with Swift Teacher Guide</h3><div name="4b7c" id="4b7c" class="graf graf--mixtapeEmbed graf-after--h3"><a href="https://books.apple.com/tw/book/app-development-with-swift-teacher-guide/id1219118093?l=en" data-href="https://books.apple.com/tw/book/app-development-with-swift-teacher-guide/id1219118093?l=en" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://books.apple.com/tw/book/app-development-with-swift-teacher-guide/id1219118093?l=en"><strong class="markup--strong markup--mixtapeEmbed-strong">‎App Development with Swift Teacher Guide</strong><br><em class="markup--em markup--mixtapeEmbed-em">‎This Teacher Guide, a companion to the two-semester long App Development with Swift course, is designed for you to use…</em>books.apple.com</a><a href="https://books.apple.com/tw/book/app-development-with-swift-teacher-guide/id1219118093?l=en" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="e87aee95cddeef938aafb8bbbd22e883" data-thumbnail-img-id="0*l4tw3luX9Cw3glwH" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*l4tw3luX9Cw3glwH);"></a></div><figure name="63ef" id="63ef" class="graf graf--figure graf-after--mixtapeEmbed"><img class="graf-image" data-image-id="1*NXyrTl5gm61FwMLguS9IgQ.png" data-width="2060" data-height="722" src="https://cdn-images-1.medium.com/max/800/1*NXyrTl5gm61FwMLguS9IgQ.png"></figure><h3 name="f411" id="f411" class="graf graf--h3 graf-after--figure">點選 Download Teacher materials 下載範例程式</h3><figure name="3ed5" id="3ed5" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="1*d-0lAvVtLKixfffkLYnCsQ.jpeg" data-width="1058" data-height="1460" src="https://cdn-images-1.medium.com/max/800/1*d-0lAvVtLKixfffkLYnCsQ.jpeg"></figure><h3 name="4d7c" id="4d7c" class="graf graf--h3 graf-after--figure">啟動第五章的 server 程式 Open Restaurant</h3><p name="3663" id="3663" class="graf graf--p graf-after--h3">Apple 的範例需要從 server 抓取資料，因此我們必須先啟動 server 程式。Apple 已經幫我們將 server 程式寫好了，請切換到範例第五章 Guided Project — Restaurant 的資料夾，雙擊 Open Restaurant 啟動程式。</p><figure name="64a5" id="64a5" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*KKv8RJU5p_aUOtcPpOtY_Q.jpeg" data-width="2166" data-height="1058" src="https://cdn-images-1.medium.com/max/800/1*KKv8RJU5p_aUOtcPpOtY_Q.jpeg"></figure><figure name="b0d4" id="b0d4" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*gsshYpuviGvuS8zRclVr7A.jpeg" data-width="840" data-height="354" src="https://cdn-images-1.medium.com/max/800/1*gsshYpuviGvuS8zRclVr7A.jpeg"></figure><figure name="9493" id="9493" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*s1eNaKlt9qgbQ5KMPUXMrg.jpeg" data-width="968" data-height="470" src="https://cdn-images-1.medium.com/max/800/1*s1eNaKlt9qgbQ5KMPUXMrg.jpeg"></figure><p name="05bd" id="05bd" class="graf graf--p graf-after--figure">從 Server App 的視窗畫面可進行後台資料的編輯，點選右下角的 Start 啟動後台，讓 App 可以連線抓取資料。</p><figure name="4bd2" id="4bd2" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*x75ZjCej3Wxk3rfzn9dGWQ.jpeg" data-width="962" data-height="460" src="https://cdn-images-1.medium.com/max/800/1*x75ZjCej3Wxk3rfzn9dGWQ.jpeg"></figure><h3 name="8827" id="8827" class="graf graf--h3 graf-after--figure">執行 App</h3><p name="893b" id="893b" class="graf graf--p graf-after--h3">切換到範例第五章 Guided Project — OrderApp 的資料夾，雙擊 OrderApp.xcodeproj 打開專案。</p><figure name="747f" id="747f" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*SuPbC_WNGqylgAVj1DGY8Q.jpeg" data-width="2148" data-height="640" src="https://cdn-images-1.medium.com/max/800/1*SuPbC_WNGqylgAVj1DGY8Q.jpeg"></figure><figure name="6630" id="6630" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*Rzkg2RUWClvflR9ugkdfZw.jpeg" data-width="2560" data-height="926" src="https://cdn-images-1.medium.com/max/800/1*Rzkg2RUWClvflR9ugkdfZw.jpeg"></figure><p name="7a65" id="7a65" class="graf graf--p graf-after--figure">執行 App 後，我們可從 Server 抓取 Restaurant 的相關資料並訂購想購買的商品。</p></div><div class="section-inner sectionLayout--outsetRow" data-paragraph-count="3"><figure name="714d" id="714d" class="graf graf--figure graf--layoutOutsetRow is-partialWidth graf-after--p" style="width: 33.333%;"><img class="graf-image" data-image-id="1*zwO5p89bIqRwiSFYY6uMdA.jpeg" data-width="838" data-height="1438" src="https://cdn-images-1.medium.com/max/400/1*zwO5p89bIqRwiSFYY6uMdA.jpeg"></figure><figure name="6e01" id="6e01" class="graf graf--figure graf--layoutOutsetRowContinue is-partialWidth graf-after--figure" style="width: 33.333%;"><img class="graf-image" data-image-id="1*6Pi3Zves-p1ImHCqALexwA.jpeg" data-width="838" data-height="1438" src="https://cdn-images-1.medium.com/max/400/1*6Pi3Zves-p1ImHCqALexwA.jpeg"></figure><figure name="c5ca" id="c5ca" class="graf graf--figure graf--layoutOutsetRowContinue is-partialWidth graf-after--figure" style="width: 33.333%;"><img class="graf-image" data-image-id="1*tIDAJXpAxQ0hVbwUmdStAw.jpeg" data-width="838" data-height="1438" src="https://cdn-images-1.medium.com/max/400/1*tIDAJXpAxQ0hVbwUmdStAw.jpeg"></figure></div><div class="section-inner sectionLayout--insetColumn"><h3 name="4e74" id="4e74" class="graf graf--h3 graf-after--figure">研究模仿 Apple 範例程式</h3><ul class="postList"><li name="0a13" id="0a13" class="graf graf--li graf-after--h3"><strong class="markup--strong markup--li-strong">串接 JSON</strong></li></ul><p name="0c41" id="0c41" class="graf graf--p graf-after--li">範例程式將跟後台溝通的相關程式統一定義在 MenuController 裡，方便 App 的各個畫面使用，比方將抓取商品類別的 API 定義成 function fetchCategories，上傳訂單的 API 定義成 function submitOrder。</p><figure name="7daf" id="7daf" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*CvULH_ivdIS5OOXw67hHNA.jpeg" data-width="2516" data-height="1182" src="https://cdn-images-1.medium.com/max/800/1*CvULH_ivdIS5OOXw67hHNA.jpeg"></figure><p name="b665" id="b665" class="graf graf--p graf-after--figure">值得注意的，後台回傳的資料將帶在 function 型別的參數裡，比方呼叫 function fetchMenuItems 時，它的參數 completion 將包含商品類別的 array。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="af41" id="af41" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">fetchMenuItems</span>(<span class="hljs-params">forCategory</span> <span class="hljs-params">categoryName</span>: <span class="hljs-type">String</span>, <span class="hljs-params">completion</span>: <span class="hljs-keyword">@escaping</span> ([<span class="hljs-type">MenuItem</span>]<span class="hljs-operator">?</span>) -&gt; <span class="hljs-type">Void</span>)</span></pre><p name="f276" id="f276" class="graf graf--p graf-after--pre">之後 App 各個畫面的 view controller 只要透過 MenuController.shared 即可呼叫 function，串接後台的 API。</p><figure name="0b5d" id="0b5d" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*ExUi-eX8d7qUcS6fHgYSZw.jpeg" data-width="1072" data-height="1112" src="https://cdn-images-1.medium.com/max/800/1*ExUi-eX8d7qUcS6fHgYSZw.jpeg"></figure><p name="7bb1" id="7bb1" class="graf graf--p graf-after--figure">比方以下程式利用 MenuController.shared.fetchCategories 取得 categories。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="259b" id="259b" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {<br />     <span class="hljs-keyword">super</span>.viewDidLoad()<br />     <span class="hljs-type">MenuController</span>.shared.fetchCategories { categories <span class="hljs-keyword">in</span><br />        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> categories <span class="hljs-operator">=</span> categories {<br />            <span class="hljs-keyword">self</span>.updateUI(with: categories)<br />        }<br />     }<br />}</span></pre><p name="e0fe" id="e0fe" class="graf graf--p graf-after--pre">MenuController 的完整程式如下。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="74d9" id="74d9" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> UIKit<br /><br /><span class="hljs-keyword">class</span> <span class="hljs-title class_">MenuController</span> {<br />    <br />    <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> shared <span class="hljs-operator">=</span> <span class="hljs-type">MenuController</span>()<br />    <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> orderUpdatedNotification <span class="hljs-operator">=</span> <span class="hljs-type">Notification</span>.<span class="hljs-type">Name</span>(<span class="hljs-string">&quot;MenuController.orderUpdated&quot;</span>)<br />    <span class="hljs-keyword">let</span> baseURL <span class="hljs-operator">=</span> <span class="hljs-type">URL</span>(string: <span class="hljs-string">&quot;http://localhost:8090/&quot;</span>)<span class="hljs-operator">!</span><br />    <br />    <span class="hljs-keyword">var</span> order <span class="hljs-operator">=</span> <span class="hljs-type">Order</span>() {<br />        <span class="hljs-keyword">didSet</span> {<br />            <span class="hljs-type">NotificationCenter</span>.default.post(name: <span class="hljs-type">MenuController</span>.orderUpdatedNotification, object: <span class="hljs-literal">nil</span>)<br />        }<br />    }<br />    <br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">fetchCategories</span>(<span class="hljs-params">completion</span>: <span class="hljs-keyword">@escaping</span> ([<span class="hljs-type">String</span>]<span class="hljs-operator">?</span>) -&gt; <span class="hljs-type">Void</span>) {<br />        <span class="hljs-keyword">let</span> categoryURL <span class="hljs-operator">=</span> baseURL.appendingPathComponent(<span class="hljs-string">&quot;categories&quot;</span>)<br />        <span class="hljs-keyword">let</span> task <span class="hljs-operator">=</span> <span class="hljs-type">URLSession</span>.shared.dataTask(with: categoryURL) { data, response, error <span class="hljs-keyword">in</span><br />            <span class="hljs-keyword">let</span> jsonDecoder <span class="hljs-operator">=</span> <span class="hljs-type">JSONDecoder</span>()<br />            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> data <span class="hljs-operator">=</span> data,<br />                <span class="hljs-keyword">let</span> categories <span class="hljs-operator">=</span> <span class="hljs-keyword">try?</span> jsonDecoder.decode(<span class="hljs-type">Categories</span>.<span class="hljs-keyword">self</span>, from: data) {<br />                completion(categories.categories)<br />            } <span class="hljs-keyword">else</span> {<br />                completion(<span class="hljs-literal">nil</span>)<br />            }<br />        }<br />        task.resume()<br />    }<br />    <br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">fetchMenuItems</span>(<span class="hljs-params">forCategory</span> <span class="hljs-params">categoryName</span>: <span class="hljs-type">String</span>, <span class="hljs-params">completion</span>: <span class="hljs-keyword">@escaping</span> ([<span class="hljs-type">MenuItem</span>]<span class="hljs-operator">?</span>) -&gt; <span class="hljs-type">Void</span>) {<br />        <span class="hljs-keyword">let</span> initialMenuURL <span class="hljs-operator">=</span> baseURL.appendingPathComponent(<span class="hljs-string">&quot;menu&quot;</span>)<br />        <span class="hljs-keyword">var</span> components <span class="hljs-operator">=</span> <span class="hljs-type">URLComponents</span>(url: initialMenuURL, resolvingAgainstBaseURL: <span class="hljs-literal">true</span>)<span class="hljs-operator">!</span><br />        components.queryItems <span class="hljs-operator">=</span> [<span class="hljs-type">URLQueryItem</span>(name: <span class="hljs-string">&quot;category&quot;</span>, value: categoryName)]<br />        <span class="hljs-keyword">let</span> menuURL <span class="hljs-operator">=</span> components.url<span class="hljs-operator">!</span><br />        <span class="hljs-keyword">let</span> task <span class="hljs-operator">=</span> <span class="hljs-type">URLSession</span>.shared.dataTask(with: menuURL) { data, response, error <span class="hljs-keyword">in</span><br />            <span class="hljs-keyword">let</span> jsonDecoder <span class="hljs-operator">=</span> <span class="hljs-type">JSONDecoder</span>()<br />            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> data <span class="hljs-operator">=</span> data,<br />                <span class="hljs-keyword">let</span> menuItems <span class="hljs-operator">=</span> <span class="hljs-keyword">try?</span> jsonDecoder.decode(<span class="hljs-type">MenuItems</span>.<span class="hljs-keyword">self</span>, from: data) {<br />                completion(menuItems.items)<br />            } <span class="hljs-keyword">else</span> {<br />                completion(<span class="hljs-literal">nil</span>)<br />            }<br />        }<br />        task.resume()<br />    }<br />    <br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">fetchImage</span>(<span class="hljs-params">url</span>: <span class="hljs-type">URL</span>, <span class="hljs-params">completion</span>: <span class="hljs-keyword">@escaping</span> (<span class="hljs-type">UIImage</span>?) -&gt; <span class="hljs-type">Void</span>) {<br />        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;fetchImage&quot;</span>, url)<br />        <span class="hljs-keyword">let</span> task <span class="hljs-operator">=</span> <span class="hljs-type">URLSession</span>.shared.dataTask(with: url) { data, response, error <span class="hljs-keyword">in</span><br />            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> data <span class="hljs-operator">=</span> data,<br />                <span class="hljs-keyword">let</span> image <span class="hljs-operator">=</span> <span class="hljs-type">UIImage</span>(data: data) {<br />                completion(image)<br />            } <span class="hljs-keyword">else</span> {<br />                completion(<span class="hljs-literal">nil</span>)<br />            }<br />        }<br />        task.resume()<br />    }<br />    <br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">submitOrder</span>(<span class="hljs-params">forMenuIDs</span> <span class="hljs-params">menuIDs</span>: [<span class="hljs-type">Int</span>], <span class="hljs-params">completion</span>: <span class="hljs-keyword">@escaping</span> (<span class="hljs-type">Int</span>?) -&gt; <span class="hljs-type">Void</span>) {<br />        <span class="hljs-keyword">let</span> orderURL <span class="hljs-operator">=</span> baseURL.appendingPathComponent(<span class="hljs-string">&quot;order&quot;</span>)<br />        <span class="hljs-keyword">var</span> request <span class="hljs-operator">=</span> <span class="hljs-type">URLRequest</span>(url: orderURL)<br />        request.httpMethod <span class="hljs-operator">=</span> <span class="hljs-string">&quot;POST&quot;</span><br />        request.setValue(<span class="hljs-string">&quot;application/json&quot;</span>, forHTTPHeaderField: <span class="hljs-string">&quot;Content-Type&quot;</span>)<br />        <span class="hljs-keyword">let</span> data: [<span class="hljs-type">String</span>: [<span class="hljs-type">Int</span>]] <span class="hljs-operator">=</span> [<span class="hljs-string">&quot;menuIds&quot;</span>: menuIDs]<br />        <span class="hljs-keyword">let</span> jsonEncoder <span class="hljs-operator">=</span> <span class="hljs-type">JSONEncoder</span>()<br />        <span class="hljs-keyword">let</span> jsonData <span class="hljs-operator">=</span> <span class="hljs-keyword">try?</span> jsonEncoder.encode(data)<br />        request.httpBody <span class="hljs-operator">=</span> jsonData<br />        <span class="hljs-keyword">let</span> task <span class="hljs-operator">=</span> <span class="hljs-type">URLSession</span>.shared.dataTask(with: request) { data, response, error <span class="hljs-keyword">in</span><br />            <span class="hljs-keyword">let</span> jsonDecoder <span class="hljs-operator">=</span> <span class="hljs-type">JSONDecoder</span>()<br />            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> data <span class="hljs-operator">=</span> data,<br />                <span class="hljs-keyword">let</span> preparationTime <span class="hljs-operator">=</span> <span class="hljs-keyword">try?</span> jsonDecoder.decode(<span class="hljs-type">PreparationTime</span>.<span class="hljs-keyword">self</span>, from: data) {<br />                completion(preparationTime.prepTime)<br />            } <span class="hljs-keyword">else</span> {<br />                completion(<span class="hljs-literal">nil</span>)<br />            }<br />        }<br />        task.resume()<br />    }<br />}</span></pre><p name="e78c" id="e78c" class="graf graf--p graf-after--pre">初學者撰寫串接後台的程式時可模仿範例的寫法，將跟後台溝通的相關程式統一定義在某個檔案，比方串接 TMBD API 開發電影 App 時，將相關的 API 定義成 NetworkController 或 MovieController 的 function，然後利用 static 宣告的變數 shared 產生物件呼叫。</p><figure name="880c" id="880c" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*y-eewd9qwitWShWfULhgRQ.jpeg" data-width="1950" data-height="588" src="https://cdn-images-1.medium.com/max/800/1*y-eewd9qwitWShWfULhgRQ.jpeg"></figure><div name="5787" id="5787" class="graf graf--mixtapeEmbed graf-after--figure"><a href="https://www.themoviedb.org/documentation/api?language=en-US" data-href="https://www.themoviedb.org/documentation/api?language=en-US" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://www.themoviedb.org/documentation/api?language=en-US"><strong class="markup--strong markup--mixtapeEmbed-strong">API Overview - The Movie Database (TMDb)</strong><br><em class="markup--em markup--mixtapeEmbed-em">Our API is available for everyone to use. A TMDb user account is required to request an API key. Professional users are…</em>www.themoviedb.org</a><a href="https://www.themoviedb.org/documentation/api?language=en-US" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="f638a6c945a79b10bf01aef89204a43d"></a></div><p name="31b0" id="31b0" class="graf graf--p graf-after--mixtapeEmbed">以下幾種都是網路抓資料常見的檔名結尾。</p><ul class="postList"><li name="3e92" id="3e92" class="graf graf--li graf-after--p">Controller</li><li name="f073" id="f073" class="graf graf--li graf-after--li">Service</li><li name="e3ec" id="e3ec" class="graf graf--li graf-after--li">Client</li><li name="e503" id="e503" class="graf graf--li graf-after--li">Manager</li></ul><h3 name="c1b9" id="c1b9" class="graf graf--h3 graf-after--li">利用 capture list 解決 closure 可能產生的記憶體問題</h3><p name="b196" id="b196" class="graf graf--p graf-after--h3">呼叫 API 時，我們也可以在 closure 裡加上 capture list，比方 <code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">[weak self]</strong></code>。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="0e11" id="0e11" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {<br />    <span class="hljs-keyword">super</span>.viewDidLoad()<br />    <span class="hljs-type">MenuController</span>.shared.fetchCategories { [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] categories <span class="hljs-keyword">in</span><br />        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword">self</span> <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }<br />        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> categories <span class="hljs-operator">=</span> categories {<br />            <span class="hljs-keyword">self</span>.updateUI(with: categories)<br />        }<br />    }<br />}</span></pre><p name="47ec" id="47ec" class="graf graf--p graf-after--pre">它的好處可參考以下連結的說明。</p><div name="08fd" id="08fd" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-capture-list-%E8%A7%A3%E6%B1%BA-closure-%E5%8F%AF%E8%83%BD%E7%94%A2%E7%94%9F%E7%9A%84%E8%A8%98%E6%86%B6%E9%AB%94%E5%95%8F%E9%A1%8C-a7672fab1d1f" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-capture-list-%E8%A7%A3%E6%B1%BA-closure-%E5%8F%AF%E8%83%BD%E7%94%A2%E7%94%9F%E7%9A%84%E8%A8%98%E6%86%B6%E9%AB%94%E5%95%8F%E9%A1%8C-a7672fab1d1f" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-capture-list-%E8%A7%A3%E6%B1%BA-closure-%E5%8F%AF%E8%83%BD%E7%94%A2%E7%94%9F%E7%9A%84%E8%A8%98%E6%86%B6%E9%AB%94%E5%95%8F%E9%A1%8C-a7672fab1d1f"><strong class="markup--strong markup--mixtapeEmbed-strong">利用 capture list 解決 closure 可能產生的記憶體問題</strong><br><em class="markup--em markup--mixtapeEmbed-em">開發 iOS App 時，我們時常使用強大的 closure 語法。然而就像 spider man，能力愈大，責任愈大，強大的 closure 有時會產生麻煩的記憶體問題。</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-capture-list-%E8%A7%A3%E6%B1%BA-closure-%E5%8F%AF%E8%83%BD%E7%94%A2%E7%94%9F%E7%9A%84%E8%A8%98%E6%86%B6%E9%AB%94%E5%95%8F%E9%A1%8C-a7672fab1d1f" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="b54c891c1d8272a29fa3de3bfc2ea469" data-thumbnail-img-id="1*Vfjp-SmuZMsxT8--MGQrAA.png" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*Vfjp-SmuZMsxT8--MGQrAA.png);"></a></div><h3 name="77da" id="77da" class="graf graf--h3 graf-after--mixtapeEmbed">串接 REST API，練習 http get，post，delete，put，以 Reqres API 為例</h3><p name="5988" id="5988" class="graf graf--p graf-after--h3">剛剛 Apple 的範例已經很完整，不過常見的 REST API 通常包含了 HTTP get，post，delete &amp; put，因此接下來讓我們以 Reqres API 為例，試試串接 REST API。</p><div name="7453" id="7453" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E4%BD%BF%E7%94%A8-urlsession-%E4%B8%B2%E6%8E%A5-http-get-post-delete-put-api-%E4%BB%A5-reqres-api-%E7%82%BA%E4%BE%8B-f977ec876c33" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E4%BD%BF%E7%94%A8-urlsession-%E4%B8%B2%E6%8E%A5-http-get-post-delete-put-api-%E4%BB%A5-reqres-api-%E7%82%BA%E4%BE%8B-f977ec876c33" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E4%BD%BF%E7%94%A8-urlsession-%E4%B8%B2%E6%8E%A5-http-get-post-delete-put-api-%E4%BB%A5-reqres-api-%E7%82%BA%E4%BE%8B-f977ec876c33"><strong class="markup--strong markup--mixtapeEmbed-strong">使用 URLSession 串接 REST API，練習 http get，post，delete，put，以 Reqres API 為例</strong><br><em class="markup--em markup--mixtapeEmbed-em">開發 iOS App 時，我們時常需要跟網路上的後台(server) 溝通。如下圖所示，我們的 App 是 client，它會發送 request 給 server，然後 server 再回傳 response，比方將 JSON…</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E4%BD%BF%E7%94%A8-urlsession-%E4%B8%B2%E6%8E%A5-http-get-post-delete-put-api-%E4%BB%A5-reqres-api-%E7%82%BA%E4%BE%8B-f977ec876c33" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="c08866f764f6d1421d0b51ece79be944" data-thumbnail-img-id="1*EgbnqUQogcCH136xyvdbbQ.png" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*EgbnqUQogcCH136xyvdbbQ.png);"></a></div><ul class="postList"><li name="a368" id="a368" class="graf graf--li graf-after--mixtapeEmbed"><strong class="markup--strong markup--li-strong">model 資料型別</strong></li></ul><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="dba9" id="dba9" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">UsersResponse</span>: <span class="hljs-title class_">Decodable</span> {<br />    <span class="hljs-keyword">let</span> page: <span class="hljs-type">Int</span><br />    <span class="hljs-keyword">let</span> perPage: <span class="hljs-type">Int</span><br />    <span class="hljs-keyword">let</span> total: <span class="hljs-type">Int</span><br />    <span class="hljs-keyword">let</span> totalPages: <span class="hljs-type">Int</span><br />    <span class="hljs-keyword">let</span> data: [<span class="hljs-type">User</span>]<br />}<br /><br /><span class="hljs-keyword">struct</span> <span class="hljs-title class_">User</span>: <span class="hljs-title class_">Decodable</span> {<br />    <span class="hljs-keyword">let</span> id: <span class="hljs-type">Int</span><br />    <span class="hljs-keyword">let</span> email: <span class="hljs-type">String</span><br />    <span class="hljs-keyword">let</span> firstName: <span class="hljs-type">String</span><br />    <span class="hljs-keyword">let</span> lastName: <span class="hljs-type">String</span><br />    <span class="hljs-keyword">let</span> avatar: <span class="hljs-type">URL</span><br />}<br /><br /><span class="hljs-keyword">struct</span> <span class="hljs-title class_">CreateUserResponse</span>: <span class="hljs-title class_">Decodable</span> {<br />    <span class="hljs-keyword">let</span> name: <span class="hljs-type">String</span><br />    <span class="hljs-keyword">let</span> job: <span class="hljs-type">String</span><br />    <span class="hljs-keyword">let</span> id: <span class="hljs-type">String</span><br />}<br /><br /><span class="hljs-keyword">struct</span> <span class="hljs-title class_">UpdateUserResponse</span>: <span class="hljs-title class_">Decodable</span> {<br />    <span class="hljs-keyword">let</span> name: <span class="hljs-type">String</span><br />    <span class="hljs-keyword">let</span> job: <span class="hljs-type">String</span><br />}<br /><br /><span class="hljs-keyword">struct</span> <span class="hljs-title class_">CreateUserBody</span>: <span class="hljs-title class_">Encodable</span> {<br />    <span class="hljs-keyword">let</span> name: <span class="hljs-type">String</span><br />    <span class="hljs-keyword">let</span> job: <span class="hljs-type">String</span><br />}<br /><br /><span class="hljs-keyword">struct</span> <span class="hljs-title class_">UpdateUserBody</span>: <span class="hljs-title class_">Encodable</span> {<br />    <span class="hljs-keyword">let</span> name: <span class="hljs-type">String</span><br />    <span class="hljs-keyword">let</span> job: <span class="hljs-type">String</span><br />}</span></pre><ul class="postList"><li name="b442" id="b442" class="graf graf--li graf-after--pre"><strong class="markup--strong markup--li-strong">定義設定網址參數的 URL extension</strong></li></ul><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="732e" id="732e" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content"><span class="hljs-keyword">extension</span> <span class="hljs-title class_">URL</span> {<br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">withQueries</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">queries</span>: [<span class="hljs-params">String</span>: <span class="hljs-type">String</span>]) -&gt; <span class="hljs-type">URL</span>? {<br />        <span class="hljs-keyword">var</span> components <span class="hljs-operator">=</span> <span class="hljs-type">URLComponents</span>(url: <span class="hljs-keyword">self</span>, resolvingAgainstBaseURL: <span class="hljs-literal">true</span>)<br />        components<span class="hljs-operator">?</span>.queryItems <span class="hljs-operator">=</span> queries.map {<br />            <span class="hljs-type">URLQueryItem</span>(name: <span class="hljs-variable">$0</span>.key, value: <span class="hljs-variable">$0</span>.value)<br />        }<br />        <span class="hljs-keyword">return</span> components<span class="hljs-operator">?</span>.url<br />    }<br />}</span></pre><ul class="postList"><li name="ec17" id="ec17" class="graf graf--li graf-after--pre"><strong class="markup--strong markup--li-strong">定義錯誤型別 NetworkError</strong></li></ul><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="36d9" id="36d9" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content"><span class="hljs-keyword">enum</span> <span class="hljs-title class_">NetworkError</span>: <span class="hljs-title class_">Error</span>{<br />   <span class="hljs-keyword">case</span> invalidURL<br />}</span></pre><ul class="postList"><li name="b940" id="b940" class="graf graf--li graf-after--pre"><strong class="markup--strong markup--li-strong">串接 API 的 NetworkController</strong></li></ul><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="4b10" id="4b10" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> Foundation<br /><br /><span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkController</span> {<br />    <br />    <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> shared <span class="hljs-operator">=</span> <span class="hljs-type">NetworkController</span>()<br />    <br />    <span class="hljs-keyword">let</span> baseURL <span class="hljs-operator">=</span> <span class="hljs-type">URL</span>(string: <span class="hljs-string">&quot;https://reqres.in/api&quot;</span>)<span class="hljs-operator">!</span><br />    <br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">getUsers</span>(<span class="hljs-params">page</span>: <span class="hljs-type">Int</span>, <span class="hljs-params">completion</span>: <span class="hljs-keyword">@escaping</span> (<span class="hljs-type">UsersResponse</span>?) -&gt; <span class="hljs-type">Void</span>) {<br />        <br />        <span class="hljs-keyword">let</span> queries <span class="hljs-operator">=</span> [<span class="hljs-string">&quot;page&quot;</span>: <span class="hljs-string">&quot;<span class="hljs-subst">\(page)</span>&quot;</span>]<br />        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> url <span class="hljs-operator">=</span> baseURL.appendingPathComponent(<span class="hljs-string">&quot;users&quot;</span>).withQueries(queries) <span class="hljs-keyword">else</span> {<br />            completion(<span class="hljs-literal">nil</span>)<br />            <span class="hljs-keyword">return</span><br />        }<br />        <br />        <span class="hljs-type">URLSession</span>.shared.dataTask(with: url) { data, response, error <span class="hljs-keyword">in</span><br />            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> data <span class="hljs-operator">=</span> data {<br />                <span class="hljs-keyword">do</span> {<br />                    <span class="hljs-built_in">print</span>(<span class="hljs-type">String</span>(data: data, encoding: .utf8)<span class="hljs-operator">!</span>)<br />                    <br />                    <span class="hljs-keyword">let</span> decoder <span class="hljs-operator">=</span> <span class="hljs-type">JSONDecoder</span>()<br />                    decoder.keyDecodingStrategy <span class="hljs-operator">=</span> .convertFromSnakeCase<br />                    <span class="hljs-keyword">let</span> usersResponse <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> decoder.decode(<span class="hljs-type">UsersResponse</span>.<span class="hljs-keyword">self</span>, from: data)<br />                    completion(usersResponse)<br />                } <span class="hljs-keyword">catch</span>  {<br />                    <span class="hljs-built_in">print</span>(error)<br />                    completion(<span class="hljs-literal">nil</span>)<br />                }<br />            } <span class="hljs-keyword">else</span> {<br />                completion(<span class="hljs-literal">nil</span>)<br />            }<br />        }.resume()<br />    }<br />    <br />    <br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">createUser</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">user</span>: <span class="hljs-type">CreateUserBody</span>, <span class="hljs-params">completion</span>: <span class="hljs-keyword">@escaping</span> (<span class="hljs-type">CreateUserResponse</span>?) -&gt; <span class="hljs-type">Void</span>) {<br />        <span class="hljs-keyword">let</span> url <span class="hljs-operator">=</span> baseURL.appendingPathComponent(<span class="hljs-string">&quot;users&quot;</span>)<br />        <span class="hljs-keyword">var</span> request <span class="hljs-operator">=</span> <span class="hljs-type">URLRequest</span>(url: url)<br />        request.httpMethod <span class="hljs-operator">=</span> <span class="hljs-string">&quot;POST&quot;</span><br />        request.setValue(<span class="hljs-string">&quot;application/json&quot;</span>, forHTTPHeaderField: <span class="hljs-string">&quot;Content-Type&quot;</span>)<br />        <br />        <span class="hljs-keyword">let</span> encoder <span class="hljs-operator">=</span> <span class="hljs-type">JSONEncoder</span>()<br />        <span class="hljs-keyword">let</span> data <span class="hljs-operator">=</span> <span class="hljs-keyword">try?</span> encoder.encode(user)<br />        request.httpBody <span class="hljs-operator">=</span> data<br />        <span class="hljs-type">URLSession</span>.shared.dataTask(with: request) { data, response, error <span class="hljs-keyword">in</span><br />            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> data <span class="hljs-operator">=</span> data {<br />                <span class="hljs-keyword">do</span> {<br />                    <span class="hljs-keyword">let</span> decoder <span class="hljs-operator">=</span> <span class="hljs-type">JSONDecoder</span>()<br />                    <span class="hljs-keyword">let</span> createUserResponse <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> decoder.decode(<span class="hljs-type">CreateUserResponse</span>.<span class="hljs-keyword">self</span>, from: data)<br />                    completion(createUserResponse)<br />                } <span class="hljs-keyword">catch</span>  {<br />                    <span class="hljs-built_in">print</span>(error)<br />                    completion(<span class="hljs-literal">nil</span>)<br />                }<br />            } <span class="hljs-keyword">else</span> {<br />                completion(<span class="hljs-literal">nil</span>)<br />            }<br />        }.resume()<br />    }<br />    <br />    <br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">deleteUser</span>(<span class="hljs-params">userId</span>: <span class="hljs-type">Int</span>, <span class="hljs-params">completion</span>: <span class="hljs-keyword">@escaping</span> (<span class="hljs-type">String</span>?) -&gt; <span class="hljs-type">Void</span>) {<br />        <span class="hljs-keyword">let</span> url <span class="hljs-operator">=</span> baseURL.appendingPathComponent(<span class="hljs-string">&quot;users/<span class="hljs-subst">\(userId)</span>&quot;</span>)<br />        <span class="hljs-keyword">var</span> request <span class="hljs-operator">=</span> <span class="hljs-type">URLRequest</span>(url: url)<br />        request.httpMethod <span class="hljs-operator">=</span> <span class="hljs-string">&quot;DELETE&quot;</span><br />        <span class="hljs-type">URLSession</span>.shared.dataTask(with: request) { data, response, error <span class="hljs-keyword">in</span><br />            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> httpResponse <span class="hljs-operator">=</span> response <span class="hljs-keyword">as?</span> <span class="hljs-type">HTTPURLResponse</span>,<br />               httpResponse.statusCode <span class="hljs-operator">==</span> <span class="hljs-number">204</span> {<br />                completion(<span class="hljs-string">&quot;ok&quot;</span>)<br />            } <span class="hljs-keyword">else</span> {<br />                completion(<span class="hljs-literal">nil</span>)<br />            }<br />        }.resume()<br />    }<br />    <br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">updateUser</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">user</span>: <span class="hljs-type">UpdateUserBody</span>, <span class="hljs-params">completion</span>: <span class="hljs-keyword">@escaping</span> (<span class="hljs-type">UpdateUserResponse</span>?) -&gt; <span class="hljs-type">Void</span>) {<br />        <br />        <span class="hljs-keyword">let</span> url <span class="hljs-operator">=</span> baseURL.appendingPathComponent(<span class="hljs-string">&quot;users&quot;</span>)<br />        <span class="hljs-keyword">var</span> request <span class="hljs-operator">=</span> <span class="hljs-type">URLRequest</span>(url: url)<br />        request.httpMethod <span class="hljs-operator">=</span> <span class="hljs-string">&quot;PUT&quot;</span><br />        request.setValue(<span class="hljs-string">&quot;application/json&quot;</span>, forHTTPHeaderField: <span class="hljs-string">&quot;Content-Type&quot;</span>)<br />        <br />        <span class="hljs-keyword">let</span> encoder <span class="hljs-operator">=</span> <span class="hljs-type">JSONEncoder</span>()<br />        <span class="hljs-keyword">let</span> data <span class="hljs-operator">=</span> <span class="hljs-keyword">try?</span> encoder.encode(user)<br />        request.httpBody <span class="hljs-operator">=</span> data<br />        <span class="hljs-type">URLSession</span>.shared.dataTask(with: request) { data, response, error <span class="hljs-keyword">in</span><br />            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> data <span class="hljs-operator">=</span> data {<br />                <span class="hljs-keyword">do</span> {<br />                    <span class="hljs-keyword">let</span> decoder <span class="hljs-operator">=</span> <span class="hljs-type">JSONDecoder</span>()<br />                    <span class="hljs-keyword">let</span> updateUserResponse <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> decoder.decode(<span class="hljs-type">UpdateUserResponse</span>.<span class="hljs-keyword">self</span>, from: data)<br />                    completion(updateUserResponse)<br />                } <span class="hljs-keyword">catch</span>  {<br />                    <span class="hljs-built_in">print</span>(error)<br />                    completion(<span class="hljs-literal">nil</span>)<br />                }<br />            } <span class="hljs-keyword">else</span> {<br />                completion(<span class="hljs-literal">nil</span>)<br />            }<br />        }.resume()<br />    }<br />    <br />}</span></pre><ul class="postList"><li name="4e67" id="4e67" class="graf graf--li graf-after--pre"><strong class="markup--strong markup--li-strong">呼叫 NetworkController 定義的 function</strong></li></ul><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="81c6" id="81c6" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> UIKit<br /><br /><span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewController</span>: <span class="hljs-title class_">UIViewController</span> {<br /><br />  <span class="hljs-keyword">@IBAction</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">get</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">sender</span>: <span class="hljs-keyword">Any</span>) {<br />        <span class="hljs-type">NetworkController</span>.shared.getUsers(page: <span class="hljs-number">1</span>) { userResponse <span class="hljs-keyword">in</span><br />            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> userResponse <span class="hljs-operator">=</span> userResponse {<br />                <span class="hljs-built_in">print</span>(userResponse)<br />            }<br />        }<br />    }<br />    <br />    <span class="hljs-keyword">@IBAction</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">post</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">sender</span>: <span class="hljs-keyword">Any</span>) {<br />        <span class="hljs-keyword">let</span> user <span class="hljs-operator">=</span> <span class="hljs-type">CreateUserBody</span>(name: <span class="hljs-string">&quot;fox&quot;</span>, job: <span class="hljs-string">&quot;student&quot;</span>)<br />        <span class="hljs-type">NetworkController</span>.shared.createUser(user) { createUserResponse <span class="hljs-keyword">in</span><br />            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> createUserResponse <span class="hljs-operator">=</span> createUserResponse {<br />                <span class="hljs-built_in">print</span>(createUserResponse)<br />            }<br />        }<br />    }<br />    <br />  <br />    <span class="hljs-keyword">@IBAction</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">remove</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">sender</span>: <span class="hljs-keyword">Any</span>) {<br />        <br />        <span class="hljs-type">NetworkController</span>.shared.deleteUser(userId: <span class="hljs-number">5</span>) { result <span class="hljs-keyword">in</span><br />            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> result <span class="hljs-operator">=</span> result {<br />                <span class="hljs-built_in">print</span>(result)<br />            }<br />        }<br />    }<br />    <br />    <span class="hljs-keyword">@IBAction</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">put</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">sender</span>: <span class="hljs-keyword">Any</span>) {<br />        <span class="hljs-keyword">let</span> user <span class="hljs-operator">=</span> <span class="hljs-type">UpdateUserBody</span>(name: <span class="hljs-string">&quot;Peter&quot;</span>, job: <span class="hljs-string">&quot;Writer&quot;</span>)<br />        <span class="hljs-type">NetworkController</span>.shared.updateUser(user) { updateUserResponse <span class="hljs-keyword">in</span><br />            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> updateUserResponse <span class="hljs-operator">=</span> updateUserResponse {<br />                <span class="hljs-built_in">print</span>(updateUserResponse)<br />            }<br />        }<br />    }<br />}</span></pre><h3 name="ce2a" id="ce2a" class="graf graf--h3 graf-after--pre">其它 API 串接範例:</h3><h3 name="fd3a" id="fd3a" class="graf graf--h3 graf-after--h3">iTunes API</h3><p name="ea66" id="ea66" class="graf graf--p graf-after--h3">LBTA 的 AppStore JSON APIs。</p><div name="91ca" id="91ca" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://www.letsbuildthatapp.com" data-href="https://www.letsbuildthatapp.com" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://www.letsbuildthatapp.com"><strong class="markup--strong markup--mixtapeEmbed-strong">Courses</strong><br><em class="markup--em markup--mixtapeEmbed-em">Let&#39;s Build Apps Together</em>www.letsbuildthatapp.com</a><a href="https://www.letsbuildthatapp.com" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="a2aad3eb5823d33e018277701765d00d" data-thumbnail-img-id="0*QtCeqh8q-uAPqN7K" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*QtCeqh8q-uAPqN7K);"></a></div><figure name="bba2" id="bba2" class="graf graf--figure graf-after--mixtapeEmbed graf--trailing"><img class="graf-image" data-image-id="1*1XaYO4qRKCGtmSvNC67eZw.jpeg" data-width="1888" data-height="870" src="https://cdn-images-1.medium.com/max/800/1*1XaYO4qRKCGtmSvNC67eZw.jpeg"></figure></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@apppeterpan" class="p-author h-card">彼得潘的 iOS App Neverland</a> on <a href="https://medium.com/p/84139d10a7c9"><time class="dt-published" datetime="2019-12-20T07:36:54.270Z">December 20, 2019</time></a>.</p><p><a href="https://medium.com/@apppeterpan/%E6%A8%A1%E4%BB%BF-apple-%E5%AE%98%E6%96%B9%E7%AF%84%E4%BE%8B%E4%B8%B2%E6%8E%A5-json-api-84139d10a7c9" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on September 17, 2025.</p></footer></article></body></html>