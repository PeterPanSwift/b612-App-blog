<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Protocols 程式範例 — Apple’s The Swift Programming Language</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Protocols 程式範例 — Apple’s The Swift Programming Language</h1>
</header>
<section data-field="subtitle" class="p-summary">
Protocol Syntax
</section>
<section data-field="body" class="e-content">
<section name="ab47" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="b617" id="b617" class="graf graf--h3 graf--leading graf--title">Protocols 程式範例 — Apple’s The Swift Programming Language</h3><div name="c3c8" id="c3c8" class="graf graf--mixtapeEmbed graf-after--h3"><a href="https://docs.swift.org/swift-book/LanguageGuide/Protocols.html" data-href="https://docs.swift.org/swift-book/LanguageGuide/Protocols.html" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://docs.swift.org/swift-book/LanguageGuide/Protocols.html"><strong class="markup--strong markup--mixtapeEmbed-strong">Protocols - The Swift Programming Language (Swift 4.2)</strong><br><em class="markup--em markup--mixtapeEmbed-em">A protocol defines a blueprint of methods, properties, and other requirements that suit a particular task or piece of…</em>docs.swift.org</a><a href="https://docs.swift.org/swift-book/LanguageGuide/Protocols.html" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="920ba493ba708f8632a3e0b88e74c993"></a></div><blockquote name="6398" id="6398" class="graf graf--blockquote graf-after--mixtapeEmbed"><strong class="markup--strong markup--blockquote-strong">Protocol Syntax</strong></blockquote><p name="3e76" id="3e76" class="graf graf--p graf-after--blockquote">如果有繼承，要先寫父類別，再寫遵從的 protocol。</p><pre name="fedc" id="fedc" class="graf graf--pre graf-after--p">struct SomeStructure: FirstProtocol, AnotherProtocol {</pre><pre name="e64e" id="e64e" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">   // structure definition goes here</em></pre><pre name="7eaa" id="7eaa" class="graf graf--pre graf-after--pre">}</pre><pre name="745b" id="745b" class="graf graf--pre graf-after--pre">class SomeClass: SomeSuperclass, FirstProtocol, AnotherProtocol {</pre><pre name="b889" id="b889" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">   // class definition goes here</em></pre><pre name="173d" id="173d" class="graf graf--pre graf-after--pre">}</pre><blockquote name="fb1f" id="fb1f" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">Property Requirements</strong></blockquote><pre name="887d" id="887d" class="graf graf--pre graf-after--blockquote">protocol SomeProtocol {</pre><pre name="d2c8" id="d2c8" class="graf graf--pre graf-after--pre">   var mustBeSettable: Int { get set }</pre><pre name="b99a" id="b99a" class="graf graf--pre graf-after--pre">   var doesNotNeedToBeSettable: Int { get }</pre><pre name="7a89" id="7a89" class="graf graf--pre graf-after--pre">}</pre><pre name="f921" id="f921" class="graf graf--pre graf-after--pre">protocol AnotherProtocol {</pre><pre name="27a3" id="27a3" class="graf graf--pre graf-after--pre">   static var someTypeProperty: Int { get set }</pre><pre name="97cb" id="97cb" class="graf graf--pre graf-after--pre">}</pre><p name="519d" id="519d" class="graf graf--p graf-after--pre">以 stored property 或 computed property 實現。</p><p name="68a9" id="68a9" class="graf graf--p graf-after--p">例子</p><pre name="df4b" id="df4b" class="graf graf--pre graf-after--p">protocol FullyNamed {</pre><pre name="f7f8" id="f7f8" class="graf graf--pre graf-after--pre">   var fullName: String { get }</pre><pre name="078d" id="078d" class="graf graf--pre graf-after--pre">}</pre><pre name="9c7f" id="9c7f" class="graf graf--pre graf-after--pre">struct Person: FullyNamed {</pre><pre name="2d2a" id="2d2a" class="graf graf--pre graf-after--pre">   var fullName: String</pre><pre name="8b24" id="8b24" class="graf graf--pre graf-after--pre">}</pre><pre name="77d3" id="77d3" class="graf graf--pre graf-after--pre">let john = Person(fullName: &quot;John Appleseed&quot;)</pre><pre name="5bbc" id="5bbc" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// john.fullName is &quot;John Appleseed&quot;</em></pre><pre name="30c7" id="30c7" class="graf graf--pre graf-after--pre">class Starship: FullyNamed {</pre><pre name="4a7d" id="4a7d" class="graf graf--pre graf-after--pre">   var prefix: String?</pre><pre name="b3a6" id="b3a6" class="graf graf--pre graf-after--pre">   var name: String</pre><pre name="4c67" id="4c67" class="graf graf--pre graf-after--pre">   init(name: String, prefix: String? = nil) {</pre><pre name="4e9e" id="4e9e" class="graf graf--pre graf-after--pre">      self.name = name</pre><pre name="bb64" id="bb64" class="graf graf--pre graf-after--pre">      self.prefix = prefix</pre><pre name="dfd6" id="dfd6" class="graf graf--pre graf-after--pre">   }</pre><pre name="05d4" id="05d4" class="graf graf--pre graf-after--pre">   var fullName: String {</pre><pre name="524e" id="524e" class="graf graf--pre graf-after--pre">      return (prefix != nil ? prefix! + &quot; &quot; : &quot;&quot;) + name</pre><pre name="6fd2" id="6fd2" class="graf graf--pre graf-after--pre">   }</pre><pre name="ac4e" id="ac4e" class="graf graf--pre graf-after--pre">}</pre><pre name="34d1" id="34d1" class="graf graf--pre graf-after--pre">var ncc1701 = Starship(name: &quot;Enterprise&quot;, prefix: &quot;USS&quot;)</pre><pre name="2bc2" id="2bc2" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// ncc1701.fullName is &quot;USS Enterprise&quot;</em></pre><blockquote name="a1b9" id="a1b9" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">Method Requirements</strong></blockquote><pre name="b4d3" id="b4d3" class="graf graf--pre graf-after--blockquote">protocol RandomNumberGenerator {</pre><pre name="6bef" id="6bef" class="graf graf--pre graf-after--pre">   func random() -&gt; Double</pre><pre name="9411" id="9411" class="graf graf--pre graf-after--pre">}</pre><pre name="cc51" id="cc51" class="graf graf--pre graf-after--pre">class LinearCongruentialGenerator: RandomNumberGenerator {</pre><pre name="f771" id="f771" class="graf graf--pre graf-after--pre">   var lastRandom = 42.0</pre><pre name="3304" id="3304" class="graf graf--pre graf-after--pre">   let m = 139968.0</pre><pre name="5600" id="5600" class="graf graf--pre graf-after--pre">   let a = 3877.0</pre><pre name="f92f" id="f92f" class="graf graf--pre graf-after--pre">   let c = 29573.0</pre><pre name="6e94" id="6e94" class="graf graf--pre graf-after--pre">   func random() -&gt; Double {</pre><pre name="fdf8" id="fdf8" class="graf graf--pre graf-after--pre">      lastRandom = ((lastRandom * a + c).truncatingRemainder(dividingBy:m))</pre><pre name="5d7d" id="5d7d" class="graf graf--pre graf-after--pre">      return lastRandom / m</pre><pre name="3292" id="3292" class="graf graf--pre graf-after--pre">   }</pre><pre name="2767" id="2767" class="graf graf--pre graf-after--pre">}</pre><pre name="eaa0" id="eaa0" class="graf graf--pre graf-after--pre">let generator = LinearCongruentialGenerator()</pre><pre name="2e3a" id="2e3a" class="graf graf--pre graf-after--pre">print(&quot;Here&#39;s a random number: \(generator.random())&quot;)</pre><pre name="c32a" id="c32a" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// Prints &quot;Here&#39;s a random number: 0.3746499199817101&quot;</em></pre><pre name="39f9" id="39f9" class="graf graf--pre graf-after--pre">print(&quot;And another one: \(generator.random())&quot;)</pre><pre name="e6eb" id="e6eb" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// Prints &quot;And another one: 0.729023776863283&quot;</em></pre><blockquote name="022d" id="022d" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">Mutating Method Requirements</strong></blockquote><pre name="b149" id="b149" class="graf graf--pre graf-after--blockquote">protocol Togglable {</pre><pre name="aa4c" id="aa4c" class="graf graf--pre graf-after--pre">   mutating func toggle()</pre><pre name="5f96" id="5f96" class="graf graf--pre graf-after--pre">}</pre><pre name="86ad" id="86ad" class="graf graf--pre graf-after--pre">enum OnOffSwitch: Togglable {</pre><pre name="1394" id="1394" class="graf graf--pre graf-after--pre">   case off, on</pre><pre name="7a55" id="7a55" class="graf graf--pre graf-after--pre">   mutating func toggle() {</pre><pre name="28a3" id="28a3" class="graf graf--pre graf-after--pre">      switch self {</pre><pre name="a5b0" id="a5b0" class="graf graf--pre graf-after--pre">      case .off:</pre><pre name="5450" id="5450" class="graf graf--pre graf-after--pre">         self = .on</pre><pre name="fde0" id="fde0" class="graf graf--pre graf-after--pre">      case .on:</pre><pre name="667a" id="667a" class="graf graf--pre graf-after--pre">         self = .off</pre><pre name="42f3" id="42f3" class="graf graf--pre graf-after--pre">      }</pre><pre name="5d45" id="5d45" class="graf graf--pre graf-after--pre">   }</pre><pre name="ea26" id="ea26" class="graf graf--pre graf-after--pre">}</pre><pre name="af28" id="af28" class="graf graf--pre graf-after--pre">var lightSwitch = OnOffSwitch.off</pre><pre name="a168" id="a168" class="graf graf--pre graf-after--pre">lightSwitch.toggle()</pre><pre name="d4f0" id="d4f0" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// lightSwitch is now equal to .on</em></pre><blockquote name="e5cb" id="e5cb" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">Initializer Requirements</strong></blockquote><pre name="7380" id="7380" class="graf graf--pre graf-after--blockquote">protocol SomeProtocol {</pre><pre name="5a6f" id="5a6f" class="graf graf--pre graf-after--pre">   init(someParameter: Int)</pre><pre name="11a5" id="11a5" class="graf graf--pre graf-after--pre">}</pre><blockquote name="9a7a" id="9a7a" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">Class Implementations of Protocol Initializer Requirements</strong></blockquote><p name="f7ef" id="f7ef" class="graf graf--p graf-after--blockquote">class 定義 protocol 的 init 時，要加上 required，才能確保繼承的 class 也會有 protocol 的 init。(例外: 如果 class 有加上 final，則可以不用加 required。)</p><pre name="fa6a" id="fa6a" class="graf graf--pre graf-after--p">protocol SomeProtocol {</pre><pre name="a245" id="a245" class="graf graf--pre graf-after--pre">   init(someParameter: Int)</pre><pre name="2265" id="2265" class="graf graf--pre graf-after--pre">}</pre><pre name="9d93" id="9d93" class="graf graf--pre graf-after--pre">class SomeClass: SomeProtocol {</pre><pre name="c62d" id="c62d" class="graf graf--pre graf-after--pre">   required init(someParameter: Int) {</pre><pre name="d519" id="d519" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">      // initializer implementation goes here</em></pre><pre name="2090" id="2090" class="graf graf--pre graf-after--pre">   }</pre><pre name="e0e8" id="e0e8" class="graf graf--pre graf-after--pre">}</pre><p name="4798" id="4798" class="graf graf--p graf-after--pre">覆寫父類別的 init 和定義 protocol 的 init，因此要加上 required override。</p><pre name="1dc3" id="1dc3" class="graf graf--pre graf-after--p">protocol SomeProtocol {</pre><pre name="5de0" id="5de0" class="graf graf--pre graf-after--pre">   init()</pre><pre name="5b5b" id="5b5b" class="graf graf--pre graf-after--pre">}</pre><pre name="8518" id="8518" class="graf graf--pre graf-after--pre">class SomeSuperClass {</pre><pre name="24cf" id="24cf" class="graf graf--pre graf-after--pre">   init() {</pre><pre name="d87d" id="d87d" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">      // initializer implementation goes here</em></pre><pre name="470d" id="470d" class="graf graf--pre graf-after--pre">   }</pre><pre name="bd50" id="bd50" class="graf graf--pre graf-after--pre">}</pre><pre name="1b07" id="1b07" class="graf graf--pre graf-after--pre">class SomeSubClass: SomeSuperClass, SomeProtocol {</pre><pre name="87ab" id="87ab" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">   // &quot;required&quot; from SomeProtocol conformance; &quot;override&quot; from SomeSuperClass</em></pre><pre name="4375" id="4375" class="graf graf--pre graf-after--pre">   required override init() {</pre><pre name="ab44" id="ab44" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">      // initializer implementation goes here</em></pre><pre name="981a" id="981a" class="graf graf--pre graf-after--pre">   }</pre><pre name="52c9" id="52c9" class="graf graf--pre graf-after--pre">}</pre><blockquote name="8b5e" id="8b5e" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">Failable Initializer Requirements</strong></blockquote><pre name="be1a" id="be1a" class="graf graf--pre graf-after--blockquote">A failable initializer requirement can be satisfied by a failable or nonfailable initializer on a conforming type. A nonfailable initializer requirement can be satisfied by a nonfailable initializer or an implicitly unwrapped failable initializer.</pre><blockquote name="8c26" id="8c26" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">Protocols as Types</strong></blockquote><pre name="50fd" id="50fd" class="graf graf--pre graf-after--blockquote">class Dice {</pre><pre name="c9a7" id="c9a7" class="graf graf--pre graf-after--pre">   let sides: Int</pre><pre name="8935" id="8935" class="graf graf--pre graf-after--pre">   let generator: RandomNumberGenerator</pre><pre name="ff40" id="ff40" class="graf graf--pre graf-after--pre">   init(sides: Int, generator: RandomNumberGenerator) {</pre><pre name="3f54" id="3f54" class="graf graf--pre graf-after--pre">      self.sides = sides</pre><pre name="b50b" id="b50b" class="graf graf--pre graf-after--pre">      self.generator = generator</pre><pre name="a9c1" id="a9c1" class="graf graf--pre graf-after--pre">   }</pre><pre name="867a" id="867a" class="graf graf--pre graf-after--pre">   func roll() -&gt; Int {</pre><pre name="a693" id="a693" class="graf graf--pre graf-after--pre">      return Int(generator.random() * Double(sides)) + 1</pre><pre name="fa94" id="fa94" class="graf graf--pre graf-after--pre">   }</pre><pre name="eb6d" id="eb6d" class="graf graf--pre graf-after--pre">}</pre><pre name="0615" id="0615" class="graf graf--pre graf-after--pre">var d6 = Dice(sides: 6, generator: LinearCongruentialGenerator())</pre><pre name="b2b4" id="b2b4" class="graf graf--pre graf-after--pre">for _ in 1...5 {</pre><pre name="29e3" id="29e3" class="graf graf--pre graf-after--pre">   print(&quot;Random dice roll is \(d6.roll())&quot;)</pre><pre name="b992" id="b992" class="graf graf--pre graf-after--pre">}</pre><pre name="9242" id="9242" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// Random dice roll is 3</em></pre><pre name="e7f4" id="e7f4" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// Random dice roll is 5</em></pre><pre name="a05f" id="a05f" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// Random dice roll is 4</em></pre><pre name="ab39" id="ab39" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// Random dice roll is 5</em></pre><pre name="ae74" id="ae74" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// Random dice roll is 4</em></pre><blockquote name="cada" id="cada" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">Delegation</strong></blockquote><pre name="f79a" id="f79a" class="graf graf--pre graf-after--blockquote">protocol DiceGame {</pre><pre name="c4be" id="c4be" class="graf graf--pre graf-after--pre">   var dice: Dice { get }</pre><pre name="6a47" id="6a47" class="graf graf--pre graf-after--pre">   func play()</pre><pre name="9e83" id="9e83" class="graf graf--pre graf-after--pre">}</pre><pre name="ebf5" id="ebf5" class="graf graf--pre graf-after--pre">protocol DiceGameDelegate: AnyObject {</pre><pre name="3280" id="3280" class="graf graf--pre graf-after--pre">   func gameDidStart(_ game: DiceGame)</pre><pre name="7335" id="7335" class="graf graf--pre graf-after--pre">   func game(_ game: DiceGame, didStartNewTurnWithDiceRoll diceRoll: Int)</pre><pre name="a93a" id="a93a" class="graf graf--pre graf-after--pre">   func gameDidEnd(_ game: DiceGame)</pre><pre name="1f8b" id="1f8b" class="graf graf--pre graf-after--pre">}</pre><pre name="b8e1" id="b8e1" class="graf graf--pre graf-after--pre">class SnakesAndLadders: DiceGame {</pre><pre name="d04e" id="d04e" class="graf graf--pre graf-after--pre">   let finalSquare = 25</pre><pre name="6396" id="6396" class="graf graf--pre graf-after--pre">   let dice = Dice(sides: 6, generator: LinearCongruentialGenerator())</pre><pre name="eab6" id="eab6" class="graf graf--pre graf-after--pre">   var square = 0</pre><pre name="9660" id="9660" class="graf graf--pre graf-after--pre">   var board: [Int]</pre><pre name="84ad" id="84ad" class="graf graf--pre graf-after--pre">   init() {</pre><pre name="86ab" id="86ab" class="graf graf--pre graf-after--pre">      board = Array(repeating: 0, count: finalSquare + 1)</pre><pre name="ba54" id="ba54" class="graf graf--pre graf-after--pre">      board[03] = +08; board[06] = +11; board[09] = +09; board[10] = +02</pre><pre name="e208" id="e208" class="graf graf--pre graf-after--pre">      board[14] = -10; board[19] = -11; board[22] = -02; board[24] = -08</pre><pre name="4f83" id="4f83" class="graf graf--pre graf-after--pre">   }</pre><pre name="c0f3" id="c0f3" class="graf graf--pre graf-after--pre">   weak var delegate: DiceGameDelegate?</pre><pre name="15e6" id="15e6" class="graf graf--pre graf-after--pre">   func play() {</pre><pre name="e665" id="e665" class="graf graf--pre graf-after--pre">      square = 0</pre><pre name="3781" id="3781" class="graf graf--pre graf-after--pre">      delegate?.gameDidStart(self)</pre><pre name="144e" id="144e" class="graf graf--pre graf-after--pre">      gameLoop: while square != finalSquare {</pre><pre name="0403" id="0403" class="graf graf--pre graf-after--pre">         let diceRoll = dice.roll()</pre><pre name="cc0a" id="cc0a" class="graf graf--pre graf-after--pre">         delegate?.game(self, didStartNewTurnWithDiceRoll: diceRoll)</pre><pre name="dcc4" id="dcc4" class="graf graf--pre graf-after--pre">         switch square + diceRoll {</pre><pre name="c27d" id="c27d" class="graf graf--pre graf-after--pre">         case finalSquare:</pre><pre name="02bb" id="02bb" class="graf graf--pre graf-after--pre">            break gameLoop</pre><pre name="7643" id="7643" class="graf graf--pre graf-after--pre">         case let newSquare where newSquare &gt; finalSquare:</pre><pre name="267c" id="267c" class="graf graf--pre graf-after--pre">            continue gameLoop</pre><pre name="3487" id="3487" class="graf graf--pre graf-after--pre">         default:</pre><pre name="0cbd" id="0cbd" class="graf graf--pre graf-after--pre">            square += diceRoll</pre><pre name="fe59" id="fe59" class="graf graf--pre graf-after--pre">            square += board[square]</pre><pre name="cfac" id="cfac" class="graf graf--pre graf-after--pre">         }</pre><pre name="4d7c" id="4d7c" class="graf graf--pre graf-after--pre">     }</pre><pre name="5f4c" id="5f4c" class="graf graf--pre graf-after--pre">     delegate?.gameDidEnd(self)</pre><pre name="a137" id="a137" class="graf graf--pre graf-after--pre">   }</pre><pre name="5a54" id="5a54" class="graf graf--pre graf-after--pre">}</pre><pre name="2a40" id="2a40" class="graf graf--pre graf-after--pre">class DiceGameTracker: DiceGameDelegate {</pre><pre name="2a01" id="2a01" class="graf graf--pre graf-after--pre">   var numberOfTurns = 0</pre><pre name="9870" id="9870" class="graf graf--pre graf-after--pre">   func gameDidStart(_ game: DiceGame) {</pre><pre name="ccf1" id="ccf1" class="graf graf--pre graf-after--pre">      numberOfTurns = 0</pre><pre name="c00a" id="c00a" class="graf graf--pre graf-after--pre">      if game is SnakesAndLadders {</pre><pre name="a3d5" id="a3d5" class="graf graf--pre graf-after--pre">         print(&quot;Started a new game of Snakes and Ladders&quot;)</pre><pre name="cb50" id="cb50" class="graf graf--pre graf-after--pre">      }</pre><pre name="a31c" id="a31c" class="graf graf--pre graf-after--pre">      print(&quot;The game is using a \(game.dice.sides)-sided dice&quot;)</pre><pre name="5473" id="5473" class="graf graf--pre graf-after--pre">   }</pre><pre name="d7d1" id="d7d1" class="graf graf--pre graf-after--pre">   func game(_ game: DiceGame, didStartNewTurnWithDiceRoll diceRoll: Int) {</pre><pre name="94b8" id="94b8" class="graf graf--pre graf-after--pre">      numberOfTurns += 1</pre><pre name="51a8" id="51a8" class="graf graf--pre graf-after--pre">      print(&quot;Rolled a \(diceRoll)&quot;)</pre><pre name="c444" id="c444" class="graf graf--pre graf-after--pre">   }</pre><pre name="24ed" id="24ed" class="graf graf--pre graf-after--pre">   func gameDidEnd(_ game: DiceGame) {</pre><pre name="ff8c" id="ff8c" class="graf graf--pre graf-after--pre">      print(&quot;The game lasted for \(numberOfTurns) turns&quot;)</pre><pre name="d654" id="d654" class="graf graf--pre graf-after--pre">   }</pre><pre name="38e0" id="38e0" class="graf graf--pre graf-after--pre">}</pre><pre name="6e96" id="6e96" class="graf graf--pre graf-after--pre">let tracker = DiceGameTracker()</pre><pre name="7927" id="7927" class="graf graf--pre graf-after--pre">let game = SnakesAndLadders()</pre><pre name="bb49" id="bb49" class="graf graf--pre graf-after--pre">game.delegate = tracker</pre><pre name="e334" id="e334" class="graf graf--pre graf-after--pre">game.play()</pre><pre name="2794" id="2794" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// Started a new game of Snakes and Ladders</em></pre><pre name="2659" id="2659" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// The game is using a 6-sided dice</em></pre><pre name="179d" id="179d" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// Rolled a 3</em></pre><pre name="bba5" id="bba5" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// Rolled a 5</em></pre><pre name="07eb" id="07eb" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// Rolled a 4</em></pre><pre name="7aa1" id="7aa1" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// Rolled a 5</em></pre><pre name="2e47" id="2e47" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// The game lasted for 4 turns</em></pre><blockquote name="e6be" id="e6be" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">Adding Protocol Conformance with an Extension</strong></blockquote><p name="ee9f" id="ee9f" class="graf graf--p graf-after--blockquote">利用 extension 讓型別遵從 protocol 和定義 protocol 的功能。</p><pre name="427c" id="427c" class="graf graf--pre graf-after--p">extension Dice: TextRepresentable {</pre><pre name="9e9a" id="9e9a" class="graf graf--pre graf-after--pre">   var textualDescription: String {</pre><pre name="6830" id="6830" class="graf graf--pre graf-after--pre">      return &quot;A \(sides)-sided dice&quot;</pre><pre name="282c" id="282c" class="graf graf--pre graf-after--pre">   }</pre><pre name="d694" id="d694" class="graf graf--pre graf-after--pre">}</pre><pre name="caee" id="caee" class="graf graf--pre graf-after--pre">let d12 = Dice(sides: 12, generator: LinearCongruentialGenerator())</pre><pre name="187d" id="187d" class="graf graf--pre graf-after--pre">print(d12.textualDescription)</pre><pre name="fdf2" id="fdf2" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// Prints &quot;A 12-sided dice&quot;</em></pre><pre name="8b94" id="8b94" class="graf graf--pre graf-after--pre"><br>extension SnakesAndLadders: TextRepresentable {</pre><pre name="da78" id="da78" class="graf graf--pre graf-after--pre">   var textualDescription: String {</pre><pre name="590d" id="590d" class="graf graf--pre graf-after--pre">      return &quot;A game of Snakes and Ladders with \(finalSquare) squares&quot;</pre><pre name="e1cc" id="e1cc" class="graf graf--pre graf-after--pre">   }</pre><pre name="9237" id="9237" class="graf graf--pre graf-after--pre">}</pre><pre name="07c8" id="07c8" class="graf graf--pre graf-after--pre">print(game.textualDescription)</pre><pre name="feaf" id="feaf" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// Prints &quot;A game of Snakes and Ladders with 25 squares&quot;</em></pre><blockquote name="d537" id="d537" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">Conditionally Conforming to a Protocol</strong></blockquote><p name="d35c" id="d35c" class="graf graf--p graf-after--blockquote">利用 where 判斷滿足某個條件時才遵從 protocol。</p><pre name="6472" id="6472" class="graf graf--pre graf-after--p">extension Array: TextRepresentable where Element: TextRepresentable {</pre><pre name="c90d" id="c90d" class="graf graf--pre graf-after--pre">   var textualDescription: String {</pre><pre name="764b" id="764b" class="graf graf--pre graf-after--pre">      let itemsAsText = self.map { $0.textualDescription }</pre><pre name="a323" id="a323" class="graf graf--pre graf-after--pre">      return &quot;[&quot; + itemsAsText.joined(separator: &quot;, &quot;) + &quot;]&quot;</pre><pre name="3b2f" id="3b2f" class="graf graf--pre graf-after--pre">   }</pre><pre name="9d4e" id="9d4e" class="graf graf--pre graf-after--pre">}</pre><pre name="f744" id="f744" class="graf graf--pre graf-after--pre">let myDice = [d6, d12]</pre><pre name="eb29" id="eb29" class="graf graf--pre graf-after--pre">print(myDice.textualDescription)</pre><pre name="41da" id="41da" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// Prints &quot;[A 6-sided dice, A 12-sided dice]&quot;</em></pre><blockquote name="2448" id="2448" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">Declaring Protocol Adoption with an Extension</strong></blockquote><p name="2750" id="2750" class="graf graf--p graf-after--blockquote">如果型別已經實作 protocol 的功能，可另外透過 extension 和空白的 { }，讓它遵從 protocol。</p><pre name="ccd9" id="ccd9" class="graf graf--pre graf-after--p">struct Hamster {</pre><pre name="9390" id="9390" class="graf graf--pre graf-after--pre">   var name: String</pre><pre name="4722" id="4722" class="graf graf--pre graf-after--pre">   var textualDescription: String {</pre><pre name="b539" id="b539" class="graf graf--pre graf-after--pre">      return &quot;A hamster named \(name)&quot;</pre><pre name="1d8a" id="1d8a" class="graf graf--pre graf-after--pre">   }</pre><pre name="ca67" id="ca67" class="graf graf--pre graf-after--pre">}</pre><pre name="3acb" id="3acb" class="graf graf--pre graf-after--pre">extension Hamster: TextRepresentable {}</pre><pre name="4740" id="4740" class="graf graf--pre graf-after--pre">let simonTheHamster = Hamster(name: &quot;Simon&quot;)</pre><pre name="4180" id="4180" class="graf graf--pre graf-after--pre">let somethingTextRepresentable: TextRepresentable = simonTheHamster</pre><pre name="862f" id="862f" class="graf graf--pre graf-after--pre">print(somethingTextRepresentable.textualDescription)</pre><pre name="5fa0" id="5fa0" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// Prints &quot;A hamster named Simon&quot;</em></pre><blockquote name="18a9" id="18a9" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">Collections of Protocol Types</strong></blockquote><pre name="e4e2" id="e4e2" class="graf graf--pre graf-after--blockquote">let things: [TextRepresentable] = [game, d12, simonTheHamster]</pre><pre name="d06c" id="d06c" class="graf graf--pre graf-after--pre">for thing in things {</pre><pre name="33ce" id="33ce" class="graf graf--pre graf-after--pre">   print(thing.textualDescription)</pre><pre name="e0dd" id="e0dd" class="graf graf--pre graf-after--pre">}</pre><pre name="d4d1" id="d4d1" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// A game of Snakes and Ladders with 25 squares</em></pre><pre name="ce3d" id="ce3d" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// A 12-sided dice</em></pre><pre name="f8cd" id="f8cd" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// A hamster named Simon</em></pre><blockquote name="d772" id="d772" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">Protocol Inheritance</strong></blockquote><pre name="6b81" id="6b81" class="graf graf--pre graf-after--blockquote">protocol PrettyTextRepresentable: TextRepresentable {</pre><pre name="4753" id="4753" class="graf graf--pre graf-after--pre">   var prettyTextualDescription: String { get }</pre><pre name="990a" id="990a" class="graf graf--pre graf-after--pre">}</pre><pre name="9041" id="9041" class="graf graf--pre graf-after--pre">extension SnakesAndLadders: PrettyTextRepresentable {</pre><pre name="8d37" id="8d37" class="graf graf--pre graf-after--pre">   var prettyTextualDescription: String {</pre><pre name="c07c" id="c07c" class="graf graf--pre graf-after--pre">      var output = textualDescription + &quot;:\n&quot;</pre><pre name="7d89" id="7d89" class="graf graf--pre graf-after--pre">      for index in 1...finalSquare {</pre><pre name="8a25" id="8a25" class="graf graf--pre graf-after--pre">         switch board[index] {</pre><pre name="cfd6" id="cfd6" class="graf graf--pre graf-after--pre">         case let ladder where ladder &gt; 0:</pre><pre name="185b" id="185b" class="graf graf--pre graf-after--pre">            output += &quot;▲ &quot;</pre><pre name="7bc0" id="7bc0" class="graf graf--pre graf-after--pre">         case let snake where snake &lt; 0:</pre><pre name="d90f" id="d90f" class="graf graf--pre graf-after--pre">            output += &quot;▼ &quot;</pre><pre name="71fb" id="71fb" class="graf graf--pre graf-after--pre">         default:</pre><pre name="d50b" id="d50b" class="graf graf--pre graf-after--pre">            output += &quot;○ &quot;</pre><pre name="ea65" id="ea65" class="graf graf--pre graf-after--pre">         }</pre><pre name="9b5a" id="9b5a" class="graf graf--pre graf-after--pre">      }</pre><pre name="2be4" id="2be4" class="graf graf--pre graf-after--pre">      return output</pre><pre name="8569" id="8569" class="graf graf--pre graf-after--pre">   }</pre><pre name="deb2" id="deb2" class="graf graf--pre graf-after--pre">}</pre><pre name="8fe1" id="8fe1" class="graf graf--pre graf-after--pre">print(game.prettyTextualDescription)</pre><pre name="6735" id="6735" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// A game of Snakes and Ladders with 25 squares:</em></pre><pre name="32dc" id="32dc" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// ○ ○ ▲ ○ ○ ▲ ○ ○ ▲ ▲ ○ ○ ○ ▼ ○ ○ ○ ○ ▼ ○ ○ ▼ ○ ▼ ○</em></pre><blockquote name="8ea3" id="8ea3" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">Class-Only Protocols</strong></blockquote><p name="00c4" id="00c4" class="graf graf--p graf-after--blockquote">當 protocol 遵從 AnyObject，表示之後只有 class 能遵從此 protocol。</p><pre name="c4de" id="c4de" class="graf graf--pre graf-after--p">protocol SomeClassOnlyProtocol: AnyObject, SomeInheritedProtocol {</pre><pre name="3f7f" id="3f7f" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">   // class-only protocol definition goes here</em></pre><pre name="07e4" id="07e4" class="graf graf--pre graf-after--pre">}</pre><blockquote name="0592" id="0592" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">Protocol Composition</strong></blockquote><p name="edc4" id="edc4" class="graf graf--p graf-after--blockquote">利用 &amp; 結合多個 protocol，宣告需滿足多個 protocol 的型別。</p><pre name="7160" id="7160" class="graf graf--pre graf-after--p">protocol Named {</pre><pre name="649c" id="649c" class="graf graf--pre graf-after--pre">   var name: String { get }</pre><pre name="b488" id="b488" class="graf graf--pre graf-after--pre">}</pre><pre name="e165" id="e165" class="graf graf--pre graf-after--pre">protocol Aged {</pre><pre name="e425" id="e425" class="graf graf--pre graf-after--pre">   var age: Int { get }</pre><pre name="ed00" id="ed00" class="graf graf--pre graf-after--pre">}</pre><pre name="ead7" id="ead7" class="graf graf--pre graf-after--pre">struct Person: Named, Aged {</pre><pre name="f840" id="f840" class="graf graf--pre graf-after--pre">   var name: String</pre><pre name="67f5" id="67f5" class="graf graf--pre graf-after--pre">   var age: Int</pre><pre name="67b1" id="67b1" class="graf graf--pre graf-after--pre">}</pre><pre name="7b50" id="7b50" class="graf graf--pre graf-after--pre">func wishHappyBirthday(to celebrator: Named &amp; Aged) {</pre><pre name="2698" id="2698" class="graf graf--pre graf-after--pre">   print(&quot;Happy birthday, \(celebrator.name), you&#39;re \(celebrator.age)!&quot;)</pre><pre name="64a1" id="64a1" class="graf graf--pre graf-after--pre">}</pre><pre name="4112" id="4112" class="graf graf--pre graf-after--pre">let birthdayPerson = Person(name: &quot;Malcolm&quot;, age: 21)</pre><pre name="8a10" id="8a10" class="graf graf--pre graf-after--pre">wishHappyBirthday(to: birthdayPerson)</pre><pre name="4fa7" id="4fa7" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// Prints &quot;Happy birthday, Malcolm, you&#39;re 21!&quot;</em></pre><p name="4ee8" id="4ee8" class="graf graf--p graf-after--pre">除了可利用 &amp; 結合多個 protocol，也可結合類別，指定型別要繼承的父類別。</p><pre name="ed81" id="ed81" class="graf graf--pre graf-after--p">class Location {</pre><pre name="bddd" id="bddd" class="graf graf--pre graf-after--pre">   var latitude: Double</pre><pre name="8372" id="8372" class="graf graf--pre graf-after--pre">   var longitude: Double</pre><pre name="de2f" id="de2f" class="graf graf--pre graf-after--pre">   init(latitude: Double, longitude: Double) {</pre><pre name="a9b4" id="a9b4" class="graf graf--pre graf-after--pre">      self.latitude = latitude</pre><pre name="edad" id="edad" class="graf graf--pre graf-after--pre">      self.longitude = longitude</pre><pre name="9c17" id="9c17" class="graf graf--pre graf-after--pre">   }</pre><pre name="aae9" id="aae9" class="graf graf--pre graf-after--pre">}</pre><pre name="fa99" id="fa99" class="graf graf--pre graf-after--pre">class City: Location, Named {</pre><pre name="09c9" id="09c9" class="graf graf--pre graf-after--pre">   var name: String</pre><pre name="da29" id="da29" class="graf graf--pre graf-after--pre">   init(name: String, latitude: Double, longitude: Double) {</pre><pre name="b4cf" id="b4cf" class="graf graf--pre graf-after--pre">      self.name = name</pre><pre name="5d6c" id="5d6c" class="graf graf--pre graf-after--pre">      super.init(latitude: latitude, longitude: longitude)</pre><pre name="75b4" id="75b4" class="graf graf--pre graf-after--pre">   }</pre><pre name="a47b" id="a47b" class="graf graf--pre graf-after--pre">}</pre><pre name="9825" id="9825" class="graf graf--pre graf-after--pre">func beginConcert(in location: Location &amp; Named) {</pre><pre name="78e4" id="78e4" class="graf graf--pre graf-after--pre">   print(&quot;Hello, \(location.name)!&quot;)</pre><pre name="4bf8" id="4bf8" class="graf graf--pre graf-after--pre">}</pre><pre name="97a7" id="97a7" class="graf graf--pre graf-after--pre">let seattle = City(name: &quot;Seattle&quot;, latitude: 47.6, longitude: -122.3)</pre><pre name="00ef" id="00ef" class="graf graf--pre graf-after--pre">beginConcert(in: seattle)</pre><pre name="ab4b" id="ab4b" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// Prints &quot;Hello, Seattle!&quot;</em></pre><blockquote name="eb71" id="eb71" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">Checking for Protocol Conformance</strong></blockquote><pre name="21f9" id="21f9" class="graf graf--pre graf-after--blockquote">protocol HasArea {</pre><pre name="669a" id="669a" class="graf graf--pre graf-after--pre">   var area: Double { get }</pre><pre name="be16" id="be16" class="graf graf--pre graf-after--pre">}</pre><pre name="c2d1" id="c2d1" class="graf graf--pre graf-after--pre">class Circle: HasArea {</pre><pre name="5a7b" id="5a7b" class="graf graf--pre graf-after--pre">   let pi = 3.1415927</pre><pre name="bfe4" id="bfe4" class="graf graf--pre graf-after--pre">   var radius: Double</pre><pre name="2b88" id="2b88" class="graf graf--pre graf-after--pre">   var area: Double { return pi * radius * radius }</pre><pre name="ef80" id="ef80" class="graf graf--pre graf-after--pre">   init(radius: Double) { self.radius = radius }</pre><pre name="889f" id="889f" class="graf graf--pre graf-after--pre">}</pre><pre name="8fed" id="8fed" class="graf graf--pre graf-after--pre">class Country: HasArea {</pre><pre name="1f68" id="1f68" class="graf graf--pre graf-after--pre">   var area: Double</pre><pre name="7e0d" id="7e0d" class="graf graf--pre graf-after--pre">   init(area: Double) { self.area = area }</pre><pre name="6b6c" id="6b6c" class="graf graf--pre graf-after--pre">}</pre><pre name="5a8f" id="5a8f" class="graf graf--pre graf-after--pre">class Animal {</pre><pre name="00a2" id="00a2" class="graf graf--pre graf-after--pre">   var legs: Int</pre><pre name="82ee" id="82ee" class="graf graf--pre graf-after--pre">   init(legs: Int) { self.legs = legs }</pre><pre name="ee67" id="ee67" class="graf graf--pre graf-after--pre">}</pre><pre name="e923" id="e923" class="graf graf--pre graf-after--pre">let objects: [AnyObject] = [</pre><pre name="066f" id="066f" class="graf graf--pre graf-after--pre">   Circle(radius: 2.0),</pre><pre name="6676" id="6676" class="graf graf--pre graf-after--pre">   Country(area: 243_610),</pre><pre name="d00b" id="d00b" class="graf graf--pre graf-after--pre">   Animal(legs: 4)</pre><pre name="9188" id="9188" class="graf graf--pre graf-after--pre">]</pre><pre name="af79" id="af79" class="graf graf--pre graf-after--pre">for object in objects {</pre><pre name="7341" id="7341" class="graf graf--pre graf-after--pre">   if let objectWithArea = object as? HasArea {</pre><pre name="fa6d" id="fa6d" class="graf graf--pre graf-after--pre">      print(&quot;Area is \(objectWithArea.area)&quot;)</pre><pre name="48f2" id="48f2" class="graf graf--pre graf-after--pre">   } else {</pre><pre name="1c61" id="1c61" class="graf graf--pre graf-after--pre">      print(&quot;Something that doesn&#39;t have an area&quot;)</pre><pre name="7c38" id="7c38" class="graf graf--pre graf-after--pre">   }</pre><pre name="cbee" id="cbee" class="graf graf--pre graf-after--pre">}</pre><pre name="92eb" id="92eb" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// Area is 12.5663708</em></pre><pre name="ccfc" id="ccfc" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// Area is 243610.0</em></pre><pre name="b497" id="b497" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// Something that doesn&#39;t have an area</em></pre><blockquote name="a97f" id="a97f" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">Optional Protocol Requirements</strong></blockquote><p name="8191" id="8191" class="graf graf--p graf-after--blockquote">用 optional 宣告不一定要實作的 protocol 功能。在 protocol &amp; 宣告的 optional 功能前都要加上 @objc，到時候只有類別能夠遵從加了 @objc 的 protocol。</p><pre name="c3cb" id="c3cb" class="graf graf--pre graf-after--p">import Foundation</pre><pre name="81e7" id="81e7" class="graf graf--pre graf-after--pre">@objc protocol CounterDataSource {</pre><pre name="939b" id="939b" class="graf graf--pre graf-after--pre">   @objc optional func increment(forCount count: Int) -&gt; Int</pre><pre name="21fe" id="21fe" class="graf graf--pre graf-after--pre">   @objc optional var fixedIncrement: Int { get }</pre><pre name="eb3c" id="eb3c" class="graf graf--pre graf-after--pre">}</pre><pre name="0e93" id="0e93" class="graf graf--pre graf-after--pre">class Counter {</pre><pre name="e732" id="e732" class="graf graf--pre graf-after--pre">   var count = 0</pre><pre name="3da8" id="3da8" class="graf graf--pre graf-after--pre">   var dataSource: CounterDataSource?</pre><pre name="1041" id="1041" class="graf graf--pre graf-after--pre">   func increment() {</pre><pre name="dc5a" id="dc5a" class="graf graf--pre graf-after--pre">      dataSource?.increment?(forCount: 3)</pre><pre name="3a23" id="3a23" class="graf graf--pre graf-after--pre">      if let amount = dataSource?.increment?(forCount: count) {</pre><pre name="9167" id="9167" class="graf graf--pre graf-after--pre">         count += amount</pre><pre name="6d27" id="6d27" class="graf graf--pre graf-after--pre">      } else if let amount = dataSource?.fixedIncrement {</pre><pre name="d60f" id="d60f" class="graf graf--pre graf-after--pre">         count += amount</pre><pre name="5c2c" id="5c2c" class="graf graf--pre graf-after--pre">      }</pre><pre name="e30e" id="e30e" class="graf graf--pre graf-after--pre">   }</pre><pre name="899b" id="899b" class="graf graf--pre graf-after--pre">}</pre><pre name="b58e" id="b58e" class="graf graf--pre graf-after--pre">class ThreeSource: NSObject, CounterDataSource {</pre><pre name="073d" id="073d" class="graf graf--pre graf-after--pre">   let fixedIncrement = 3</pre><pre name="208a" id="208a" class="graf graf--pre graf-after--pre">}</pre><pre name="234a" id="234a" class="graf graf--pre graf-after--pre">var counter = Counter()</pre><pre name="9232" id="9232" class="graf graf--pre graf-after--pre">counter.dataSource = ThreeSource()</pre><pre name="912e" id="912e" class="graf graf--pre graf-after--pre">for _ in 1...4 {</pre><pre name="59cf" id="59cf" class="graf graf--pre graf-after--pre">   counter.increment()</pre><pre name="a55c" id="a55c" class="graf graf--pre graf-after--pre">   print(counter.count)</pre><pre name="ad72" id="ad72" class="graf graf--pre graf-after--pre">}</pre><pre name="ca3a" id="ca3a" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// 3</em></pre><pre name="d47d" id="d47d" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// 6</em></pre><pre name="5235" id="5235" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// 9</em></pre><pre name="5165" id="5165" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// 12</em></pre><p name="4eeb" id="4eeb" class="graf graf--p graf-after--pre">定義讓數字愈來愈接近 0 的 dataSource。</p><pre name="8e73" id="8e73" class="graf graf--pre graf-after--p">class TowardsZeroSource: NSObject, CounterDataSource {</pre><pre name="2acb" id="2acb" class="graf graf--pre graf-after--pre">   func increment(forCount count: Int) -&gt; Int {</pre><pre name="96f2" id="96f2" class="graf graf--pre graf-after--pre">      if count == 0 {</pre><pre name="eba5" id="eba5" class="graf graf--pre graf-after--pre">         return 0</pre><pre name="2b49" id="2b49" class="graf graf--pre graf-after--pre">      } else if count &lt; 0 {</pre><pre name="0f55" id="0f55" class="graf graf--pre graf-after--pre">         return 1</pre><pre name="adaf" id="adaf" class="graf graf--pre graf-after--pre">      } else {</pre><pre name="34d2" id="34d2" class="graf graf--pre graf-after--pre">         return -1</pre><pre name="fbbe" id="fbbe" class="graf graf--pre graf-after--pre">      }</pre><pre name="1e31" id="1e31" class="graf graf--pre graf-after--pre">   }</pre><pre name="c2e1" id="c2e1" class="graf graf--pre graf-after--pre">}</pre><pre name="7a7b" id="7a7b" class="graf graf--pre graf-after--pre">counter.count = -4</pre><pre name="444a" id="444a" class="graf graf--pre graf-after--pre">counter.dataSource = TowardsZeroSource()</pre><pre name="8ce2" id="8ce2" class="graf graf--pre graf-after--pre">for _ in 1...5 {</pre><pre name="110a" id="110a" class="graf graf--pre graf-after--pre">   counter.increment()</pre><pre name="6b1b" id="6b1b" class="graf graf--pre graf-after--pre">   print(counter.count)</pre><pre name="6a02" id="6a02" class="graf graf--pre graf-after--pre">}</pre><pre name="05a5" id="05a5" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// -3</em></pre><pre name="55ca" id="55ca" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// -2</em></pre><pre name="bfbd" id="bfbd" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// -1</em></pre><pre name="0201" id="0201" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// 0</em></pre><pre name="74a7" id="74a7" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// 0</em></pre><blockquote name="ea9f" id="ea9f" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">Protocol Extensions</strong></blockquote><p name="ad87" id="ad87" class="graf graf--p graf-after--blockquote">利用 extension 擴充定義 protocol 的功能。</p><pre name="0f3e" id="0f3e" class="graf graf--pre graf-after--p">protocol RandomNumberGenerator {</pre><pre name="5387" id="5387" class="graf graf--pre graf-after--pre">   func random() -&gt; Double</pre><pre name="7d5f" id="7d5f" class="graf graf--pre graf-after--pre">}</pre><pre name="7fb9" id="7fb9" class="graf graf--pre graf-after--pre">extension RandomNumberGenerator {</pre><pre name="e083" id="e083" class="graf graf--pre graf-after--pre">   func randomBool() -&gt; Bool {</pre><pre name="304c" id="304c" class="graf graf--pre graf-after--pre">      return random() &gt; 0.5</pre><pre name="5608" id="5608" class="graf graf--pre graf-after--pre">   }</pre><pre name="8c36" id="8c36" class="graf graf--pre graf-after--pre">}</pre><pre name="551d" id="551d" class="graf graf--pre graf-after--pre">let generator = LinearCongruentialGenerator()</pre><pre name="2874" id="2874" class="graf graf--pre graf-after--pre">print(&quot;Here&#39;s a random number: \(generator.random())&quot;)</pre><pre name="3daa" id="3daa" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// Prints &quot;Here&#39;s a random number: 0.3746499199817101&quot;</em></pre><pre name="1bd8" id="1bd8" class="graf graf--pre graf-after--pre">print(&quot;And here&#39;s a random Boolean: \(generator.randomBool())&quot;)</pre><pre name="6edb" id="6edb" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// Prints &quot;And here&#39;s a random Boolean: true&quot;</em></pre><blockquote name="63af" id="63af" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">Providing Default Implementations</strong></blockquote><p name="376c" id="376c" class="graf graf--p graf-after--blockquote">利用 extension 定義 protocol 宣告的功能。</p><pre name="f0a9" id="f0a9" class="graf graf--pre graf-after--p">extension PrettyTextRepresentable  {</pre><pre name="d27d" id="d27d" class="graf graf--pre graf-after--pre">   var prettyTextualDescription: String {</pre><pre name="811c" id="811c" class="graf graf--pre graf-after--pre">      return textualDescription</pre><pre name="f0ef" id="f0ef" class="graf graf--pre graf-after--pre">   }</pre><pre name="6363" id="6363" class="graf graf--pre graf-after--pre">}</pre><blockquote name="581b" id="581b" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">Adding Constraints to Protocol Extensions</strong></blockquote><p name="463b" id="463b" class="graf graf--p graf-after--blockquote">例子:</p><p name="0938" id="0938" class="graf graf--p graf-after--p">只有 Element 遵從 Equatable 時，才會擴充加上 function allEqual()。</p><pre name="31e2" id="31e2" class="graf graf--pre graf-after--p">extension Collection where Element: Equatable {</pre><pre name="d669" id="d669" class="graf graf--pre graf-after--pre">   func allEqual() -&gt; Bool {</pre><pre name="1465" id="1465" class="graf graf--pre graf-after--pre">      for element in self {</pre><pre name="bd00" id="bd00" class="graf graf--pre graf-after--pre">         if element != self.first {</pre><pre name="5394" id="5394" class="graf graf--pre graf-after--pre">            return false</pre><pre name="84ce" id="84ce" class="graf graf--pre graf-after--pre">         }</pre><pre name="35c2" id="35c2" class="graf graf--pre graf-after--pre">      }</pre><pre name="0a18" id="0a18" class="graf graf--pre graf-after--pre">      return true</pre><pre name="8f89" id="8f89" class="graf graf--pre graf-after--pre">   }</pre><pre name="c919" id="c919" class="graf graf--pre graf-after--pre">}</pre><pre name="b40a" id="b40a" class="graf graf--pre graf-after--pre">let equalNumbers = [100, 100, 100, 100, 100]</pre><pre name="883b" id="883b" class="graf graf--pre graf-after--pre">let differentNumbers = [100, 100, 200, 100, 200]</pre><pre name="5131" id="5131" class="graf graf--pre graf-after--pre">print(equalNumbers.allEqual())</pre><pre name="ebe1" id="ebe1" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// Prints &quot;true&quot;</em></pre><pre name="0ca6" id="0ca6" class="graf graf--pre graf-after--pre">print(differentNumbers.allEqual())</pre><pre name="6c93" id="6c93" class="graf graf--pre graf-after--pre graf--trailing"><em class="markup--em markup--pre-em">// Prints &quot;false&quot;</em></pre></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@apppeterpan" class="p-author h-card">彼得潘的 iOS App Neverland</a> on <a href="https://medium.com/p/16fc0742345"><time class="dt-published" datetime="2018-09-24T06:20:47.691Z">September 24, 2018</time></a>.</p><p><a href="https://medium.com/@apppeterpan/protocols-%E7%A8%8B%E5%BC%8F%E7%AF%84%E4%BE%8B-apples-the-swift-programming-language-16fc0742345" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on November 16, 2025.</p></footer></article></body></html>