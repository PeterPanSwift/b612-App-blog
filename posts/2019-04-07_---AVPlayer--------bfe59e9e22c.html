<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>利用 AVPlayer 播放音樂音效</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">利用 AVPlayer 播放音樂音效</h1>
</header>
<section data-field="subtitle" class="p-summary">
1 查詢音樂的網址。
</section>
<section data-field="body" class="e-content">
<section name="fc03" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="cd4f" id="cd4f" class="graf graf--h3 graf--leading graf--title">利用 <strong class="markup--strong markup--h3-strong">AVPlayer 播放音樂音效</strong></h3><p name="40ea" id="40ea" class="graf graf--p graf-after--h3">彼得潘的生活不能沒有音樂，尤其是在寫 code 的時候。因此接下來就讓我們認識既能播放 App 裡的歌曲，也能播放網路上歌曲的音樂播放器， AVPlayer ! (ps: 其實不只音樂，它也能播放影片。)</p><h3 name="71b4" id="71b4" class="graf graf--h3 graf-after--p">將音樂檔加到 Xcode 專案</h3><div name="d8b2" id="d8b2" class="graf graf--mixtapeEmbed graf-after--h3"><a href="https://apppeterpan.medium.com/%E5%B0%87%E9%9F%B3%E6%A8%82-%E5%BD%B1%E7%89%87-%E6%96%87%E5%AD%97%E6%AA%94%E7%AD%89%E7%B4%A0%E6%9D%90%E5%8A%A0%E5%88%B0-project-navigator-c5fdb34d5d06" data-href="https://apppeterpan.medium.com/%E5%B0%87%E9%9F%B3%E6%A8%82-%E5%BD%B1%E7%89%87-%E6%96%87%E5%AD%97%E6%AA%94%E7%AD%89%E7%B4%A0%E6%9D%90%E5%8A%A0%E5%88%B0-project-navigator-c5fdb34d5d06" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://apppeterpan.medium.com/%E5%B0%87%E9%9F%B3%E6%A8%82-%E5%BD%B1%E7%89%87-%E6%96%87%E5%AD%97%E6%AA%94%E7%AD%89%E7%B4%A0%E6%9D%90%E5%8A%A0%E5%88%B0-project-navigator-c5fdb34d5d06"><strong class="markup--strong markup--mixtapeEmbed-strong">將音樂，影片，文字檔等素材加到 project navigator，然後透過 URL 讀取內容</strong><br><em class="markup--em markup--mixtapeEmbed-em">開發 iOS App 時，我們時常需要將音樂，影片，文字檔等素材加到專案，然後再透過檔案的 URL 讀取內容。接下來讓我們以加入 Hebe 小幸運的 mp3 為例說明。</em>apppeterpan.medium.com</a><a href="https://apppeterpan.medium.com/%E5%B0%87%E9%9F%B3%E6%A8%82-%E5%BD%B1%E7%89%87-%E6%96%87%E5%AD%97%E6%AA%94%E7%AD%89%E7%B4%A0%E6%9D%90%E5%8A%A0%E5%88%B0-project-navigator-c5fdb34d5d06" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="e4863a8c6c655f2e611604ec746b44c6" data-thumbnail-img-id="1*B_bma-uDRtUMRMTuiporlA.png" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*B_bma-uDRtUMRMTuiporlA.png);"></a></div><h3 name="59a6" id="59a6" class="graf graf--h3 graf-after--mixtapeEmbed">利用 <strong class="markup--strong markup--h3-strong">AVPlayer 播放 App 裡的音樂</strong></h3><p name="0326" id="0326" class="graf graf--p graf-after--h3">以下範例分別示範在 SwiftUI &amp; UIKit App 畫面出現時播放音樂。</p><p name="72f1" id="72f1" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">SwiftUI 版本</strong></p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="245a" id="245a" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> SwiftUI<br /><span class="hljs-keyword">import</span> AVFoundation<br /><br /><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ContentView</span>: <span class="hljs-title class_">View</span> {<br />    <br />    <span class="hljs-keyword">let</span> player <span class="hljs-operator">=</span> <span class="hljs-type">AVPlayer</span>()<br />    <br />    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {<br />        <span class="hljs-type">Text</span>(<span class="hljs-string">&quot;原來你是我最想留住的幸運&quot;</span>)<br />            .onAppear {<br />                <span class="hljs-keyword">let</span> url <span class="hljs-operator">=</span> <span class="hljs-type">Bundle</span>.main.url(forResource: <span class="hljs-string">&quot;黑色毛衣&quot;</span>, withExtension: <span class="hljs-string">&quot;mp3&quot;</span>)<span class="hljs-operator">!</span><br />                <span class="hljs-keyword">let</span> playerItem <span class="hljs-operator">=</span> <span class="hljs-type">AVPlayerItem</span>(url: url)<br />                player.replaceCurrentItem(with: playerItem)<br />                player.play()<br />        }<br />    }<br />}</span></pre><p name="b49b" id="b49b" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">UIKit 版本</strong></p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="4127" id="4127" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> UIKit<br /><span class="hljs-keyword">import</span> AVFoundation<br /><br /><span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewController</span>: <span class="hljs-title class_">UIViewController</span> {<br />    <br />    <span class="hljs-keyword">let</span> player <span class="hljs-operator">=</span> <span class="hljs-type">AVPlayer</span>()<br />    <br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {<br />        <span class="hljs-keyword">super</span>.viewDidLoad()<br />        <br />        <span class="hljs-keyword">let</span> url <span class="hljs-operator">=</span> <span class="hljs-type">Bundle</span>.main.url(forResource: <span class="hljs-string">&quot;黑色毛衣&quot;</span>, withExtension: <span class="hljs-string">&quot;mp3&quot;</span>)<span class="hljs-operator">!</span><br />        <span class="hljs-keyword">let</span> playerItem <span class="hljs-operator">=</span> <span class="hljs-type">AVPlayerItem</span>(url: url)<br />        player.replaceCurrentItem(with: playerItem)<br />        player.play()<br />    }<br />}</span></pre><p name="5cc4" id="5cc4" class="graf graf--p graf-after--pre">說明:</p><ul class="postList"><li name="a391" id="a391" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">加入 AVFoundation 函式庫(framework)</strong></li></ul><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="ece2" id="ece2" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> AVFoundation</span></pre><p name="1fe1" id="1fe1" class="graf graf--p graf-after--pre">為了使用 AVPlayer 播放音樂，必須先加入 AVFoundation。</p><ul class="postList"><li name="a858" id="a858" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">宣告 AVPlayer 型別的 property player。</strong></li></ul><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="a266" id="a266" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> player <span class="hljs-operator">=</span> <span class="hljs-type">AVPlayer</span>()</span></pre><p name="52df" id="52df" class="graf graf--p graf-after--pre">生成播放音樂的 AVPlayer 物件。</p><ul class="postList"><li name="ff2d" id="ff2d" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">設定 player 播放的音樂並開始播放。</strong></li></ul><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="350e" id="350e" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> url <span class="hljs-operator">=</span> <span class="hljs-type">Bundle</span>.main.url(forResource: <span class="hljs-string">&quot;黑色毛衣&quot;</span>, withExtension: <span class="hljs-string">&quot;mp3&quot;</span>)<span class="hljs-operator">!</span><br /><span class="hljs-keyword">let</span> playerItem <span class="hljs-operator">=</span> <span class="hljs-type">AVPlayerItem</span>(url: url)<br />player.replaceCurrentItem(with: playerItem)<br />player.play()</span></pre><p name="1378" id="1378" class="graf graf--p graf-after--pre">(1) 產生音樂在 App 裡路徑的 URL。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="f6e4" id="f6e4" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> url <span class="hljs-operator">=</span> <span class="hljs-type">Bundle</span>.main.url(forResource: <span class="hljs-string">&quot;music&quot;</span>, withExtension: <span class="hljs-string">&quot;mp3&quot;</span>)<span class="hljs-operator">!</span></span></pre><p name="c9f1" id="c9f1" class="graf graf--p graf-after--pre">利用 Bundle.man 取得 App 主要的 Bundle，也就是 App 本身的資料夾。放在 Project navigator 下的 music.mp4 將在 App 的資料夾下，透過呼叫 function url(forResource:withExtension:) 可取得它在資料夾裡的 URL，參數 forResource 傳入檔名，參數 withExtension 傳入附檔名。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="89fc" id="89fc" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">url</span>(<span class="hljs-params">forResource</span> <span class="hljs-params">name</span>: <span class="hljs-type">String</span>?, <span class="hljs-params">withExtension</span> <span class="hljs-params">ext</span>: <span class="hljs-type">String</span>?) -&gt; <span class="hljs-type">URL</span>?</span></pre><div name="7fac" id="7fac" class="graf graf--mixtapeEmbed graf-after--pre"><a href="https://developer.apple.com/documentation/foundation/bundle/1411540-url" data-href="https://developer.apple.com/documentation/foundation/bundle/1411540-url" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/foundation/bundle/1411540-url"><strong class="markup--strong markup--mixtapeEmbed-strong">url(forResource:withExtension:) | Apple Developer Documentation</strong><br><em class="markup--em markup--mixtapeEmbed-em">Returns the file URL for the resource identified by the specified name and file extension.</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/foundation/bundle/1411540-url" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="811ca203d4e3a5eea8d19292e2ee7a0b" data-thumbnail-img-id="0*wlaKN1VQ90QZj1u4" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*wlaKN1VQ90QZj1u4);"></a></div><p name="3b85" id="3b85" class="graf graf--p graf-after--mixtapeEmbed">值得注意的，function url 回傳的 URL 將是 optional ，因此我們加上 ! 取值。假設我們不會手殘，檔名不會打錯，因此我們可以放心加上 !。</p><p name="80b8" id="80b8" class="graf graf--p graf-after--p">(2) 利用 AVPlayerItem 生成要播放的音樂。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="5b84" id="5b84" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> playerItem <span class="hljs-operator">=</span> <span class="hljs-type">AVPlayerItem</span>(url: fileUrl)</span></pre><p name="631f" id="631f" class="graf graf--p graf-after--pre">(3) 設定 player 要播放的 AVPlayerItem。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="abfd" id="abfd" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">player.replaceCurrentItem(with: playerItem)</span></pre><p name="70aa" id="70aa" class="graf graf--p graf-after--pre">(4) 開始播放音樂。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="a6a1" id="a6a1" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">player.play()</span></pre><p name="0cf7" id="0cf7" class="graf graf--p graf-after--pre">現在 App 啟動後，將可立即聽到美妙的音樂。</p><p name="ed9c" id="ed9c" class="graf graf--p graf-after--p">也許有人有疑問，為何不在 SwiftUI 範例的 onAppear 或 UIKit 範例的 viewDidLoad 裡產生 AVPlayer 物件，而是另外宣告 property 儲存呢 ? 比方以下我們在 function onAppear 裡宣告常數 player。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="091f" id="091f" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ContentView</span>: <span class="hljs-title class_">View</span> {<br />    <br />    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {<br />        <span class="hljs-type">Text</span>(<span class="hljs-string">&quot;Hello, World!&quot;</span>)<br />            .onAppear {<br />                <span class="hljs-keyword">let</span> player <span class="hljs-operator">=</span> <span class="hljs-type">AVPlayer</span>()<br />                <span class="hljs-keyword">let</span> url <span class="hljs-operator">=</span> <span class="hljs-type">Bundle</span>.main.url(forResource: <span class="hljs-string">&quot;黑色毛衣&quot;</span>, withExtension: <span class="hljs-string">&quot;mp3&quot;</span>)<span class="hljs-operator">!</span><br />                <span class="hljs-keyword">let</span> playerItem <span class="hljs-operator">=</span> <span class="hljs-type">AVPlayerItem</span>(url: url)<br />                player.replaceCurrentItem(with: playerItem)<br />                player.play()<br />        }<br />    }<br />}</span></pre><p name="5bdf" id="5bdf" class="graf graf--p graf-after--pre">剛剛的程式還是可以執行，但我們完全聽不到音樂，因為常數 player 是在 onAppear 的 { } 裡生成，所以 onAppear 執行完後，player 就會被殘忍地結束生命，它連一秒鐘的音樂都來不及唱出。</p><h3 name="3377" id="3377" class="graf graf--h3 graf-after--p">利用 AVPlayer 播放網路上的音樂</h3><p name="dc2a" id="dc2a" class="graf graf--p graf-after--h3">我們也可以用 AVPlayer 播放網路上的音樂，只要在生成 AVPlayerItem 時傳入網路上音樂的 URL，比方以下例子:</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="9f6d" id="9f6d" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> url <span class="hljs-operator">=</span> <span class="hljs-type">URL</span>(string: <span class="hljs-string">&quot;https://audio-ssl.itunes.apple.com/apple-assets-us-std-000001/AudioPreview118/v4/69/0e/98/690e98db-440d-cb0c-2bff-91b00a05bdda/mzaf_1674062311671795807.plus.aac.p.m4a&quot;</span>)<span class="hljs-operator">!</span><br /><span class="hljs-keyword">let</span> playerItem <span class="hljs-operator">=</span> <span class="hljs-type">AVPlayerItem</span>(url: url)</span></pre><h3 name="f181" id="f181" class="graf graf--h3 graf-after--pre">暫停音樂</h3><p name="274c" id="274c" class="graf graf--p graf-after--h3">呼叫 function pause。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="df0c" id="df0c" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">player.pause()</span></pre><h3 name="fa28" id="fa28" class="graf graf--h3 graf-after--pre">調整音量</h3><p name="4ba4" id="4ba4" class="graf graf--p graf-after--h3">volum 的大小是 0 ~ 1。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="81d9" id="81d9" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">player.volume <span class="hljs-operator">=</span> <span class="hljs-number">0.8</span></span></pre><p name="60c7" id="60c7" class="graf graf--p graf-after--pre">volume 控制的音量是相對於系統的音量，如下圖所示，倘若此時系統的音量是一半的音量，那麼就算 volume 等於 1 也會只有一半的音量。</p><figure name="19d9" id="19d9" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*GKDMMHJh2UHm-WgccdD58Q.jpeg" data-width="592" data-height="584" src="https://cdn-images-1.medium.com/max/800/1*GKDMMHJh2UHm-WgccdD58Q.jpeg"></figure><p name="bccc" id="bccc" class="graf graf--p graf-after--figure">如果想要調整系統的音量，可直接在畫面上加入 MPVolumeView。加入前記得先 import MediaPlayer，然後請在實機測試，因為它無法在模擬器測試。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="f357" id="f357" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> volumeView <span class="hljs-operator">=</span> <span class="hljs-type">MPVolumeView</span>(frame: <span class="hljs-type">CGRect</span>(x: <span class="hljs-number">10</span>, y: <span class="hljs-number">100</span>, width: <span class="hljs-number">300</span>, height: <span class="hljs-number">40</span>))<br />view.addSubview(volumeView)</span></pre><figure name="674d" id="674d" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*PLQMTEqHiSnk6pLbkjcn3A.jpeg" data-width="508" data-height="88" src="https://cdn-images-1.medium.com/max/800/1*PLQMTEqHiSnk6pLbkjcn3A.jpeg"></figure><h3 name="d37c" id="d37c" class="graf graf--h3 graf-after--figure">播放下一首 / 上一首歌</h3><p name="ec9c" id="ec9c" class="graf graf--p graf-after--h3">AVPlayer 播放的音樂由 AVPlayerItem 控制，因此我們只要呼叫 function replaceCurrentItem(with:)，傳入下一首，上一首歌的 URL，即可改變播放的音樂。</p><p name="167e" id="167e" class="graf graf--p graf-after--p">比方下一首歌是周興哲的你好不好，播放的程式如下:</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="3a74" id="3a74" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> url <span class="hljs-operator">=</span> <span class="hljs-type">Bundle</span>.main.url(forResource: <span class="hljs-string">&quot;你好不好&quot;</span>, withExtension: <span class="hljs-string">&quot;mp4&quot;</span>)<span class="hljs-operator">!</span><br /><span class="hljs-keyword">let</span> playerItem <span class="hljs-operator">=</span> <span class="hljs-type">AVPlayerItem</span>(url: url)<br />player.replaceCurrentItem(with: playerItem)</span></pre><h3 name="0b5c" id="0b5c" class="graf graf--h3 graf-after--pre">判斷目前是否正在播放歌曲</h3><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="7be3" id="7be3" class="graf graf--pre graf-after--h3 graf--preV2"><span class="pre--content"><span class="hljs-keyword">if</span> player.timeControlStatus <span class="hljs-operator">==</span> .playing {<br />                <br />}</span></pre><h3 name="6ac4" id="6ac4" class="graf graf--h3 graf-after--pre">取得歌曲目前播放到第幾秒</h3><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="4479" id="4479" class="graf graf--pre graf-after--h3 graf--preV2"><span class="pre--content">player.currentTime().seconds</span></pre><h3 name="d47a" id="d47a" class="graf graf--h3 graf-after--pre">取得目前播放歌曲的長度</h3><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="8052" id="8052" class="graf graf--pre graf-after--h3 graf--preV2"><span class="pre--content">player.currentItem<span class="hljs-operator">?</span>.duration</span></pre><h3 name="d152" id="d152" class="graf graf--h3 graf-after--pre">調整歌曲播放的區段(SEEK)</h3><p name="8019" id="8019" class="graf graf--p graf-after--h3">利用 seek 控制歌曲播放的區段。</p><p name="ddce" id="ddce" class="graf graf--p graf-after--p">從頭播放。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="2228" id="2228" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">player.seek(to: .zero)</span></pre><p name="6783" id="6783" class="graf graf--p graf-after--pre">從第 30 秒開始播放。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="7dff" id="7dff" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> time <span class="hljs-operator">=</span> <span class="hljs-type">CMTime</span>(value: <span class="hljs-number">30</span>, timescale: <span class="hljs-number">1</span>)<br />player.seek(to: time)</span></pre><p name="35ca" id="35ca" class="graf graf--p graf-after--pre">timeScale 通常會傳 1，value / timescale 表示秒數，因此 CMTime(value: 30, timescale: 2) 將變成第 15 秒。</p><h3 name="3d6f" id="3d6f" class="graf graf--h3 graf-after--p">歌曲播放完的通知，AVPlayerItemDidPlayToEndTime</h3><p name="e649" id="e649" class="graf graf--p graf-after--h3">很多時候我們想知道歌曲播完了，比方想在周興哲的你好不好唱完後，繼續播放五月天的好好。</p><p name="02a4" id="02a4" class="graf graf--p graf-after--p">我們可在音樂播完了收到 Notification，此時它會發送通知AVPlayerItemDidPlayToEndTime。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="a286" id="a286" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-type">NotificationCenter</span>.default.addObserver(forName: <span class="hljs-type">NSNotification</span>.<span class="hljs-type">Name</span>.<span class="hljs-type">AVPlayerItemDidPlayToEndTime</span>, object: <span class="hljs-literal">nil</span>, queue: .main) { <span class="hljs-keyword">_</span> <span class="hljs-keyword">in</span><br />   <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;finish, next song&quot;</span>)<br />}</span></pre><h3 name="9758" id="9758" class="graf graf--h3 graf-after--pre">偵測歌曲目前播放的時間</h3><div name="510b" id="510b" class="graf graf--mixtapeEmbed graf-after--h3"><a href="https://developer.apple.com/documentation/avfoundation/media_playback/monitoring_playback_progress_in_your_app/" data-href="https://developer.apple.com/documentation/avfoundation/media_playback/monitoring_playback_progress_in_your_app/" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/avfoundation/media_playback/monitoring_playback_progress_in_your_app/"><strong class="markup--strong markup--mixtapeEmbed-strong">Monitoring playback progress in your app | Apple Developer Documentation</strong><br><em class="markup--em markup--mixtapeEmbed-em">Observe the playback of a media asset to update your app&#39;s user-interface state.</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/avfoundation/media_playback/monitoring_playback_progress_in_your_app/" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="c78cb5c3700ac2c58781f7a028baf347" data-thumbnail-img-id="0*29DEX_tkNWJQ4vO_" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*29DEX_tkNWJQ4vO_);"></a></div><h3 name="5a1c" id="5a1c" class="graf graf--h3 graf-after--mixtapeEmbed">產生 AVPlayer 的多種方法</h3><p name="f29b" id="f29b" class="graf graf--p graf-after--h3">如果一開始已知道播放的歌曲，也可以在產生 AVPlayer 時傳入 playerItem 或 url。</p><figure name="fa29" id="fa29" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*NbY0KKoYAL8SizSYQMPJTg.png" data-width="988" data-height="354" src="https://cdn-images-1.medium.com/max/800/1*NbY0KKoYAL8SizSYQMPJTg.png"></figure><h3 name="659c" id="659c" class="graf graf--h3 graf-after--figure">重覆播放音樂</h3><p name="7f43" id="7f43" class="graf graf--p graf-after--h3">剛剛的程式已經可以順利播放音樂，可惜它只能播放一次。若覺得一次不夠好，想多聽幾次的朋友，可參考以下連結利用 AVPlayerLooper 實現重覆播放。</p><div name="c42c" id="c42c" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-avplayerlooper-%E9%87%8D%E8%A6%86%E6%92%AD%E6%94%BE%E9%9F%B3%E6%A8%82%E5%92%8C%E5%BD%B1%E7%89%87-a9142d48465e" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-avplayerlooper-%E9%87%8D%E8%A6%86%E6%92%AD%E6%94%BE%E9%9F%B3%E6%A8%82%E5%92%8C%E5%BD%B1%E7%89%87-a9142d48465e" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-avplayerlooper-%E9%87%8D%E8%A6%86%E6%92%AD%E6%94%BE%E9%9F%B3%E6%A8%82%E5%92%8C%E5%BD%B1%E7%89%87-a9142d48465e"><strong class="markup--strong markup--mixtapeEmbed-strong">利用 AVPlayerLooper 重覆播放音樂和影片</strong><br><em class="markup--em markup--mixtapeEmbed-em">彼得潘很喜歡重覆聽同一首歌，重覆看同一部電影，所以接下來，就讓我們試試用 iOS 10 的 AVPlayerLooper 實現重覆播放的功能吧。</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-avplayerlooper-%E9%87%8D%E8%A6%86%E6%92%AD%E6%94%BE%E9%9F%B3%E6%A8%82%E5%92%8C%E5%BD%B1%E7%89%87-a9142d48465e" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="2000d59776a9e26c60788a3f9ca0e2af" data-thumbnail-img-id="1*R2XkZTogycUWVskjO_vKxA.jpeg" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*R2XkZTogycUWVskjO_vKxA.jpeg);"></a></div><h3 name="7900" id="7900" class="graf graf--h3 graf-after--mixtapeEmbed">背景播放音樂</h3><div name="213d" id="213d" class="graf graf--mixtapeEmbed graf-after--h3"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E8%A8%AD%E5%AE%9A-background-mode-%E5%9C%A8%E8%83%8C%E6%99%AF%E6%92%AD%E6%94%BE%E9%9F%B3%E6%A8%82-9bab5db75cc9" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E8%A8%AD%E5%AE%9A-background-mode-%E5%9C%A8%E8%83%8C%E6%99%AF%E6%92%AD%E6%94%BE%E9%9F%B3%E6%A8%82-9bab5db75cc9" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E8%A8%AD%E5%AE%9A-background-mode-%E5%9C%A8%E8%83%8C%E6%99%AF%E6%92%AD%E6%94%BE%E9%9F%B3%E6%A8%82-9bab5db75cc9"><strong class="markup--strong markup--mixtapeEmbed-strong">設定 Background Mode 在背景播放音樂</strong><br><em class="markup--em markup--mixtapeEmbed-em">開發音樂播放的 App 時，我們時常需要讓音樂在背景也能繼續播放，這樣的功能是如何實現的呢 ? 只要調整 Background Mode &amp; 設定 AVAudioSession 即可實現。</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E8%A8%AD%E5%AE%9A-background-mode-%E5%9C%A8%E8%83%8C%E6%99%AF%E6%92%AD%E6%94%BE%E9%9F%B3%E6%A8%82-9bab5db75cc9" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="bdbda01a0dd345dc8b96029bb2cd85b9" data-thumbnail-img-id="1*fpnYAG_nAk-SLyc3xugtQw.jpeg" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*fpnYAG_nAk-SLyc3xugtQw.jpeg);"></a></div><h3 name="c8fb" id="c8fb" class="graf graf--h3 graf-after--mixtapeEmbed">背景控制音樂</h3><div name="40c5" id="40c5" class="graf graf--mixtapeEmbed graf-after--h3"><a href="https://developer.apple.com/documentation/watchkit/storyboard_support/playing_background_audio" data-href="https://developer.apple.com/documentation/watchkit/storyboard_support/playing_background_audio" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/watchkit/storyboard_support/playing_background_audio"><strong class="markup--strong markup--mixtapeEmbed-strong">Playing Background Audio | Apple Developer Documentation</strong><br><em class="markup--em markup--mixtapeEmbed-em">Enable background audio in your app to provide a seamless playback experience.</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/watchkit/storyboard_support/playing_background_audio" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="b50381f24b2a24d138df095ca2272587" data-thumbnail-img-id="0*62kL2FFiIHoB_y_s" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*62kL2FFiIHoB_y_s);"></a></div><figure name="6651" id="6651" class="graf graf--figure graf-after--mixtapeEmbed"><img class="graf-image" data-image-id="1*U6OMxUDx72q4iDxvlKppEQ.png" data-width="1125" data-height="2436" src="https://cdn-images-1.medium.com/max/800/1*U6OMxUDx72q4iDxvlKppEQ.png"></figure><h3 name="eae9" id="eae9" class="graf graf--h3 graf-after--figure">免費音效網站</h3><div name="690f" id="690f" class="graf graf--mixtapeEmbed graf-after--h3"><a href="https://www.bnext.com.tw/ext_rss/view/id/928492" data-href="https://www.bnext.com.tw/ext_rss/view/id/928492" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://www.bnext.com.tw/ext_rss/view/id/928492"><strong class="markup--strong markup--mixtapeEmbed-strong">10大免費音樂音效素材下載網站：商業影片也能用上！｜數位時代</strong><br><em class="markup--em markup--mixtapeEmbed-em">當你在工作、生活中想要剪輯一支影片、設計一支微電影，這時候你需要一些背景音樂，或許是某首能讓大家放鬆的古典音樂？還是說這時侯你需要一些音效，讓影片中熙來攘往的城市場景多一些忙碌的聲音？除了自己去錄，除了購買授權外，有沒有一些管道可以獲得合法…</em>www.bnext.com.tw</a><a href="https://www.bnext.com.tw/ext_rss/view/id/928492" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="ebd613ad8906e5c34d18a1b0607dcb3b" data-thumbnail-img-id="0*hR2fE9FcPrsdW-hf" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*hR2fE9FcPrsdW-hf);"></a></div><h3 name="eadb" id="eadb" class="graf graf--h3 graf-after--mixtapeEmbed">免費背景音樂網站</h3><div name="f3f1" id="f3f1" class="graf graf--mixtapeEmbed graf-after--h3"><a href="https://www.bensound.com" data-href="https://www.bensound.com" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://www.bensound.com"><strong class="markup--strong markup--mixtapeEmbed-strong">Royalty Free Music by Bensound | Stock Music</strong><br><em class="markup--em markup--mixtapeEmbed-em">Download Royalty Free Music for free and use it in your project: Videos(youtube,...), Websites, films,...</em>www.bensound.com</a><a href="https://www.bensound.com" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="bb1cf1fcd56741ef63919de45a034c59" data-thumbnail-img-id="0*9ny9cV5OBeja-opE" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*9ny9cV5OBeja-opE);"></a></div><h3 name="835e" id="835e" class="graf graf--h3 graf-after--mixtapeEmbed">作品集</h3><div name="7218" id="7218" class="graf graf--mixtapeEmbed graf-after--h3 graf--trailing"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E6%95%99%E5%AE%A4/201210-%E9%A1%9E%E5%88%A5%E7%B7%B4%E7%BF%92-f39b85089a76" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E6%95%99%E5%AE%A4/201210-%E9%A1%9E%E5%88%A5%E7%B7%B4%E7%BF%92-f39b85089a76" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E6%95%99%E5%AE%A4/201210-%E9%A1%9E%E5%88%A5%E7%B7%B4%E7%BF%92-f39b85089a76"><strong class="markup--strong markup--mixtapeEmbed-strong">[201210] 類別練習</strong><br><em class="markup--em markup--mixtapeEmbed-em">Season BGM Player</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E6%95%99%E5%AE%A4/201210-%E9%A1%9E%E5%88%A5%E7%B7%B4%E7%BF%92-f39b85089a76" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="e3d159c2541eade55a3621b013c07ef7" data-thumbnail-img-id="1*i-daMgvuuUvTnsIWwTUCUQ.gif" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*i-daMgvuuUvTnsIWwTUCUQ.gif);"></a></div></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@apppeterpan" class="p-author h-card">彼得潘的 iOS App Neverland</a> on <a href="https://medium.com/p/bfe59e9e22c"><time class="dt-published" datetime="2019-04-07T04:23:50.056Z">April 7, 2019</time></a>.</p><p><a href="https://medium.com/@apppeterpan/%E5%88%A9%E7%94%A8-viewdidload-%E9%BB%9E%E4%B8%80%E9%A6%96%E6%AD%8C-%E6%92%AD%E6%94%BE%E4%B8%80%E6%AC%A1pl-bfe59e9e22c" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on September 17, 2025.</p></footer></article></body></html>