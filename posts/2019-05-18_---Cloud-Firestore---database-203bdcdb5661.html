<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>讀取 Cloud Firestore 的 database</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">讀取 Cloud Firestore 的 database</h1>
</header>
<section data-field="subtitle" class="p-summary">
官方文件
</section>
<section data-field="body" class="e-content">
<section name="02f0" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="7ebb" id="7ebb" class="graf graf--h3 graf--leading graf--title"><strong class="markup--strong markup--h3-strong">讀取 Cloud Firestore 的 database</strong></h3><h3 name="2f56" id="2f56" class="graf graf--h3 graf-after--h3">官方文件</h3><div name="aa0f" id="aa0f" class="graf graf--mixtapeEmbed graf-after--h3"><a href="https://firebase.google.com/docs/firestore/query-data/get-data" data-href="https://firebase.google.com/docs/firestore/query-data/get-data" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://firebase.google.com/docs/firestore/query-data/get-data"><strong class="markup--strong markup--mixtapeEmbed-strong">Get data with Cloud Firestore | Firebase</strong><br><em class="markup--em markup--mixtapeEmbed-em">Retrieving a list of collections is not possible with the mobile/web client libraries. You should only look up…</em>firebase.google.com</a><a href="https://firebase.google.com/docs/firestore/query-data/get-data" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="e6446ae56d8b131524cc53e7865dc38e" data-thumbnail-img-id="0*KsfIg77Gghz0_SD4" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*KsfIg77Gghz0_SD4);"></a></div><h3 name="bdd9" id="bdd9" class="graf graf--h3 graf-after--mixtapeEmbed">新版做法: 利用 FirebaseFirestoreSwift</h3><div name="5dff" id="5dff" class="graf graf--mixtapeEmbed graf-after--h3"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-firebasefirestoreswift-%E5%B0%87-firestore-%E7%9A%84%E8%B3%87%E6%96%99%E8%AE%8A%E6%88%90%E8%87%AA%E8%A8%82%E5%9E%8B%E5%88%A5-89f33c852018" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-firebasefirestoreswift-%E5%B0%87-firestore-%E7%9A%84%E8%B3%87%E6%96%99%E8%AE%8A%E6%88%90%E8%87%AA%E8%A8%82%E5%9E%8B%E5%88%A5-89f33c852018" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-firebasefirestoreswift-%E5%B0%87-firestore-%E7%9A%84%E8%B3%87%E6%96%99%E8%AE%8A%E6%88%90%E8%87%AA%E8%A8%82%E5%9E%8B%E5%88%A5-89f33c852018"><strong class="markup--strong markup--mixtapeEmbed-strong">利用 FirebaseFirestoreSwift 將 Firestore 的資料變成自訂型別</strong><br><em class="markup--em markup--mixtapeEmbed-em">Firebase 提供強大的 Firestore 讓我們上傳和下載資料，不過從前撰寫上傳和下載資料的相關程式時，並不是很方便，因為資料的型別是 [String: Any]，我們需要自己寫程式將它轉換成方便 App 使用的自訂型別。</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-firebasefirestoreswift-%E5%B0%87-firestore-%E7%9A%84%E8%B3%87%E6%96%99%E8%AE%8A%E6%88%90%E8%87%AA%E8%A8%82%E5%9E%8B%E5%88%A5-89f33c852018" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="f0cab3f368b3c5bb4aa02146a34c3bcc" data-thumbnail-img-id="1*viiClZ6IZY61PRJWRjh0gg.jpeg" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*viiClZ6IZY61PRJWRjh0gg.jpeg);"></a></div><p name="f581" id="f581" class="graf graf--p graf-after--mixtapeEmbed">以下是舊版做法。</p><h3 name="9bf8" id="9bf8" class="graf graf--h3 graf-after--p">import FirebaseFirestore</h3><p name="826f" id="826f" class="graf graf--p graf-after--h3">加入 framework FirebaseFirestore 才能使用 FirebaseFirestore 的相關功能。</p><h3 name="e032" id="e032" class="graf graf--h3 graf-after--p">範例 1</h3><figure name="543d" id="543d" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="1*uHVBhb1-RGwdaJTBtqSGUg.jpeg" data-width="1410" data-height="492" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*uHVBhb1-RGwdaJTBtqSGUg.jpeg"></figure><blockquote name="5d3b" id="5d3b" class="graf graf--blockquote graf-after--figure"><strong class="markup--strong markup--blockquote-strong">以 getDocuments 讀取某個 collection 下全部的 documents</strong></blockquote><p name="5df2" id="5df2" class="graf graf--p graf-after--blockquote">collection() 裡可傳入 collection 的名字，因此我們用 <code class="markup--code markup--p-code">db.collection(&quot;songs&quot;)</code> 取得 songs collection，然後再呼叫 function getDocuments 取得它底下所有的 documents。 (記得要 import Firebase)</p><pre name="5308" id="5308" class="graf graf--pre graf-after--p">let db = Firestore.firestore()</pre><pre name="1cb5" id="1cb5" class="graf graf--pre graf-after--pre">db.collection(&quot;songs&quot;).getDocuments { querySnapshot, error in</pre><pre name="185c" id="185c" class="graf graf--pre graf-after--pre">   if let querySnapshot = querySnapshot {</pre><pre name="6b6f" id="6b6f" class="graf graf--pre graf-after--pre">      for document in querySnapshot.documents {</pre><pre name="c46c" id="c46c" class="graf graf--pre graf-after--pre">         print(document.data())</pre><pre name="015c" id="015c" class="graf graf--pre graf-after--pre">      }</pre><pre name="607e" id="607e" class="graf graf--pre graf-after--pre">   }</pre><pre name="4fa7" id="4fa7" class="graf graf--pre graf-after--pre">}</pre><p name="2234" id="2234" class="graf graf--p graf-after--pre">document 的型別為 QueryDocumentSnapshot，利用它的 data() 可取得 dictionary 型別的資料。</p><figure name="1bb5" id="1bb5" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*SeSX71j2ysBHikZZtlhYtw.jpeg" data-width="946" data-height="184" src="https://cdn-images-1.medium.com/max/800/1*SeSX71j2ysBHikZZtlhYtw.jpeg"></figure><p name="7ec9" id="7ec9" class="graf graf--p graf-after--figure">比方以下寫法可取得歌名。</p><pre name="e14d" id="e14d" class="graf graf--pre graf-after--p">let name = document.data()[&quot;name&quot;]</pre><p name="4ea7" id="4ea7" class="graf graf--p graf-after--pre">結果</p><pre name="1a1c" id="1a1c" class="graf graf--pre graf-after--p"><strong class="markup--strong markup--pre-strong">[&quot;singer&quot;: 薛之謙, &quot;rate&quot;: 3, &quot;name&quot;: 演員]</strong></pre><pre name="c6f5" id="c6f5" class="graf graf--pre graf-after--pre"><strong class="markup--strong markup--pre-strong">[&quot;singer&quot;: 田馥甄, &quot;name&quot;: 小幸運, &quot;rate&quot;: 4]</strong></pre><pre name="3220" id="3220" class="graf graf--pre graf-after--pre"><strong class="markup--strong markup--pre-strong">[&quot;singer&quot;: 周興哲, &quot;name&quot;: 你好不好, &quot;rate&quot;: 5]</strong></pre><p name="ac0d" id="ac0d" class="graf graf--p graf-after--pre">ps: 當 getDocuments 找不到任何 document 時，可利用 querySnapshot.documents.count 是否為 0 判斷。</p><blockquote name="fafe" id="fafe" class="graf graf--blockquote graf-after--p"><strong class="markup--strong markup--blockquote-strong">以 order(by:) 排序，由小到大。</strong></blockquote><p name="2b32" id="2b32" class="graf graf--p graf-after--blockquote">以 rate 排序，由小到大。</p><pre name="9ea5" id="9ea5" class="graf graf--pre graf-after--p">let db = Firestore.firestore()</pre><pre name="8f81" id="8f81" class="graf graf--pre graf-after--pre">db.collection(&quot;songs&quot;).<strong class="markup--strong markup--pre-strong">order(by: &quot;rate&quot;)</strong>.getDocuments { querySnapshot, error in</pre><pre name="a21b" id="a21b" class="graf graf--pre graf-after--pre">   if let querySnapshot = querySnapshot {</pre><pre name="9a33" id="9a33" class="graf graf--pre graf-after--pre">      for document in querySnapshot.documents {</pre><pre name="cee3" id="cee3" class="graf graf--pre graf-after--pre">         print(document.data())</pre><pre name="bd32" id="bd32" class="graf graf--pre graf-after--pre">      }</pre><pre name="dfff" id="dfff" class="graf graf--pre graf-after--pre">   }</pre><pre name="c080" id="c080" class="graf graf--pre graf-after--pre">}</pre><p name="0ae1" id="0ae1" class="graf graf--p graf-after--pre">結果</p><pre name="a9e4" id="a9e4" class="graf graf--pre graf-after--p"><strong class="markup--strong markup--pre-strong">[&quot;name&quot;: 演員, &quot;singer&quot;: 薛之謙, &quot;rate&quot;: 3]</strong></pre><pre name="2e4d" id="2e4d" class="graf graf--pre graf-after--pre"><strong class="markup--strong markup--pre-strong">[&quot;rate&quot;: 4, &quot;singer&quot;: 田馥甄, &quot;name&quot;: 小幸運]</strong></pre><pre name="2da2" id="2da2" class="graf graf--pre graf-after--pre"><strong class="markup--strong markup--pre-strong">[&quot;rate&quot;: 5, &quot;singer&quot;: 周興哲, &quot;name&quot;: 你好不好]</strong></pre><blockquote name="e12b" id="e12b" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">以多個欄位排序，比方先比身高，身高一樣再比體重。</strong></blockquote><pre name="52ec" id="52ec" class="graf graf--pre graf-after--blockquote">let db = Firestore.firestore()</pre><pre name="0c97" id="0c97" class="graf graf--pre graf-after--pre">db.collection(&quot;students&quot;)<strong class="markup--strong markup--pre-strong">.order(by: &quot;height&quot;).order(by: &quot;weight&quot;)</strong>.getDocuments { querySnapshot, error in</pre><pre name="b2d3" id="b2d3" class="graf graf--pre graf-after--pre">}</pre><blockquote name="fdfb" id="fdfb" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">以 order 的參數 descending 為 true 控制排序由大到小。</strong></blockquote><p name="261b" id="261b" class="graf graf--p graf-after--blockquote">以 rate 排序，由大到小。</p><pre name="02cd" id="02cd" class="graf graf--pre graf-after--p">let db = Firestore.firestore()</pre><pre name="17d1" id="17d1" class="graf graf--pre graf-after--pre">db.collection(&quot;songs&quot;).<strong class="markup--strong markup--pre-strong">order(by: &quot;rate&quot;, descending: true)</strong>.getDocuments { querySnapshot, error in</pre><pre name="2a06" id="2a06" class="graf graf--pre graf-after--pre">   if let querySnapshot = querySnapshot {</pre><pre name="4413" id="4413" class="graf graf--pre graf-after--pre">      for document in querySnapshot.documents {</pre><pre name="fc61" id="fc61" class="graf graf--pre graf-after--pre">         print(document.data())</pre><pre name="a246" id="a246" class="graf graf--pre graf-after--pre">      }</pre><pre name="a8cc" id="a8cc" class="graf graf--pre graf-after--pre">   }</pre><pre name="2ba9" id="2ba9" class="graf graf--pre graf-after--pre">}</pre><p name="7c23" id="7c23" class="graf graf--p graf-after--pre">結果</p><pre name="f1e7" id="f1e7" class="graf graf--pre graf-after--p"><strong class="markup--strong markup--pre-strong">[&quot;name&quot;: 你好不好, &quot;rate&quot;: 5, &quot;singer&quot;: 周興哲]</strong></pre><pre name="7900" id="7900" class="graf graf--pre graf-after--pre"><strong class="markup--strong markup--pre-strong">[&quot;singer&quot;: 田馥甄, &quot;name&quot;: 小幸運, &quot;rate&quot;: 4]</strong></pre><pre name="bc5e" id="bc5e" class="graf graf--pre graf-after--pre"><strong class="markup--strong markup--pre-strong">[&quot;singer&quot;: 薛之謙, &quot;name&quot;: 演員, &quot;rate&quot;: 3]</strong></pre><p name="e574" id="e574" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">以 limit(to:) 指定抓取的數量。</strong></p><pre name="f05b" id="f05b" class="graf graf--pre graf-after--p">db.collection(&quot;songs&quot;).order(by: &quot;rate&quot;).<strong class="markup--strong markup--pre-strong">limit(to: 2)</strong>.getDocuments { querySnapshot, error in</pre><pre name="b18c" id="b18c" class="graf graf--pre graf-after--pre">   if let querySnapshot = querySnapshot {</pre><pre name="87c6" id="87c6" class="graf graf--pre graf-after--pre">      for document in querySnapshot.documents {</pre><pre name="7b6c" id="7b6c" class="graf graf--pre graf-after--pre">         print(document.data())</pre><pre name="c87f" id="c87f" class="graf graf--pre graf-after--pre">      }</pre><pre name="262c" id="262c" class="graf graf--pre graf-after--pre">   }</pre><pre name="a8bb" id="a8bb" class="graf graf--pre graf-after--pre">}</pre><p name="504d" id="504d" class="graf graf--p graf-after--pre">結果</p><pre name="3f0f" id="3f0f" class="graf graf--pre graf-after--p"><strong class="markup--strong markup--pre-strong">[&quot;name&quot;: 演員, &quot;rate&quot;: 3, &quot;singer&quot;: 薛之謙]</strong></pre><pre name="56c1" id="56c1" class="graf graf--pre graf-after--pre"><strong class="markup--strong markup--pre-strong">[&quot;name&quot;: 小幸運, &quot;singer&quot;: 田馥甄, &quot;rate&quot;: 4]</strong></pre><p name="264b" id="264b" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">利用 whereField 設定 search 的條件。</strong></p><figure name="e690" id="e690" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*3VfNY4rkuv5Jd7FTrfn5Iw.jpeg" data-width="1500" data-height="568" src="https://cdn-images-1.medium.com/max/800/1*3VfNY4rkuv5Jd7FTrfn5Iw.jpeg"></figure><pre name="d8d0" id="d8d0" class="graf graf--pre graf-after--figure">let db = Firestore.firestore()</pre><pre name="30d3" id="30d3" class="graf graf--pre graf-after--pre">db.collection(&quot;songs&quot;).<strong class="markup--strong markup--pre-strong">whereField(&quot;singer&quot;, isEqualTo: &quot;周興哲&quot;)</strong>.getDocuments { querySnapshot, error in</pre><pre name="ee21" id="ee21" class="graf graf--pre graf-after--pre">   if let querySnapshot = querySnapshot { </pre><pre name="3282" id="3282" class="graf graf--pre graf-after--pre">      for document in querySnapshot.documents {</pre><pre name="e6e0" id="e6e0" class="graf graf--pre graf-after--pre">         print(document.data())</pre><pre name="aa88" id="aa88" class="graf graf--pre graf-after--pre">      }</pre><pre name="07c9" id="07c9" class="graf graf--pre graf-after--pre">   }</pre><pre name="4cb8" id="4cb8" class="graf graf--pre graf-after--pre">}</pre><p name="854a" id="854a" class="graf graf--p graf-after--pre">結果</p><pre name="72a4" id="72a4" class="graf graf--pre graf-after--p"><strong class="markup--strong markup--pre-strong">[&quot;name&quot;: 你好不好, &quot;singer&quot;: 周興哲, &quot;rate&quot;: 5]</strong></pre><h3 name="374e" id="374e" class="graf graf--h3 graf-after--pre">範例 2</h3><figure name="12ad" id="12ad" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="1*HfTL4KAaaZWvCJXEyGaesA.jpeg" data-width="1364" data-height="600" src="https://cdn-images-1.medium.com/max/800/1*HfTL4KAaaZWvCJXEyGaesA.jpeg"></figure><figure name="d5eb" id="d5eb" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*LONxSskVMc0cBIbSuWAL7w.jpeg" data-width="1956" data-height="580" src="https://cdn-images-1.medium.com/max/800/1*LONxSskVMc0cBIbSuWAL7w.jpeg"></figure><blockquote name="126d" id="126d" class="graf graf--blockquote graf-after--figure"><strong class="markup--strong markup--blockquote-strong">讀取某個 document</strong></blockquote><pre name="cbc3" id="cbc3" class="graf graf--pre graf-after--blockquote">let db = Firestore.firestore()</pre><pre name="8ec7" id="8ec7" class="graf graf--pre graf-after--pre">db.collection(&quot;music&quot;).document(&quot;周杰倫&quot;).getDocument { (document, error) in</pre><pre name="7c30" id="7c30" class="graf graf--pre graf-after--pre">   if let document = document, document.exists {</pre><pre name="04c2" id="04c2" class="graf graf--pre graf-after--pre">      print(document.documentID, document.data())</pre><pre name="8f3c" id="8f3c" class="graf graf--pre graf-after--pre">   } else {</pre><pre name="20d7" id="20d7" class="graf graf--pre graf-after--pre">      print(&quot;Document does not exist&quot;)</pre><pre name="678d" id="678d" class="graf graf--pre graf-after--pre">   }</pre><pre name="972d" id="972d" class="graf graf--pre graf-after--pre">}</pre><p name="8bfc" id="8bfc" class="graf graf--p graf-after--pre">結果</p><pre name="3dbc" id="3dbc" class="graf graf--pre graf-after--p">周杰倫 Optional([&quot;gender&quot;: 男])</pre><blockquote name="d493" id="d493" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">讀取某個 document 下的 collection</strong></blockquote><pre name="c4cc" id="c4cc" class="graf graf--pre graf-after--blockquote">let db = Firestore.firestore()</pre><pre name="d5e7" id="d5e7" class="graf graf--pre graf-after--pre">db.collection(&quot;music&quot;).document(&quot;周杰倫&quot;).collection(&quot;albums&quot;).getDocuments { querySnapshot, error in</pre><pre name="3c02" id="3c02" class="graf graf--pre graf-after--pre">   if let querySnapshot = querySnapshot {</pre><pre name="03f0" id="03f0" class="graf graf--pre graf-after--pre">      for document in querySnapshot.documents {</pre><pre name="1bc7" id="1bc7" class="graf graf--pre graf-after--pre">         print(document.documentID)</pre><pre name="c5a3" id="c5a3" class="graf graf--pre graf-after--pre">      }</pre><pre name="fe09" id="fe09" class="graf graf--pre graf-after--pre">   }</pre><pre name="088e" id="088e" class="graf graf--pre graf-after--pre">}</pre><p name="b98e" id="b98e" class="graf graf--p graf-after--pre">結果</p><pre name="f8e5" id="f8e5" class="graf graf--pre graf-after--p"><strong class="markup--strong markup--pre-strong">葉惠美</strong></pre><p name="a66c" id="a66c" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">利用 document 或 collection 路徑讀取</strong></p><p name="5af0" id="5af0" class="graf graf--p graf-after--p">利用 collection 路徑讀取 documents</p><pre name="e784" id="e784" class="graf graf--pre graf-after--p">let db = Firestore.firestore()</pre><pre name="99db" id="99db" class="graf graf--pre graf-after--pre">db.collection(&quot;music/周杰倫/albums&quot;).getDocuments { querySnapshot, error in</pre><pre name="2c26" id="2c26" class="graf graf--pre graf-after--pre">   if let querySnapshot = querySnapshot {</pre><pre name="0f2c" id="0f2c" class="graf graf--pre graf-after--pre">      for document in querySnapshot.documents {</pre><pre name="14e9" id="14e9" class="graf graf--pre graf-after--pre">         print(document.documentID)</pre><pre name="9c5d" id="9c5d" class="graf graf--pre graf-after--pre">      }</pre><pre name="4f37" id="4f37" class="graf graf--pre graf-after--pre">   }</pre><pre name="786c" id="786c" class="graf graf--pre graf-after--pre">}</pre><p name="44fc" id="44fc" class="graf graf--p graf-after--pre">結果</p><pre name="8e0c" id="8e0c" class="graf graf--pre graf-after--p"><strong class="markup--strong markup--pre-strong">葉惠美</strong></pre><p name="47a3" id="47a3" class="graf graf--p graf-after--pre">利用 document 路徑讀取 document</p><pre name="1421" id="1421" class="graf graf--pre graf-after--p">let db = Firestore.firestore()</pre><pre name="cda9" id="cda9" class="graf graf--pre graf-after--pre">db.document(&quot;music/周杰倫&quot;).getDocument  { (document, error) in</pre><pre name="44cd" id="44cd" class="graf graf--pre graf-after--pre">   if let document = document, document.exists {</pre><pre name="9f48" id="9f48" class="graf graf--pre graf-after--pre">      print(document.documentID, document.data())</pre><pre name="8f4b" id="8f4b" class="graf graf--pre graf-after--pre">   } else {</pre><pre name="bb20" id="bb20" class="graf graf--pre graf-after--pre">      print(&quot;Document does not exist&quot;)</pre><pre name="2614" id="2614" class="graf graf--pre graf-after--pre">   }</pre><pre name="fbec" id="fbec" class="graf graf--pre graf-after--pre">}</pre><p name="06a7" id="06a7" class="graf graf--p graf-after--pre">結果</p><pre name="fd75" id="fd75" class="graf graf--pre graf-after--p"><strong class="markup--strong markup--pre-strong">周杰倫 Optional([&quot;gender&quot;: 男])</strong></pre><h3 name="a25e" id="a25e" class="graf graf--h3 graf-after--pre">持續偵測 collection 下的 document 是否有新增，刪除，修改</h3><p name="8b7b" id="8b7b" class="graf graf--p graf-after--h3">一開始 addSnapshotListener 會先抓到 collection 下所有的 document， 因此 documentChanges 將包含所有的 document，type 則為 .added。之後 addSnapshotListener 的 closure 再被觸發時，documentChanges 將只包含新增，刪除(removed)或修改(modified)的 document。</p><pre name="9ab2" id="9ab2" class="graf graf--pre graf-after--p">let db = Firestore.firestore()</pre><pre name="e077" id="e077" class="graf graf--pre graf-after--pre">db.collection(&quot;songs&quot;).<strong class="markup--strong markup--pre-strong">addSnapshotListener</strong> { (querySnapshot, error) in</pre><pre name="6b76" id="6b76" class="graf graf--pre graf-after--pre">   guard let querySnapshot = querySnapshot else {</pre><pre name="675a" id="675a" class="graf graf--pre graf-after--pre">      return</pre><pre name="79c8" id="79c8" class="graf graf--pre graf-after--pre">   }</pre><pre name="24ac" id="24ac" class="graf graf--pre graf-after--pre">   querySnapshot.documentChanges.forEach({ (documentChange) in</pre><pre name="a422" id="a422" class="graf graf--pre graf-after--pre">      if documentChange.type == .added {</pre><pre name="0304" id="0304" class="graf graf--pre graf-after--pre">         print(documentChange.document.data())</pre><pre name="6080" id="6080" class="graf graf--pre graf-after--pre">      }</pre><pre name="46b4" id="46b4" class="graf graf--pre graf-after--pre">   })</pre><pre name="7d74" id="7d74" class="graf graf--pre graf-after--pre">}</pre><h3 name="f211" id="f211" class="graf graf--h3 graf-after--pre">將偵測到的資料儲存到 array，顯示在表格上</h3><pre name="7c9b" id="7c9b" class="graf graf--pre graf-after--h3">class SongsTableViewController: UITableViewController {<br>    <br>  <strong class="markup--strong markup--pre-strong">  var songs = [QueryDocumentSnapshot]()</strong></pre><pre name="cb29" id="cb29" class="graf graf--pre graf-after--pre">override func viewDidLoad() {<br>        super.viewDidLoad()</pre><pre name="73f0" id="73f0" class="graf graf--pre graf-after--pre">let db = Firestore.firestore()<br>        db.collection(&quot;songs&quot;).order(by: &quot;rate&quot;).addSnapshotListener { (querySnapshot, error) in<br>            guard let querySnapshot = querySnapshot else {<br>               return<br>            }<br>            <br>           <strong class="markup--strong markup--pre-strong"> self.songs = querySnapshot.documents</strong><br>            self.tableView.reloadData()<br>        }<br>    }</pre><h3 name="5632" id="5632" class="graf graf--h3 graf-after--pre"><strong class="markup--strong markup--h3-strong">自訂型別儲存 Firebase 抓取的資料</strong></h3><ul class="postList"><li name="2cb7" id="2cb7" class="graf graf--li graf-after--h3">比較方便的方法:</li></ul><p name="5116" id="5116" class="graf graf--p graf-after--li"><strong class="markup--strong markup--p-strong">利用 FirebaseFirestoreSwift 將 Firestore 的資料變成自訂型別</strong></p><div name="614d" id="614d" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-firebasefirestoreswift-%E5%B0%87-firestore-%E7%9A%84%E8%B3%87%E6%96%99%E8%AE%8A%E6%88%90%E8%87%AA%E8%A8%82%E5%9E%8B%E5%88%A5-89f33c852018" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-firebasefirestoreswift-%E5%B0%87-firestore-%E7%9A%84%E8%B3%87%E6%96%99%E8%AE%8A%E6%88%90%E8%87%AA%E8%A8%82%E5%9E%8B%E5%88%A5-89f33c852018" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-firebasefirestoreswift-%E5%B0%87-firestore-%E7%9A%84%E8%B3%87%E6%96%99%E8%AE%8A%E6%88%90%E8%87%AA%E8%A8%82%E5%9E%8B%E5%88%A5-89f33c852018"><strong class="markup--strong markup--mixtapeEmbed-strong">利用 FirebaseFirestoreSwift 將 Firestore 的資料變成自訂型別</strong><br><em class="markup--em markup--mixtapeEmbed-em">Firebase 提供強大的 Firestore 讓我們上傳和下載資料，不過從前撰寫上傳和下載資料的相關程式時，並不是很方便，因為資料的型別是 [String: Any]，我們需要自己寫程式將它轉換成方便 App 使用的自訂型別。</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-firebasefirestoreswift-%E5%B0%87-firestore-%E7%9A%84%E8%B3%87%E6%96%99%E8%AE%8A%E6%88%90%E8%87%AA%E8%A8%82%E5%9E%8B%E5%88%A5-89f33c852018" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="f0cab3f368b3c5bb4aa02146a34c3bcc" data-thumbnail-img-id="1*viiClZ6IZY61PRJWRjh0gg.jpeg" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*viiClZ6IZY61PRJWRjh0gg.jpeg);"></a></div><ul class="postList"><li name="08c8" id="08c8" class="graf graf--li graf-after--mixtapeEmbed"><strong class="markup--strong markup--li-strong">其它方法</strong></li></ul><p name="c93f" id="c93f" class="graf graf--p graf-after--li">範例</p><pre name="a87a" id="a87a" class="graf graf--pre graf-after--p">struct Song {<br>    var name: String<br>    var singer: String<br>    var rate: Int<br>    var youtube: URL?<br>}</pre><pre name="4c82" id="4c82" class="graf graf--pre graf-after--pre">extension Song {<br>    init(dic: [String: Any]) {<br>        name = dic[&quot;name&quot;] as? String ?? &quot;街角的祝福&quot;<br>        singer = dic[&quot;singer&quot;] as? String ?? &quot;peter pan&quot;<br>        rate = dic[&quot;rate&quot;] as? Int ?? 1<br>        if let urlString = dic[&quot;youtube&quot;] as? String {<br>            youtube = URL(string: urlString)<br>        }<br>    }<br>}</pre><div name="57c2" id="57c2" class="graf graf--mixtapeEmbed graf-after--pre"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-extension-%E5%90%8C%E6%99%82%E5%AE%A2%E8%A3%BD-init-%E5%92%8C%E4%BF%9D%E7%95%99-default-initializer-memberwise-initializer-18927569104e" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-extension-%E5%90%8C%E6%99%82%E5%AE%A2%E8%A3%BD-init-%E5%92%8C%E4%BF%9D%E7%95%99-default-initializer-memberwise-initializer-18927569104e" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-extension-%E5%90%8C%E6%99%82%E5%AE%A2%E8%A3%BD-init-%E5%92%8C%E4%BF%9D%E7%95%99-default-initializer-memberwise-initializer-18927569104e"><strong class="markup--strong markup--mixtapeEmbed-strong">利用 extension 同時客製 init 和保留 default initializer &amp; memberwise initializer</strong><br><em class="markup--em markup--mixtapeEmbed-em">當我們沒有定義任何 init 時，Swift 可以自動生成一些 init 方便我們生東西。比方 struct 會生成方便設定每個 property 的 memberwise initializer，而當 class &amp; struct 的…</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-extension-%E5%90%8C%E6%99%82%E5%AE%A2%E8%A3%BD-init-%E5%92%8C%E4%BF%9D%E7%95%99-default-initializer-memberwise-initializer-18927569104e" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="5328fe2b51951307ca1dd2442ad9ac71" data-thumbnail-img-id="1*ygiZCNYyzJzySmkjn-36dw.jpeg" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*ygiZCNYyzJzySmkjn-36dw.jpeg);"></a></div><pre name="68fe" id="68fe" class="graf graf--pre graf-after--mixtapeEmbed">class SongsTableViewController: UITableViewController {</pre><pre name="339d" id="339d" class="graf graf--pre graf-after--pre">    var songs = [Song]()</pre><p name="d0e7" id="d0e7" class="graf graf--p graf-after--pre">在 SongsTableViewController 裡定義 function getSongs。</p><p name="ee74" id="ee74" class="graf graf--p graf-after--p">方法一: 用 map 將 Firebase 的資料轉換成自訂型別。</p><pre name="ab82" id="ab82" class="graf graf--pre graf-after--p">func getSongs() {<br>        let db = Firestore.firestore()<br>        db.collection(&quot;songs&quot;).order(by: &quot;rate&quot;).addSnapshotListener { (querySnapshot, error) in<br>            guard let querySnapshot = querySnapshot else {<br>               return<br>            }<br>            <br>           <strong class="markup--strong markup--pre-strong"> self.songs = querySnapshot.documents.map {<br>                Song(dic: $0.data())<br>            }</strong><br>          <br>            self.tableView.reloadData()<br>        }<br>}</pre><p name="46e2" id="46e2" class="graf graf--p graf-after--pre">方法二: 用 <em class="markup--em markup--p-em">forEach</em> 將 Firebase 的資料轉換成自訂型別。</p><pre name="ecd1" id="ecd1" class="graf graf--pre graf-after--p">querySnapshot.documents.forEach { (songDoc) in<br>    let song = Song(dic: songDoc.data())<br>    self.songs.append(song)<br>}</pre><p name="9c57" id="9c57" class="graf graf--p graf-after--pre">方法三: 用 <em class="markup--em markup--p-em">for in </em>將 Firebase 的資料轉換成自訂型別。</p><pre name="deee" id="deee" class="graf graf--pre graf-after--p">for songDoc in querySnapshot.documents {<br>    let song = Song(dic: songDoc.data())<br>    self.songs.append(song)<br>}</pre><h4 name="4e03" id="4e03" class="graf graf--h4 graf-after--pre">分頁功能</h4><div name="e235" id="e235" class="graf graf--mixtapeEmbed graf-after--h4 graf--trailing"><a href="https://firebase.google.com/docs/firestore/query-data/query-cursors" data-href="https://firebase.google.com/docs/firestore/query-data/query-cursors" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://firebase.google.com/docs/firestore/query-data/query-cursors"><strong class="markup--strong markup--mixtapeEmbed-strong">Paginate data with query cursors | Firebase</strong><br><em class="markup--em markup--mixtapeEmbed-em">To add more granularity to your cursor&#39;s start or end point, you can specify multiple conditions in the cursor clause…</em>firebase.google.com</a><a href="https://firebase.google.com/docs/firestore/query-data/query-cursors" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="3a883af40812e2ce1d7d9ee33c17a21e" data-thumbnail-img-id="0*PFfCTigMgw3agIBQ" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*PFfCTigMgw3agIBQ);"></a></div></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@apppeterpan" class="p-author h-card">彼得潘的 iOS App Neverland</a> on <a href="https://medium.com/p/203bdcdb5661"><time class="dt-published" datetime="2019-05-18T09:27:08.776Z">May 18, 2019</time></a>.</p><p><a href="https://medium.com/@apppeterpan/%E8%AE%80%E5%8F%96-cloud-firestore-%E7%9A%84-database-203bdcdb5661" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on September 17, 2025.</p></footer></article></body></html>