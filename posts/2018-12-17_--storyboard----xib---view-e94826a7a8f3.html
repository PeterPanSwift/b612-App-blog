<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>在 storyboard 加入 xib 的 view</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">在 storyboard 加入 xib 的 view</h1>
</header>
<section data-field="subtitle" class="p-summary">
開發 iOS App 時，我們時常遇到在多個頁面重覆出現的元件，比方顯示下載中的 loading view。此時較好的做法是利用 xib 設計這些重覆出現的元件，如此我們只要設計一次，之後即可在多個地方使用。
</section>
<section data-field="body" class="e-content">
<section name="0718" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="4fa7" id="4fa7" class="graf graf--h3 graf--leading graf--title">在 storyboard 加入 xib 的 view</h3><p name="dc51" id="dc51" class="graf graf--p graf-after--h3">開發 iOS App 時，我們時常遇到在多個頁面重覆出現的元件，比方顯示下載中的 loading view。此時較好的做法是利用 xib 設計這些重覆出現的元件，如此我們只要設計一次，之後即可在多個地方使用。</p><p name="873c" id="873c" class="graf graf--p graf-after--p">不過我們常在 storyboard 設計 App 主要的畫面流程，有沒有方法直接在 storyboard 加入 xib 設計的畫面，而不用另外從程式加入呢 ?</p><p name="9a4a" id="9a4a" class="graf graf--p graf-after--p">有的，只要透過以下三個步驟即可實現。</p><ul class="postList"><li name="e03e" id="e03e" class="graf graf--li graf-after--p">自訂繼承 UIView 的類別 A。</li><li name="9bd8" id="9bd8" class="graf graf--li graf-after--li">在類別 A 的程式裡用 addSubview 加入 xib 設計的畫面。</li><li name="3035" id="3035" class="graf graf--li graf-after--li">在 storyboard 的 controller 畫面加入 View 元件，將元件的 class 設成類別 A。</li></ul><p name="6a0b" id="6a0b" class="graf graf--p graf-after--li">為什麼這樣就可以呢 ? 因為此時 View 元件的類別為 A，而類別 Ａ 的程式將貼上 xib 設計的畫面，因此 App 執行時， 畫面在顯示類別 Ａ 的元件時也會包含 xib 的畫面。</p><p name="e0c5" id="e0c5" class="graf graf--p graf-after--p">接下來就讓我們一步步在 storyboard 加入 xib 設計的彼得潘 loading view 吧。</p><blockquote name="842d" id="842d" class="graf graf--blockquote graf-after--p"><strong class="markup--strong markup--blockquote-strong">1 在 LoadingView.xib 設計 loading view。</strong></blockquote><figure name="6e25" id="6e25" class="graf graf--figure graf-after--blockquote"><img class="graf-image" data-image-id="1*JZ2NnT7OkrG9lLprzC9L4g.jpeg" data-width="1500" data-height="734" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*JZ2NnT7OkrG9lLprzC9L4g.jpeg"></figure><blockquote name="e641" id="e641" class="graf graf--blockquote graf-after--figure"><strong class="markup--strong markup--blockquote-strong">2 自訂繼承 UIView 的類別 LoadingView，然後將 xib 裡 View 元件的 class 設為 LoadingView。</strong></blockquote><pre name="eaa2" id="eaa2" class="graf graf--pre graf-after--blockquote">class LoadingView: UIView</pre><figure name="138d" id="138d" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*sxDJ_POgYct4k1LUWXdBlA.jpeg" data-width="850" data-height="422" src="https://cdn-images-1.medium.com/max/800/1*sxDJ_POgYct4k1LUWXdBlA.jpeg"></figure><p name="a012" id="a012" class="graf graf--p graf-after--figure">有了自訂的類別 LoadingView，之後即可將 xib 裡的元件拉 outlet 到 LoadingView，方便未來從程式控制。</p><p name="02a0" id="02a0" class="graf graf--p graf-after--p">接下來正式進入讓 storyboard 能加入 xib 畫面的關鍵步驟。</p><blockquote name="a975" id="a975" class="graf graf--blockquote graf-after--p"><strong class="markup--strong markup--blockquote-strong">3 自訂繼承 UIView 的類別 LoadingSuperview。</strong></blockquote><pre name="c723" id="c723" class="graf graf--pre graf-after--blockquote">class LoadingSuperview: UIView</pre><p name="fff5" id="fff5" class="graf graf--p graf-after--pre">我們將 class 命名為 LoadingSuperview，因為它將用 addSubview 加入 xib 設計的畫面，成為 LoadingView 元件的 superview。</p><blockquote name="8a13" id="8a13" class="graf graf--blockquote graf-after--p"><strong class="markup--strong markup--blockquote-strong">4 在 LoadingSuperview 裡定義 function addXibView 加入 xib 設計的畫面。</strong></blockquote><pre name="2254" id="2254" class="graf graf--pre graf-after--blockquote">func addXibView() {</pre><pre name="7c40" id="7c40" class="graf graf--pre graf-after--pre">   if let loadingView = Bundle(for: LoadingView.self).loadNibNamed(&quot;\(LoadingView.self)&quot;, owner: nil, options: nil)?.first as? UIView {</pre><pre name="e009" id="e009" class="graf graf--pre graf-after--pre">      addSubview(loadingView)</pre><pre name="3d0e" id="3d0e" class="graf graf--pre graf-after--pre">      loadingView.frame = bounds</pre><pre name="53df" id="53df" class="graf graf--pre graf-after--pre">   }</pre><pre name="6fac" id="6fac" class="graf graf--pre graf-after--pre">}</pre><p name="6e09" id="6e09" class="graf graf--p graf-after--pre">說明</p><p name="86b8" id="86b8" class="graf graf--p graf-after--p"><code class="markup--code markup--p-code">Bundle(for: LoadingView.self)</code></p><p name="94d2" id="94d2" class="graf graf--p graf-after--p">生成和 LoadingView 有關的 Bundle 物件。</p><p name="c334" id="c334" class="graf graf--p graf-after--p"><code class="markup--code markup--p-code">if let loadingView = Bundle(for: LoadingView.self).loadNibNamed(&quot;\(LoadingView.self)&quot;, owner: nil, options: nil)?.first as? UIView</code></p><p name="845b" id="845b" class="graf graf--p graf-after--p">loadNibNamed 將生成 xib 裡的元件。由於 xib 裡可能有多個元件，因此它將回傳型別 [Any]? 的 array。</p><pre name="c482" id="c482" class="graf graf--pre graf-after--p">func loadNibNamed(_ name: String, <br>            owner: Any?, <br>          options: [UINib.OptionsKey : Any]? = nil) -&gt; [Any]?</pre><div name="56fb" id="56fb" class="graf graf--mixtapeEmbed graf-after--pre"><a href="https://developer.apple.com/documentation/foundation/bundle/1618147-loadnibnamed" data-href="https://developer.apple.com/documentation/foundation/bundle/1618147-loadnibnamed" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/foundation/bundle/1618147-loadnibnamed"><strong class="markup--strong markup--mixtapeEmbed-strong">loadNibNamed(_:owner:options:) - Bundle | Apple Developer Documentation</strong><br><em class="markup--em markup--mixtapeEmbed-em">An array containing the top-level objects in the nib file. The array does not contain references to the File&#39;s Owner or…</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/foundation/bundle/1618147-loadnibnamed" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="c63feb7ac3a9b3aea18fe619ea9748ed"></a></div><p name="fa18" id="fa18" class="graf graf--p graf-after--mixtapeEmbed">LoadingView.xib 的內容如下圖，因此利用 array 的 first 即可取出我們想要的 Loading View 元件。</p><figure name="4a75" id="4a75" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*pKLO4N5lro9ojhDcTpOmUA.jpeg" data-width="848" data-height="402" src="https://cdn-images-1.medium.com/max/800/1*pKLO4N5lro9ojhDcTpOmUA.jpeg"></figure><p name="a495" id="a495" class="graf graf--p graf-after--figure"><code class="markup--code markup--p-code">loadingView.frame = bounds</code></p><p name="214b" id="214b" class="graf graf--p graf-after--p">讓 loadingView 和之後在 storyboard 貼上的 LoadingSuperview 元件一樣大。由於當初 xib 裡 loadingView 預設的 Autoresizing 如下，因此之後 LoadingSuperview 大小改變時，loadingView 也會跟著縮放調整大小。</p><figure name="1e06" id="1e06" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*MHp9znpBTkER7Ar4MLBhBQ.jpeg" data-width="1472" data-height="524" src="https://cdn-images-1.medium.com/max/800/1*MHp9znpBTkER7Ar4MLBhBQ.jpeg"></figure><p name="7f1b" id="7f1b" class="graf graf--p graf-after--figure">剛剛 <code class="markup--code markup--p-code">loadingView.frame = bounds</code>的方法搭配的技巧是 Autoresizing，比較習慣 Auto Layout 的朋友也可以在 addXibView 裡設定 Auto Layout 的條件。</p><blockquote name="9df5" id="9df5" class="graf graf--blockquote graf-after--p"><strong class="markup--strong markup--blockquote-strong">5 在 LoadingSuperview 裡定義 function awakeFromNib。</strong></blockquote><p name="36c1" id="36c1" class="graf graf--p graf-after--blockquote">awakeFromNib 將在 storyboard 裡的 LoadingSuperview 元件被載入時觸發，我們在 function 裡呼叫 addXibView 加入 xib 的 loading view。</p><pre name="c4b6" id="c4b6" class="graf graf--pre graf-after--p">override func awakeFromNib() {</pre><pre name="6130" id="6130" class="graf graf--pre graf-after--pre">   super.awakeFromNib()</pre><pre name="5791" id="5791" class="graf graf--pre graf-after--pre">   addXibView()</pre><pre name="96d1" id="96d1" class="graf graf--pre graf-after--pre">}</pre><blockquote name="b610" id="b610" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">6 在 storyboard 的多個畫面加入 View 元件，並將 View 的類別設為 LoadingSuperview。</strong></blockquote><figure name="72ec" id="72ec" class="graf graf--figure graf-after--blockquote"><img class="graf-image" data-image-id="1*lTWFTs7kMag3eqAkC6TNKA.jpeg" data-width="1278" data-height="906" src="https://cdn-images-1.medium.com/max/800/1*lTWFTs7kMag3eqAkC6TNKA.jpeg"></figure><figure name="60bc" id="60bc" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*lxllJ0nM80ILTkDPQ1Sykg.jpeg" data-width="598" data-height="244" src="https://cdn-images-1.medium.com/max/800/1*lxllJ0nM80ILTkDPQ1Sykg.jpeg"></figure><p name="fdc8" id="fdc8" class="graf graf--p graf-after--figure">是時候啟動 App 了 ! 如下圖所示，以下兩個畫面我們都可看到 xib 設計的彼得潘 loading view。</p></div><div class="section-inner sectionLayout--outsetRow" data-paragraph-count="2"><figure name="251f" id="251f" class="graf graf--figure graf--layoutOutsetRow is-partialWidth graf-after--p" style="width: 50%;"><img class="graf-image" data-image-id="1*lIs5oKwl7kd7PtZa5Q3OFA.jpeg" data-width="846" data-height="1446" src="https://cdn-images-1.medium.com/max/600/1*lIs5oKwl7kd7PtZa5Q3OFA.jpeg"></figure><figure name="9a0f" id="9a0f" class="graf graf--figure graf--layoutOutsetRowContinue is-partialWidth graf-after--figure" style="width: 50%;"><img class="graf-image" data-image-id="1*cQ6g14xkqlOcdi6rRlD_jQ.jpeg" data-width="846" data-height="1446" src="https://cdn-images-1.medium.com/max/600/1*cQ6g14xkqlOcdi6rRlD_jQ.jpeg"></figure></div><div class="section-inner sectionLayout--insetColumn"><p name="33af" id="33af" class="graf graf--p graf-after--figure">Jobs 常說 One more thing，我們也來跟他學習吧。One more thing，有沒有可能在 storyboard 看到 xib 設計的畫面，不用等 App 啟動呢 ?</p><figure name="456f" id="456f" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*j76FZDNvNT4YkUA0nMl4iQ.jpeg" data-width="914" data-height="644" src="https://cdn-images-1.medium.com/max/800/1*j76FZDNvNT4YkUA0nMl4iQ.jpeg"></figure><p name="5b1f" id="5b1f" class="graf graf--p graf-after--figure">當然可以呀。別忘了 UI 元件加上 @IBDesignable 後即可在 Interface Builder 顯示程式客製的內容。因此我們將 class LoadingSuperview 加上 @IBDesignable。</p><pre name="9629" id="9629" class="graf graf--pre graf-after--p">@IBDesignable class LoadingSuperview: UIView {</pre><p name="46bd" id="46bd" class="graf graf--p graf-after--pre">不過 LoadingSuperview 原本在 awakeFromNib 裡加入 xib，但 awakeFromNib 在 App 執行時才會呼叫。為了能在 storyboard 顯示時加入 xib，我們需要定義另一個 function，prepareForInterfaceBuilder</p><pre name="9c8e" id="9c8e" class="graf graf--pre graf-after--p">@IBDesignable class LoadingSuperview: UIView {</pre><pre name="1a63" id="1a63" class="graf graf--pre graf-after--pre">   override func prepareForInterfaceBuilder() {</pre><pre name="e832" id="e832" class="graf graf--pre graf-after--pre">      super.prepareForInterfaceBuilder()</pre><pre name="bfba" id="bfba" class="graf graf--pre graf-after--pre">      addXibView()</pre><pre name="fd92" id="fd92" class="graf graf--pre graf-after--pre">   }</pre><div name="a577" id="a577" class="graf graf--mixtapeEmbed graf-after--pre"><a href="https://developer.apple.com/documentation/objectivec/nsobject/1402908-prepareforinterfacebuilder" data-href="https://developer.apple.com/documentation/objectivec/nsobject/1402908-prepareforinterfacebuilder" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/objectivec/nsobject/1402908-prepareforinterfacebuilder"><strong class="markup--strong markup--mixtapeEmbed-strong">prepareForInterfaceBuilder() - NSObject | Apple Developer Documentation</strong><br><em class="markup--em markup--mixtapeEmbed-em">Interface Builder waits until all objects in a graph have been created and initialized before calling this method. So…</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/objectivec/nsobject/1402908-prepareforinterfacebuilder" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="4da218831622ec949ff1537351fd8187"></a></div><p name="88a0" id="88a0" class="graf graf--p graf-after--mixtapeEmbed">prepareForInterfaceBuilder 的名字明白告訴我們，它是為了 Interface Builder 存在的 function，就像聖誕老公公是為了聖誕禮物存在一樣。此 function 並不影響 App 的執行，它只在 Interface Builder 顯示元件時執行，方便我們從程式指定元件在 Interface Builder 顯示的內容。</p><p name="b3c6" id="b3c6" class="graf graf--p graf-after--p">因此我們在裡面呼叫 addXibView，然後再切回 storyboard 的畫面。</p><p name="450e" id="450e" class="graf graf--p graf-after--p">Cool ! 即使 App 沒執行，storyboard 依然能顯示 xib 設計的彼得潘 loading view。</p><figure name="b6dc" id="b6dc" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*s0yLShqx7EqahgGL1IQ-NQ.jpeg" data-width="1168" data-height="996" src="https://cdn-images-1.medium.com/max/800/1*s0yLShqx7EqahgGL1IQ-NQ.jpeg"></figure><div name="2350" id="2350" class="graf graf--mixtapeEmbed graf-after--figure"><a href="https://github.com/AppPeterPan/AddXibViewOnStoryboard" data-href="https://github.com/AppPeterPan/AddXibViewOnStoryboard" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://github.com/AppPeterPan/AddXibViewOnStoryboard"><strong class="markup--strong markup--mixtapeEmbed-strong">AppPeterPan/AddXibViewOnStoryboard</strong><br><em class="markup--em markup--mixtapeEmbed-em">Contribute to AppPeterPan/AddXibViewOnStoryboard development by creating an account on GitHub.</em>github.com</a><a href="https://github.com/AppPeterPan/AddXibViewOnStoryboard" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="852d8461cfbb4156542598a2f1735b68" data-thumbnail-img-id="0*l6ryU01c0Vd_jz_J" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*l6ryU01c0Vd_jz_J);"></a></div><p name="60be" id="60be" class="graf graf--p graf-after--mixtapeEmbed">ps: 也許有人對 Bundle 的程式有疑問，好奇為何要用 Bundle(for: LoadingView.self)，不用 Bundle.main 產生 Bundle ?</p><p name="8f18" id="8f18" class="graf graf--p graf-after--p">基本上用 Bundle.main 也可以，在 App 執行時可看到一樣的結果。不過 storyboard 顯示時會出問題，出現以下的錯誤訊息:</p><pre name="917c" id="917c" class="graf graf--pre graf-after--p">Main.storyboard: error: IB Designables: Failed to render and update auto layout status for UITableViewController</pre><figure name="19bf" id="19bf" class="graf graf--figure graf-after--pre graf--trailing"><img class="graf-image" data-image-id="1*52b88pdnRCcqZGhaqeR1ww.jpeg" data-width="1640" data-height="646" src="https://cdn-images-1.medium.com/max/800/1*52b88pdnRCcqZGhaqeR1ww.jpeg"></figure></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@apppeterpan" class="p-author h-card">彼得潘的 iOS App Neverland</a> on <a href="https://medium.com/p/e94826a7a8f3"><time class="dt-published" datetime="2018-12-17T06:43:13.484Z">December 17, 2018</time></a>.</p><p><a href="https://medium.com/@apppeterpan/%E5%9C%A8-storyboard-%E5%8A%A0%E5%85%A5-xib-%E7%9A%84-view-e94826a7a8f3" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on November 16, 2025.</p></footer></article></body></html>