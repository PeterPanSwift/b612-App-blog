<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Swift 方便存取 property      的 KeyPath &amp; KeyPath as Functions</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Swift 方便存取 property      的 KeyPath &amp; KeyPath as Functions</h1>
</header>
<section data-field="subtitle" class="p-summary">
Swift 的 KeyPath 可以指定某個 property 或 subscript，方便我們存取資料的 property 或 subscript，接下來就讓我們以 Song 為例，看看它特別的地方吧。
</section>
<section data-field="body" class="e-content">
<section name="af9f" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="f341" id="f341" class="graf graf--h3 graf--leading graf--title">Swift 方便存取 property 的 KeyPath &amp; KeyPath as Functions</h3><p name="85b9" id="85b9" class="graf graf--p graf-after--h3">Swift 的 KeyPath 可以指定某個 property 或 subscript，方便我們存取資料的 property 或 subscript，接下來就讓我們以 Song 為例，看看它特別的地方吧。</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="php" name="3206" id="3206" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">struct Song {<br />    <span class="hljs-keyword">var</span> name: String<br />    <span class="hljs-keyword">var</span> genre: String<br />}<br /><span class="hljs-keyword">var</span> favoriteSong = <span class="hljs-title function_ invoke__">Song</span>(<span class="hljs-attr">name</span>: <span class="hljs-string">&quot;小幸運&quot;</span>, <span class="hljs-attr">genre</span>: <span class="hljs-string">&quot;抒情&quot;</span>)<br /><span class="hljs-keyword">print</span>(favoriteSong.name)</span></pre><h3 name="ae31" id="ae31" class="graf graf--h3 graf-after--pre">存取 property</h3><p name="07e9" id="07e9" class="graf graf--p graf-after--h3">我們可以用 favoriteSong.name 讀取歌曲的名字，但也可以改成以下 KeyPath 的方法讀取。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="13f5" id="13f5" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> name <span class="hljs-operator">=</span> \<span class="hljs-type">Song</span>.name<br /><span class="hljs-built_in">print</span>(favoriteSong[keyPath: name])</span></pre><p name="3a3b" id="3a3b" class="graf graf--p graf-after--pre">說明</p><ul class="postList"><li name="dcb3" id="dcb3" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">描述 KeyPath</strong></li></ul><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="883e" id="883e" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> name <span class="hljs-operator">=</span> \<span class="hljs-type">Song</span>.name</span></pre><p name="950c" id="950c" class="graf graf--p graf-after--pre">KeyPath 的標準寫法是 \ + 型別. + property。</p><figure name="d317" id="d317" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*7wO5xdSMf6_SpJ8LWnqPMA.jpeg" data-width="1596" data-height="332" src="https://cdn-images-1.medium.com/max/800/1*7wO5xdSMf6_SpJ8LWnqPMA.jpeg"></figure><p name="bd97" id="bd97" class="graf graf--p graf-after--figure"><code class="markup--code markup--p-code">\Song.name</code> 表示型別 Song 的 property name。輸入 KeyPath 時 Xcode 也會貼心地提供自動完成，因此打完 \Song. 後，它會自動列出 property genre &amp; name。</p><figure name="ae94" id="ae94" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*azkXMQ0RQYyHD1EYkzdeWg.jpeg" data-width="1014" data-height="258" src="https://cdn-images-1.medium.com/max/800/1*azkXMQ0RQYyHD1EYkzdeWg.jpeg"></figure><p name="6e48" id="6e48" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">利用 KeyPath 讀取 property。</strong></p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="40c9" id="40c9" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-built_in">print</span>(favoriteSong[keyPath: name])</span></pre><p name="0639" id="0639" class="graf graf--p graf-after--pre">在 favoriteSong 後加上 [ ]，然後在參數 keyPath 後傳入 name 讀取 favoriteSong 的 song。</p><figure name="c61d" id="c61d" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*7KzXS-4smZpC7ixv-WnbpA.jpeg" data-width="1262" data-height="310" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*7KzXS-4smZpC7ixv-WnbpA.jpeg"></figure><figure name="4b2c" id="4b2c" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*Bx7a2K2odwQb34aDxtIGNw.jpeg" data-width="1416" data-height="138" src="https://cdn-images-1.medium.com/max/800/1*Bx7a2K2odwQb34aDxtIGNw.jpeg"></figure><p name="5c52" id="5c52" class="graf graf--p graf-after--figure">我們也可以在參數 keyPath: 後直接傳入 <code class="markup--code markup--p-code">\Song.name</code>，描述想要讀取的 property。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="998a" id="998a" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-built_in">print</span>(favoriteSong[keyPath: \<span class="hljs-type">Song</span>.name])</span></pre><p name="4bce" id="4bce" class="graf graf--p graf-after--pre">甚至我們還可以省略 Song，輸入 <code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">\.name</strong></code>。</p><figure name="d8e9" id="d8e9" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*fNZ_tZEf7SJEGoljlVXDJg.jpeg" data-width="1372" data-height="246" src="https://cdn-images-1.medium.com/max/800/1*fNZ_tZEf7SJEGoljlVXDJg.jpeg"></figure><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="ac14" id="ac14" class="graf graf--pre graf-after--figure graf--preV2"><span class="pre--content"><span class="hljs-built_in">print</span>(favoriteSong[keyPath: \.name])</span></pre><h3 name="657d" id="657d" class="graf graf--h3 graf-after--pre"><strong class="markup--strong markup--h3-strong">KeyPath 的型別</strong></h3><p name="35d2" id="35d2" class="graf graf--p graf-after--h3">如下圖所示，name 是型別是 WritableKeyPath&lt;Song, String&gt;。</p><figure name="d713" id="d713" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*C90SIKklCKOJznys7O2JZw.jpeg" data-width="1080" data-height="382" src="https://cdn-images-1.medium.com/max/800/1*C90SIKklCKOJznys7O2JZw.jpeg"></figure><p name="b615" id="b615" class="graf graf--p graf-after--figure">WritableKeyPath 表示它是可以讀取和寫入的 KeyPath。從以下 WritableKeyPath 的定義，我們看出它有兩個 generic 型別代號，Root &amp; Value，Root 代表資料的型別，Value 代表 property 的型別，因此 \Song.name 的型別為 WritableKeyPath&lt;Song, String&gt;，表示從 Song 裡讀取的 name 為 String。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="d0af" id="d0af" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">class</span> <span class="hljs-title class_">WritableKeyPath</span>&lt;<span class="hljs-title class_">Root</span>, <span class="hljs-title class_">Value</span>&gt; : <span class="hljs-title class_">KeyPath</span>&lt;<span class="hljs-title class_">Root</span>, <span class="hljs-title class_">Value</span>&gt;</span></pre><div name="dac5" id="dac5" class="graf graf--mixtapeEmbed graf-after--pre"><a href="https://developer.apple.com/documentation/swift/writablekeypath" data-href="https://developer.apple.com/documentation/swift/writablekeypath" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/swift/writablekeypath"><strong class="markup--strong markup--mixtapeEmbed-strong">WritableKeyPath</strong><br><em class="markup--em markup--mixtapeEmbed-em">A key path that supports reading from and writing to the resulting value.</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/swift/writablekeypath" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="4946b1a97b165648577a7d30c782efef"></a></div><div name="3dc3" id="3dc3" class="graf graf--mixtapeEmbed graf-after--mixtapeEmbed"><a href="https://developer.apple.com/documentation/swift/keypath" data-href="https://developer.apple.com/documentation/swift/keypath" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/swift/keypath"><strong class="markup--strong markup--mixtapeEmbed-strong">KeyPath</strong><br><em class="markup--em markup--mixtapeEmbed-em">A partially type-erased key path, from a concrete root type to any resulting value type. A type-erased key path, from…</em>developer.apple.co</a><a href="https://developer.apple.com/documentation/swift/keypath" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="28328563e4e7244a4ad255a5c1531c4a"></a></div><h3 name="e412" id="e412" class="graf graf--h3 graf-after--mixtapeEmbed">存取 subscript</h3><p name="04f7" id="04f7" class="graf graf--p graf-after--h3">KeyPath 也可以存取 subscript，例如以下 array &amp; dictionary 的例子。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="f9a2" id="f9a2" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">var</span> favoriteSongs <span class="hljs-operator">=</span> [<br />    <span class="hljs-type">Song</span>(name: <span class="hljs-string">&quot;小幸運&quot;</span>, genre: <span class="hljs-string">&quot;抒情&quot;</span>),<br />    <span class="hljs-type">Song</span>(name: <span class="hljs-string">&quot;漂向北方&quot;</span>, genre: <span class="hljs-string">&quot;饒舌&quot;</span>)<br />]</span></pre><p name="6691" id="6691" class="graf graf--p graf-after--pre">傳入 <code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">\[Song].[1]</strong></code>。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="9423" id="9423" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">var</span> song <span class="hljs-operator">=</span> favoriteSongs[keyPath: \[<span class="hljs-type">Song</span>].[<span class="hljs-number">1</span>]]</span></pre><p name="c093" id="c093" class="graf graf--p graf-after--pre">傳入<code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong"> \.[1]</strong></code>。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="d8ed" id="d8ed" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">var</span> song <span class="hljs-operator">=</span> favoriteSongs[keyPath: \.[<span class="hljs-number">1</span>]]</span></pre><p name="91a8" id="91a8" class="graf graf--p graf-after--pre">dictionary 的例子。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="af4d" id="af4d" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">var</span> favoriteSongDic <span class="hljs-operator">=</span> [<br />    <span class="hljs-string">&quot;田馥甄&quot;</span>: <span class="hljs-type">Song</span>(name: <span class="hljs-string">&quot;小幸運&quot;</span>, genre: <span class="hljs-string">&quot;抒情&quot;</span>),<br />    <span class="hljs-string">&quot;黃明志王力宏&quot;</span>: <span class="hljs-type">Song</span>(name: <span class="hljs-string">&quot;漂向北方&quot;</span>, genre: <span class="hljs-string">&quot;饒舌&quot;</span>)<br />]</span></pre><p name="b5e4" id="b5e4" class="graf graf--p graf-after--pre">傳入 <code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">\[String: Song].[&quot;田馥甄&quot;]</strong></code>。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="41ca" id="41ca" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">var</span> song <span class="hljs-operator">=</span> favoriteSongDic[keyPath: \[<span class="hljs-type">String</span>: <span class="hljs-type">Song</span>].[<span class="hljs-string">&quot;田馥甄&quot;</span>]]</span></pre><p name="cd06" id="cd06" class="graf graf--p graf-after--pre">傳入<code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong"> \.[&quot;田馥甄&quot;]</strong></code>。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="7b57" id="7b57" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">var</span> song <span class="hljs-operator">=</span> favoriteSongDic[keyPath: \.[<span class="hljs-string">&quot;田馥甄&quot;</span>]]</span></pre><h3 name="265d" id="265d" class="graf graf--h3 graf-after--pre">KeyPath as Functions</h3><p name="bf97" id="bf97" class="graf graf--p graf-after--h3">KeyPath 有很多方便的地方，比方它可以當成 function 參數傳入。</p><p name="fc4c" id="fc4c" class="graf graf--p graf-after--p">接下來我們以存取經典的文學名著說明。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="a264" id="a264" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Book</span> {<br />    <span class="hljs-keyword">var</span> name: <span class="hljs-type">String</span><br />    <span class="hljs-keyword">var</span> character: <span class="hljs-type">String</span><br />    <span class="hljs-keyword">var</span> year: <span class="hljs-type">Int</span><br />}<br /><span class="hljs-keyword">var</span> books <span class="hljs-operator">=</span> [<br />    <span class="hljs-type">Book</span>(name: <span class="hljs-string">&quot;愛麗絲夢遊仙境&quot;</span>, character: <span class="hljs-string">&quot;愛麗絲&quot;</span>, year: <span class="hljs-number">1865</span>),<br />    <span class="hljs-type">Book</span>(name: <span class="hljs-string">&quot;湯姆歷險記&quot;</span>, character: <span class="hljs-string">&quot;湯姆&quot;</span>, year: <span class="hljs-number">1876</span>),<br />    <span class="hljs-type">Book</span>(name: <span class="hljs-string">&quot;唐‧吉訶德&quot;</span>, character: <span class="hljs-string">&quot;唐‧吉訶德&quot;</span>, year: <span class="hljs-number">1605</span>)<br />]</span></pre><ul class="postList"><li name="09a7" id="09a7" class="graf graf--li graf-after--pre"><strong class="markup--strong markup--li-strong">map</strong></li></ul><p name="9c19" id="9c19" class="graf graf--p graf-after--li">傳統寫法: 利用 map 搭配 closure 取得書本主角名稱的 array。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="b038" id="b038" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> characters <span class="hljs-operator">=</span> books.map { <span class="hljs-variable">$0</span>.character }</span></pre><figure name="08ea" id="08ea" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*lY6468kTcbEK5jjxlvUx5g.jpeg" data-width="516" data-height="352" src="https://cdn-images-1.medium.com/max/800/1*lY6468kTcbEK5jjxlvUx5g.jpeg"></figure><p name="6387" id="6387" class="graf graf--p graf-after--figure">map 的參數型別是 function 型別，因此我們傳入 closure <code class="markup--code markup--p-code">{ $0.character }</code>。</p><figure name="4a4f" id="4a4f" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*uyTPmFB9_GMlaYcfc1Nz1Q.jpeg" data-width="1136" data-height="134" src="https://cdn-images-1.medium.com/max/800/1*uyTPmFB9_GMlaYcfc1Nz1Q.jpeg"></figure><p name="1ac1" id="1ac1" class="graf graf--p graf-after--figure">當參數的型別是 (Root) -&gt; Value 時，我們可以傳入 KeyPath，表示回傳的內容為 Root 型別資料下的 property。在剛剛的例子，Root 型別為 Book，因此我們可傳入<code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong"> \.character</strong></code>，表示回傳書本的角色名字。</p><figure name="aa35" id="aa35" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*2syFtjTOdLyoRxCMJlD48A.jpeg" data-width="1712" data-height="424" src="https://cdn-images-1.medium.com/max/800/1*2syFtjTOdLyoRxCMJlD48A.jpeg"></figure><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="f919" id="f919" class="graf graf--pre graf-after--figure graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> characters <span class="hljs-operator">=</span> books.map(\.character)</span></pre><p name="2065" id="2065" class="graf graf--p graf-after--pre">當我們想用 print 印出 array 成員的某個 property 時，KeyPath 的寫法也很方便。</p><ul class="postList"><li name="e4db" id="e4db" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">filter</strong></li></ul><p name="edfa" id="edfa" class="graf graf--p graf-after--li">KeyPath 也可以多層串聯，以下程式的 <code class="markup--code markup--p-code">print(babies.map(\.rabbit.name)) </code>將印出 <code class="markup--code markup--p-code">[&quot;彼得兔&quot;, &quot;米菲兔&quot;]</code>。</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="php" name="8169" id="8169" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><br />struct Rabbit {<br />    let name: String<br />}<br /><br />struct Baby {<br />    let name: String<br />    let age: Int<br />    let rabbit: Rabbit<br />}<br /><br /><span class="hljs-keyword">var</span> babies = [<br />    <span class="hljs-title function_ invoke__">Baby</span>(<span class="hljs-attr">name</span>: <span class="hljs-string">&quot;彼得潘&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">rabbit</span>: <span class="hljs-title function_ invoke__">Rabbit</span>(<span class="hljs-attr">name</span>: <span class="hljs-string">&quot;彼得兔&quot;</span>)),<br />    <span class="hljs-title function_ invoke__">Baby</span>(<span class="hljs-attr">name</span>: <span class="hljs-string">&quot;虎克船長&quot;</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">rabbit</span>: <span class="hljs-title function_ invoke__">Rabbit</span>(<span class="hljs-attr">name</span>: <span class="hljs-string">&quot;米菲兔&quot;</span>))<br />]<br /><br /><span class="hljs-keyword">print</span>(babies.<span class="hljs-title function_ invoke__">map</span>(\.rabbit.name))</span></pre><ul class="postList"><li name="2e68" id="2e68" class="graf graf--li graf-after--pre"><strong class="markup--strong markup--li-strong">filter</strong></li></ul><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="9b5d" id="9b5d" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> booksAfter1800 <span class="hljs-operator">=</span> books.filter { <span class="hljs-variable">$0</span>.year <span class="hljs-operator">&gt;=</span> <span class="hljs-number">1800</span> }</span></pre><figure name="f1b7" id="f1b7" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*ApCsGH-RpZtqqPJHPC2eQQ.jpeg" data-width="1342" data-height="260" src="https://cdn-images-1.medium.com/max/800/1*ApCsGH-RpZtqqPJHPC2eQQ.jpeg"></figure><p name="ee31" id="ee31" class="graf graf--p graf-after--figure">filter 的參數必須回傳 Bool，為了傳入 KeyPath，我們在 Book 裡定義 computed property after1800。</p><figure name="6335" id="6335" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*uqGdYO3yIe_BR2U4ILanfQ.jpeg" data-width="1158" data-height="114" src="https://cdn-images-1.medium.com/max/800/1*uqGdYO3yIe_BR2U4ILanfQ.jpeg"></figure><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="99d0" id="99d0" class="graf graf--pre graf-after--figure graf--preV2"><span class="pre--content"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Book</span> {<br />    <span class="hljs-keyword">var</span> name: <span class="hljs-type">String</span><br />    <span class="hljs-keyword">var</span> character: <span class="hljs-type">String</span><br />    <span class="hljs-keyword">var</span> year: <span class="hljs-type">Int</span><br />    <span class="hljs-keyword">var</span> after1800: <span class="hljs-type">Bool</span> {<br />        year <span class="hljs-operator">&gt;=</span> <span class="hljs-number">1800</span><br />    }<br />}<br /><span class="hljs-keyword">let</span> booksAfter1800 <span class="hljs-operator">=</span> books.filter(\.after1800)</span></pre><ul class="postList"><li name="4310" id="4310" class="graf graf--li graf-after--pre"><strong class="markup--strong markup--li-strong">compactMap</strong></li></ul><p name="67a0" id="67a0" class="graf graf--p graf-after--li">傳統寫法: 利用 compactMap 搭配 closure 取得有兔子的書的兔子名字。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="6a6b" id="6a6b" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Book</span> {<br />    <span class="hljs-keyword">var</span> name: <span class="hljs-type">String</span><br />    <span class="hljs-keyword">var</span> character: <span class="hljs-type">String</span><br />    <span class="hljs-keyword">var</span> year: <span class="hljs-type">Int</span><br />    <span class="hljs-keyword">var</span> rabbit: <span class="hljs-type">String</span>?<br />    <br />}<br /><span class="hljs-keyword">var</span> books <span class="hljs-operator">=</span> [<br />    <span class="hljs-type">Book</span>(name: <span class="hljs-string">&quot;愛麗絲夢遊仙境&quot;</span>, character: <span class="hljs-string">&quot;愛麗絲&quot;</span>, year: <span class="hljs-number">1865</span>, rabbit: <span class="hljs-string">&quot;白兔&quot;</span>),<br />    <span class="hljs-type">Book</span>(name: <span class="hljs-string">&quot;湯姆歷險記&quot;</span>, character: <span class="hljs-string">&quot;湯姆&quot;</span>, year: <span class="hljs-number">1876</span>),<br />    <span class="hljs-type">Book</span>(name: <span class="hljs-string">&quot;唐‧吉訶德&quot;</span>, character: <span class="hljs-string">&quot;唐‧吉訶德&quot;</span>, year: <span class="hljs-number">1605</span>)<br />]<br /><span class="hljs-keyword">let</span> rabbits <span class="hljs-operator">=</span> books.compactMap { <span class="hljs-variable">$0</span>.rabbit }</span></pre><figure name="5c72" id="5c72" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*xesBwegqu0fYTX9jamMdgQ.jpeg" data-width="388" data-height="196" src="https://cdn-images-1.medium.com/max/800/1*xesBwegqu0fYTX9jamMdgQ.jpeg"></figure><p name="6ffb" id="6ffb" class="graf graf--p graf-after--figure">compactMap 的參數如下，而 Book property rabbit 的型別是 String?，符合 compactMap 參數的回傳型別，因此我們傳入 <code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">\.rabbit</strong></code>。</p><figure name="d177" id="d177" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*hzRA4lfflDzClDTqizyQdw.jpeg" data-width="1476" data-height="92" src="https://cdn-images-1.medium.com/max/800/1*hzRA4lfflDzClDTqizyQdw.jpeg"></figure><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="7b46" id="7b46" class="graf graf--pre graf-after--figure graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> rabbits <span class="hljs-operator">=</span> books.compactMap(\.rabbit)</span></pre><div name="3b30" id="3b30" class="graf graf--mixtapeEmbed graf-after--pre"><a href="https://github.com/apple/swift-evolution/blob/master/proposals/0249-key-path-literal-function-expressions.md" data-href="https://github.com/apple/swift-evolution/blob/master/proposals/0249-key-path-literal-function-expressions.md" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://github.com/apple/swift-evolution/blob/master/proposals/0249-key-path-literal-function-expressions.md"><strong class="markup--strong markup--mixtapeEmbed-strong">apple/swift-evolution</strong><br><em class="markup--em markup--mixtapeEmbed-em">This proposal introduces the ability to use the key path expression \Root.value wherever functions of (Root) -&gt; Value…</em>github.com</a><a href="https://github.com/apple/swift-evolution/blob/master/proposals/0249-key-path-literal-function-expressions.md" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="43bb93a5d4ce5aca839555715d381adc" data-thumbnail-img-id="0*UMSgpenygsyWCqjy" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*UMSgpenygsyWCqjy);"></a></div><h3 name="f3c8" id="f3c8" class="graf graf--h3 graf-after--mixtapeEmbed">參考資料</h3><div name="82c0" id="82c0" class="graf graf--mixtapeEmbed graf-after--h3"><a href="https://docs.swift.org/swift-book/ReferenceManual/Expressions.html" data-href="https://docs.swift.org/swift-book/ReferenceManual/Expressions.html" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://docs.swift.org/swift-book/ReferenceManual/Expressions.html"><strong class="markup--strong markup--mixtapeEmbed-strong">Expressions - The Swift Programming Language (Swift 5.1)</strong><br><em class="markup--em markup--mixtapeEmbed-em">In Swift, there are four kinds of expressions: prefix expressions, binary expressions, primary expressions, and postfix…</em>docs.swift.org</a><a href="https://docs.swift.org/swift-book/ReferenceManual/Expressions.html" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="3b57b51beb1ce4115bc50609c87f9265"></a></div><div name="041a" id="041a" class="graf graf--mixtapeEmbed graf-after--mixtapeEmbed"><a href="https://www.hackingwithswift.com/example-code/language/what-are-keypaths" data-href="https://www.hackingwithswift.com/example-code/language/what-are-keypaths" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://www.hackingwithswift.com/example-code/language/what-are-keypaths"><strong class="markup--strong markup--mixtapeEmbed-strong">What are keypaths?</strong><br><em class="markup--em markup--mixtapeEmbed-em">Swift version: 5.1 Paul Hudson @twostraws Swift keypaths are a way of storing uninvoked references to properties, which…</em>www.hackingwithswift.com</a><a href="https://www.hackingwithswift.com/example-code/language/what-are-keypaths" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="5c925cdb96393a2349ceb6a656e1fccd" data-thumbnail-img-id="0*Jpxw1GWzdnX6UDsf" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*Jpxw1GWzdnX6UDsf);"></a></div><div name="bb7c" id="bb7c" class="graf graf--mixtapeEmbed graf-after--mixtapeEmbed"><a href="https://www.swiftbysundell.com/articles/the-power-of-key-paths-in-swift/" data-href="https://www.swiftbysundell.com/articles/the-power-of-key-paths-in-swift/" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://www.swiftbysundell.com/articles/the-power-of-key-paths-in-swift/"><strong class="markup--strong markup--mixtapeEmbed-strong">The power of key paths in Swift | Swift by Sundell</strong><br><em class="markup--em markup--mixtapeEmbed-em">Swift keeps gaining more and more features that are more dynamic in nature - while still retaining its focus on type…</em>www.swiftbysundell.com</a><a href="https://www.swiftbysundell.com/articles/the-power-of-key-paths-in-swift/" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="1ea00de1ee05b0c5e73daa8f3b4c4936" data-thumbnail-img-id="0*9NpA-ZawSCKItCSc" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*9NpA-ZawSCKItCSc);"></a></div><div name="e708" id="e708" class="graf graf--mixtapeEmbed graf-after--mixtapeEmbed graf--trailing"><a href="https://www.hackingwithswift.com/articles/57/how-swift-keypaths-let-us-write-more-natural-code" data-href="https://www.hackingwithswift.com/articles/57/how-swift-keypaths-let-us-write-more-natural-code" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://www.hackingwithswift.com/articles/57/how-swift-keypaths-let-us-write-more-natural-code"><strong class="markup--strong markup--mixtapeEmbed-strong">How Swift keypaths let us write more natural code</strong><br><em class="markup--em markup--mixtapeEmbed-em">Swift 4.0 introduced new keypath types as part of SE-0161, but it&#39;s fair to say a lot of folks either don&#39;t understand…</em>www.hackingwithswift.com</a><a href="https://www.hackingwithswift.com/articles/57/how-swift-keypaths-let-us-write-more-natural-code" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="a84fd5983e39cfbf8fe55a59caf5aac6" data-thumbnail-img-id="0*V_0rkChdYSdHT4Ia" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*V_0rkChdYSdHT4Ia);"></a></div></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@apppeterpan" class="p-author h-card">彼得潘的 iOS App Neverland</a> on <a href="https://medium.com/p/85778939c2fd"><time class="dt-published" datetime="2020-08-10T05:26:40.030Z">August 10, 2020</time></a>.</p><p><a href="https://medium.com/@apppeterpan/swift-%E6%96%B9%E4%BE%BF%E5%AD%98%E5%8F%96-property-%E7%9A%84-keypath-keypath-as-functions-85778939c2fd" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on September 17, 2025.</p></footer></article></body></html>