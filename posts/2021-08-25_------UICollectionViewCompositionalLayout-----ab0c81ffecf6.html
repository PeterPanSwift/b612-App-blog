<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>方便排版的 UICollectionViewCompositionalLayout 初體驗</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">方便排版的 UICollectionViewCompositionalLayout 初體驗</h1>
</header>
<section data-field="subtitle" class="p-summary">
從 iOS 13 開始，iOS SDK 推出了 UICollectionViewCompositionalLayout，幫助我們更方便排版 collection view 的內容。從前在 collection view 需要大費周章才能實現的排版，利用…
</section>
<section data-field="body" class="e-content">
<section name="7504" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="3f65" id="3f65" class="graf graf--h3 graf--leading graf--title">方便排版的 UICollectionViewCompositionalLayout 初體驗</h3><figure name="2fb8" id="2fb8" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="1*O7n6t4wwtXtwFq1naGBMuA.png" data-width="1478" data-height="976" src="https://cdn-images-1.medium.com/max/800/1*O7n6t4wwtXtwFq1naGBMuA.png"></figure><p name="fde9" id="fde9" class="graf graf--p graf-after--figure">從 iOS 13 開始，iOS SDK 推出了 UICollectionViewCompositionalLayout，幫助我們更方便排版 collection view 的內容。從前在 collection view 需要大費周章才能實現的排版，利用 UICollectionViewCompositionalLayout 只要幾行程式就能搞定。除了簡單的格子狀照片牆排版，UICollectionViewCompositionalLayout 還能實現一些複雜的畫面。</p><p name="b45c" id="b45c" class="graf graf--p graf-after--p">以下圖的 App Store 為例，UICollectionViewCompositionalLayout 可幫我們克服畫面裡的兩大難題。</p><ul class="postList"><li name="5663" id="5663" class="graf graf--li graf-after--p">整個 collection view 上下滑動，裡面的內容可左右滑動。</li><li name="3589" id="3589" class="graf graf--li graf-after--li">分頁滑動區塊會露出前一個和下一個的部分內容。</li></ul><figure name="f00f" id="f00f" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*36VeALbHiaR_9i2G-WaPuw.png" data-width="1125" data-height="2436" src="https://cdn-images-1.medium.com/max/800/1*36VeALbHiaR_9i2G-WaPuw.png"></figure><p name="5293" id="5293" class="graf graf--p graf-after--figure">接下來就讓我們以熱血的聖鬥士星矢漫畫封面為例，一步步從零開始認識 UICollectionViewCompositionalLayout。</p><h3 name="bb24" id="bb24" class="graf graf--h3 graf-after--p">文章重點整理</h3><ul class="postList"><li name="c326" id="c326" class="graf graf--li graf-after--h3">將 collection view 的 collectionViewLayout 改成 compositional layout</li><li name="dc78" id="dc78" class="graf graf--li graf-after--li">Item，Group，Section &amp; 固定大小的 absolute</li><li name="9c96" id="9c96" class="graf graf--li graf-after--li">控制 item 排列方向的 NSCollectionLayoutGroup.vertical &amp; NSCollectionLayoutGroup.horizontal</li><li name="e774" id="e774" class="graf graf--li graf-after--li">依比例設定 item &amp; group 大小的 fractionalWidth &amp; fractionalHeight，比方格子狀照片牆(grid)</li><li name="dff0" id="dff0" class="graf graf--li graf-after--li">自動計算合適大小的 estimated</li><li name="a3e2" id="a3e2" class="graf graf--li graf-after--li">設定間距</li><li name="57c6" id="57c6" class="graf graf--li graf-after--li">控制內容的捲動方向</li><li name="fbff" id="fbff" class="graf graf--li graf-after--li">控制捲動行為的 orthogonalScrollingBehavior，分頁和露出前一個 / 下一個的部分內容</li><li name="3b72" id="3b72" class="graf graf--li graf-after--li">每個 section 採用不同的排版，比方整個頁面垂直捲動，頁面裡有水平捲動的區塊</li></ul><h3 name="9bb8" id="9bb8" class="graf graf--h3 graf-after--li">設定 UICollectionViewCompositionalLayout 前的準備</h3><h4 name="196f" id="196f" class="graf graf--h4 graf-after--h3">1. storyboard 畫面設計</h4><figure name="9649" id="9649" class="graf graf--figure graf-after--h4"><img class="graf-image" data-image-id="1*waEaXYFhEyiUOBBFyXPegQ.png" data-width="1178" data-height="860" src="https://cdn-images-1.medium.com/max/800/1*waEaXYFhEyiUOBBFyXPegQ.png"></figure><ul class="postList"><li name="3fe6" id="3fe6" class="graf graf--li graf-after--figure">collection view 的寬度為螢幕寬度，高度為 300。</li><li name="d705" id="d705" class="graf graf--li graf-after--li">collection view 的 data source 為 view controller。</li><li name="e276" id="e276" class="graf graf--li graf-after--li">cell 裡裝 image view，image view 佔滿 cell，image view 的大小等於 cell 的大小。</li><li name="792c" id="792c" class="graf graf--li graf-after--li">cell 大小設為 100 * 137，cell 之間的間距 10。</li></ul><figure name="dd02" id="dd02" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*Ub6rXFVvE5C4NRUJhYiLAg.png" data-width="526" data-height="628" src="https://cdn-images-1.medium.com/max/800/1*Ub6rXFVvE5C4NRUJhYiLAg.png"></figure><ul class="postList"><li name="6346" id="6346" class="graf graf--li graf-after--figure">cell 的類別 &amp; reuse id 為 CollectionViewCell，連結 image view 的 outlet。</li></ul><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="dd67" id="dd67" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CollectionViewCell</span>: <span class="hljs-title class_">UICollectionViewCell</span> {<br />    <span class="hljs-keyword">@IBOutlet</span> <span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> imageView: <span class="hljs-type">UIImageView</span>!<br />    <br />}</span></pre><h4 name="022e" id="022e" class="graf graf--h4 graf-after--pre">2. 設定 cell 的數量和內容，連結 collection view 的 outlet</h4><ul class="postList"><li name="0219" id="0219" class="graf graf--li graf-after--h4"><strong class="markup--strong markup--li-strong">方法 1: 定義 UICollectionViewDataSource 的相關 function</strong></li></ul><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="81ae" id="81ae" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewController</span>: <span class="hljs-title class_">UIViewController</span> {<br />   <span class="hljs-keyword">@IBOutlet</span> <span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> collectionView: <span class="hljs-type">UICollectionView</span>!<br />}<br /><br /><span class="hljs-keyword">extension</span> <span class="hljs-title class_">ViewController</span>: <span class="hljs-title class_">UICollectionViewDataSource</span> {<br /><br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">collectionView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">collectionView</span>: <span class="hljs-type">UICollectionView</span>, <span class="hljs-params">numberOfItemsInSection</span> <span class="hljs-params">section</span>: <span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">Int</span> {<br />        <span class="hljs-keyword">return</span> <span class="hljs-number">15</span><br />    }<br />    <br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">collectionView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">collectionView</span>: <span class="hljs-type">UICollectionView</span>, <span class="hljs-params">cellForItemAt</span> <span class="hljs-params">indexPath</span>: <span class="hljs-type">IndexPath</span>) -&gt; <span class="hljs-type">UICollectionViewCell</span> {<br />        <span class="hljs-keyword">let</span> cell <span class="hljs-operator">=</span> collectionView.dequeueReusableCell(withReuseIdentifier: <span class="hljs-string">&quot;<span class="hljs-subst">\(CollectionViewCell.<span class="hljs-keyword">self</span>)</span>&quot;</span>, for: indexPath) <span class="hljs-keyword">as!</span> <span class="hljs-type">CollectionViewCell</span><br />        cell.imageView.image <span class="hljs-operator">=</span> <span class="hljs-type">UIImage</span>(named: <span class="hljs-string">&quot;聖鬥士星矢<span class="hljs-subst">\(indexPath.item <span class="hljs-operator">+</span> <span class="hljs-number">1</span>)</span>&quot;</span>)<br />        <span class="hljs-keyword">return</span> cell<br />    }<br />    <br />}</span></pre><ul class="postList"><li name="a4c2" id="a4c2" class="graf graf--li graf-after--pre"><strong class="markup--strong markup--li-strong">方法 2: 使用 UICollectionViewDiffableDataSource</strong></li></ul><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="e17c" id="e17c" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewController</span>: <span class="hljs-title class_">UIViewController</span> {<br />    <br />    <span class="hljs-keyword">@IBOutlet</span> <span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> collectionView: <span class="hljs-type">UICollectionView</span>!<br />    <span class="hljs-keyword">var</span> dataSource: <span class="hljs-type">UICollectionViewDiffableDataSource</span>&lt;<span class="hljs-type">Int</span>, <span class="hljs-type">Int</span>&gt;!<br />    <br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {<br />        <span class="hljs-keyword">super</span>.viewDidLoad()<br />        createDataSource()<br />        createSnapshot()<br />    }<br />    <br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">createSnapshot</span>() {<br />        <span class="hljs-keyword">var</span> snapshot <span class="hljs-operator">=</span> <span class="hljs-type">NSDiffableDataSourceSnapshot</span>&lt;<span class="hljs-type">Int</span>, <span class="hljs-type">Int</span>&gt;()<br />        snapshot.appendSections([<span class="hljs-number">0</span>])<br />        snapshot.appendItems(<span class="hljs-type">Array</span>(<span class="hljs-number">0</span><span class="hljs-operator">...</span><span class="hljs-number">14</span>))<br />        dataSource.apply(snapshot, animatingDifferences: <span class="hljs-literal">false</span>)<br />    }<br />    <br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">createDataSource</span>() {<br />        dataSource <span class="hljs-operator">=</span> <span class="hljs-type">UICollectionViewDiffableDataSource</span>(collectionView: collectionView, cellProvider: { collectionView, indexPath, itemIdentifier <span class="hljs-keyword">in</span><br />            <span class="hljs-keyword">let</span> cell <span class="hljs-operator">=</span> collectionView.dequeueReusableCell(withReuseIdentifier: <span class="hljs-string">&quot;<span class="hljs-subst">\(CollectionViewCell.<span class="hljs-keyword">self</span>)</span>&quot;</span>, for: indexPath) <span class="hljs-keyword">as!</span> <span class="hljs-type">CollectionViewCell</span><br />            cell.imageView.image <span class="hljs-operator">=</span> <span class="hljs-type">UIImage</span>(named: <span class="hljs-string">&quot;聖鬥士星矢<span class="hljs-subst">\(indexPath.item <span class="hljs-operator">+</span> <span class="hljs-number">1</span>)</span>&quot;</span>)<br />            <span class="hljs-keyword">return</span> cell<br />        })<br />    }<br />}</span></pre><h3 name="39e3" id="39e3" class="graf graf--h3 graf-after--pre">Flow Layout 的 collection view</h3><p name="7720" id="7720" class="graf graf--p graf-after--h3">現在我們已經可以執行 App 了。collection view 預設的排版是 flow layout，預設的捲動方向是 Vertical。</p><figure name="daa0" id="daa0" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*pqPg_nqa2WXTGG_wX_uAOA.png" data-width="530" data-height="288" src="https://cdn-images-1.medium.com/max/800/1*pqPg_nqa2WXTGG_wX_uAOA.png"></figure><p name="325f" id="325f" class="graf graf--p graf-after--figure">畫面將如下圖的格子狀排版，畫面可上下捲動，由於每個 cell 大小為 100 * 137，因此在寬度 390 的 iPhone 12 一排將顯示 3 個 cell。</p></div><div class="section-inner sectionLayout--outsetRow" data-paragraph-count="2"><figure name="eb11" id="eb11" class="graf graf--figure graf--layoutOutsetRow is-partialWidth graf-after--p" style="width: 50%;"><img class="graf-image" data-image-id="1*z7JejkbJ-RwQbQVmzFH-Jw.png" data-width="1170" data-height="2532" src="https://cdn-images-1.medium.com/max/600/1*z7JejkbJ-RwQbQVmzFH-Jw.png"></figure><figure name="c275" id="c275" class="graf graf--figure graf--layoutOutsetRowContinue is-partialWidth graf-after--figure" style="width: 50%;"><img class="graf-image" data-image-id="1*H70vXYyL_RfzGUiDWX_hhQ.png" data-width="1170" data-height="2532" src="https://cdn-images-1.medium.com/max/600/1*H70vXYyL_RfzGUiDWX_hhQ.png"></figure></div><div class="section-inner sectionLayout--insetColumn"><h3 name="b7b3" id="b7b3" class="graf graf--h3 graf-after--figure">將 collection view 的 collectionViewLayout 改成 compositional layout</h3><p name="bf4f" id="bf4f" class="graf graf--p graf-after--h3">接下來終於可以進入重頭戲了。將 collection view 的 collectionViewLayout 從預設的 flow layout 改成 compositional layout。</p><p name="0c43" id="0c43" class="graf graf--p graf-after--p">如下圖所示，compositional layout 控制畫面的排版，它將畫面分成多個 Section，Section 裡分成一個個 Group，Group 裡分成一個個 Item。</p><figure name="8f61" id="8f61" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*iXoCZqVwHrJOMjpIKYJeGQ.png" data-width="714" data-height="968" src="https://cdn-images-1.medium.com/max/800/1*iXoCZqVwHrJOMjpIKYJeGQ.png"></figure><p name="7caa" id="7caa" class="graf graf--p graf-after--figure">相較於 flow layout 的 collection view，它多了 Group，Group 讓它變得更彈性，更容易做出複雜的排版。接下來我們將透過實際的例子學習Section，Group &amp; Item 排版的概念。</p><h3 name="d4bf" id="d4bf" class="graf graf--h3 graf-after--p">Item，Group，Section &amp; 固定大小的 absolute</h3><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="e7bd" id="e7bd" class="graf graf--pre graf-after--h3 graf--preV2"><span class="pre--content"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewController</span>: <span class="hljs-title class_">UIViewController</span> {<br />  <span class="hljs-keyword">@IBOutlet</span> <span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> collectionView: <span class="hljs-type">UICollectionView</span>!<br />    <br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {<br />        <span class="hljs-keyword">super</span>.viewDidLoad()<br />        collectionView.collectionViewLayout <span class="hljs-operator">=</span> generateLayout()<br />    }<br /><br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">generateLayout</span>() -&gt; <span class="hljs-type">UICollectionViewLayout</span> {<br />        <span class="hljs-keyword">let</span> itemSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .absolute(<span class="hljs-number">100</span>), heightDimension: .absolute(<span class="hljs-number">137</span>))<br />        <span class="hljs-keyword">let</span> item <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutItem</span>(layoutSize: itemSize)<br />        <span class="hljs-keyword">let</span> groupSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .absolute(<span class="hljs-number">390</span>), heightDimension: .absolute(<span class="hljs-number">150</span>))<br />        <span class="hljs-keyword">let</span> group <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutGroup</span>.horizontal(layoutSize: groupSize, subitems: [item])<br />        <span class="hljs-keyword">let</span> section <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSection</span>(group: group)<br />        <span class="hljs-keyword">return</span> <span class="hljs-type">UICollectionViewCompositionalLayout</span>(section: section)<br />    }<br />}</span></pre><p name="d13c" id="d13c" class="graf graf--p graf-after--pre">說明:</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="3902" id="3902" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">collectionView.collectionViewLayout <span class="hljs-operator">=</span> generateLayout()</span></pre><p name="564c" id="564c" class="graf graf--p graf-after--pre">將 collectionViewLayout 設為 UICollectionViewCompositionalLayout，generateLayout 將回傳 UICollectionViewCompositionalLayout。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="fe2a" id="fe2a" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> itemSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .absolute(<span class="hljs-number">100</span>), heightDimension: .absolute(<span class="hljs-number">137</span>))<br /><span class="hljs-keyword">let</span> item <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutItem</span>(layoutSize: itemSize)</span></pre><p name="6982" id="6982" class="graf graf--p graf-after--pre">item 對應到 collection view cell，它控制 cell 的大小。在此我們設定 item size 為 100 * 137，NSCollectionLayoutDimension 的 absolute 可指定固定的大小。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="3778" id="3778" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> groupSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .absolute(<span class="hljs-number">390</span>), heightDimension: .absolute(<span class="hljs-number">145</span>))<br /><span class="hljs-keyword">let</span> group <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutGroup</span>.horizontal(layoutSize: groupSize, subitems: [item])</span></pre><p name="2715" id="2715" class="graf graf--p graf-after--pre">group 裡可以有很多 item，在此我們設定 group size 為 390 * 145，然後利用 NSCollectionLayoutGroup.horizontal 產生 group。horizontal 將讓 group 裡的 item 沿著水平方向排列，參數 subitems 傳入 [item] 表示 group 裡排列的是剛剛產生的 item。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="a16f" id="a16f" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> section <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSection</span>(group: group)</span></pre><p name="4c98" id="4c98" class="graf graf--p graf-after--pre">section 裡可以有很多 group ，產生 NSCollectionLayoutSection 時傳入 group 表示 section 裡排列的是剛剛產生的 group。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="1b02" id="1b02" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">return</span> <span class="hljs-type">UICollectionViewCompositionalLayout</span>(section: section)</span></pre><p name="9fb4" id="9fb4" class="graf graf--p graf-after--pre">利用 section 產生 UICollectionViewCompositionalLayout。</p><p name="9199" id="9199" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">結果</strong></p><p name="5669" id="5669" class="graf graf--p graf-after--p">如下圖所示，group 裡的 item 將沿著水平方向排列，由於 group size 為 390 * 145，item size 為 100 * 137，因此一排可顯示三本書。section 裡的 group 預設將由上而下排列，由上而下依序為 Group0，Group 1，Group 2 等，我們可上下滑動瀏覽內容。(ps: 後面會再說明如何調整 group 排列的方向，我們也可以讓它變成由左而右排列)</p></div><div class="section-inner sectionLayout--outsetRow" data-paragraph-count="2"><figure name="80db" id="80db" class="graf graf--figure graf--layoutOutsetRow is-partialWidth graf-after--p" style="width: 61.013%;"><img class="graf-image" data-image-id="1*UPAW5n_bEc7_kyVmCjodgA.png" data-width="742" data-height="1026" src="https://cdn-images-1.medium.com/max/800/1*UPAW5n_bEc7_kyVmCjodgA.png"></figure><figure name="4197" id="4197" class="graf graf--figure graf--layoutOutsetRowContinue is-partialWidth graf-after--figure" style="width: 38.987%;"><img class="graf-image" data-image-id="1*5Y_yjyNnOVBEzV-5_AlkNw.png" data-width="1170" data-height="2532" src="https://cdn-images-1.medium.com/max/600/1*5Y_yjyNnOVBEzV-5_AlkNw.png"></figure></div><div class="section-inner sectionLayout--insetColumn"><h3 name="a9b4" id="a9b4" class="graf graf--h3 graf-after--figure">當 group 的寬度超過 collection view 的寬度</h3><p name="50eb" id="50eb" class="graf graf--p graf-after--h3">接著讓我們試試 group 的寬度超過 collection view 的寬度會發生什麼事 ?</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="4b09" id="4b09" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">generateLayout</span>() -&gt; <span class="hljs-type">UICollectionViewLayout</span> {<br />        <span class="hljs-keyword">let</span> itemSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .absolute(<span class="hljs-number">100</span>), heightDimension: .absolute(<span class="hljs-number">137</span>))<br />        <span class="hljs-keyword">let</span> item <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutItem</span>(layoutSize: itemSize)<br />        <span class="hljs-keyword">let</span> groupSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .absolute(<span class="hljs-number">650</span>), heightDimension: .absolute(<span class="hljs-number">145</span>))<br />        <span class="hljs-keyword">let</span> group <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutGroup</span>.horizontal(layoutSize: groupSize, subitems: [item])<br />        <span class="hljs-keyword">let</span> section <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSection</span>(group: group)<br />        <span class="hljs-keyword">return</span> <span class="hljs-type">UICollectionViewCompositionalLayout</span>(section: section)<br />}</span></pre><p name="0968" id="0968" class="graf graf--p graf-after--pre">group 寬度 650，item 寬度 100，所以一個 group 可以排列 6 本書。在 iPhone 12 時，collection view 寬度只有 390，當 group 寬度超過 collection view 寬度時，我們將可水平滑動瀏覽內容。</p><figure name="c125" id="c125" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*djPkYDz8VZmqTcnhW2-3Zw.png" data-width="1662" data-height="1108" src="https://cdn-images-1.medium.com/max/800/1*djPkYDz8VZmqTcnhW2-3Zw.png"></figure><h3 name="02c8" id="02c8" class="graf graf--h3 graf-after--figure">控制 item 排列方向的 <strong class="markup--strong markup--h3-strong">NSCollectionLayoutGroup</strong></h3><p name="132e" id="132e" class="graf graf--p graf-after--h3">除了 NSCollectionLayoutGroup.horizontal，我們也可以用 NSCollectionLayoutGroup.vertical 產生 group。NSCollectionLayoutGroup.vertical 將讓 item 沿著垂直方向排列。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="e63a" id="e63a" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">generateLayout</span>() -&gt; <span class="hljs-type">UICollectionViewLayout</span> {<br />            <span class="hljs-keyword">let</span> itemSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .absolute(<span class="hljs-number">80</span>), heightDimension: .absolute(<span class="hljs-number">80</span>))<br />            <span class="hljs-keyword">let</span> item <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutItem</span>(layoutSize: itemSize)<br />            <span class="hljs-keyword">let</span> groupSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .absolute(<span class="hljs-number">390</span>), heightDimension: .absolute(<span class="hljs-number">180</span>))<br />            <span class="hljs-keyword">let</span> group <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutGroup</span>.vertical(layoutSize: groupSize, subitems: [item])<br />            <span class="hljs-keyword">let</span> section <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSection</span>(group: group)<br />            <span class="hljs-keyword">return</span> <span class="hljs-type">UICollectionViewCompositionalLayout</span>(section: section)<br />}</span></pre><p name="8f15" id="8f15" class="graf graf--p graf-after--pre">如下圖所示，group 的高度為 180，item 的高度為 80，因此一個 group 可以裝兩個 item。</p><figure name="18bc" id="18bc" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*XU28dkXf1hed9Q_DpUledQ.png" data-width="1170" data-height="2532" src="https://cdn-images-1.medium.com/max/800/1*XU28dkXf1hed9Q_DpUledQ.png"></figure><h3 name="a8fb" id="a8fb" class="graf graf--h3 graf-after--figure">依比例設定 item &amp; group 大小的 fractionalWidth &amp; fractionalHeight，比方格子狀照片牆(grid)</h3><p name="1f5a" id="1f5a" class="graf graf--p graf-after--h3">使用 absolute 設定固定大小很方便，不過更多時候我們會使用較彈性的 fractionalWidth &amp; fractionalHeight，它可以依比例設定 item &amp; group 的大小。</p><p name="adbe" id="adbe" class="graf graf--p graf-after--p">比方一排 3 張照片的格子狀照片牆，透過 fractionalWidth &amp; fractionalHeight 將可輕易做到，不用再像以前 flow layout 時手動計算大小。</p><figure name="a90a" id="a90a" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*xD5roF49iGV5Cgm10-mLNw.png" data-width="1170" data-height="2532" src="https://cdn-images-1.medium.com/max/800/1*xD5roF49iGV5Cgm10-mLNw.png"></figure><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="b482" id="b482" class="graf graf--pre graf-after--figure graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">generateLayout</span>() -&gt; <span class="hljs-type">UICollectionViewLayout</span> {<br />        <span class="hljs-keyword">let</span> itemSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1</span><span class="hljs-operator">/</span><span class="hljs-number">3</span>), heightDimension: .fractionalHeight(<span class="hljs-number">1</span>))<br />        <span class="hljs-keyword">let</span> item <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutItem</span>(layoutSize: itemSize)<br />        <span class="hljs-keyword">let</span> groupSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1</span>), heightDimension: .fractionalWidth(<span class="hljs-number">1</span><span class="hljs-operator">/</span><span class="hljs-number">3</span>))<br />        <span class="hljs-keyword">let</span> group <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutGroup</span>.horizontal(layoutSize: groupSize, subitems: [item])<br />        <span class="hljs-keyword">let</span> section <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSection</span>(group: group)<br />        <span class="hljs-keyword">return</span> <span class="hljs-type">UICollectionViewCompositionalLayout</span>(section: section)<br />}</span></pre><p name="bd9e" id="bd9e" class="graf graf--p graf-after--pre">說明</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="77f4" id="77f4" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> itemSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1</span><span class="hljs-operator">/</span><span class="hljs-number">3</span>), heightDimension: .fractionalHeight(<span class="hljs-number">1</span>))<br /><span class="hljs-keyword">let</span> item <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutItem</span>(layoutSize: itemSize)</span></pre><p name="19a8" id="19a8" class="graf graf--p graf-after--pre">設定 item size 時，fractional 指的是相對於 group 的大小， widthDimension 傳入 fractionalWidth(1/3) 代表 item 的寬度是 group 寬度的 1/3，heightDimension 傳入 fractionalHeight(1) 代表 item 的高度等於 group 高度。因此水平排列時一個 group 可以裝 3 個 item。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="8efe" id="8efe" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> groupSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1</span>), heightDimension: .fractionalWidth(<span class="hljs-number">1</span><span class="hljs-operator">/</span><span class="hljs-number">3</span>))<br /><span class="hljs-keyword">let</span> group <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutGroup</span>.horizontal(layoutSize: groupSize, subitems: [item])</span></pre><p name="9e2e" id="9e2e" class="graf graf--p graf-after--pre">設定 group size 時，fractional 依據以下兩種情況有不同的意思:</p><ul class="postList"><li name="51d7" id="51d7" class="graf graf--li graf-after--p">group 被包在 section 裡。</li><li name="034a" id="034a" class="graf graf--li graf-after--li">group 被包在另一個 group 裡。</li></ul><p name="8f64" id="8f64" class="graf graf--p graf-after--li">我們先看比較簡單的情況，當 group 被包在 section 裡，fractional 指的是相對於 collection view 的大小，widthDimension 傳入 .fractionalWidth(1) 代表 group 的寬度等於 collection view 的寬度，heightDimension 傳入 fractionalWidth(1/3) 代表 group 的高度等於 collection view 寬度的 1/3。</p><p name="a29f" id="a29f" class="graf graf--p graf-after--p">綜合以上條件， item 的寬度跟高度都會是 collection view 寬度的 1/3，因此 collection view 一排將顯示 3 個 item，每個 item 會是正方形 。</p><p name="93fa" id="93fa" class="graf graf--p graf-after--p">ps: group &amp; section 若有設定 contentInsets，fractional 計算大小時會先扣除間距，相關說明後面會說明。</p><p name="b1e6" id="b1e6" class="graf graf--p graf-after--p">接著讓我們再看看其它幾個例子。</p><ul class="postList"><li name="9197" id="9197" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">畫面一開始顯示時剛好顯示 2 個 group，圖片完全不會被切到。</strong></li></ul><p name="8f88" id="8f88" class="graf graf--p graf-after--li">將 group size 的高度設為 fractionalHeight(1/2)，group 的高度等於 collection view 高度的 1/2。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="de24" id="de24" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">generateLayout</span>() -&gt; <span class="hljs-type">UICollectionViewLayout</span> {<br />            <span class="hljs-keyword">let</span> itemSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1</span><span class="hljs-operator">/</span><span class="hljs-number">3</span>), heightDimension: .fractionalHeight(<span class="hljs-number">1</span>))<br />            <span class="hljs-keyword">let</span> item <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutItem</span>(layoutSize: itemSize)<br />            <span class="hljs-keyword">let</span> groupSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1</span>), heightDimension: .fractionalHeight(<span class="hljs-number">1</span><span class="hljs-operator">/</span><span class="hljs-number">2</span>))<br />            <span class="hljs-keyword">let</span> group <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutGroup</span>.horizontal(layoutSize: groupSize, subitems: [item])<br />            <span class="hljs-keyword">let</span> section <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSection</span>(group: group)<br />            <span class="hljs-keyword">return</span> <span class="hljs-type">UICollectionViewCompositionalLayout</span>(section: section)<br />}</span></pre><figure name="6f6d" id="6f6d" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*5uch4Byli9hYaNpIandJEw.png" data-width="1170" data-height="2532" src="https://cdn-images-1.medium.com/max/800/1*5uch4Byli9hYaNpIandJEw.png"></figure><ul class="postList"><li name="e6f2" id="e6f2" class="graf graf--li graf-after--figure"><strong class="markup--strong markup--li-strong">指定 item 寬高比例 1:2</strong></li></ul><p name="0390" id="0390" class="graf graf--p graf-after--li">剛剛我們看到實現正方形 item 的方法，現在讓我們看看另一種搭配 estimated 的方法。我們將 itemSize 的寬高分別設為 fractionalWidth(1/3) &amp; fractionalWidth(2/3)，因此比例會是 1:2。至於 group 的大小，我們將高度設為 <code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">estimated(100)</strong></code>，它將自動計算合適的高度，在此 group 的高度將變成剛好容納 item 的高度。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="da86" id="da86" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">generateLayout</span>() -&gt; <span class="hljs-type">UICollectionViewLayout</span> {<br />            <span class="hljs-keyword">let</span> itemSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1</span><span class="hljs-operator">/</span><span class="hljs-number">3</span>), heightDimension: .fractionalWidth(<span class="hljs-number">2</span><span class="hljs-operator">/</span><span class="hljs-number">3</span>))<br />            <span class="hljs-keyword">let</span> item <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutItem</span>(layoutSize: itemSize)<br />            <span class="hljs-keyword">let</span> groupSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1</span>), heightDimension: .estimated(<span class="hljs-number">100</span>))<br />            <span class="hljs-keyword">let</span> group <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutGroup</span>.horizontal(layoutSize: groupSize, subitems: [item])<br />            <span class="hljs-keyword">let</span> section <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSection</span>(group: group)<br />            <span class="hljs-keyword">return</span> <span class="hljs-type">UICollectionViewCompositionalLayout</span>(section: section)<br />}</span></pre><figure name="63e0" id="63e0" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*i7_bJ2Lrhbj97D7xkjrqkg.png" data-width="1170" data-height="2532" src="https://cdn-images-1.medium.com/max/800/1*i7_bJ2Lrhbj97D7xkjrqkg.png"></figure><h3 name="e9ed" id="e9ed" class="graf graf--h3 graf-after--figure">讓 collection view 轉向時維持排版</h3><p name="8506" id="8506" class="graf graf--p graf-after--h3">使用 fractional 還有另一個好處，在 iPhone 轉向時 collection view 可以維持排版。以下例子將讓 collection view 一排顯示三張圖片，不管 iPhone 在直向還是橫向。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="4661" id="4661" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">generateLayout</span>() -&gt; <span class="hljs-type">UICollectionViewLayout</span> {<br />        <span class="hljs-keyword">let</span> itemSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1</span><span class="hljs-operator">/</span><span class="hljs-number">3</span>), heightDimension: .fractionalHeight(<span class="hljs-number">1</span>))<br />        <span class="hljs-keyword">let</span> item <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutItem</span>(layoutSize: itemSize)<br />        <span class="hljs-keyword">let</span> groupSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1</span>), heightDimension: .fractionalWidth(<span class="hljs-number">1</span><span class="hljs-operator">/</span><span class="hljs-number">3</span>))<br />        <span class="hljs-keyword">let</span> group <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutGroup</span>.horizontal(layoutSize: groupSize, subitems: [item])<br />        <span class="hljs-keyword">let</span> section <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSection</span>(group: group)<br />        <span class="hljs-keyword">return</span> <span class="hljs-type">UICollectionViewCompositionalLayout</span>(section: section)<br />}</span></pre><figure name="5d1f" id="5d1f" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*rCYuAgJgt7oFXKjHTphI5g.png" data-width="2532" data-height="1170" src="https://cdn-images-1.medium.com/max/800/1*rCYuAgJgt7oFXKjHTphI5g.png"></figure><h3 name="7f18" id="7f18" class="graf graf--h3 graf-after--figure">指定 group 裡的 item 數量</h3><p name="50f3" id="50f3" class="graf graf--p graf-after--h3">利用 <code class="markup--code markup--p-code">let groupSize = NSCollectionLayoutSize(widthDimension: .fractionalWidth(1), heightDimension: .fractionalWidth(1/3)) </code>可讓 group 裡水平排列的 item 裝三個，不過我們也可以用另一種寫法，生成 group 時在參數 count 裡傳入 item 的數量。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="e748" id="e748" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">generateLayout</span>() -&gt; <span class="hljs-type">UICollectionViewLayout</span> {<br />        <span class="hljs-keyword">let</span> itemSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1</span>), heightDimension: .fractionalHeight(<span class="hljs-number">1</span>))<br />        <span class="hljs-keyword">let</span> item <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutItem</span>(layoutSize: itemSize)<br />        <span class="hljs-keyword">let</span> groupSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1</span>), heightDimension: .fractionalWidth(<span class="hljs-number">1</span><span class="hljs-operator">/</span><span class="hljs-number">3</span>))<br />        <span class="hljs-keyword">let</span> group <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutGroup</span>.horizontal(layoutSize: groupSize, subitem: item, count: <span class="hljs-number">3</span>)<br />        <span class="hljs-keyword">let</span> section <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSection</span>(group: group)<br />        <span class="hljs-keyword">return</span> <span class="hljs-type">UICollectionViewCompositionalLayout</span>(section: section)<br />}</span></pre><p name="655c" id="655c" class="graf graf--p graf-after--pre">值得注意的，當我們用 count 指定數量時，item size 的 widthDimension 傳什麼就不重要了，因為它會自己算出一個 item 要多寬。</p><figure name="572f" id="572f" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*xD5roF49iGV5Cgm10-mLNw.png" data-width="1170" data-height="2532" src="https://cdn-images-1.medium.com/max/800/1*xD5roF49iGV5Cgm10-mLNw.png"></figure><h3 name="1bdb" id="1bdb" class="graf graf--h3 graf-after--figure">搭配 auto layout 設定 item 的大小比例</h3><p name="bff0" id="bff0" class="graf graf--p graf-after--h3">讓 item 固定大小比例有很多方法，現在讓我們再看另一種搭配 auto layout 的方法。在 storyboard 設定 image view 的比例為 1:1，priority 設為 999。(當 priority 為 1000 時，執行時 Xcode 將顯示 auto layout breaking constraint 的警告訊息。)</p></div><div class="section-inner sectionLayout--outsetRow" data-paragraph-count="2"><figure name="b0e0" id="b0e0" class="graf graf--figure graf--layoutOutsetRow is-partialWidth graf-after--p" style="width: 58.785%;"><img class="graf-image" data-image-id="1*OJaLS-khc1kzNGq2dy66XA.png" data-width="1266" data-height="948" src="https://cdn-images-1.medium.com/max/800/1*OJaLS-khc1kzNGq2dy66XA.png"></figure><figure name="ace9" id="ace9" class="graf graf--figure graf--layoutOutsetRowContinue is-partialWidth graf-after--figure" style="width: 41.215%;"><img class="graf-image" data-image-id="1*Z-qkKKb0Lqx8jSJU6OvfSA.png" data-width="530" data-height="566" src="https://cdn-images-1.medium.com/max/600/1*Z-qkKKb0Lqx8jSJU6OvfSA.png"></figure></div><div class="section-inner sectionLayout--insetColumn"><p name="c426" id="c426" class="graf graf--p graf-after--figure">item 的寬度由 group 裡裝 3 個 item 自動計算，而 item 的高度 &amp; group 高度都設為 estimated，它將自動計算適合的高度。由於我們設定 image view 的比例為 1:1，因此 item 和 group 的高度將等於 item 的寬度。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="1916" id="1916" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">generateLayout</span>() -&gt; <span class="hljs-type">UICollectionViewLayout</span> {<br />        <span class="hljs-keyword">let</span> itemSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1</span>), heightDimension: .estimated(<span class="hljs-number">100</span>))<br />        <span class="hljs-keyword">let</span> item <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutItem</span>(layoutSize: itemSize)<br />        <span class="hljs-keyword">let</span> groupSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1</span>), heightDimension: .estimated(<span class="hljs-number">100</span>))<br />        <span class="hljs-keyword">let</span> group <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutGroup</span>.horizontal(layoutSize: groupSize, subitem: item, count: <span class="hljs-number">3</span>)<br />        <span class="hljs-keyword">let</span> section <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSection</span>(group: group)<br />        <span class="hljs-keyword">return</span> <span class="hljs-type">UICollectionViewCompositionalLayout</span>(section: section)<br />}</span></pre><figure name="2bc0" id="2bc0" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*qhmsSLWEAjELdvwnAtjBtA.png" data-width="1170" data-height="2532" src="https://cdn-images-1.medium.com/max/800/1*qhmsSLWEAjELdvwnAtjBtA.png"></figure><h3 name="0570" id="0570" class="graf graf--h3 graf-after--figure">設定間距</h3><p name="2d04" id="2d04" class="graf graf--p graf-after--h3">我們可以透過很多方法設定間距，比方 item 的 contentInsets 或 group 的 interItemSpacing 都可以設定 item 間的間距，不過卻有小小的差異，讓我們看看以下的例子。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="5ca9" id="5ca9" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">generateLayout</span>() -&gt; <span class="hljs-type">UICollectionViewLayout</span> {<br />        <span class="hljs-keyword">let</span> itemSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .absolute(<span class="hljs-number">100</span>), heightDimension: .absolute(<span class="hljs-number">100</span>))<br />        <span class="hljs-keyword">let</span> item <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutItem</span>(layoutSize: itemSize)<br />        <span class="hljs-keyword">let</span> groupSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .absolute(<span class="hljs-number">390</span>), heightDimension: .absolute(<span class="hljs-number">100</span>))<br />        <span class="hljs-keyword">let</span> group <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutGroup</span>.horizontal(layoutSize: groupSize, subitems: [item])<br />        group.interItemSpacing <span class="hljs-operator">=</span> .fixed(<span class="hljs-number">30</span>)<br />        <span class="hljs-keyword">let</span> section <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSection</span>(group: group)<br />        <span class="hljs-keyword">return</span> <span class="hljs-type">UICollectionViewCompositionalLayout</span>(section: section)<br />}</span></pre><p name="3692" id="3692" class="graf graf--p graf-after--pre"><code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">group.interItemSpacing = .fixed(30)</strong></code> 讓 item 間有著 30 的間距，item 的大小維持 100 * 100。</p><figure name="1e43" id="1e43" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*MJ6oMLGDjcjXrHf1LkLkmQ.png" data-width="1170" data-height="2532" src="https://cdn-images-1.medium.com/max/800/1*MJ6oMLGDjcjXrHf1LkLkmQ.png"></figure><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="bec9" id="bec9" class="graf graf--pre graf-after--figure graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">generateLayout</span>() -&gt; <span class="hljs-type">UICollectionViewLayout</span> {<br />        <span class="hljs-keyword">let</span> itemSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .absolute(<span class="hljs-number">100</span>), heightDimension: .absolute(<span class="hljs-number">100</span>))<br />        <span class="hljs-keyword">let</span> item <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutItem</span>(layoutSize: itemSize)<br />        item.contentInsets <span class="hljs-operator">=</span> <span class="hljs-type">NSDirectionalEdgeInsets</span>(top: <span class="hljs-number">0</span>, leading: <span class="hljs-number">0</span>, bottom: <span class="hljs-number">0</span>, trailing: <span class="hljs-number">30</span>)<br />        <span class="hljs-keyword">let</span> groupSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .absolute(<span class="hljs-number">390</span>), heightDimension: .absolute(<span class="hljs-number">100</span>))<br />        <span class="hljs-keyword">let</span> group <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutGroup</span>.horizontal(layoutSize: groupSize, subitems: [item])<br />        <span class="hljs-keyword">let</span> section <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSection</span>(group: group)<br />        <span class="hljs-keyword">return</span> <span class="hljs-type">UICollectionViewCompositionalLayout</span>(section: section)<br />}</span></pre><p name="11b8" id="11b8" class="graf graf--p graf-after--pre"><code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">item.contentInsets = NSDirectionalEdgeInsets(top: 0, leading: 0, bottom: 0, trailing: 30)</strong></code> 將在原本 100 * 100 的 item 裡加入右邊 30 的間距，因此 item 的大小將變成 70 * 100，不再是正方形。</p><figure name="4e41" id="4e41" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*khCQcC6t5bYmomaoiLT9Vg.png" data-width="1170" data-height="2532" src="https://cdn-images-1.medium.com/max/800/1*khCQcC6t5bYmomaoiLT9Vg.png"></figure><p name="4873" id="4873" class="graf graf--p graf-after--figure">若要維持 item 100 * 100 的大小，還有一個方法是設定 edgeSpacing，例如以下例子。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="b673" id="b673" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">item.edgeSpacing <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutEdgeSpacing</span>(leading: .fixed(<span class="hljs-number">0</span>), top: .fixed(<span class="hljs-number">0</span>), trailing: .fixed(<span class="hljs-number">30</span>), bottom: .fixed(<span class="hljs-number">0</span>))</span></pre><p name="5d0e" id="5d0e" class="graf graf--p graf-after--pre">了解 contentInsets，interItemSpacing &amp; edgeSpacing 的差別後，我們將可運用以下 property 調整間距。</p><ul class="postList"><li name="379d" id="379d" class="graf graf--li graf-after--p">NSCollectionLayoutItem 的 contentInsets &amp; edgeSpacing。</li><li name="f92b" id="f92b" class="graf graf--li graf-after--li">NSCollectionLayoutGroup 的 contentInsets，interItemSpacing &amp; edgeSpacing。</li><li name="2c4e" id="2c4e" class="graf graf--li graf-after--li">NSCollectionLayoutSection 的 contentInsets &amp; interGroupSpacing。</li></ul><p name="0949" id="0949" class="graf graf--p graf-after--li">接著讓我們試試在一排顯示 3 張圖片，item 彼此的間距是 10，item 跟邊界的間距也是 10。</p><ul class="postList"><li name="328c" id="328c" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">範例1: group 的高度固定為 200</strong></li></ul><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="2aa8" id="2aa8" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">generateLayout</span>() -&gt; <span class="hljs-type">UICollectionViewLayout</span> {<br />        <span class="hljs-keyword">let</span> padding: <span class="hljs-type">Double</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span><br />        <span class="hljs-keyword">let</span> itemSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1</span>), heightDimension: .fractionalHeight(<span class="hljs-number">1</span>))<br />        <span class="hljs-keyword">let</span> item <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutItem</span>(layoutSize: itemSize)<br />        <span class="hljs-keyword">let</span> groupSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1</span>), heightDimension: .absolute(<span class="hljs-number">200</span>))<br />        <span class="hljs-keyword">let</span> group <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutGroup</span>.horizontal(layoutSize: groupSize, subitem: item, count: <span class="hljs-number">3</span>)<br />        group.interItemSpacing <span class="hljs-operator">=</span> .fixed(padding)<br />        <span class="hljs-keyword">let</span> section <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSection</span>(group: group)<br />        section.interGroupSpacing <span class="hljs-operator">=</span> padding<br />        section.contentInsets <span class="hljs-operator">=</span> <span class="hljs-type">NSDirectionalEdgeInsets</span>(top: padding, leading: padding, bottom: padding, trailing: padding)<br />        <span class="hljs-keyword">return</span> <span class="hljs-type">UICollectionViewCompositionalLayout</span>(section: section)<br />        <br />}</span></pre><p name="722f" id="722f" class="graf graf--p graf-after--pre">說明</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="a9c3" id="a9c3" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">group.interItemSpacing <span class="hljs-operator">=</span> .fixed(padding)</span></pre><p name="4fec" id="4fec" class="graf graf--p graf-after--pre">設定 item 之間的間距。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="af94" id="af94" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">section.interGroupSpacing <span class="hljs-operator">=</span> padding</span></pre><p name="92e8" id="92e8" class="graf graf--p graf-after--pre">設定 group 之間的間距。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="2515" id="2515" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">section.contentInsets <span class="hljs-operator">=</span> <span class="hljs-type">NSDirectionalEdgeInsets</span>(top: padding, leading: padding, bottom: padding, trailing: padding)</span></pre><p name="2df4" id="2df4" class="graf graf--p graf-after--pre">設定 section 跟 collection view 邊界的間距。</p><figure name="08f8" id="08f8" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*Oc7q0FL7aN7sgefp6coMBA.png" data-width="1170" data-height="2532" src="https://cdn-images-1.medium.com/max/800/1*Oc7q0FL7aN7sgefp6coMBA.png"></figure><p name="8e18" id="8e18" class="graf graf--p graf-after--figure">若是 item 的寬度是以 fractionalWidth(1/3) 計算時，我們不能用 interGroupSpacing 設定 item 間的間距，而要改用 item 的 contentInsets。我們將 item contentInsets 的 leading 設為 10，section contentInsets 的 trailing 設為 10，因此水平方向的 item 間距以及 item 跟邊界的間距都會是 10。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="2653" id="2653" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">generateLayout</span>() -&gt; <span class="hljs-type">UICollectionViewLayout</span> {<br />        <span class="hljs-keyword">let</span> padding: <span class="hljs-type">Double</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span><br />        <span class="hljs-keyword">let</span> itemSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1</span><span class="hljs-operator">/</span><span class="hljs-number">3</span>), heightDimension: .fractionalHeight(<span class="hljs-number">1</span>))<br />        <span class="hljs-keyword">let</span> item <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutItem</span>(layoutSize: itemSize)<br />        item.contentInsets <span class="hljs-operator">=</span> <span class="hljs-type">NSDirectionalEdgeInsets</span>(top: <span class="hljs-number">0</span>, leading: padding, bottom: <span class="hljs-number">0</span>, trailing: <span class="hljs-number">0</span>)<br />        <br />        <span class="hljs-keyword">let</span> groupSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1</span>), heightDimension: .absolute(<span class="hljs-number">200</span>))<br />        <span class="hljs-keyword">let</span> group <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutGroup</span>.horizontal(layoutSize: groupSize, subitems: [item])<br />        <span class="hljs-keyword">let</span> section <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSection</span>(group: group)<br />        section.interGroupSpacing <span class="hljs-operator">=</span> padding<br />        section.contentInsets <span class="hljs-operator">=</span> <span class="hljs-type">NSDirectionalEdgeInsets</span>(top: padding, leading: <span class="hljs-number">0</span>, bottom: padding, trailing: padding)<br />        <span class="hljs-keyword">return</span> <span class="hljs-type">UICollectionViewCompositionalLayout</span>(section: section)<br />        <br />}</span></pre><ul class="postList"><li name="e205" id="e205" class="graf graf--li graf-after--pre"><strong class="markup--strong markup--li-strong">範例2: item 比例固定為 1:1</strong></li></ul><p name="964d" id="964d" class="graf graf--p graf-after--li">方法 1: 使用 estimated 設定 group 高度</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="fa6a" id="fa6a" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">generateLayout</span>() -&gt; <span class="hljs-type">UICollectionViewLayout</span> {<br />        <span class="hljs-keyword">let</span> padding: <span class="hljs-type">Double</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span><br />        <span class="hljs-keyword">let</span> itemSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1</span><span class="hljs-operator">/</span><span class="hljs-number">3</span>), heightDimension: .fractionalWidth(<span class="hljs-number">1</span><span class="hljs-operator">/</span><span class="hljs-number">3</span>))<br />        <span class="hljs-keyword">let</span> item <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutItem</span>(layoutSize: itemSize)<br />        item.contentInsets <span class="hljs-operator">=</span> <span class="hljs-type">NSDirectionalEdgeInsets</span>(top: <span class="hljs-number">0</span>, leading: padding, bottom: <span class="hljs-number">0</span>, trailing: <span class="hljs-number">0</span>)<br />        <br />        <span class="hljs-keyword">let</span> groupSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1</span>), heightDimension: .estimated(<span class="hljs-number">100</span>))<br />        <span class="hljs-keyword">let</span> group <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutGroup</span>.horizontal(layoutSize: groupSize, subitems: [item])<br />        <span class="hljs-keyword">let</span> section <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSection</span>(group: group)<br />        section.interGroupSpacing <span class="hljs-operator">=</span> padding<br />        section.contentInsets <span class="hljs-operator">=</span> <span class="hljs-type">NSDirectionalEdgeInsets</span>(top: padding, leading: <span class="hljs-number">0</span>, bottom: padding, trailing: padding)<br />        <span class="hljs-keyword">return</span> <span class="hljs-type">UICollectionViewCompositionalLayout</span>(section: section)<br />        <br />}</span></pre><p name="a7b8" id="a7b8" class="graf graf--p graf-after--pre">方法 2: 使用 auto layout 計算 group 高度</p><p name="4d1c" id="4d1c" class="graf graf--p graf-after--p">先在 storyboard 設定 image view 的比例為 1:1，然後利用以下程式設定排版。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="29ee" id="29ee" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">generateLayout</span>() -&gt; <span class="hljs-type">UICollectionViewLayout</span> {<br />        <span class="hljs-keyword">let</span> padding: <span class="hljs-type">Double</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span><br />        <span class="hljs-keyword">let</span> itemSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1</span>), heightDimension: .estimated(<span class="hljs-number">100</span>))<br />        <span class="hljs-keyword">let</span> item <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutItem</span>(layoutSize: itemSize)<br />        <span class="hljs-keyword">let</span> groupSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1</span>), heightDimension: .estimated(<span class="hljs-number">100</span>))<br />        <span class="hljs-keyword">let</span> group <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutGroup</span>.horizontal(layoutSize: groupSize, subitem: item, count: <span class="hljs-number">3</span>)<br />        group.interItemSpacing <span class="hljs-operator">=</span> .fixed(padding)<br />        <span class="hljs-keyword">let</span> section <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSection</span>(group: group)<br />        section.interGroupSpacing <span class="hljs-operator">=</span> padding<br />        section.contentInsets <span class="hljs-operator">=</span> <span class="hljs-type">NSDirectionalEdgeInsets</span>(top: padding, leading: padding, bottom: padding, trailing: padding)<br />        <span class="hljs-keyword">return</span> <span class="hljs-type">UICollectionViewCompositionalLayout</span>(section: section)<br />}</span></pre><figure name="023a" id="023a" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*lo3LYDVtl07qwL4oZXnOPg.png" data-width="1170" data-height="2532" src="https://cdn-images-1.medium.com/max/800/1*lo3LYDVtl07qwL4oZXnOPg.png"></figure><p name="36a9" id="36a9" class="graf graf--p graf-after--figure">當我們設定 contentInsets 時，它也會影響 fractional 計算的大小。</p><ul class="postList"><li name="4b66" id="4b66" class="graf graf--li graf-after--p">item size 以 fractional 計算:</li></ul><p name="34d0" id="34d0" class="graf graf--p graf-after--li">group 若有設定 contentInsets，則須扣除 contentInsets 再乘 fractional 設定的比例。</p><ul class="postList"><li name="e782" id="e782" class="graf graf--li graf-after--p">group size 以 fractional 計算</li></ul><p name="3130" id="3130" class="graf graf--p graf-after--li">section 若有設定 contentInsets，則要考慮 contentInsets。group 垂直排列時，須扣除 contentInsets 的 leading &amp; trailing 再乘 fractional 設定的比例。group 水平排列時，須扣除 contentInsets 的 top &amp; bottom 再乘 fractional 設定的比例。</p><h3 name="f9cd" id="f9cd" class="graf graf--h3 graf-after--p">控制內容的捲動方向</h3><h4 name="daab" id="daab" class="graf graf--h4 graf-after--h3"><strong class="markup--strong markup--h4-strong">方法1: 設定 UICollectionViewCompositionalLayoutConfiguration 的 scrollDirection</strong></h4><p name="4c74" id="4c74" class="graf graf--p graf-after--h4">當 collection view 採用 UICollectionViewCompositionalLayout 時，預設的捲動方向是 vertical，group 將延著垂直方向排列。</p><p name="9e23" id="9e23" class="graf graf--p graf-after--p">我們可透過 UICollectionViewCompositionalLayoutConfiguration 的 scrollDirection 設定 horizontal 或 vertical。當我們設為 horizontal 時，collection view 將變成水平捲動，group 將延著水平方向排列。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="9aed" id="9aed" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">generateLayout</span>() -&gt; <span class="hljs-type">UICollectionViewLayout</span> {<br />        <span class="hljs-keyword">let</span> itemSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .absolute(<span class="hljs-number">100</span>), heightDimension: .fractionalHeight(<span class="hljs-number">1</span>))<br />        <span class="hljs-keyword">let</span> item <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutItem</span>(layoutSize: itemSize)<br />        <span class="hljs-keyword">let</span> groupSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .absolute(<span class="hljs-number">250</span>), heightDimension: .fractionalHeight(<span class="hljs-number">1</span>))<br />        <span class="hljs-keyword">let</span> group <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutGroup</span>.horizontal(layoutSize: groupSize, subitems: [item])<br />        <span class="hljs-keyword">let</span> section <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSection</span>(group: group)<br />        <span class="hljs-keyword">let</span> configuration <span class="hljs-operator">=</span> <span class="hljs-type">UICollectionViewCompositionalLayoutConfiguration</span>()<br />        configuration.scrollDirection <span class="hljs-operator">=</span> .horizontal<br />        <span class="hljs-keyword">return</span> <span class="hljs-type">UICollectionViewCompositionalLayout</span>(section: section, configuration: configuration)<br />}</span></pre><figure name="f859" id="f859" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*Rpp4hdDsLls6iB0pDiFiAQ.png" data-width="1170" data-height="2532" src="https://cdn-images-1.medium.com/max/800/1*Rpp4hdDsLls6iB0pDiFiAQ.png"></figure><h4 name="4975" id="4975" class="graf graf--h4 graf-after--figure">方法 2: 設定 section 的 orthogonalScrollingBehavior</h4><p name="ce8b" id="ce8b" class="graf graf--p graf-after--h4">section 裡 group 預設的排列方向會跟 UICollectionViewCompositionalLayoutConfiguration 的 scrollDirection 一致，由於 scrollDirection 預設為 vertical，因此 group 會由上而下排列。</p><p name="68b5" id="68b5" class="graf graf--p graf-after--p">當 section 的 orthogonalScrollingBehavior 不是 none 時， group 的排列方向會跟 scrollDirection 正交。</p><p name="603d" id="603d" class="graf graf--p graf-after--p">什麼是正交呢？它就像唱反調，喜歡跟別人不一樣。換句話說，當 scrollDirection 為 vertical，group 將延水平方向排列。當 scrollDirection 為 horizontal，group 將延垂直方向排列。</p><p name="c493" id="c493" class="graf graf--p graf-after--p">以下例子我們將 orthogonalScrollingBehavior 設為 continuous，由於 scrollDirection 預設為 vertical，因此 group 將延水平方向排列，我們可以水平捲動。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="5a6d" id="5a6d" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">generateLayout</span>() -&gt; <span class="hljs-type">UICollectionViewLayout</span> {<br />        <span class="hljs-keyword">let</span> itemSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .absolute(<span class="hljs-number">100</span>), heightDimension: .fractionalHeight(<span class="hljs-number">1</span>))<br />        <span class="hljs-keyword">let</span> item <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutItem</span>(layoutSize: itemSize)<br />        <span class="hljs-keyword">let</span> groupSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .absolute(<span class="hljs-number">250</span>), heightDimension: .fractionalHeight(<span class="hljs-number">1</span>))<br />        <span class="hljs-keyword">let</span> group <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutGroup</span>.horizontal(layoutSize: groupSize, subitems: [item])<br />        <span class="hljs-keyword">let</span> section <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSection</span>(group: group)<br />        section.orthogonalScrollingBehavior <span class="hljs-operator">=</span> .continuous<br />        <span class="hljs-keyword">return</span> <span class="hljs-type">UICollectionViewCompositionalLayout</span>(section: section)<br />}</span></pre><figure name="9f24" id="9f24" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*Rpp4hdDsLls6iB0pDiFiAQ.png" data-width="1170" data-height="2532" src="https://cdn-images-1.medium.com/max/800/1*Rpp4hdDsLls6iB0pDiFiAQ.png"></figure><p name="a746" id="a746" class="graf graf--p graf-after--figure">值得注意的，剛剛的例子是 section 裡的內容可以水平捲動，但 collection view 本身還是垂直捲動。若想將 collection view 本身的捲動關掉，記得要將它的 isScrollEnabled 設為 false</p><h3 name="8776" id="8776" class="graf graf--h3 graf-after--p">控制捲動行為的 orthogonalScrollingBehavior，分頁和露出前一個 / 下一個的部分內容</h3><p name="7b67" id="7b67" class="graf graf--p graf-after--h3">我們可以透過 orthogonalScrollingBehavior 調整畫面捲動的行為，接下來讓我們看看幾種不同的捲動行為。</p><h4 name="143d" id="143d" class="graf graf--h4 graf-after--p">continuous</h4><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="0541" id="0541" class="graf graf--pre graf-after--h4 graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">generateLayout</span>() -&gt; <span class="hljs-type">UICollectionViewLayout</span> {<br />        <span class="hljs-keyword">let</span> itemSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1</span>), heightDimension: .fractionalHeight(<span class="hljs-number">1</span>))<br />        <span class="hljs-keyword">let</span> item <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutItem</span>(layoutSize: itemSize)<br />        <span class="hljs-keyword">let</span> groupSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1</span>), heightDimension: .fractionalHeight(<span class="hljs-number">1</span>))<br />        <span class="hljs-keyword">let</span> group <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutGroup</span>.horizontal(layoutSize: groupSize, subitems: [item])<br />        <span class="hljs-keyword">let</span> section <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSection</span>(group: group)<br />        section.orthogonalScrollingBehavior <span class="hljs-operator">=</span> .continuous<br />        <span class="hljs-keyword">return</span> <span class="hljs-type">UICollectionViewCompositionalLayout</span>(section: section)<br />}</span></pre><p name="c48a" id="c48a" class="graf graf--p graf-after--pre">畫面水平捲動，可停留在任何一個位置，沒有分頁的效果。</p><figure name="e7cf" id="e7cf" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*exLxN1RZHrIutBVRXnhEsg.png" data-width="1066" data-height="1072" src="https://cdn-images-1.medium.com/max/800/1*exLxN1RZHrIutBVRXnhEsg.png"></figure><h4 name="4836" id="4836" class="graf graf--h4 graf-after--figure">paging</h4><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="e277" id="e277" class="graf graf--pre graf-after--h4 graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">generateLayout</span>() -&gt; <span class="hljs-type">UICollectionViewLayout</span> {<br />        <span class="hljs-keyword">let</span> itemSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1</span>), heightDimension: .fractionalHeight(<span class="hljs-number">1</span>))<br />        <span class="hljs-keyword">let</span> item <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutItem</span>(layoutSize: itemSize)<br />        <span class="hljs-keyword">let</span> groupSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1</span>), heightDimension: .fractionalHeight(<span class="hljs-number">1</span>))<br />        <span class="hljs-keyword">let</span> group <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutGroup</span>.horizontal(layoutSize: groupSize, subitems: [item])<br />        <span class="hljs-keyword">let</span> section <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSection</span>(group: group)<br />        section.orthogonalScrollingBehavior <span class="hljs-operator">=</span> .paging<br />        <span class="hljs-keyword">return</span> <span class="hljs-type">UICollectionViewCompositionalLayout</span>(section: section)<br />}</span></pre><p name="d314" id="d314" class="graf graf--p graf-after--pre">畫面水平捲動，搭配分頁效果，分頁的寬度是 collection view 的寬度。</p><figure name="c240" id="c240" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*32ovN1mqVRbjKXrpuSB_9Q.png" data-width="1092" data-height="1092" src="https://cdn-images-1.medium.com/max/800/1*32ovN1mqVRbjKXrpuSB_9Q.png"></figure><p name="a613" id="a613" class="graf graf--p graf-after--figure">不過當 group 之間有間距時，剛剛的分頁效果卻會產生問題。因為 paging 時分頁的寬度是 collection view 的寬度，因此滑動後我們會看到間距露出來。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="00b5" id="00b5" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">generateLayout</span>() -&gt; <span class="hljs-type">UICollectionViewLayout</span> {<br />        <span class="hljs-keyword">let</span> itemSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1</span>), heightDimension: .fractionalHeight(<span class="hljs-number">1</span>))<br />        <span class="hljs-keyword">let</span> item <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutItem</span>(layoutSize: itemSize)<br />        <span class="hljs-keyword">let</span> groupSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1</span>), heightDimension: .fractionalHeight(<span class="hljs-number">1</span>))<br />        <span class="hljs-keyword">let</span> group <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutGroup</span>.horizontal(layoutSize: groupSize, subitems: [item])<br />        <span class="hljs-keyword">let</span> section <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSection</span>(group: group)<br />        section.interGroupSpacing <span class="hljs-operator">=</span> <span class="hljs-number">10</span><br />        section.orthogonalScrollingBehavior <span class="hljs-operator">=</span> .paging<br />        <span class="hljs-keyword">return</span> <span class="hljs-type">UICollectionViewCompositionalLayout</span>(section: section)<br />}</span></pre><figure name="ba18" id="ba18" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*VCp-4hSLB2KEiev_mNnmxQ.png" data-width="1614" data-height="1092" src="https://cdn-images-1.medium.com/max/800/1*VCp-4hSLB2KEiev_mNnmxQ.png"></figure><h4 name="0dc7" id="0dc7" class="graf graf--h4 graf-after--figure">groupPaging</h4><p name="9c51" id="9c51" class="graf graf--p graf-after--h4">groupPaging 可解決剛剛的問題，它的分頁將以 group 為單位，滑動停止時將剛好顯示 group 的起點。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="cbaa" id="cbaa" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">generateLayout</span>() -&gt; <span class="hljs-type">UICollectionViewLayout</span> {<br />        <span class="hljs-keyword">let</span> itemSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1</span>), heightDimension: .fractionalHeight(<span class="hljs-number">1</span>))<br />        <span class="hljs-keyword">let</span> item <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutItem</span>(layoutSize: itemSize)<br />        <span class="hljs-keyword">let</span> groupSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1</span>), heightDimension: .fractionalHeight(<span class="hljs-number">1</span>))<br />        <span class="hljs-keyword">let</span> group <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutGroup</span>.horizontal(layoutSize: groupSize, subitems: [item])<br />        <span class="hljs-keyword">let</span> section <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSection</span>(group: group)<br />        section.interGroupSpacing <span class="hljs-operator">=</span> <span class="hljs-number">10</span><br />        section.orthogonalScrollingBehavior <span class="hljs-operator">=</span> .groupPaging<br />        <span class="hljs-keyword">return</span> <span class="hljs-type">UICollectionViewCompositionalLayout</span>(section: section)<br />}</span></pre><p name="a9b1" id="a9b1" class="graf graf--p graf-after--pre">如下圖所示，滑動停止時一定會剛好顯示 group 的起點，不會露出間距。</p><figure name="668f" id="668f" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*luSjwXc0pZlB3v6jo-8PWQ.png" data-width="1688" data-height="1104" src="https://cdn-images-1.medium.com/max/800/1*luSjwXc0pZlB3v6jo-8PWQ.png"></figure><h4 name="135b" id="135b" class="graf graf--h4 graf-after--figure">分頁，露出上一個 / 下一個的部分內容</h4><p name="3ac0" id="3ac0" class="graf graf--p graf-after--h4">接著讓我們挑戰 iOS App 時常看到的酷炫設計，不只有分頁，還可以露出前一個 / 下一個的部分內容。</p><h4 name="a303" id="a303" class="graf graf--h4 graf-after--p">露出下一個的部分內容: groupPaging</h4><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="2410" id="2410" class="graf graf--pre graf-after--h4 graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">generateLayout</span>() -&gt; <span class="hljs-type">UICollectionViewLayout</span> {<br />        <span class="hljs-keyword">let</span> space: <span class="hljs-type">Double</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span><br />        <span class="hljs-keyword">let</span> itemSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1</span>), heightDimension: .fractionalHeight(<span class="hljs-number">1</span>))<br />        <span class="hljs-keyword">let</span> item <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutItem</span>(layoutSize: itemSize)<br />        <span class="hljs-keyword">let</span> groupSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">0.9</span>), heightDimension: .fractionalHeight(<span class="hljs-number">1</span>))<br />        <span class="hljs-keyword">let</span> group <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutGroup</span>.horizontal(layoutSize: groupSize, subitems: [item])<br />        <span class="hljs-keyword">let</span> section <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSection</span>(group: group)<br />        section.interGroupSpacing <span class="hljs-operator">=</span> space<br />        section.orthogonalScrollingBehavior <span class="hljs-operator">=</span> .groupPaging<br />        section.contentInsets <span class="hljs-operator">=</span> <span class="hljs-type">NSDirectionalEdgeInsets</span>(top: <span class="hljs-number">0</span>, leading: space, bottom: <span class="hljs-number">0</span>, trailing: space)<br />        <span class="hljs-keyword">return</span> <span class="hljs-type">UICollectionViewCompositionalLayout</span>(section: section)<br />}</span></pre><p name="de04" id="de04" class="graf graf--p graf-after--pre">說明</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="c8a1" id="c8a1" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> groupSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">0.9</span>), heightDimension: .fractionalHeight(<span class="hljs-number">1</span>))</span></pre><p name="7132" id="7132" class="graf graf--p graf-after--pre">group 的寬度是 collection view 寬度的 0.9 倍，因此畫面上將露出下一個的部分內容。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="166e" id="166e" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">section.orthogonalScrollingBehavior <span class="hljs-operator">=</span> .groupPaging</span></pre><p name="37bb" id="37bb" class="graf graf--p graf-after--pre">滑動停止時將剛好停在 group 的起點。</p><figure name="d3b3" id="d3b3" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*Qa4BNUxqjDgfZMaKY541xw.png" data-width="1068" data-height="1066" src="https://cdn-images-1.medium.com/max/800/1*Qa4BNUxqjDgfZMaKY541xw.png"></figure><h4 name="f14c" id="f14c" class="graf graf--h4 graf-after--figure">露出上一個 / 下一個的部分內容: groupPagingCentered</h4><p name="9815" id="9815" class="graf graf--p graf-after--h4">不只是露出下一個，我們也可以露出上一個的部分內容。我們可以改用 groupPagingCentered。滑動停止時它將讓 group 置中，因此前一個跟下一個都可以露出。(ps: 以下例子若採用 interGroupSpacing 設定間距會出問題，因此要從 item 的 contentInsets 設間距，間距將是 space * 2）</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="46d2" id="46d2" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">generateLayout</span>() -&gt; <span class="hljs-type">UICollectionViewLayout</span> {<br />        <span class="hljs-keyword">let</span> space: <span class="hljs-type">Double</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span><br />        <span class="hljs-keyword">let</span> itemSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1</span>), heightDimension: .fractionalHeight(<span class="hljs-number">1</span>))<br />        <span class="hljs-keyword">let</span> item <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutItem</span>(layoutSize: itemSize)<br />        item.contentInsets <span class="hljs-operator">=</span> <span class="hljs-type">NSDirectionalEdgeInsets</span>(top: <span class="hljs-number">0</span>, leading: space, bottom: <span class="hljs-number">0</span>, trailing: space)<br />        <span class="hljs-keyword">let</span> groupSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">0.9</span>), heightDimension: .fractionalHeight(<span class="hljs-number">1</span>))<br />        <span class="hljs-keyword">let</span> group <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutGroup</span>.horizontal(layoutSize: groupSize, subitems: [item])<br />        <span class="hljs-keyword">let</span> section <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSection</span>(group: group)<br />        section.orthogonalScrollingBehavior <span class="hljs-operator">=</span> .groupPagingCentered<br />        <span class="hljs-keyword">return</span> <span class="hljs-type">UICollectionViewCompositionalLayout</span>(section: section)<br />}</span></pre><figure name="0c12" id="0c12" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*UJXDbntYdXLl8GZom29z3A.png" data-width="1072" data-height="1096" src="https://cdn-images-1.medium.com/max/800/1*UJXDbntYdXLl8GZom29z3A.png"></figure><h3 name="bee6" id="bee6" class="graf graf--h3 graf-after--figure">continuousGroupLeadingBoundary</h3><p name="8335" id="8335" class="graf graf--p graf-after--h3">最後還有一個特別的捲動效果 continuousGroupLeadingBoundary，它同時具有快速滑動跟分頁的優點。</p><ul class="postList"><li name="abbc" id="abbc" class="graf graf--li graf-after--p">它可以快速滑動，不像分頁一次只能滑一個。</li><li name="7530" id="7530" class="graf graf--li graf-after--li">當滑動停止時，它將剛好停在 group 的起點，所以圖片不會被切到。</li></ul><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="e029" id="e029" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">generateLayout</span>() -&gt; <span class="hljs-type">UICollectionViewLayout</span> {<br />        <span class="hljs-keyword">let</span> itemSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1</span>), heightDimension: .fractionalWidth(<span class="hljs-number">1</span>))<br />        <span class="hljs-keyword">let</span> item <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutItem</span>(layoutSize: itemSize)<br />        <span class="hljs-keyword">let</span> groupSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalHeight(<span class="hljs-number">1</span>), heightDimension: .fractionalHeight(<span class="hljs-number">1</span>))<br />        <span class="hljs-keyword">let</span> group <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutGroup</span>.horizontal(layoutSize: groupSize, subitems: [item])<br />        <span class="hljs-keyword">let</span> section <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSection</span>(group: group)<br />        section.interGroupSpacing <span class="hljs-operator">=</span> <span class="hljs-number">10</span><br />        section.orthogonalScrollingBehavior <span class="hljs-operator">=</span> .continuousGroupLeadingBoundary<br />        <span class="hljs-keyword">return</span> <span class="hljs-type">UICollectionViewCompositionalLayout</span>(section: section)<br />}</span></pre><p name="87f7" id="87f7" class="graf graf--p graf-after--pre">彼得潘大力一滑，從一開始的第一集跑到第八集漫畫。</p><figure name="3f90" id="3f90" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*3IhNQR9oe-M_gGkbUHtXvA.png" data-width="1084" data-height="1086" src="https://cdn-images-1.medium.com/max/800/1*3IhNQR9oe-M_gGkbUHtXvA.png"></figure><h3 name="b470" id="b470" class="graf graf--h3 graf-after--figure">多個 section</h3><p name="737f" id="737f" class="graf graf--p graf-after--h3">剛剛看到的例子只產生一個 NSCollectionLayoutSection，因此只會有一種 section 的版面設計。就算我們的 App 有多個 section，每個 section 會是同樣的排版，例如以下例子:</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="27fe" id="27fe" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewController</span>: <span class="hljs-title class_">UIViewController</span> {<br />    <br />    <span class="hljs-keyword">@IBOutlet</span> <span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> collectionView: <span class="hljs-type">UICollectionView</span>!<br />    <br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {<br />        <span class="hljs-keyword">super</span>.viewDidLoad()<br />        collectionView.collectionViewLayout <span class="hljs-operator">=</span> generateLayout()<br />    }<br />    <br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">generateLayout</span>() -&gt; <span class="hljs-type">UICollectionViewLayout</span> {<br />        <span class="hljs-keyword">let</span> itemSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1</span>), heightDimension: .fractionalWidth(<span class="hljs-number">1</span>))<br />        <span class="hljs-keyword">let</span> item <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutItem</span>(layoutSize: itemSize)<br />        <span class="hljs-keyword">let</span> groupSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .absolute(<span class="hljs-number">300</span>), heightDimension: .absolute(<span class="hljs-number">300</span>))<br />        <span class="hljs-keyword">let</span> group <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutGroup</span>.horizontal(layoutSize: groupSize, subitems: [item])<br />        <span class="hljs-keyword">let</span> section <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSection</span>(group: group)<br />        section.interGroupSpacing <span class="hljs-operator">=</span> <span class="hljs-number">10</span><br />        section.contentInsets <span class="hljs-operator">=</span> <span class="hljs-type">NSDirectionalEdgeInsets</span>(top: <span class="hljs-number">0</span>, leading: <span class="hljs-number">0</span>, bottom: <span class="hljs-number">30</span>, trailing: <span class="hljs-number">0</span>)<br />        section.orthogonalScrollingBehavior <span class="hljs-operator">=</span> .groupPaging<br />        <span class="hljs-keyword">return</span> <span class="hljs-type">UICollectionViewCompositionalLayout</span>(section: section)<br />    }<br />}<br /><br /><span class="hljs-keyword">extension</span> <span class="hljs-title class_">ViewController</span>: <span class="hljs-title class_">UICollectionViewDataSource</span> {<br />    <br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">numberOfSections</span>(<span class="hljs-params">in</span> <span class="hljs-params">collectionView</span>: <span class="hljs-type">UICollectionView</span>) -&gt; <span class="hljs-type">Int</span> {<br />        <span class="hljs-keyword">return</span> <span class="hljs-number">2</span><br />    }<br /><br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">collectionView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">collectionView</span>: <span class="hljs-type">UICollectionView</span>, <span class="hljs-params">numberOfItemsInSection</span> <span class="hljs-params">section</span>: <span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">Int</span> {<br />        <span class="hljs-keyword">if</span> section <span class="hljs-operator">==</span> <span class="hljs-number">0</span> {<br />            <span class="hljs-keyword">return</span> <span class="hljs-number">15</span><br />        } <span class="hljs-keyword">else</span> {<br />            <span class="hljs-keyword">return</span> <span class="hljs-number">8</span><br />        }<br />    }<br />    <br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">collectionView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">collectionView</span>: <span class="hljs-type">UICollectionView</span>, <span class="hljs-params">cellForItemAt</span> <span class="hljs-params">indexPath</span>: <span class="hljs-type">IndexPath</span>) -&gt; <span class="hljs-type">UICollectionViewCell</span> {<br />        <span class="hljs-keyword">let</span> cell <span class="hljs-operator">=</span> collectionView.dequeueReusableCell(withReuseIdentifier: <span class="hljs-string">&quot;<span class="hljs-subst">\(CollectionViewCell.<span class="hljs-keyword">self</span>)</span>&quot;</span>, for: indexPath) <span class="hljs-keyword">as!</span> <span class="hljs-type">CollectionViewCell</span><br />        <span class="hljs-keyword">if</span> indexPath.section <span class="hljs-operator">==</span> <span class="hljs-number">0</span> {<br />            cell.imageView.image <span class="hljs-operator">=</span> <span class="hljs-type">UIImage</span>(named: <span class="hljs-string">&quot;聖鬥士星矢<span class="hljs-subst">\(indexPath.item <span class="hljs-operator">+</span> <span class="hljs-number">1</span>)</span>&quot;</span>)<br />        } <span class="hljs-keyword">else</span> {<br />            cell.imageView.image <span class="hljs-operator">=</span> <span class="hljs-type">UIImage</span>(named: <span class="hljs-string">&quot;spider<span class="hljs-subst">\(indexPath.item <span class="hljs-operator">+</span> <span class="hljs-number">1</span>)</span>&quot;</span>)<br />        }<br />        <span class="hljs-keyword">return</span> cell<br />    }    <br />}</span></pre><p name="275d" id="275d" class="graf graf--p graf-after--pre">collection view 有兩個 section，分別顯示帥氣的聖鬥士星矢跟 spider man。</p><figure name="2208" id="2208" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*UYb7_TRDAtXvEmP6xDekow.png" data-width="1170" data-height="2532" src="https://cdn-images-1.medium.com/max/800/1*UYb7_TRDAtXvEmP6xDekow.png"></figure><h3 name="c026" id="c026" class="graf graf--h3 graf-after--figure">每個 section 採用不同的排版，比方整個頁面垂直捲動，頁面裡有水平捲動的區塊</h3><p name="eb94" id="eb94" class="graf graf--p graf-after--h3">我們也可以產生多個 NSCollectionLayoutSection，讓每個 section 採用不同的排版。</p><p name="8b48" id="8b48" class="graf graf--p graf-after--p">ps: 在實驗以下範例前，先回到 storyboard，將 collection view 高度 300 的條件拿掉，加入跟 safe area bottom 間距 0 的條件。</p><figure name="13eb" id="13eb" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*EkIxxYEiGyoHKL0AaPW3Dg.png" data-width="1166" data-height="794" src="https://cdn-images-1.medium.com/max/800/1*EkIxxYEiGyoHKL0AaPW3Dg.png"></figure><h4 name="41dd" id="41dd" class="graf graf--h4 graf-after--figure">範例 1: 第一個 section 一次顯示一張圖，第二個 section 一次顯示兩張圖</h4><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="541d" id="541d" class="graf graf--pre graf-after--h4 graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">generateLayout</span>() -&gt; <span class="hljs-type">UICollectionViewLayout</span> {<br />        <span class="hljs-type">UICollectionViewCompositionalLayout</span> { sectionIndex, environment <span class="hljs-keyword">in</span><br />            <br />            <span class="hljs-keyword">let</span> itemCountInGroup <span class="hljs-operator">=</span> sectionIndex <span class="hljs-operator">==</span> <span class="hljs-number">0</span> <span class="hljs-operator">?</span> <span class="hljs-number">1</span> : <span class="hljs-number">2</span><br />            <span class="hljs-keyword">let</span> ratio <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-operator">/</span> <span class="hljs-type">Double</span>(itemCountInGroup)<br />            <span class="hljs-keyword">let</span> itemSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(ratio), heightDimension: .fractionalWidth(ratio))<br />            <span class="hljs-keyword">let</span> item <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutItem</span>(layoutSize: itemSize)<br />            <span class="hljs-keyword">let</span> groupSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1</span>), heightDimension: .estimated(<span class="hljs-number">100</span>))<br />            <span class="hljs-keyword">let</span> group <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutGroup</span>.horizontal(layoutSize: groupSize, subitems: [item])<br />            <span class="hljs-keyword">let</span> section <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSection</span>(group: group)<br />            section.interGroupSpacing <span class="hljs-operator">=</span> <span class="hljs-number">10</span><br />            section.orthogonalScrollingBehavior <span class="hljs-operator">=</span> .groupPaging<br />            <span class="hljs-keyword">return</span> section<br />        }<br />}</span></pre><p name="f62c" id="f62c" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">說明</strong></p><p name="47da" id="47da" class="graf graf--p graf-after--p">生成 UICollectionViewCompositionalLayout 時改用以下的 init。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="96fa" id="96fa" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">init</span>(<span class="hljs-params">sectionProvider</span>: <span class="hljs-keyword">@escaping</span> <span class="hljs-type">UICollectionViewCompositionalLayoutSectionProvider</span>)</span></pre><p name="1006" id="1006" class="graf graf--p graf-after--pre">UICollectionViewCompositionalLayoutSectionProvider 的定義如下</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="fdda" id="fdda" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">typealias</span> <span class="hljs-type">UICollectionViewCompositionalLayoutSectionProvider</span> <span class="hljs-operator">=</span> (<span class="hljs-type">Int</span>, <span class="hljs-type">NSCollectionLayoutEnvironment</span>) -&gt; <span class="hljs-type">NSCollectionLayoutSection</span>?</span></pre><p name="d47b" id="d47b" class="graf graf--p graf-after--pre">在參數 sectionProvider 傳入生成 NSCollectionLayoutSection 的 closure。我們有 2 個 section，因此 closure 將呼叫兩次，參數 sectionIndex 分別是 0 &amp; 1，我們可依據 sectionIndex 設計不同的排版，回傳不同的 section。範例裡依據 sectionIndex 計算不同的 item size，</p><figure name="626e" id="626e" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*mfEO4rP9O67GytjkCikcsQ.png" data-width="1110" data-height="1080" src="https://cdn-images-1.medium.com/max/800/1*mfEO4rP9O67GytjkCikcsQ.png"></figure><h4 name="ccb4" id="ccb4" class="graf graf--h4 graf-after--figure">範例 2: 整個頁面垂直捲動，頁面裡有水平捲動的區塊</h4><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="9724" id="9724" class="graf graf--pre graf-after--h4 graf--preV2"><span class="pre--content"><span class="hljs-keyword">var</span> seiyaSection: <span class="hljs-type">NSCollectionLayoutSection</span> {<br />        <span class="hljs-keyword">let</span> itemSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1</span>), heightDimension: .fractionalWidth(<span class="hljs-number">1</span>))<br />        <span class="hljs-keyword">let</span> item <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutItem</span>(layoutSize: itemSize)<br />        <span class="hljs-keyword">let</span> groupSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .absolute(<span class="hljs-number">300</span>), heightDimension: .absolute(<span class="hljs-number">300</span>))<br />        <span class="hljs-keyword">let</span> group <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutGroup</span>.horizontal(layoutSize: groupSize, subitems: [item])<br />        <span class="hljs-keyword">let</span> section <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSection</span>(group: group)<br />        section.interGroupSpacing <span class="hljs-operator">=</span> <span class="hljs-number">10</span><br />        section.orthogonalScrollingBehavior <span class="hljs-operator">=</span> .groupPaging<br />        <span class="hljs-keyword">return</span> section<br />}<br />    <br /><span class="hljs-keyword">var</span> spiderManSection: <span class="hljs-type">NSCollectionLayoutSection</span> {<br />        <span class="hljs-keyword">let</span> padding: <span class="hljs-type">Double</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span><br />        <span class="hljs-keyword">let</span> itemSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1</span><span class="hljs-operator">/</span><span class="hljs-number">2</span>), heightDimension: .fractionalWidth(<span class="hljs-number">1</span><span class="hljs-operator">/</span><span class="hljs-number">2</span>))<br />        <span class="hljs-keyword">let</span> item <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutItem</span>(layoutSize: itemSize)<br />        item.contentInsets <span class="hljs-operator">=</span> <span class="hljs-type">NSDirectionalEdgeInsets</span>(top: <span class="hljs-number">0</span>, leading: padding, bottom: <span class="hljs-number">0</span>, trailing: <span class="hljs-number">0</span>)<br />        <br />        <span class="hljs-keyword">let</span> groupSize <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSize</span>(widthDimension: .fractionalWidth(<span class="hljs-number">1</span>), heightDimension: .estimated(<span class="hljs-number">100</span>))<br />        <span class="hljs-keyword">let</span> group <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutGroup</span>.horizontal(layoutSize: groupSize, subitems: [item])<br />        <span class="hljs-keyword">let</span> section <span class="hljs-operator">=</span> <span class="hljs-type">NSCollectionLayoutSection</span>(group: group)<br />        section.interGroupSpacing <span class="hljs-operator">=</span> padding<br />        section.contentInsets <span class="hljs-operator">=</span> <span class="hljs-type">NSDirectionalEdgeInsets</span>(top: padding, leading: <span class="hljs-number">0</span>, bottom: padding, trailing: padding)<br />        <span class="hljs-keyword">return</span> section<br />}<br />    <br /><span class="hljs-keyword">func</span> <span class="hljs-title function_">generateLayout</span>() -&gt; <span class="hljs-type">UICollectionViewLayout</span> {<br />        <span class="hljs-type">UICollectionViewCompositionalLayout</span> { [<span class="hljs-keyword">unowned</span> <span class="hljs-keyword">self</span>] sectionIndex, environment <span class="hljs-keyword">in</span><br />            <span class="hljs-keyword">if</span> sectionIndex <span class="hljs-operator">==</span> <span class="hljs-number">0</span> {<br />                <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>.seiyaSection<br />            } <span class="hljs-keyword">else</span> {<br />                <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>.spiderManSection<br />            }<br />        }<br />}</span></pre><p name="3cb8" id="3cb8" class="graf graf--p graf-after--pre">定義回傳 NSCollectionLayoutSection 的 computed property seiyaSection &amp; spiderManSection。值得注意的，在產生 UICollectionViewCompositionalLayout 時必須加上 capture list [unowned self]，不然會產生 reference cycle 的記憶體問題。</p><figure name="21e4" id="21e4" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*mojzsw0mWBBSBz170jVk9Q.png" data-width="1676" data-height="1078" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*mojzsw0mWBBSBz170jVk9Q.png"></figure><h3 name="e5b7" id="e5b7" class="graf graf--h3 graf-after--figure">UICollectionViewCompositionalLayout 常見排版範例</h3><div name="2b05" id="2b05" class="graf graf--mixtapeEmbed graf-after--h3"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/uicollectionviewcompositionallayout-%E5%B8%B8%E8%A6%8B%E6%8E%92%E7%89%88%E7%AF%84%E4%BE%8B-7656068783d9" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/uicollectionviewcompositionallayout-%E5%B8%B8%E8%A6%8B%E6%8E%92%E7%89%88%E7%AF%84%E4%BE%8B-7656068783d9" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/uicollectionviewcompositionallayout-%E5%B8%B8%E8%A6%8B%E6%8E%92%E7%89%88%E7%AF%84%E4%BE%8B-7656068783d9"><strong class="markup--strong markup--mixtapeEmbed-strong">UICollectionViewCompositionalLayout 常見排版範例</strong><br><em class="markup--em markup--mixtapeEmbed-em">iOS 13 推出了 UICollectionViewCompositionalLayout，幫助我們更方便排版畫面，以下連結說明它的相關排版原理。</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/uicollectionviewcompositionallayout-%E5%B8%B8%E8%A6%8B%E6%8E%92%E7%89%88%E7%AF%84%E4%BE%8B-7656068783d9" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="f6d9c872e1b67d156e057ffe064a077b" data-thumbnail-img-id="1*XBVGdXDUNmrVOlYjWLc72A.png" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*XBVGdXDUNmrVOlYjWLc72A.png);"></a></div><h3 name="b638" id="b638" class="graf graf--h3 graf-after--mixtapeEmbed">collection view cell 不同高度的對齊問題</h3><p name="ea36" id="ea36" class="graf graf--p graf-after--h3">UICollectionViewCompositionalLayout 還可以完美解決 flow layout 在 cell 不同高度的對齊問題，相關說明可參考以下連結。</p><div name="e6c8" id="e6c8" class="graf graf--mixtapeEmbed graf-after--p graf--trailing"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/collection-view-cell-%E4%B8%8D%E5%90%8C%E9%AB%98%E5%BA%A6%E7%9A%84%E5%B0%8D%E9%BD%8A%E5%95%8F%E9%A1%8C-c66f7df2f929" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/collection-view-cell-%E4%B8%8D%E5%90%8C%E9%AB%98%E5%BA%A6%E7%9A%84%E5%B0%8D%E9%BD%8A%E5%95%8F%E9%A1%8C-c66f7df2f929" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/collection-view-cell-%E4%B8%8D%E5%90%8C%E9%AB%98%E5%BA%A6%E7%9A%84%E5%B0%8D%E9%BD%8A%E5%95%8F%E9%A1%8C-c66f7df2f929"><strong class="markup--strong markup--mixtapeEmbed-strong">collection view cell 不同高度的對齊問題</strong><br><em class="markup--em markup--mixtapeEmbed-em">當 collection view cell 有著不同高度時，在 flow layout 會出現特別的對齊問題，如下圖所示，第一個 cell 比第二個高，因此第二個 cell 會垂直置中顯示。</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/collection-view-cell-%E4%B8%8D%E5%90%8C%E9%AB%98%E5%BA%A6%E7%9A%84%E5%B0%8D%E9%BD%8A%E5%95%8F%E9%A1%8C-c66f7df2f929" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="e69977b3991f372126483b52cc4b7efd" data-thumbnail-img-id="1*tW-79s9TNBi6vqKeuJgddQ.png" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*tW-79s9TNBi6vqKeuJgddQ.png);"></a></div></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@apppeterpan" class="p-author h-card">彼得潘的 iOS App Neverland</a> on <a href="https://medium.com/p/ab0c81ffecf6"><time class="dt-published" datetime="2021-08-25T08:56:48.666Z">August 25, 2021</time></a>.</p><p><a href="https://medium.com/@apppeterpan/%E6%96%B9%E4%BE%BF%E6%8E%92%E7%89%88%E7%9A%84-uicollectionviewcompositionallayout-%E5%88%9D%E9%AB%94%E9%A9%97-ab0c81ffecf6" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on November 16, 2025.</p></footer></article></body></html>