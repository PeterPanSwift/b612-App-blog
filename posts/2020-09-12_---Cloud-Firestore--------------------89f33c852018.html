<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>åˆ©ç”¨ Cloud Firestore å¯¦ç¾è³‡æ–™çš„å»ºç«‹ï¼Œè®€å–ï¼Œä¿®æ”¹ &amp; åˆªé™¤</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">åˆ©ç”¨ Cloud Firestore å¯¦ç¾è³‡æ–™çš„å»ºç«‹ï¼Œè®€å–ï¼Œä¿®æ”¹ &amp; åˆªé™¤</h1>
</header>
<section data-field="subtitle" class="p-summary">
Firebase æä¾›å¼·å¤§çš„ Firestore è®“æˆ‘å€‘ä¸Šå‚³å’Œä¸‹è¼‰è³‡æ–™ï¼Œä¸éå¾å‰æ’°å¯«ä¸Šå‚³å’Œä¸‹è¼‰è³‡æ–™çš„ç›¸é—œç¨‹å¼æ™‚ï¼Œä¸¦ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Œå› ç‚ºè³‡æ–™çš„å‹åˆ¥æ˜¯ [String: Any]ï¼Œæˆ‘å€‘éœ€è¦è‡ªå·±å¯«ç¨‹å¼å°‡å®ƒè½‰æ›æˆæ–¹ä¾¿ App ä½¿ç”¨çš„è‡ªè¨‚å‹åˆ¥ã€‚
</section>
<section data-field="body" class="e-content">
<section name="4563" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="9000" id="9000" class="graf graf--h3 graf--leading graf--title"><strong class="markup--strong markup--h3-strong"><em class="markup--em markup--h3-em">åˆ©ç”¨ Cloud Firestore å¯¦ç¾è³‡æ–™çš„å»ºç«‹ï¼Œè®€å–ï¼Œä¿®æ”¹ &amp;Â åˆªé™¤</em></strong></h3><p name="5257" id="5257" class="graf graf--p graf-after--h3">Firebase æä¾›å¼·å¤§çš„ Firestore è®“æˆ‘å€‘ä¸Šå‚³å’Œä¸‹è¼‰è³‡æ–™ï¼Œæ¥ä¸‹ä¾†è®“æˆ‘å€‘ä¸€æ­¥æ­¥èªè­˜å®ƒï¼Œåˆ©ç”¨å®ƒå¯¦ç¾è³‡æ–™çš„å»ºç«‹ï¼Œè®€å–ï¼Œä¿®æ”¹ &amp; åˆªé™¤ã€‚</p><h3 name="18bb" id="18bb" class="graf graf--h3 graf-after--p">ä½¿ç”¨ FirebaseFirestoreSwift å‰çš„æº–å‚™å‹•ä½œ</h3><blockquote name="1425" id="1425" class="graf graf--blockquote graf-after--h3"><strong class="markup--strong markup--blockquote-strong">å»ºç«‹ Firebase å°ˆæ¡ˆ</strong></blockquote><div name="f76e" id="f76e" class="graf graf--mixtapeEmbed graf-after--blockquote"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%BB%BA%E7%AB%8B-firebase-%E5%B0%88%E6%A1%88-fbd6d19808c3" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%BB%BA%E7%AB%8B-firebase-%E5%B0%88%E6%A1%88-fbd6d19808c3" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%BB%BA%E7%AB%8B-firebase-%E5%B0%88%E6%A1%88-fbd6d19808c3"><strong class="markup--strong markup--mixtapeEmbed-strong">å»ºç«‹ Firebase å°ˆæ¡ˆ</strong><br><em class="markup--em markup--mixtapeEmbed-em">1 é€£åˆ° Firebase ç¶²ç«™ã€‚</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%BB%BA%E7%AB%8B-firebase-%E5%B0%88%E6%A1%88-fbd6d19808c3" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="d4346ccd2dd984dcba53c9f4acce4a4f" data-thumbnail-img-id="1*bmkc-Seir7MAzj6eb_08uw.jpeg" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*bmkc-Seir7MAzj6eb_08uw.jpeg);"></a></div><blockquote name="c702" id="c702" class="graf graf--blockquote graf-after--mixtapeEmbed"><strong class="markup--strong markup--blockquote-strong">è¨­å®š iOS App çš„ Firebase åŠŸèƒ½å’Œå®‰è£ FirebaseFirestoreSwift å¥—ä»¶</strong></blockquote><div name="04ec" id="04ec" class="graf graf--mixtapeEmbed graf-after--blockquote"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E8%A8%AD%E5%AE%9A-ios-app-%E7%9A%84-firebase-%E5%8A%9F%E8%83%BD-afcaaabe00f2" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E8%A8%AD%E5%AE%9A-ios-app-%E7%9A%84-firebase-%E5%8A%9F%E8%83%BD-afcaaabe00f2" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E8%A8%AD%E5%AE%9A-ios-app-%E7%9A%84-firebase-%E5%8A%9F%E8%83%BD-afcaaabe00f2"><strong class="markup--strong markup--mixtapeEmbed-strong">è¨­å®š iOS App çš„ Firebase åŠŸèƒ½å’Œå®‰è£ Firebase å¥—ä»¶</strong><br><em class="markup--em markup--mixtapeEmbed-em">1 é€£åˆ° Firebase çš„å°ˆæ¡ˆé é¢ã€‚</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E8%A8%AD%E5%AE%9A-ios-app-%E7%9A%84-firebase-%E5%8A%9F%E8%83%BD-afcaaabe00f2" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="a6897cb16e9940b46d6b5a890c3f21df" data-thumbnail-img-id="1*sU1Rl7a-oTLvzzBRtKBW4A.jpeg" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*sU1Rl7a-oTLvzzBRtKBW4A.jpeg);"></a></div><blockquote name="fecb" id="fecb" class="graf graf--blockquote graf-after--mixtapeEmbed"><strong class="markup--strong markup--blockquote-strong">è¨­å®š Firebase å°ˆæ¡ˆçš„ Cloud Firestore åŠŸèƒ½</strong></blockquote><div name="d1c0" id="d1c0" class="graf graf--mixtapeEmbed graf-after--blockquote"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/firebase-%E5%B0%88%E6%A1%88%E7%9A%84-cloud-firestore-%E8%A8%AD%E5%AE%9A-39334f74b348" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/firebase-%E5%B0%88%E6%A1%88%E7%9A%84-cloud-firestore-%E8%A8%AD%E5%AE%9A-39334f74b348" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/firebase-%E5%B0%88%E6%A1%88%E7%9A%84-cloud-firestore-%E8%A8%AD%E5%AE%9A-39334f74b348"><strong class="markup--strong markup--mixtapeEmbed-strong">Firebase å°ˆæ¡ˆçš„ Cloud Firestore è¨­å®š</strong><br><em class="markup--em markup--mixtapeEmbed-em">1 é€£åˆ° Firebase çš„å°ˆæ¡ˆé é¢ã€‚</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/firebase-%E5%B0%88%E6%A1%88%E7%9A%84-cloud-firestore-%E8%A8%AD%E5%AE%9A-39334f74b348" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="ff6fe1c912763ae87db03caba236dafb" data-thumbnail-img-id="1*PqUoLvdSaOxvKvQGq3fLGQ.jpeg" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*PqUoLvdSaOxvKvQGq3fLGQ.jpeg);"></a></div><blockquote name="04f7" id="04f7" class="graf graf--blockquote graf-after--mixtapeEmbed"><strong class="markup--strong markup--blockquote-strong">Cloud Firestore Data Model ä»‹ç´¹</strong></blockquote><div name="44c9" id="44c9" class="graf graf--mixtapeEmbed graf-after--blockquote"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/cloud-firestore-data-model-%E4%BB%8B%E7%B4%B9-333b57237a12" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/cloud-firestore-data-model-%E4%BB%8B%E7%B4%B9-333b57237a12" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/cloud-firestore-data-model-%E4%BB%8B%E7%B4%B9-333b57237a12"><strong class="markup--strong markup--mixtapeEmbed-strong">Cloud Firestore Data Model ä»‹ç´¹</strong><br><em class="markup--em markup--mixtapeEmbed-em">collection &amp; document</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/cloud-firestore-data-model-%E4%BB%8B%E7%B4%B9-333b57237a12" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="7c4a856c33cd5a8634b03da1c5b40c88" data-thumbnail-img-id="1*K8cjeQvEtuS4Fx1rsYw9eQ.jpeg" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*K8cjeQvEtuS4Fx1rsYw9eQ.jpeg);"></a></div><blockquote name="4160" id="4160" class="graf graf--blockquote graf-after--mixtapeEmbed"><strong class="markup--strong markup--blockquote-strong"><em class="markup--em markup--blockquote-em">å¾ Firebase console æ‰‹å‹•è¼¸å…¥ Cloud Firestore çš„ database å…§å®¹</em></strong></blockquote><p name="767b" id="767b" class="graf graf--p graf-after--blockquote">Cloud Firestore çš„è³‡æ–™å¦‚ä¸‹ï¼Œcollection songs è£¡å„²å­˜å¤œå¤œä¼´å½¼å¾—æ½˜å…¥çœ çš„å¥½æ­Œã€‚è‹¥æƒ³è³‡æ–™éƒ½å¾ç¨‹å¼ä¸Šå‚³ï¼Œä¹Ÿå¯å¿½ç•¥æ­¤æ­¥é©Ÿã€‚</p><figure name="3df3" id="3df3" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*adcI24dOha1aj1xXU0boYw.png" data-width="2596" data-height="1242" src="https://cdn-images-1.medium.com/max/800/1*adcI24dOha1aj1xXU0boYw.png"></figure><div name="166b" id="166b" class="graf graf--mixtapeEmbed graf-after--figure"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%BE%9E-firebase-console-%E6%89%8B%E5%8B%95%E8%BC%B8%E5%85%A5-cloud-firestore-%E7%9A%84-database-%E5%85%A7%E5%AE%B9-f345b0792a45" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%BE%9E-firebase-console-%E6%89%8B%E5%8B%95%E8%BC%B8%E5%85%A5-cloud-firestore-%E7%9A%84-database-%E5%85%A7%E5%AE%B9-f345b0792a45" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%BE%9E-firebase-console-%E6%89%8B%E5%8B%95%E8%BC%B8%E5%85%A5-cloud-firestore-%E7%9A%84-database-%E5%85%A7%E5%AE%B9-f345b0792a45"><strong class="markup--strong markup--mixtapeEmbed-strong">å¾ Firebase console æ‰‹å‹•è¼¸å…¥ Cloud Firestore çš„ database å…§å®¹</strong><br><em class="markup--em markup--mixtapeEmbed-em">Cloud Firestore çš„ database ä¸»è¦åˆ†æˆ collection &amp; document å…©ç¨®æ±è¥¿ã€‚document ä»£è¡¨æˆ‘å€‘çš„è³‡æ–™ï¼Œæ¯”æ–¹æˆ‘å€‘å¯ä»¥ç”¨ documentâ€¦</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%BE%9E-firebase-console-%E6%89%8B%E5%8B%95%E8%BC%B8%E5%85%A5-cloud-firestore-%E7%9A%84-database-%E5%85%A7%E5%AE%B9-f345b0792a45" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="d88e28afc81affd16ffd2001e655f1f2" data-thumbnail-img-id="1*Vdv3UmfACFNzk3fgA_Dv6g.jpeg" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*Vdv3UmfACFNzk3fgA_Dv6g.jpeg);"></a></div><h3 name="e3fb" id="e3fb" class="graf graf--h3 graf-after--mixtapeEmbed">import FirebaseFirestore &amp; FirebaseFirestoreSwift</h3><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="dc94" id="dc94" class="graf graf--pre graf-after--h3 graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> FirebaseFirestore<br /><span class="hljs-keyword">import</span> FirebaseFirestoreSwift</span></pre><p name="6e82" id="6e82" class="graf graf--p graf-after--pre">import FirebaseFirestore æ‰èƒ½å¾ Firestore å­˜å–è³‡æ–™ï¼Œimport FirebaseFirestoreSwift æ‰èƒ½å°‡è³‡æ–™å°æ‡‰åˆ°æˆ‘å€‘è‡ªè¨‚çš„å‹åˆ¥ã€‚</p><h3 name="7f77" id="7f77" class="graf graf--h3 graf-after--p">å®šç¾© Firestore è³‡æ–™å°æ‡‰çš„è‡ªè¨‚å‹åˆ¥</h3><ul class="postList"><li name="e2c7" id="e2c7" class="graf graf--li graf-after--h3"><strong class="markup--strong markup--li-strong">è‡ªè¨‚ Firestore è³‡æ–™å°æ‡‰çš„ Codable å‹åˆ¥</strong></li></ul><p name="df69" id="df69" class="graf graf--p graf-after--li">æˆ‘å€‘å¸Œæœ›å¾ Cloud Firestore æŠ“å–çš„è³‡æ–™è®Šæˆä»¥ä¸‹çš„è‡ªè¨‚å‹åˆ¥ Songã€‚ç‚ºäº†è®“è³‡æ–™æœ‰è­˜åˆ¥çš„ id &amp; éµå¾ protocol Identifiableï¼Œæˆ‘å€‘å¦å¤–åŠ å…¥ <code class="markup--code markup--p-code u-paddingRight0 u-marginRight0"><a href="http://twitter.com/DocumentID" data-href="http://twitter.com/DocumentID" class="markup--anchor markup--p-anchor" title="Twitter profile for @DocumentID" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">@DocumentID</strong></a><strong class="markup--strong markup--p-strong"> var id: String?</strong></code>ï¼Œåˆ°æ™‚å€™æŠ“åˆ°è³‡æ–™æ™‚ï¼Œid çš„å…§å®¹å°‡ç‚ºè³‡æ–™çš„ document idã€‚</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="23f5" id="23f5" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> FirebaseFirestoreSwift<br /><br /><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Song</span>: <span class="hljs-title class_">Codable</span>, <span class="hljs-title class_">Identifiable</span> {<br />    <span class="hljs-meta">@DocumentID</span> <span class="hljs-keyword">var</span> id: <span class="hljs-type">String</span>?<br />    <span class="hljs-keyword">let</span> name: <span class="hljs-type">String</span><br />    <span class="hljs-keyword">let</span> singer: <span class="hljs-type">String</span><br />    <span class="hljs-keyword">let</span> rate: <span class="hljs-type">Int</span><br />}</span></pre><h3 name="867b" id="867b" class="graf graf--h3 graf-after--pre">æ–°å¢è³‡æ–™(ä¸Šå‚³ Document)</h3><p name="cbdc" id="cbdc" class="graf graf--p graf-after--h3">ä»¥ä¸‹åˆ†åˆ¥ä»‹ç´¹è‡ªå‹•ç”¢ç”Ÿæ–‡ä»¶ id å’ŒæŒ‡å®šæ–‡ä»¶ id çš„å¯«æ³•ã€‚</p><h4 name="f6bd" id="f6bd" class="graf graf--h4 graf-after--p">è‡ªå‹•ç”¢ç”Ÿæ–‡ä»¶ id</h4><p name="c46d" id="c46d" class="graf graf--p graf-after--h4">å‘¼å« function addDocument ä¸Šå‚³è³‡æ–™ã€‚</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="3887" id="3887" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">createSong</span>() {<br />    <span class="hljs-keyword">let</span> db <span class="hljs-operator">=</span> <span class="hljs-type">Firestore</span>.firestore()<br />    <br />    <span class="hljs-keyword">let</span> song <span class="hljs-operator">=</span> <span class="hljs-type">Song</span>(name: <span class="hljs-string">&quot;é™ªä½ å¾ˆä¹…å¾ˆä¹…&quot;</span>, singer: <span class="hljs-string">&quot;å°çƒ&quot;</span>, rate: <span class="hljs-number">5</span>)<br />    <span class="hljs-keyword">do</span> {<br />        <span class="hljs-keyword">let</span> documentReference <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> db.collection(<span class="hljs-string">&quot;songs&quot;</span>).addDocument(from: song)<br />        <span class="hljs-built_in">print</span>(documentReference.documentID)<br />    } <span class="hljs-keyword">catch</span> {<br />        <span class="hljs-built_in">print</span>(error)<br />    }<br />}</span></pre><p name="9db6" id="9db6" class="graf graf--p graf-after--pre">å‘¼å« function addDocument(from:) ä¸Šå‚³è³‡æ–™ï¼Œå®ƒçš„åƒæ•¸å‹åˆ¥ç‚º Encodableï¼Œå› æ­¤æˆ‘å€‘å¯å‚³å…¥ Song å‹åˆ¥çš„è³‡æ–™ã€‚</p><figure name="00ba" id="00ba" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*bvKwLBo3zeDT6362d1dMAg.png" data-width="1474" data-height="662" src="https://cdn-images-1.medium.com/max/800/1*bvKwLBo3zeDT6362d1dMAg.png"></figure><p name="defd" id="defd" class="graf graf--p graf-after--figure">ä¸Šå‚³æˆåŠŸå¾Œï¼Œå¯åœ¨ Firebase ç¶²ç«™ä¸Šå°ˆæ¡ˆçš„ Cloud Firestore é é¢çœ‹åˆ°è³‡æ–™ã€‚</p><figure name="de73" id="de73" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*2RzfpqH2TQSDAB0HjhS2sA.png" data-width="2618" data-height="780" src="https://cdn-images-1.medium.com/max/800/1*2RzfpqH2TQSDAB0HjhS2sA.png"></figure><h4 name="7dda" id="7dda" class="graf graf--h4 graf-after--figure"><strong class="markup--strong markup--h4-strong">æŒ‡å®šæ–‡ä»¶ idÂ çš„å¯«æ³•</strong></h4><p name="c76d" id="c76d" class="graf graf--p graf-after--h4">é€éæ–‡ä»¶ id é™ªä½ å¾ˆä¹…å¾ˆä¹…å–å¾— DocumentReference ï¼Œç„¶å¾Œå‘¼å« function setData è¨­å®šè³‡æ–™ã€‚</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="2373" id="2373" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">createSong</span>() {<br />    <span class="hljs-keyword">let</span> db <span class="hljs-operator">=</span> <span class="hljs-type">Firestore</span>.firestore()<br />    <br />    <span class="hljs-keyword">let</span> song <span class="hljs-operator">=</span> <span class="hljs-type">Song</span>(name: <span class="hljs-string">&quot;é™ªä½ å¾ˆä¹…å¾ˆä¹…&quot;</span>, singer: <span class="hljs-string">&quot;å°çƒ&quot;</span>, rate: <span class="hljs-number">5</span>)<br />    <br />    <span class="hljs-keyword">do</span> {<br />        <span class="hljs-keyword">try</span> db.collection(<span class="hljs-string">&quot;songs&quot;</span>).document(<span class="hljs-string">&quot;é™ªä½ å¾ˆä¹…å¾ˆä¹…&quot;</span>).setData(from: song)<br />    } <span class="hljs-keyword">catch</span> {<br />        <span class="hljs-built_in">print</span>(error)<br />    }<br />}</span></pre><h3 name="fe82" id="fe82" class="graf graf--h3 graf-after--pre">åˆ©ç”¨ FirestoreQuery è®€å– Firebase Firestore è³‡æ–™åº«</h3><p name="8393" id="8393" class="graf graf--p graf-after--h3">ä½¿ç”¨ SwiftUI çš„æœ‹å‹å¯åˆ©ç”¨ FirestoreQuery è®€å– Firebase Firestore è³‡æ–™åº«ã€‚</p><div name="45fe" id="45fe" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E6%95%99%E5%AE%A4/%E5%88%A9%E7%94%A8-firestorequery-%E8%AE%80%E5%8F%96-firebase-firestore-%E8%B3%87%E6%96%99%E5%BA%AB-9b42a2284f80" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E6%95%99%E5%AE%A4/%E5%88%A9%E7%94%A8-firestorequery-%E8%AE%80%E5%8F%96-firebase-firestore-%E8%B3%87%E6%96%99%E5%BA%AB-9b42a2284f80" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E6%95%99%E5%AE%A4/%E5%88%A9%E7%94%A8-firestorequery-%E8%AE%80%E5%8F%96-firebase-firestore-%E8%B3%87%E6%96%99%E5%BA%AB-9b42a2284f80"><strong class="markup--strong markup--mixtapeEmbed-strong">åˆ©ç”¨ FirestoreQuery è®€å– Firebase Firestore è³‡æ–™åº«</strong><br><em class="markup--em markup--mixtapeEmbed-em">Firebase åœ¨æ–°ç‰ˆæ¨å‡ºäº† property wrapper FirestoreQueryï¼Œåˆ©ç”¨å®ƒæˆ‘å€‘å¯ä»¥æ–¹ä¾¿åœ°è®€å– Firebase Firestore è³‡æ–™åº«ã€‚</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E6%95%99%E5%AE%A4/%E5%88%A9%E7%94%A8-firestorequery-%E8%AE%80%E5%8F%96-firebase-firestore-%E8%B3%87%E6%96%99%E5%BA%AB-9b42a2284f80" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="e6bdda3979c677fbd317bdbfcb7151ce" data-thumbnail-img-id="1*dJP19JHn_wX_14DRsTBL3A.png" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*dJP19JHn_wX_14DRsTBL3A.png);"></a></div><h3 name="3522" id="3522" class="graf graf--h3 graf-after--mixtapeEmbed"><strong class="markup--strong markup--h3-strong"><em class="markup--em markup--h3-em">è®€å–æŸå€‹ collection ä¸‹å…¨éƒ¨çš„ documents</em></strong></h3><p name="ddf0" id="ddf0" class="graf graf--p graf-after--h3">å‘¼å« function getDocuments æŠ“å–è³‡æ–™ã€‚</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="115d" id="115d" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">fetchSongs</span>() {<br />    <span class="hljs-keyword">let</span> db <span class="hljs-operator">=</span> <span class="hljs-type">Firestore</span>.firestore()<br />    db.collection(<span class="hljs-string">&quot;songs&quot;</span>).getDocuments { snapshot, error <span class="hljs-keyword">in</span><br />            <br />         <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> snapshot <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }<br />        <br />         <span class="hljs-keyword">let</span> songs <span class="hljs-operator">=</span> snapshot.documents.compactMap { snapshot <span class="hljs-keyword">in</span><br />             <span class="hljs-keyword">try?</span> snapshot.data(as: <span class="hljs-type">Song</span>.<span class="hljs-keyword">self</span>)<br />         }<br />         <span class="hljs-built_in">print</span>(songs)<br />            <br />     } <br />}</span></pre><p name="f05e" id="f05e" class="graf graf--p graf-after--pre">å¾ Firestore æŠ“å–çš„è³‡æ–™æ˜¯å‹åˆ¥ [QueryDocumentSnapshot] çš„ documentsï¼Œæˆ‘å€‘æƒ³å°‡å®ƒè½‰æˆå‹åˆ¥ [Song]ï¼Œå› æ­¤æˆ‘å€‘å¾ snapshot.documents å‘¼å« function compactMapï¼Œåœ¨ compactMap çš„ closure è£¡ç”Ÿæˆå‹åˆ¥ Song çš„è³‡æ–™ã€‚</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="fcf8" id="fcf8" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> songs <span class="hljs-operator">=</span> snapshot.documents.compactMap { snapshot <span class="hljs-keyword">in</span><br />   <span class="hljs-keyword">try?</span> snapshot.data(as: <span class="hljs-type">Song</span>.<span class="hljs-keyword">self</span>)<br />}</span></pre><p name="175a" id="175a" class="graf graf--p graf-after--pre">åƒæ•¸ snapshot çš„å‹åˆ¥ç‚º QueryDocumentSnapshotï¼Œå‘¼å«å®ƒçš„ function<code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong"> data(as:)</strong></code> å¯å°‡è³‡æ–™è®Šæˆè‡ªè¨‚å‹åˆ¥ã€‚åœ¨æ­¤æˆ‘å€‘å‚³å…¥ <code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">Song.self</strong></code><strong class="markup--strong markup--p-strong">ï¼Œ</strong>å¾—åˆ°å‹åˆ¥ Song çš„è³‡æ–™ã€‚</p><figure name="ed31" id="ed31" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*mtPMBKBtMxWriWOhhYKcTQ.png" data-width="1550" data-height="588" src="https://cdn-images-1.medium.com/max/800/1*mtPMBKBtMxWriWOhhYKcTQ.png"></figure><p name="1eb1" id="1eb1" class="graf graf--p graf-after--figure">å¦‚ä¸‹åœ–æ‰€ç¤ºï¼ŒcompactMap å›å‚³çš„è³‡æ–™å‹åˆ¥ç‚º [Song]ã€‚</p><figure name="41f5" id="41f5" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*7t-D-FZvanYb1ZU-L2w1-A.png" data-width="1834" data-height="446" src="https://cdn-images-1.medium.com/max/800/1*7t-D-FZvanYb1ZU-L2w1-A.png"></figure><div name="6808" id="6808" class="graf graf--mixtapeEmbed graf-after--figure"><a href="https://developer.apple.com/documentation/swift/sequence/2950916-compactmap" data-href="https://developer.apple.com/documentation/swift/sequence/2950916-compactmap" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/swift/sequence/2950916-compactmap"><strong class="markup--strong markup--mixtapeEmbed-strong">Apple Developer Documentation</strong><br><em class="markup--em markup--mixtapeEmbed-em">Edit description</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/swift/sequence/2950916-compactmap" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="0241c3d36894ba23c4ab7bfcaeae650c"></a></div><p name="508d" id="508d" class="graf graf--p graf-after--mixtapeEmbed">ps: æˆ‘å€‘ä¹Ÿå¯ä»¥å¾ snapshot.data() è®€å– document çš„å…§å®¹ï¼Œå®ƒçš„å‹åˆ¥ç‚º [StringÂ : Any]ã€‚</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="997a" id="997a" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">fetchSongs</span>() {<br />    <span class="hljs-keyword">let</span> db <span class="hljs-operator">=</span> <span class="hljs-type">Firestore</span>.firestore()<br />    db.collection(<span class="hljs-string">&quot;songs&quot;</span>).getDocuments { snapshot, error <span class="hljs-keyword">in</span><br />        <br />        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> snapshot <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }<br />        <br />        snapshot.documents.forEach { snapshot <span class="hljs-keyword">in</span><br />            <span class="hljs-built_in">print</span>(snapshot.data()[<span class="hljs-string">&quot;name&quot;</span>] <span class="hljs-operator">??</span> <span class="hljs-string">&quot;&quot;</span>)<br />        }<br />    }<br />}</span></pre><h3 name="d8f9" id="d8f9" class="graf graf--h3 graf-after--pre">æ’åº</h3><h4 name="e4c3" id="e4c3" class="graf graf--h4 graf-after--h3"><strong class="markup--strong markup--h4-strong"><em class="markup--em markup--h4-em">ä»¥ order(by:) æ’åºï¼Œç”±å°åˆ°å¤§</em></strong></h4><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="dffe" id="dffe" class="graf graf--pre graf-after--h4 graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">fetchSongs</span>() {<br />    <span class="hljs-keyword">let</span> db <span class="hljs-operator">=</span> <span class="hljs-type">Firestore</span>.firestore()<br />    db.collection(<span class="hljs-string">&quot;songs&quot;</span>).order(by: <span class="hljs-string">&quot;rate&quot;</span>).getDocuments { snapshot, error <span class="hljs-keyword">in</span><br />        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> snapshot <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }<br />        <br />        <span class="hljs-keyword">let</span> songs <span class="hljs-operator">=</span> snapshot.documents.compactMap { snapshot <span class="hljs-keyword">in</span><br />            <span class="hljs-keyword">try?</span> snapshot.data(as: <span class="hljs-type">Song</span>.<span class="hljs-keyword">self</span>)<br />        }<br />        <span class="hljs-built_in">print</span>(songs)<br />    }<br />}</span></pre><h4 name="f688" id="f688" class="graf graf--h4 graf-after--pre"><strong class="markup--strong markup--h4-strong"><em class="markup--em markup--h4-em">ä»¥å¤šå€‹æ¬„ä½æ’åºï¼Œæ¯”æ–¹å…ˆæ¯”èº«é«˜ï¼Œèº«é«˜ä¸€æ¨£å†æ¯”é«”é‡</em></strong></h4><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="417a" id="417a" class="graf graf--pre graf-after--h4 graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> db <span class="hljs-operator">=</span> <span class="hljs-type">Firestore</span>.firestore()<br />db.collection(<span class="hljs-string">&quot;students&quot;</span>).order(by: <span class="hljs-string">&quot;height&quot;</span>).order(by: <span class="hljs-string">&quot;weight&quot;</span>).getDocuments { snapshot, error <span class="hljs-keyword">in</span><br /><br />}</span></pre><h4 name="cd34" id="cd34" class="graf graf--h4 graf-after--pre"><strong class="markup--strong markup--h4-strong"><em class="markup--em markup--h4-em">ä»¥ order çš„åƒæ•¸ descending ç‚º trueÂ æ§åˆ¶æ’åºç”±å¤§åˆ°å°</em></strong></h4><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="1ba1" id="1ba1" class="graf graf--pre graf-after--h4 graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> db <span class="hljs-operator">=</span> <span class="hljs-type">Firestore</span>.firestore()<br />db.collection(<span class="hljs-string">&quot;songs&quot;</span>).order(by: <span class="hljs-string">&quot;rate&quot;</span>, descending: <span class="hljs-literal">true</span>).getDocuments { snapshot, error <span class="hljs-keyword">in</span><br />   <br />}</span></pre><h3 name="7a68" id="7a68" class="graf graf--h3 graf-after--pre">è¨­å®šæ•¸é‡</h3><p name="8cd9" id="8cd9" class="graf graf--p graf-after--h3">ä»¥ limit(to:) æŒ‡å®šæŠ“å–çš„æ•¸é‡ã€‚</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="0331" id="0331" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> db <span class="hljs-operator">=</span> <span class="hljs-type">Firestore</span>.firestore()<br />db.collection(<span class="hljs-string">&quot;songs&quot;</span>).order(by: <span class="hljs-string">&quot;rate&quot;</span>).limit(to: <span class="hljs-number">2</span>).getDocuments { snapshot, error <span class="hljs-keyword">in</span><br />   <br />}</span></pre><h3 name="c704" id="c704" class="graf graf--h3 graf-after--pre">æœå°‹ç‰¹å®šçš„è³‡æ–™</h3><p name="0ca4" id="0ca4" class="graf graf--p graf-after--h3">åˆ©ç”¨ whereField è¨­å®š search çš„æ¢ä»¶ã€‚</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="815d" id="815d" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> db <span class="hljs-operator">=</span> <span class="hljs-type">Firestore</span>.firestore()<br />db.collection(<span class="hljs-string">&quot;songs&quot;</span>).whereField(<span class="hljs-string">&quot;singer&quot;</span>, isEqualTo: <span class="hljs-string">&quot;å‘¨èˆˆå“²&quot;</span>).getDocuments { snapshot, error <span class="hljs-keyword">in</span><br />   <br />}</span></pre><p name="ccd8" id="ccd8" class="graf graf--p graf-after--pre">whereField æœ‰å¾ˆå¤šè¨­å®šæ¢ä»¶çš„æ–¹æ³•ï¼Œæœ‰èˆˆè¶£çš„æœ‹å‹å¯é€²ä¸€æ­¥æŸ¥è©¢ç›¸é—œè³‡è¨Šã€‚</p><figure name="e014" id="e014" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*eH9Mw92vqKoetMNtcy4QEQ.png" data-width="1506" data-height="776" src="https://cdn-images-1.medium.com/max/800/1*eH9Mw92vqKoetMNtcy4QEQ.png"></figure><p name="b57a" id="b57a" class="graf graf--p graf-after--figure">æª¢æŸ¥ç‰¹å®šæ¢ä»¶çš„è³‡æ–™æ˜¯å¦å­˜åœ¨ã€‚</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="d9b2" id="d9b2" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> db <span class="hljs-operator">=</span> <span class="hljs-type">Firestore</span>.firestore()<br />db.collection(<span class="hljs-string">&quot;songs&quot;</span>).whereField(<span class="hljs-string">&quot;singer&quot;</span>, isEqualTo: <span class="hljs-string">&quot;å‘¨èˆˆå“²&quot;</span>).getDocuments { snapshot, error <span class="hljs-keyword">in</span><br />           <br />     <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> snapshot <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }<br />     <span class="hljs-keyword">if</span> snapshot.documents.isEmpty  {<br />    <br />     } <span class="hljs-keyword">else</span> {<br />                <br />     }<br />}</span></pre><h3 name="13c2" id="13c2" class="graf graf--h3 graf-after--pre">Firebase Firestore å¤šå€‹æ¬„ä½ query çš„ indexÂ å•é¡Œ</h3><p name="56d9" id="56d9" class="graf graf--p graf-after--h3">æŠ“å–è³‡æ–™æ™‚è‹¥æœ‰ç”¨åˆ°å¤šå€‹æ¬„ä½ï¼Œå°‡é‡åˆ°è³‡æ–™ç„¡æ³•æŠ“å–çš„å•é¡Œã€‚æ¯”æ–¹ä»¥ä¸‹ç¨‹å¼çš„ query æœƒåˆ¤æ–· mood &amp; rateï¼ŒæŠ“å–ä»¥ rate æ’åºçš„æ‚²å‚·æƒ…æ­Œã€‚</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="c632" id="c632" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> db <span class="hljs-operator">=</span> <span class="hljs-type">Firestore</span>.firestore()<br />db.collection(<span class="hljs-string">&quot;songs&quot;</span>).whereField(<span class="hljs-string">&quot;mood&quot;</span>, isEqualTo: <span class="hljs-string">&quot;ğŸ˜¢&quot;</span>).order(by: <span class="hljs-string">&quot;rate&quot;</span>).getDocuments { snapshot, error <span class="hljs-keyword">in</span><br /><br />}</span></pre><p name="c99e" id="c99e" class="graf graf--p graf-after--pre">æ­¤å•é¡Œå¯é€éåŠ ä¸Š index è§£æ±ºï¼Œç›¸é—œèªªæ˜å¯åƒè€ƒä»¥ä¸‹é€£çµã€‚</p><div name="9e64" id="9e64" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/firebase-firestore-%E5%A4%9A%E5%80%8B%E6%AC%84%E4%BD%8D-query-%E7%9A%84-index-%E5%95%8F%E9%A1%8C-3c921aeafba7" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/firebase-firestore-%E5%A4%9A%E5%80%8B%E6%AC%84%E4%BD%8D-query-%E7%9A%84-index-%E5%95%8F%E9%A1%8C-3c921aeafba7" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/firebase-firestore-%E5%A4%9A%E5%80%8B%E6%AC%84%E4%BD%8D-query-%E7%9A%84-index-%E5%95%8F%E9%A1%8C-3c921aeafba7"><strong class="markup--strong markup--mixtapeEmbed-strong">Firebase Firestore å¤šå€‹æ¬„ä½ query çš„ index å•é¡Œ</strong><br><em class="markup--em markup--mixtapeEmbed-em">é€é Firebase çš„ Firestore æˆ‘å€‘å¯ä»¥æ–¹ä¾¿åœ°æŠ“å–é›²ç«¯çš„è³‡æ–™ï¼Œæ¯”æ–¹é€éä»¥ä¸‹ç”¨ FirestoreQuery å®£å‘Šçš„ property å¯è®€å– songs ä¸‹ mood æ˜¯ ğŸ˜¢ çš„æ‚²å‚·æƒ…æ­Œã€‚</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/firebase-firestore-%E5%A4%9A%E5%80%8B%E6%AC%84%E4%BD%8D-query-%E7%9A%84-index-%E5%95%8F%E9%A1%8C-3c921aeafba7" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="8a195d463aefa74b8a6b2e23feec73b0" data-thumbnail-img-id="1*gnCAZGmqVfWPEXhjdBPLPw.png" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*gnCAZGmqVfWPEXhjdBPLPw.png);"></a></div><h3 name="c248" id="c248" class="graf graf--h3 graf-after--mixtapeEmbed">é€éæ–‡ä»¶ id <strong class="markup--strong markup--h3-strong"><em class="markup--em markup--h3-em">è®€å–æŸå€‹Â document</em></strong></h3><p name="3011" id="3011" class="graf graf--p graf-after--h3">é€éæ–‡ä»¶ id é™ªä½ å¾ˆä¹…å¾ˆä¹…å–å¾— DocumentReference ï¼Œç„¶å¾Œå‘¼å« function getDocumentã€‚</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="23fd" id="23fd" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">getFavoriteSong</span>() {<br />    <span class="hljs-keyword">let</span> db <span class="hljs-operator">=</span> <span class="hljs-type">Firestore</span>.firestore()<br />    db.collection(<span class="hljs-string">&quot;songs&quot;</span>).document(<span class="hljs-string">&quot;é™ªä½ å¾ˆä¹…å¾ˆä¹…&quot;</span>).getDocument { document, error <span class="hljs-keyword">in</span><br />        <br />        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> document,<br />              document.exists,<br />              <span class="hljs-keyword">let</span> song <span class="hljs-operator">=</span> <span class="hljs-keyword">try?</span> document.data(as: <span class="hljs-type">Song</span>.<span class="hljs-keyword">self</span>) <span class="hljs-keyword">else</span> {<br />            <span class="hljs-keyword">return</span><br />        }<br />        <span class="hljs-built_in">print</span>(song)<br />        <br />    }<br />}</span></pre><h3 name="2845" id="2845" class="graf graf--h3 graf-after--pre"><strong class="markup--strong markup--h3-strong"><em class="markup--em markup--h3-em">è®€å–æŸå€‹ document ä¸‹çš„ collection çš„ documents</em></strong></h3><p name="cc8a" id="cc8a" class="graf graf--p graf-after--h3">å‡è¨­ Firestore çš„è³‡æ–™å¦‚ä¸‹ã€‚(è¨»: document ä¸‹å¯ä»¥æœ‰ collectionï¼Œcollection ä¸‹æœ‰ documentï¼Œå› æ­¤å¯ä»¥å¯¦ç¾éå¸¸å¤šå±¤çš„æ¶æ§‹ã€‚)</p><figure name="165e" id="165e" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*3A37vWW9kZIyGHSpgEyZ-w.jpeg" data-width="1364" data-height="600" src="https://cdn-images-1.medium.com/max/800/1*3A37vWW9kZIyGHSpgEyZ-w.jpeg"></figure><figure name="bf98" id="bf98" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*WJQp8GaQnZ13dg7nEqT66A.jpeg" data-width="1400" data-height="415" src="https://cdn-images-1.medium.com/max/800/1*WJQp8GaQnZ13dg7nEqT66A.jpeg"></figure><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="bash" name="cbbf" id="cbbf" class="graf graf--pre graf-after--figure graf--preV2"><span class="pre--content"><span class="hljs-built_in">let</span> db = Firestore.firestore()<br />db.collection(<span class="hljs-string">&quot;music&quot;</span>).document(<span class="hljs-string">&quot;å‘¨æ°å€«&quot;</span>).collection(<span class="hljs-string">&quot;albums&quot;</span>).getDocuments { querySnapshot, error <span class="hljs-keyword">in</span><br />   <br />}</span></pre><h3 name="f6b2" id="f6b2" class="graf graf--h3 graf-after--pre"><strong class="markup--strong markup--h3-strong">åˆ©ç”¨è·¯å¾‘è®€å–</strong></h3><p name="eb55" id="eb55" class="graf graf--p graf-after--h3">å‡è¨­ Firestore çš„è³‡æ–™å¦‚ä¸‹ã€‚</p><figure name="63cd" id="63cd" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*3A37vWW9kZIyGHSpgEyZ-w.jpeg" data-width="1364" data-height="600" src="https://cdn-images-1.medium.com/max/800/1*3A37vWW9kZIyGHSpgEyZ-w.jpeg"></figure><figure name="5e8f" id="5e8f" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*WJQp8GaQnZ13dg7nEqT66A.jpeg" data-width="1400" data-height="415" src="https://cdn-images-1.medium.com/max/800/1*WJQp8GaQnZ13dg7nEqT66A.jpeg"></figure><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="fcc7" id="fcc7" class="graf graf--pre graf-after--figure graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> db <span class="hljs-operator">=</span> <span class="hljs-type">Firestore</span>.firestore()<br />db.collection(<span class="hljs-string">&quot;music/å‘¨æ°å€«/albums&quot;</span>).getDocuments { querySnapshot, error <span class="hljs-keyword">in</span><br />  <br />}</span></pre><h3 name="995c" id="995c" class="graf graf--h3 graf-after--pre">æŒçºŒåµæ¸¬è³‡æ–™æ˜¯å¦æœ‰æ›´æ–°</h3><h4 name="a996" id="a996" class="graf graf--h4 graf-after--h3">æŒçºŒåµæ¸¬ collection ä¸‹çš„ document æ˜¯å¦æœ‰æ–°å¢ï¼Œåˆªé™¤ï¼Œä¿®æ”¹</h4><p name="c22c" id="c22c" class="graf graf--p graf-after--h4">ä¸€é–‹å§‹ addSnapshotListener æœƒå…ˆæŠ“åˆ° collection ä¸‹æ‰€æœ‰çš„ documentï¼Œ å› æ­¤ documentChanges å°‡åŒ…å«æ‰€æœ‰çš„ documentï¼Œtype å‰‡ç‚ºÂ .addedã€‚ä¹‹å¾Œ addSnapshotListener çš„ closure å†è¢«è§¸ç™¼æ™‚ï¼ŒdocumentChanges å°‡åªåŒ…å«æ–°å¢ï¼Œåˆªé™¤(removed)æˆ–ä¿®æ”¹(modified)çš„ documentã€‚</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="66d7" id="66d7" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">checkSongsChange</span>() {<br />    <span class="hljs-keyword">let</span> db <span class="hljs-operator">=</span> <span class="hljs-type">Firestore</span>.firestore()<br />    db.collection(<span class="hljs-string">&quot;songs&quot;</span>).addSnapshotListener { snapshot, error <span class="hljs-keyword">in</span><br />        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> snapshot <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }<br />        snapshot.documentChanges.forEach { documentChange <span class="hljs-keyword">in</span><br />            <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> song <span class="hljs-operator">=</span> <span class="hljs-keyword">try?</span> documentChange.document.data(as: <span class="hljs-type">Song</span>.<span class="hljs-keyword">self</span>) <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }<br />            <span class="hljs-keyword">switch</span> documentChange.type {<br />            <span class="hljs-keyword">case</span> .added:<br />                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;added&quot;</span>, song)<br />            <span class="hljs-keyword">case</span> .modified:<br />                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;modified&quot;</span>, song)<br />            <span class="hljs-keyword">case</span> .removed:<br />                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;removed&quot;</span>, song)<br />            }<br />        }<br />    }<br />}</span></pre><p name="aa6a" id="aa6a" class="graf graf--p graf-after--pre">è‹¥åªæƒ³åµæ¸¬æŸäº› document çš„è®ŠåŒ–ï¼Œå¯æ­é… whereField è¨­å®šæ¢ä»¶ã€‚</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="fa3d" id="fa3d" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> db <span class="hljs-operator">=</span> <span class="hljs-type">Firestore</span>.firestore()<br />        <br />db.collection(<span class="hljs-string">&quot;songs&quot;</span>).whereField(<span class="hljs-string">&quot;singer&quot;</span>, isEqualTo: <span class="hljs-string">&quot;å°çƒ&quot;</span>).addSnapshotListener { snapshot, error <span class="hljs-keyword">in</span><br />            <br />}</span></pre><h4 name="b84b" id="b84b" class="graf graf--h4 graf-after--pre">æŒçºŒåµæ¸¬ documentÂ æ˜¯å¦æœ‰æ›´æ–°</h4><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="9569" id="9569" class="graf graf--pre graf-after--h4 graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">checkSongChange</span>() {<br />    <span class="hljs-keyword">let</span> db <span class="hljs-operator">=</span> <span class="hljs-type">Firestore</span>.firestore()<br />    db.collection(<span class="hljs-string">&quot;songs&quot;</span>).document(<span class="hljs-string">&quot;é™ªä½ å¾ˆä¹…å¾ˆä¹…&quot;</span>).addSnapshotListener { snapshot, error <span class="hljs-keyword">in</span><br />        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> snapshot <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }<br />        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> song <span class="hljs-operator">=</span> <span class="hljs-keyword">try?</span> snapshot.data(as: <span class="hljs-type">Song</span>.<span class="hljs-keyword">self</span>) <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }<br />        <br />        <span class="hljs-built_in">print</span>(song)<br />    }<br />}</span></pre><h3 name="abf0" id="abf0" class="graf graf--h3 graf-after--pre">ä¿®æ”¹è³‡æ–™(æ›´æ–° Document)</h3><p name="c96b" id="c96b" class="graf graf--p graf-after--h3">å°‡ Song çš„ singer &amp; rate å®£å‘Šç‚ºå¯ä¿®æ”¹çš„è®Šæ•¸ã€‚</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="8946" id="8946" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Song</span>: <span class="hljs-title class_">Codable</span>, <span class="hljs-title class_">Identifiable</span> {<br />    <span class="hljs-meta">@DocumentID</span> <span class="hljs-keyword">var</span> id: <span class="hljs-type">String</span>?<br />    <span class="hljs-keyword">let</span> name: <span class="hljs-type">String</span><br />    <span class="hljs-keyword">var</span> singer: <span class="hljs-type">String</span><br />    <span class="hljs-keyword">var</span> rate: <span class="hljs-type">Int</span><br />}</span></pre><h4 name="6984" id="6984" class="graf graf--h4 graf-after--pre"><strong class="markup--strong markup--h4-strong">ç¯„ä¾‹ 1: å·²çŸ¥æ–‡ä»¶Â id</strong></h4><p name="d3c0" id="d3c0" class="graf graf--p graf-after--h4">ä¿®æ”¹é™ªä½ å¾ˆä¹…å¾ˆä¹…çš„æ­Œæ‰‹è·Ÿè©•åˆ†ã€‚</p><figure name="81c3" id="81c3" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*465i0yl4VXKbG7KSKxGITw.png" data-width="1900" data-height="500" src="https://cdn-images-1.medium.com/max/800/1*465i0yl4VXKbG7KSKxGITw.png"></figure><p name="352a" id="352a" class="graf graf--p graf-after--figure">å°‡æ­Œæ‰‹æ”¹æˆå¤§çƒï¼Œè©•åˆ†æ”¹æˆ 5ã€‚</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="7ea4" id="7ea4" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">modifySong</span>() {<br />    <span class="hljs-keyword">let</span> db <span class="hljs-operator">=</span> <span class="hljs-type">Firestore</span>.firestore()<br />    <span class="hljs-keyword">let</span> documentReference <span class="hljs-operator">=</span><br />    db.collection(<span class="hljs-string">&quot;songs&quot;</span>).document(<span class="hljs-string">&quot;é™ªä½ å¾ˆä¹…å¾ˆä¹…&quot;</span>)<br />    documentReference.getDocument { document, error <span class="hljs-keyword">in</span><br />        <br />        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> document,<br />              document.exists,<br />              <span class="hljs-keyword">var</span> song <span class="hljs-operator">=</span> <span class="hljs-keyword">try?</span> document.data(as: <span class="hljs-type">Song</span>.<span class="hljs-keyword">self</span>)<br />        <span class="hljs-keyword">else</span> {<br />            <span class="hljs-keyword">return</span><br />        }<br />        song.rate <span class="hljs-operator">=</span> <span class="hljs-number">5</span><br />        song.singer <span class="hljs-operator">=</span> <span class="hljs-string">&quot;å¤§çƒ&quot;</span><br />        <span class="hljs-keyword">do</span> {<br />            <span class="hljs-keyword">try</span> documentReference.setData(from: song)<br />        } <span class="hljs-keyword">catch</span> {<br />            <span class="hljs-built_in">print</span>(error)<br />        }<br />        <br />    }<br />}</span></pre><figure name="dec8" id="dec8" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*ciMa3R8sFHUvYYMa6YWCnA.png" data-width="1898" data-height="554" src="https://cdn-images-1.medium.com/max/800/1*ciMa3R8sFHUvYYMa6YWCnA.png"></figure><h4 name="43e1" id="43e1" class="graf graf--h4 graf-after--figure">ç¯„ä¾‹ 2: å…ˆè®€å–æ–‡ä»¶ï¼Œæœ‰äº†æ–‡ä»¶ idÂ å¾Œå†ä¿®æ”¹æ–‡ä»¶</h4><p name="40b3" id="40b3" class="graf graf--p graf-after--h4">ä¿®æ”¹æŠ“åˆ°çš„ç¬¬ä¸€é¦–æ­Œã€‚</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="237e" id="237e" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">modifyFirstSong</span>() {<br />    <span class="hljs-keyword">let</span> db <span class="hljs-operator">=</span> <span class="hljs-type">Firestore</span>.firestore()<br />    db.collection(<span class="hljs-string">&quot;songs&quot;</span>).getDocuments { snapshot, error <span class="hljs-keyword">in</span><br />        <br />        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> snapshot <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }<br />        <br />        <span class="hljs-keyword">let</span> songs <span class="hljs-operator">=</span> snapshot.documents.compactMap { snapshot <span class="hljs-keyword">in</span><br />            <span class="hljs-keyword">try?</span> snapshot.data(as: <span class="hljs-type">Song</span>.<span class="hljs-keyword">self</span>)<br />        }<br />        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">var</span> firstSong <span class="hljs-operator">=</span> songs.first <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }<br />        firstSong.rate <span class="hljs-operator">=</span> <span class="hljs-number">2</span><br />        <span class="hljs-keyword">do</span> {<br />            <span class="hljs-keyword">try</span> db.collection(<span class="hljs-string">&quot;songs&quot;</span>).document(firstSong.id <span class="hljs-operator">??</span> <span class="hljs-string">&quot;&quot;</span>).setData(from: firstSong)<br />        } <span class="hljs-keyword">catch</span> {<br />            <span class="hljs-built_in">print</span>(error)<br />        }<br />        <br />    }<br />}</span></pre><h3 name="060a" id="060a" class="graf graf--h3 graf-after--pre">åˆªé™¤è³‡æ–™(delete Document)</h3><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="1c6a" id="1c6a" class="graf graf--pre graf-after--h3 graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> db <span class="hljs-operator">=</span> <span class="hljs-type">Firestore</span>.firestore()<br /><span class="hljs-keyword">let</span> documentReference <span class="hljs-operator">=</span> db.collection(<span class="hljs-string">&quot;songs&quot;</span>).document(<span class="hljs-string">&quot;é™ªä½ å¾ˆä¹…å¾ˆä¹…&quot;</span>)<br />documentReference.delete()</span></pre><h3 name="eecf" id="eecf" class="graf graf--h3 graf-after--pre">åˆ†é åŠŸèƒ½</h3><div name="c758" id="c758" class="graf graf--mixtapeEmbed graf-after--h3 graf--trailing"><a href="https://firebase.google.com/docs/firestore/query-data/query-cursors" data-href="https://firebase.google.com/docs/firestore/query-data/query-cursors" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://firebase.google.com/docs/firestore/query-data/query-cursors"><strong class="markup--strong markup--mixtapeEmbed-strong">Paginate data with query cursors | Firebase</strong><br><em class="markup--em markup--mixtapeEmbed-em">With query cursors in Cloud Firestore, you can split data returned by a query into batches according to the parametersâ€¦</em>firebase.google.com</a><a href="https://firebase.google.com/docs/firestore/query-data/query-cursors" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="3a883af40812e2ce1d7d9ee33c17a21e" data-thumbnail-img-id="0*7b0dkS8-Y26-m2vG" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*7b0dkS8-Y26-m2vG);"></a></div></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@apppeterpan" class="p-author h-card">å½¼å¾—æ½˜çš„ iOS App Neverland</a> on <a href="https://medium.com/p/89f33c852018"><time class="dt-published" datetime="2020-09-12T17:30:54.553Z">September 12, 2020</time></a>.</p><p><a href="https://medium.com/@apppeterpan/%E5%88%A9%E7%94%A8-firebasefirestoreswift-%E5%B0%87-firestore-%E7%9A%84%E8%B3%87%E6%96%99%E8%AE%8A%E6%88%90%E8%87%AA%E8%A8%82%E5%9E%8B%E5%88%A5-89f33c852018" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on September 17, 2025.</p></footer></article></body></html>