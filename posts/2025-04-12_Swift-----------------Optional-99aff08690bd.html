<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Swift 的問號與驚嘆號 : 可有可無的 Optional</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Swift 的問號與驚嘆號 : 可有可無的 Optional</h1>
</header>
<section data-field="subtitle" class="p-summary">
可有可無的 Optional 是 Swift 裡一個非常特別的角色。你看它號稱可有可無，我們卻還要認識他，就知道他多特別了。有了它，不管何種型別的變數或常數，都可以沒有任何內容，也就是無值的狀態。至於這有什麼好呢? 這故事得回到很久很久以前，從沒有 Optional…
</section>
<section data-field="body" class="e-content">
<section name="e886" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="7acf" id="7acf" class="graf graf--h3 graf--leading graf--title">Swift 的問號與驚嘆號 : 可有可無的 Optional</h3><figure name="5cbc" id="5cbc" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="0*h6u12PYX8-Ma2C2A" data-width="1536" data-height="1024" src="https://cdn-images-1.medium.com/max/800/0*h6u12PYX8-Ma2C2A"><figcaption class="imageCaption">來到 Optional 星球探險的小王子</figcaption></figure><p name="778a" id="778a" class="graf graf--p graf-after--figure">可有可無的 Optional 是 Swift 裡一個非常特別的角色。你看它號稱可有可無，我們卻還要認識他，就知道他多特別了。有了它，不管何種型別的變數或常數，都可以沒有任何內容，也就是無值的狀態。至於這有什麼好呢? 這故事得回到很久很久以前，從沒有 Optional 的程式世界說起。</p><h3 name="c7e7" id="c7e7" class="graf graf--h3 graf-after--p">Optional 發明的緣由</h3><p name="8f4f" id="8f4f" class="graf graf--p graf-after--h3">有了變數和常數，我們可以輕易儲存任何型別的資料。但在某些特別的情境，我們希望變數和常數能處於一個沒有內容的狀態。比方我們開發一個處理學生考試分數的程式，宣告變數 <code class="markup--code markup--p-code">peterScore</code> 儲存班上最聰明學生 Peter 考試的分數。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="3229" id="3229" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">var</span> peterScore <span class="hljs-operator">=</span> <span class="hljs-number">98</span></span></pre><p name="dff9" id="dff9" class="graf graf--p graf-after--pre">但是 Peter 很有正義感，很可能為了英雄救美或拯救世界而缺考呀。這時候 <code class="markup--code markup--p-code">peterScore</code> 要儲存什麼樣的內容才能表示缺考呢 ? 應該不能是 0，因為學生有可能考 0 分，0 分和缺考是不一樣的。我們希望可以在程式裡判斷是否缺考，給缺考的學生補考的機會。</p><p name="bddf" id="bddf" class="graf graf--p graf-after--p">也許 -1 是個不錯的解答，畢竟不可能有學生考 -1 分。將 <code class="markup--code markup--p-code">peterScore</code> 的內容預設為 <code class="markup--code markup--p-code">-1</code>，待 Peter 考完試後，再改為他實際的考試分數。如此我們即可透過比對分數是否等於 -1，判斷學生是否考過試。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="cdf9" id="cdf9" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">var</span> peterScore <span class="hljs-operator">=</span> <span class="hljs-operator">-</span><span class="hljs-number">1</span></span></pre><p name="2741" id="2741" class="graf graf--p graf-after--pre">但這種做法其實危險到了極點，它有著以下兩個可怕的缺點:</p><ol class="postList"><li name="74de" id="74de" class="graf graf--li graf-after--p">容易誤解。<br>-1 本身是個真實存在的數字，我們以它表達還沒有分數的狀態其實不太合理。閱讀程式碼時，它不只無法直覺傳達出 Peter 還沒有考試，甚至有可能讓人誤會，以為老師跟 Peter 有仇，才會給他比 0 分還不如的 -1 分。</li><li name="5df7" id="5df7" class="graf graf--li graf-after--li">修改容易出問題。<br>當我們想要採用另一個數字表示沒有分數的狀態，比方 -2，此時必須十分仔細地檢查程式碼，確保所有比對 <code class="markup--code markup--li-code">peterScore</code> 的地方都換成跟 -2 比較，只要稍有遺漏即會產生錯誤的結果。</li></ol><h3 name="3e13" id="3e13" class="graf graf--h3 graf-after--li">Optional 的宣告</h3><p name="b1c6" id="b1c6" class="graf graf--p graf-after--h3">剛剛提到的這些問題，出自於變數(常數)無法表達沒有內容的狀態。但當 optional 橫空出世後，這些問題都迎刃而解了！ Optional 的中文意思是「非必須的，可選擇的」，而在 Swift 程式裡，所有我們宣告的變數(常數)，不管型別是什麼，都可以幫它添加 optional 的特性，使其成為一個可以有值，也可以無值的特別變數(常數)。</p><p name="c986" id="c986" class="graf graf--p graf-after--p">一個 optional 的變數(常數)，可以被設定為 <code class="markup--code markup--p-code">nil</code>，表示它處於無值的狀態，不管它的型別是什麼，例如以下例子:</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="6fdc" id="6fdc" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">var</span> girlFriend: <span class="hljs-type">String</span>?</span></pre><p name="981c" id="981c" class="graf graf--p graf-after--pre">在宣告變數(常數)時，於型別的後頭接上問號，即表示它是一個 optional 。用問號來表示 optional 是個十分直覺的設計，因為問號的意思正代表了有或沒有，完全說明了它可能有值，也可能無值。</p><p name="042f" id="042f" class="graf graf--p graf-after--p">在剛剛的例子裡，<code class="markup--code markup--p-code">girlFriend</code> 可以儲存女朋友的名字，也可被設為 <code class="markup--code markup--p-code">nil</code>，處於單身的可憐狀態。雖然我們尚未將任何值指派給 <code class="markup--code markup--p-code">girlFriend</code>，但它早已貼心地被自動初始為 <code class="markup--code markup--p-code">nil</code>。也就是它的效果和以下額外指派 <code class="markup--code markup--p-code">nil</code> 的程式碼是一樣的。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="f95d" id="f95d" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">var</span> girlFriend: <span class="hljs-type">String</span>? <span class="hljs-operator">=</span> <span class="hljs-literal">nil</span></span></pre><p name="092c" id="092c" class="graf graf--p graf-after--pre">此自動初始化變數的貼心服務，可是只有 optional 獨享。若是非 optional，也就是沒有加上問號的變數，它可是無福享有自動初始的福利。如以下例子，當我們宣告 <code class="markup--code markup--p-code">age</code>後，若是沒有另外指定數值，它將不會被自動初始。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="ebc4" id="ebc4" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">var</span> age: <span class="hljs-type">Int</span></span></pre><p name="7ea0" id="7ea0" class="graf graf--p graf-after--pre">只有 optional 有特權，可以被設為<code class="markup--code markup--p-code">nil</code>。若是希望即使彗星撞地球，變數(常數)依然不會變成 <code class="markup--code markup--p-code">nil</code>，只要記得別將變數(常數)設為 optional 即可。比方以下例子，若是我們誤將非 optional 的 <code class="markup--code markup--p-code">age</code> 設為 <code class="markup--code markup--p-code">nil</code>，紅色錯誤將立即出現警告我們。</p><figure name="8151" id="8151" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*nic592t1z7RrNAd4n89ksA.png" data-width="1438" data-height="386" src="https://cdn-images-1.medium.com/max/800/1*nic592t1z7RrNAd4n89ksA.png"></figure><figure name="c827" id="c827" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*pR0qrMnFYvTk5pxonWHNQA.png" data-width="1250" data-height="192" src="https://cdn-images-1.medium.com/max/800/1*pR0qrMnFYvTk5pxonWHNQA.png"></figure><p name="6724" id="6724" class="graf graf--p graf-after--figure">有了 optional 表達無值的狀態後，請記得只有 <code class="markup--code markup--p-code">nil</code> 才代表沒有內容。數字 0 和空字串 <code class="markup--code markup--p-code">&quot;&quot;</code> 其實都還是有內容，跟 <code class="markup--code markup--p-code">nil</code> 是不一樣的。</p><p name="c695" id="c695" class="graf graf--p graf-after--p">學會 optional 後，未來我們在宣告變數(常數)時，應當在宣告時就想清楚，思考它是否可能無值，是否需要設為 optional。比方 <code class="markup--code markup--p-code">girlFriend</code> 應該是 optional，因為不一定有女朋友，而 <code class="markup--code markup--p-code">mother</code> 應是非 optional，因為一定會有媽媽，否則你根本不會存在這個世界上。養成將可能無值的設為 optional，永遠不該無值的設為非 optional 的良好習慣，即可讓我們的程式變得更安全，降低製造出難以捉摸問題的機率。</p><h3 name="fffc" id="fffc" class="graf graf--h3 graf-after--p">Optional 的設定和讀取</h3><p name="81c8" id="81c8" class="graf graf--p graf-after--h3">在設定 optional 時，其實跟設定非 optional 沒有任何差別，比方以下例子將 <code class="markup--code markup--p-code">girlFriend</code> 設為彼得潘命中注定的女朋友，Wendy 小姐 !</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="1602" id="1602" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">var</span> girlFriend: <span class="hljs-type">String</span>? <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Wendy&quot;</span></span></pre><p name="37c9" id="37c9" class="graf graf--p graf-after--pre">然而 optional 的讀取卻有些許不同。比方以下例子，為了讓女朋友開心，我們特別將 Wendy 加上真心不騙的形容詞「可愛的」。此時卻冒出了錯誤，告訴我們 <code class="markup--code markup--p-code">value of optional type &#39;String?&#39; not unwrapped; did you mean to use &#39;!&#39; or &#39;?&#39;</code>。</p><figure name="5db5" id="5db5" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*nH6c9ny0oYeViHSeJ51Q5w.png" data-width="1236" data-height="610" src="https://cdn-images-1.medium.com/max/800/1*nH6c9ny0oYeViHSeJ51Q5w.png"></figure><p name="42d5" id="42d5" class="graf graf--p graf-after--figure">難道是 Swift 看出我們說謊，只是哄 Wendy 開心的甜言蜜語嗎 ? 當然不是，學 Swift 的人都是很真心的。</p><p name="298b" id="298b" class="graf graf--p graf-after--p">錯誤的原因出自 optional 儲存的內容是被包裝起來的，我們需要解開包裝，才能讀取它的內容。可以想像 optional 的內容被裝在一個精美包裝的盒子裡。當它沒有內容時，即表示盒子是空的。當我們存了字串 <code class="markup--code markup--p-code">Wendy</code> 到 <code class="markup--code markup--p-code">girlFriend</code> 裡時，盒子裡將裝著彼得潘心愛的<code class="markup--code markup--p-code">Wendy</code>。</p><figure name="d817" id="d817" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*bhfxdH6i91J3kXiM0ZTFuQ.png" data-width="1402" data-height="924" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*bhfxdH6i91J3kXiM0ZTFuQ.png"></figure><p name="e9fa" id="e9fa" class="graf graf--p graf-after--figure">既然被盒子裝著，當盒子沒有被打開時，我們當然看不到裡面的內容。(除非你有特異功能) 所以我們必須解開包裝，打開盒子，才能看到它儲存的內容。</p><figure name="22da" id="22da" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*Ow3JXm-i9NNVnpdrmKIpzw.png" data-width="592" data-height="582" src="https://cdn-images-1.medium.com/max/800/1*Ow3JXm-i9NNVnpdrmKIpzw.png"></figure><p name="d45f" id="d45f" class="graf graf--p graf-after--figure">要怎麼解開包裝呢? 很簡單。只要請出問號的好兄弟，驚嘆號 <code class="markup--code markup--p-code">!</code> 幫忙即可。當我們在 <code class="markup--code markup--p-code">girlFriend</code> 後接上 <code class="markup--code markup--p-code">!</code>，即可取出其中儲存的字串 <code class="markup--code markup--p-code">Wendy</code>。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="fe59" id="fe59" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">var</span> girlFriend: <span class="hljs-type">String</span>? <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Wendy&quot;</span><br /><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;可愛的&quot;</span> <span class="hljs-operator">+</span> girlFriend<span class="hljs-operator">!</span>)</span></pre><figure name="427f" id="427f" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*OCPUh8Nl7rs1BEARGYDDOw.png" data-width="1018" data-height="982" src="https://cdn-images-1.medium.com/max/800/1*OCPUh8Nl7rs1BEARGYDDOw.png"><figcaption class="imageCaption">Peter 用 ! 打開盒子發現 Wendy，公主抱 Wendy 的浪漫故事</figcaption></figure><figure name="db75" id="db75" class="graf graf--figure graf--iframe graf-after--figure"></figure><p name="5c3a" id="5c3a" class="graf graf--p graf-after--figure">利用驚嘆號解開包裝讀取內容的方法稱為 <code class="markup--code markup--p-code">force-unwrap</code> ，也就是強迫解包裝。所有事情只要是強迫的，都有它的風險。當 optional 沒有任何東西，也就是被設為 <code class="markup--code markup--p-code">nil</code> 時，若是我們魯莽地加上驚嘆號，想打開潘朵拉的盒子，取得裡頭的東西，將發生可怕的慘劇 !</p><figure name="ecf5" id="ecf5" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*s-x_lVcQcrbhbJvGxlXo1g.png" data-width="1102" data-height="420" src="https://cdn-images-1.medium.com/max/800/1*s-x_lVcQcrbhbJvGxlXo1g.png"></figure><p name="8ba3" id="8ba3" class="graf graf--p graf-after--figure">剛剛的程式是個悲慘的故事。某一天 Wendy 突然移情別戀，愛上了虎克船長，所以彼得潘成為黃金單身漢，沒有女朋友，<code class="markup--code markup--p-code">girlFriend</code> 被設為 <code class="markup--code markup--p-code">nil</code>。此時當我們用 ! 讀取 <code class="markup--code markup--p-code">girlFriend</code> 的內容時，將造成程式閃退。下方的 Debug Area 區塊解釋了閃退的原因，因為 <code class="markup--code markup--p-code">unexpectedly found nil while unwrapping an Optional value</code> (在解開包裝時發現nil )， Swift 不允許我們用 ! 讀取沒有內容的 optional。</p><figure name="2ee4" id="2ee4" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*kOh-WRIy_oGf5yG9jSXcpQ.png" data-width="932" data-height="1024" src="https://cdn-images-1.medium.com/max/800/1*kOh-WRIy_oGf5yG9jSXcpQ.png"><figcaption class="imageCaption">Peter 用 ! 打開盒子，發現是空盒子，找不到 Wendy 而眼淚成河</figcaption></figure><p name="deca" id="deca" class="graf graf--p graf-after--figure">ps: 以下是 AI 將剛剛的四格漫畫變成有趣的故事說明用 ! 讀取 optional 的危險。</p><pre data-code-block-mode="0" spellcheck="false" name="c4d1" id="c4d1" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">從前從前，有一個住在 Swift 小鎮的彼得潘，他最近迷上了購物網站『Optionals.com』，這個網站神奇的地方在於，你買的東西可能有，也可能沒有，全靠運氣！<br>彼得潘點擊下單了一個可愛的禮物盒，他心裡想著：「裡面一定是超可愛的女孩 Wendy！這樣我就有個可愛的女朋友啦，呵呵～」<br>系統提示他：「你買的東西是 Optional 喔！可能有、可能沒有，請小心開箱！」<br>但是彼得潘太興奮了，他立刻拿出 Swift 小鎮的神奇工具：驚嘆號（!）。<br>他心想：「管他的，有驚嘆號就大膽拆！人生就是要冒險啊～！」<br>盒子送到了，彼得潘拿著驚嘆號（!）大喊：「拆禮物～！」 盒子「砰！」一聲打開，結果盒子裡什麼都沒有，只有一個回音：「unexpectedly found nil while unwrapping an Optional value…」<br>彼得潘頓時哭成淚人，哭喊道：「我的女朋友去哪裡了～！」<br>隔天他學乖了，買另一個禮物盒，這次他冷靜地先偷瞄了一眼，發現盒子裡真的有個超可愛的 Wendy。<br>彼得潘放心地使用驚嘆號（!）：「Wendy～！」<br>這次成功了，他幸福地抱著 Wendy 繞圈圈。<br>從此以後，彼得潘牢牢記住了 Optional 的寶貴教訓：<br>『驚嘆號（!）雖然方便，可是如果不確認盒子裡有東西，就會掉入無底深淵喔～』</span></pre><p name="ae5d" id="ae5d" class="graf graf--p graf-after--pre">Gemini 將故事變成 storybook。</p><div name="38c6" id="38c6" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://g.co/gemini/share/9a775e20a41e" data-href="https://g.co/gemini/share/9a775e20a41e" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://g.co/gemini/share/9a775e20a41e"><strong class="markup--strong markup--mixtapeEmbed-strong">‎Gemini - 📖 彼得潘與 Optional 禮物盒</strong><br><em class="markup--em markup--mixtapeEmbed-em">Created with Gemini</em>g.co</a><a href="https://g.co/gemini/share/9a775e20a41e" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="4724cd7f870575a8f36f39f1c6230398" data-thumbnail-img-id="0*C9FnBWGzbb1wZ1b2" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*C9FnBWGzbb1wZ1b2);"></a></div><p name="be56" id="be56" class="graf graf--p graf-after--mixtapeEmbed">你可以用現實世界的例子來想像，對方沒有女朋友已經很傷心了，你還硬要逼問他女朋友叫什麼名字，此時他當然會狠狠地一拳打在你臉上，讓你血流成河，就像程式裡出現的紅色錯誤一樣。類似的例子很多，所以請記得，當對方沒錢時，就別再追問他存款有多少，當對方沒朋友時，就別再追問他 IG 有幾個朋友。請別在對方傷口灑鹽了 !</p><p name="0782" id="0782" class="graf graf--p graf-after--p">從剛剛的例子，我們也明白了Swift 的用心良苦。因為 ! 暗示了危險，提醒我們用 ! 讀取 optional 要小心，當讀不到內容時程式會閃退。</p><h3 name="d394" id="d394" class="graf graf--h3 graf-after--p">檢查Optional 是否有值</h3><p name="43b9" id="43b9" class="graf graf--p graf-after--h3">想預防因為從無值的 optional 強迫取值造成的閃退，其實很簡單。只要在取值前先用 <code class="markup--code markup--p-code">if</code> 判斷它是否不等於 <code class="markup--code markup--p-code">nil</code>。若是不等於 <code class="markup--code markup--p-code">nil</code>，即表示目前有值，才可放心地取值。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="e0a9" id="e0a9" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">var</span> girlFriend: <span class="hljs-type">String</span>? <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Wendy&quot;</span><br /><span class="hljs-keyword">if</span> girlFriend <span class="hljs-operator">!=</span> <span class="hljs-literal">nil</span> {<br />    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;可愛的&quot;</span> <span class="hljs-operator">+</span> girlFriend<span class="hljs-operator">!</span>)<br />}</span></pre><h3 name="7db5" id="7db5" class="graf graf--h3 graf-after--pre">判斷是否有值，有值的話接著取值的 Optional Binding</h3><p name="7238" id="7238" class="graf graf--p graf-after--h3">利用 <code class="markup--code markup--p-code">if</code> 先判斷 optional 是否有值，若有值再用驚嘆號取值的做法可說是萬無一失，程式終於不會再閃退。但這樣子的做法其實有點麻煩，因為要分為以下兩個步驟:</p><ol class="postList"><li name="fd6c" id="fd6c" class="graf graf--li graf-after--p">判斷 optional 是否有值。</li><li name="bbc5" id="bbc5" class="graf graf--li graf-after--li">若 optional 有值，再安心地用驚嘆號取值。</li></ol><p name="baeb" id="baeb" class="graf graf--p graf-after--li">多一事不如少一事，因此 Swift 發明了 <code class="markup--code markup--p-code">optional binding</code>，將兩個步驟濃縮為一個步驟。<code class="markup--code markup--p-code">optional binding</code> 的語法如下，以 <code class="markup--code markup--p-code">if let</code> + 常數名稱或 <code class="markup--code markup--p-code">if var</code> + 變數名稱開頭，然後再接著 <code class="markup--code markup--p-code">=</code> 和 optional。</p><figure name="817a" id="817a" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="0*xe3cP3nATpG4b_YB" data-width="1536" data-height="1024" src="https://cdn-images-1.medium.com/max/800/0*xe3cP3nATpG4b_YB"></figure><p name="cde1" id="cde1" class="graf graf--p graf-after--figure">也許初次相見，你會覺得它有點難懂，就像彼得潘初次看到夢中情人 Wendy 一樣。接下來讓我們看看實際的例子，以 <code class="markup--code markup--p-code">if let</code> 說明，你將發現它其實很平易近人。</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="0b95" id="0b95" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">var</span> girlFriend: <span class="hljs-type">String</span>? <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Wendy&quot;</span><br /><span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> girlFriendName <span class="hljs-operator">=</span> girlFriend {<br />    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;可愛的&quot;</span> <span class="hljs-operator">+</span> girlFriendName)<br />} <span class="hljs-keyword">else</span> {<br />    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;沒有 girlfriend 😭😭&quot;</span>)<br />}</span></pre><p name="3051" id="3051" class="graf graf--p graf-after--pre">optional binding 將判斷 = 右邊的 optional <code class="markup--code markup--p-code">girlFriend</code> 是否有值。若是 <code class="markup--code markup--p-code">girlFriend</code> 有值，它將從 <code class="markup--code markup--p-code">girlFriend</code> 中讀取字串，儲存於新發明的常數 <code class="markup--code markup--p-code">girlFriendName</code>。(因此 <code class="markup--code markup--p-code">girlFriendName</code> 的型別為 <code class="markup--code markup--p-code">String</code>，不是 optional) 此時 <code class="markup--code markup--p-code">if</code> 判斷式將成立，所以它會執行 { } 裡的程式碼， 在 { } 裡我們可以直接存取 <code class="markup--code markup--p-code">girlFriendName</code>，不用再透過驚嘆號取值。</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="1750" id="1750" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">var</span> girlFriend: <span class="hljs-type">String</span>? <br /><span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> girlFriendName <span class="hljs-operator">=</span> girlFriend {<br />    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;可愛的&quot;</span> <span class="hljs-operator">+</span> girlFriendName)<br />} <span class="hljs-keyword">else</span> {<br />    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;沒有 girlfriend 😭😭&quot;</span>)<br />}</span></pre><p name="a432" id="a432" class="graf graf--p graf-after--pre">若是不幸分手， <code class="markup--code markup--p-code">girlFriend</code> 為 <code class="markup--code markup--p-code">nil</code>，<code class="markup--code markup--p-code">if</code> 判斷不成立，程式將跳到 <code class="markup--code markup--p-code">else</code> 執行，彼得潘只好哭哭。</p><p name="0025" id="0025" class="graf graf--p graf-after--p">透過 optional binding，現在我們只要一行程式即可判斷 optional 是否有值，並將它儲存於某個常數後讀取內容，不用再加 <code class="markup--code markup--p-code">!</code> 取值。</p><p name="17f5" id="17f5" class="graf graf--p graf-after--p">Optional binding 什麼都好，偏偏有個小小的缺點。為了使用它，我們每次都得想個新的常數名稱，接在 <code class="markup--code markup--p-code">if let</code> 之後，就像剛剛為了儲存女朋友的名字， 我們另外創建一個新的常數 <code class="markup--code markup--p-code">girlFriendName</code>。</p><p name="01aa" id="01aa" class="graf graf--p graf-after--p">想名稱其實是件挺累的事情，不管是為常數取名還是為小寶寶取名都一樣。Swift 為了怕我們想名字想到頭髮都白了，特別網開一面，允許我們使用 optional binding 時，將 <code class="markup--code markup--p-code">if let</code> 後的常數跟 = 右邊的 optional 取一樣名稱，例如以下例子:</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="bc93" id="bc93" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">var</span> girlFriend: <span class="hljs-type">String</span>?<br /><span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> girlFriend <span class="hljs-operator">=</span> girlFriend {<br />    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;可愛的&quot;</span> <span class="hljs-operator">+</span> girlFriend)<br />} <span class="hljs-keyword">else</span> {<br />    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;沒有 girlfriend 😭😭&quot;</span>)<br />}</span></pre><p name="aecd" id="aecd" class="graf graf--p graf-after--pre">也許有人會尖叫，大喊一樣名稱怎麼可以！到時候 { } 裡的 girlFriend 到底指的是誰呢 ? 這時候當然有人要被犧牲呀，Swift 早就想好了， { } 裡使用的是 if let 後的 <code class="markup--code markup--p-code">girlFriend</code>，因為它就是我們要的，它儲存著我們想從 optional 讀取的內容。</p><p name="8268" id="8268" class="graf graf--p graf-after--p">剛剛我們一直以 <code class="markup--code markup--p-code">if let</code> 舉例，另一種寫法 <code class="markup--code markup--p-code">if var</code> 其實也是一樣的概念，兩者的差別在於 <code class="markup--code markup--p-code">let</code> 產生常數，<code class="markup--code markup--p-code">var</code> 產生變數。由於大部份的時候我們只是想讀取內容，而不是修改，所以採用 <code class="markup--code markup--p-code">if let</code> 居多。</p><p name="4218" id="4218" class="graf graf--p graf-after--p">Optional binding 人真得很好，幫我們精簡步驟，讓我們開發速度更快。但彼得潘在這裡還是要揭穿它的真面目。其實它是個花心大蘿蔔，腳踏兩條船，它除了可以跟 <code class="markup--code markup--p-code">if</code> 結合，也能搭配 guard &amp; while。比方 <code class="markup--code markup--p-code">while let girlFriendName = girlFriend</code>。</p><div name="4e3d" id="4e3d" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%92%8C-if-let-%E5%BE%88%E5%83%8F%E7%9A%84-guard-let-d37900352c37" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%92%8C-if-let-%E5%BE%88%E5%83%8F%E7%9A%84-guard-let-d37900352c37" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%92%8C-if-let-%E5%BE%88%E5%83%8F%E7%9A%84-guard-let-d37900352c37"><strong class="markup--strong markup--mixtapeEmbed-strong">和 if let 很像的 guard let</strong><br><em class="markup--em markup--mixtapeEmbed-em">guard 什麼都學 if，所以自然的，它也有個跟 optional binding 的 if let 很像的 guard let，專門判斷 optional 是否有值和讀取它的內容。</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%92%8C-if-let-%E5%BE%88%E5%83%8F%E7%9A%84-guard-let-d37900352c37" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="006f05ae3dd20061b942af80734990f7" data-thumbnail-img-id="1*KkUsJ1TdtNyD8fAFudpgWQ.jpeg" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*KkUsJ1TdtNyD8fAFudpgWQ.jpeg);"></a></div><h3 name="d464" id="d464" class="graf graf--h3 graf-after--mixtapeEmbed">Optional Binding 的縮寫</h3><p name="7311" id="7311" class="graf graf--p graf-after--h3">optional binding 甚至還有更簡短的寫法。即然常數名跟 optional 一樣，Swift 允許我們只寫 if let 常數名，不用再寫後面的 = 和 optional。</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="91fd" id="91fd" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">var</span> girlFriend: <span class="hljs-type">String</span>?<br /><span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> girlFriend {<br />    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;可愛的&quot;</span> <span class="hljs-operator">+</span> girlFriend)<br />} <span class="hljs-keyword">else</span> {<br />    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;沒有 girlfriend 😭&quot;</span>)<br />}</span></pre><div name="92e6" id="92e6" class="graf graf--mixtapeEmbed graf-after--pre"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/if-let-shorthand-swift-5-7-%E6%96%B0%E5%8A%9F%E8%83%BD-c06be92e7047" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/if-let-shorthand-swift-5-7-%E6%96%B0%E5%8A%9F%E8%83%BD-c06be92e7047" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/if-let-shorthand-swift-5-7-%E6%96%B0%E5%8A%9F%E8%83%BD-c06be92e7047"><strong class="markup--strong markup--mixtapeEmbed-strong">if let shorthand — Swift 5.7 新功能</strong><br><em class="markup--em markup--mixtapeEmbed-em">從 Swift 5.7(搭配 Xcode 14)開始，optional binding 有更簡單的寫法了 !</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/if-let-shorthand-swift-5-7-%E6%96%B0%E5%8A%9F%E8%83%BD-c06be92e7047" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="73a84bb8185a7c672e1a0c826eb5f468" data-thumbnail-img-id="1*WZgAEHzHultKnZd3ItX21w.png" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*WZgAEHzHultKnZd3ItX21w.png);"></a></div><h3 name="ef18" id="ef18" class="graf graf--h3 graf-after--mixtapeEmbed">自動取值的Implicitly Unwrapped Optional</h3><p name="2fb1" id="2fb1" class="graf graf--p graf-after--h3">若是變數(常數)可能無值，但是它大多數時候有值，或是一旦被設定內容後，就會保持在有值的狀態，不會再變成 <code class="markup--code markup--p-code">nil</code>，則可利用 <code class="markup--code markup--p-code">Implicitly Unwrapped Optional</code>。它會自動解包裝，方便我們直接取值，不用再麻煩地補上驚嘆號取值。</p><p name="54ae" id="54ae" class="graf graf--p graf-after--p">怎麼讓 optional 擁有自動取值的功能呢? 很簡單，只要在宣告時，將原來的問號換成取值的驚嘆號即可，如此 optional 即會時時刻刻記得取值這件事。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="6de2" id="6de2" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">var</span> girlFriend: <span class="hljs-type">String</span>! <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Wendy&quot;</span><br /><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;可愛的&quot;</span> <span class="hljs-operator">+</span> girlFriend)</span></pre><p name="8920" id="8920" class="graf graf--p graf-after--pre">任何事情都是有代價的，自動取值為我們帶來很大的方便，但它也有潛藏的危險。若是 optional 為 <code class="markup--code markup--p-code">nil</code>，一樣的，取值將帶來可怕的閃退。由於它是自動取值，不用再額外添加驚嘆號，因此只要我們在程式裡使用它做運算，即會馬上讀取，造成致命的閃退後果。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="d497" id="d497" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">var</span> girlFriend: <span class="hljs-type">String</span>! <br /><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;可愛的&quot;</span> <span class="hljs-operator">+</span> girlFriend)</span></pre><p name="5b1d" id="5b1d" class="graf graf--p graf-after--pre">因此使用驚嘆號宣告 optional 時，其實得更加小心，因為不用加驚嘆號即會自動取值。最好能保證它一旦有值後，就不會再變成 <code class="markup--code markup--p-code">nil</code> 狀態，才不會產生意外的閃退。</p><p name="ce3c" id="ce3c" class="graf graf--p graf-after--p">若是想要更安全，也可於每次取值前先利用 <code class="markup--code markup--p-code">if</code> 做判斷，避免在 <code class="markup--code markup--p-code">nil</code> 情況下自動取值造成閃退。此外由於它會自動取值，所以我們不需要 optional binding，可直接讀取它的內容做運算。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="102b" id="102b" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">var</span> girlFriend: <span class="hljs-type">String</span>! <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Wendy&quot;</span><br /><span class="hljs-keyword">if</span> girlFriend <span class="hljs-operator">!=</span> <span class="hljs-literal">nil</span> {<br />    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;可愛的&quot;</span> <span class="hljs-operator">+</span> girlFriend)<br />}</span></pre><h3 name="c4b5" id="c4b5" class="graf graf--h3 graf-after--pre">無值怎麼辦? 變出預設值的雙重問號(nil-coalescing operator)</h3><p name="a772" id="a772" class="graf graf--p graf-after--h3">Optional 給予我們無值 <code class="markup--code markup--p-code">nil</code> 的彈性。但有些時候，我們仍希望在無值時有個預設值，例如以下例子，當沒有女朋友，<code class="markup--code markup--p-code">girlFriend</code> 為 <code class="markup--code markup--p-code">nil</code> 時，一律回覆女朋友是<code class="markup--code markup--p-code">不能說的秘密</code>。</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="4d4a" id="4d4a" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">var</span> girlFriend: <span class="hljs-type">String</span>?<br /><span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> girlFriend {<br />    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;我的女朋友是<span class="hljs-subst">\(girlFriend)</span>&quot;</span>)<br />} <span class="hljs-keyword">else</span> {<br />    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;不能說的秘密&quot;</span>)<br />}</span></pre><p name="ad9d" id="ad9d" class="graf graf--p graf-after--pre">有感於我們的需求，Swift 特別發明了即使 <code class="markup--code markup--p-code">nil</code> 也能變出預設值的雙重問號。在雙重問號的左邊接 optional，右邊接預設值，當 optional 不為 <code class="markup--code markup--p-code">nil</code> 時，即解開它的包裝取值。而當 optional 為 <code class="markup--code markup--p-code">nil</code> 時，則回傳預設值。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="8aba" id="8aba" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">var</span> girlFriend: <span class="hljs-type">String</span>?<br /><span class="hljs-keyword">var</span> girlFriendName <span class="hljs-operator">=</span> girlFriend <span class="hljs-operator">??</span> <span class="hljs-string">&quot;不能說的秘密&quot;</span></span></pre><figure name="63a1" id="63a1" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="0*LmIz9DxTEIfUCjYh" data-width="1024" data-height="1536" src="https://cdn-images-1.medium.com/max/800/0*LmIz9DxTEIfUCjYh"></figure><p name="2e36" id="2e36" class="graf graf--p graf-after--figure">當 <code class="markup--code markup--p-code">girlFriend</code> 有值時，<code class="markup--code markup--p-code">girlFriendName</code> 順利地設為解開包裝後的字串 Wendy。而當 <code class="markup--code markup--p-code">girlFriend</code> 為 <code class="markup--code markup--p-code">nil</code> 時，<code class="markup--code markup--p-code">girlFriendName</code> 則被設為不能說的秘密。</p><figure name="1ad6" id="1ad6" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*6CoFJoq3XA6JJ6CjfDjL1w.png" data-width="1674" data-height="666" src="https://cdn-images-1.medium.com/max/800/1*6CoFJoq3XA6JJ6CjfDjL1w.png"></figure><h3 name="444b" id="444b" class="graf graf--h3 graf-after--figure">AI 製作的 optional 動畫(GPT 5)</h3><div name="1def" id="1def" class="graf graf--mixtapeEmbed graf-after--h3"><a href="https://chatgpt.com/canvas/shared/68956f3cde7481919513130e4609fb83" data-href="https://chatgpt.com/canvas/shared/68956f3cde7481919513130e4609fb83" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://chatgpt.com/canvas/shared/68956f3cde7481919513130e4609fb83"><strong class="markup--strong markup--mixtapeEmbed-strong">Cute Swift Optional Web Demo (react)</strong><br><em class="markup--em markup--mixtapeEmbed-em">Edit description</em>chatgpt.com</a><a href="https://chatgpt.com/canvas/shared/68956f3cde7481919513130e4609fb83" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="5c92fe61a8e6071757ca618a0354850c" data-thumbnail-img-id="0*52MPUXfh_mARagD-" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*52MPUXfh_mARagD-);"></a></div><figure name="519b" id="519b" class="graf graf--figure graf-after--mixtapeEmbed"><img class="graf-image" data-image-id="1*ZkvaHgUC1MLIKlW-Q1HfPw.png" data-width="1626" data-height="914" src="https://cdn-images-1.medium.com/max/800/1*ZkvaHgUC1MLIKlW-Q1HfPw.png"></figure><h3 name="8ba2" id="8ba2" class="graf graf--h3 graf-after--figure">遇 nil 即臨陣脫逃的 optional chaining</h3><div name="7ce9" id="7ce9" class="graf graf--mixtapeEmbed graf-after--h3"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E9%81%87-nil-%E5%8D%B3%E8%87%A8%E9%99%A3%E8%84%AB%E9%80%83%E7%9A%84-optional-chaining-e763c1a10da5" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E9%81%87-nil-%E5%8D%B3%E8%87%A8%E9%99%A3%E8%84%AB%E9%80%83%E7%9A%84-optional-chaining-e763c1a10da5" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E9%81%87-nil-%E5%8D%B3%E8%87%A8%E9%99%A3%E8%84%AB%E9%80%83%E7%9A%84-optional-chaining-e763c1a10da5"><strong class="markup--strong markup--mixtapeEmbed-strong">遇 nil 即臨陣脫逃的 optional chaining</strong><br><em class="markup--em markup--mixtapeEmbed-em">optional binding 造成的複雜程式問題</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E9%81%87-nil-%E5%8D%B3%E8%87%A8%E9%99%A3%E8%84%AB%E9%80%83%E7%9A%84-optional-chaining-e763c1a10da5" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="a067b8ae13f77ca9b7391caec298db99" data-thumbnail-img-id="1*LWS2bgod2Sf7wuZWPgYB1A.jpeg" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*LWS2bgod2Sf7wuZWPgYB1A.jpeg);"></a></div><h3 name="2bda" id="2bda" class="graf graf--h3 graf-after--mixtapeEmbed">利用 Optional 的 flatMap 將多行 optional binding 變成一行</h3><div name="9024" id="9024" class="graf graf--mixtapeEmbed graf-after--h3"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-optional-%E7%9A%84-flatmap-%E5%B0%87%E5%A4%9A%E8%A1%8C-optional-binding-%E8%AE%8A%E6%88%90%E4%B8%80%E8%A1%8C-21771e71b8d2" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-optional-%E7%9A%84-flatmap-%E5%B0%87%E5%A4%9A%E8%A1%8C-optional-binding-%E8%AE%8A%E6%88%90%E4%B8%80%E8%A1%8C-21771e71b8d2" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-optional-%E7%9A%84-flatmap-%E5%B0%87%E5%A4%9A%E8%A1%8C-optional-binding-%E8%AE%8A%E6%88%90%E4%B8%80%E8%A1%8C-21771e71b8d2"><strong class="markup--strong markup--mixtapeEmbed-strong">利用 Optional 的 flatMap 將多行 optional binding 變成一行</strong><br><em class="markup--em markup--mixtapeEmbed-em">開發 iOS App 時，我們時常遇到串接多個 optional binding 的情況，比方以下例子先將網址字串變成合法格式的網址，然後再將它轉成 URL。</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-optional-%E7%9A%84-flatmap-%E5%B0%87%E5%A4%9A%E8%A1%8C-optional-binding-%E8%AE%8A%E6%88%90%E4%B8%80%E8%A1%8C-21771e71b8d2" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="53d48f6685a3043845cbec9b5caac27e" data-thumbnail-img-id="1*r01sFWxHz_-kWgfdzHY97Q.png" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*r01sFWxHz_-kWgfdzHY97Q.png);"></a></div><h3 name="f706" id="f706" class="graf graf--h3 graf-after--mixtapeEmbed">Optional 的真面目原來是 enum</h3><div name="394c" id="394c" class="graf graf--mixtapeEmbed graf-after--h3"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/optional-%E7%9A%84%E7%9C%9F%E9%9D%A2%E7%9B%AE%E5%8E%9F%E4%BE%86%E6%98%AF-enum-ca9ea924f631" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/optional-%E7%9A%84%E7%9C%9F%E9%9D%A2%E7%9B%AE%E5%8E%9F%E4%BE%86%E6%98%AF-enum-ca9ea924f631" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/optional-%E7%9A%84%E7%9C%9F%E9%9D%A2%E7%9B%AE%E5%8E%9F%E4%BE%86%E6%98%AF-enum-ca9ea924f631"><strong class="markup--strong markup--mixtapeEmbed-strong">Optional 的真面目原來是 enum</strong><br><em class="markup--em markup--mixtapeEmbed-em">撰寫 Swift 程式時，我們時常用到 optional，為了它使用 ? &amp; !。現在是時候揭開它的真面目了。</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/optional-%E7%9A%84%E7%9C%9F%E9%9D%A2%E7%9B%AE%E5%8E%9F%E4%BE%86%E6%98%AF-enum-ca9ea924f631" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="7f839dbeb50a11056e830c92891016d4" data-thumbnail-img-id="1*4EOidZ8VRLMFilszaho6XQ.jpeg" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*4EOidZ8VRLMFilszaho6XQ.jpeg);"></a></div><h3 name="4ffc" id="4ffc" class="graf graf--h3 graf-after--mixtapeEmbed">總結</h3><p name="ca79" id="ca79" class="graf graf--p graf-after--h3">透過 Optional，我們的程式將變得更安全更可靠。所有我們宣告的變數(常數)，不管型別是什麼，都可以幫它添加 optional 的特性，使其成為一個可以有值，也可以無值的特別變數(常數)。</p><figure name="342c" id="342c" class="graf graf--figure graf-after--p graf--trailing"><img class="graf-image" data-image-id="1*Scx5xhojl83sUwYR-qHY8Q.png" data-width="1024" data-height="1536" src="https://cdn-images-1.medium.com/max/800/1*Scx5xhojl83sUwYR-qHY8Q.png"></figure></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@apppeterpan" class="p-author h-card">彼得潘的 iOS App Neverland</a> on <a href="https://medium.com/p/99aff08690bd"><time class="dt-published" datetime="2025-04-12T14:40:38.618Z">April 12, 2025</time></a>.</p><p><a href="https://medium.com/@apppeterpan/swift%E7%9A%84%E5%95%8F%E8%99%9F%E8%88%87%E9%A9%9A%E5%98%86%E8%99%9F-%E5%8F%AF%E6%9C%89%E5%8F%AF%E7%84%A1%E7%9A%84-optional-99aff08690bd" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on November 16, 2025.</p></footer></article></body></html>