<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>使用 Swift OpenAPI Generator 自動生成串接 API 的 client</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">使用 Swift OpenAPI Generator 自動生成串接 API 的 client</h1>
</header>
<section data-field="body" class="e-content">
<section name="abeb" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="60c1" id="60c1" class="graf graf--h3 graf--leading graf--title">使用 Swift OpenAPI Generator 自動生成串接 API 的 client</h3><figure name="f294" id="f294" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="1*51tQ0Z1vE3Xo3yOmG1bqag.png" data-width="1486" data-height="722" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*51tQ0Z1vE3Xo3yOmG1bqag.png"></figure><p name="2c43" id="2c43" class="graf graf--p graf-after--figure">開發 iOS App 時，我們常常花時間研究 API 文件，然後再撰寫重覆類似的程式串接 API。</p><p name="2c2e" id="2c2e" class="graf graf--p graf-after--p">串接 API 不難，不過實作的過程有點無聊，而且容易不小心寫錯，有沒有更好的做法呢 ?</p><p name="00c7" id="00c7" class="graf graf--p graf-after--p">有的 ! 最近 Apple 推出了 Swift OpenAPI Generator。它可以讀取 OpenAPI 格式的文件，然後依據文件自動生成串接 API 的 Swift 程式。</p><p name="2069" id="2069" class="graf graf--p graf-after--p">因此只要後台提供 OpenAPI 格式的 API 文件(openapi.yaml 或 openapi.json)，我們將可省下串接 API 的時間，將時間花在更重要的 App 功能或美化 UI。</p><p name="954b" id="954b" class="graf graf--p graf-after--p">以下我們以抓取 emoji 資料的 Open Emoji API 為例，一步步說明如何使用 Swift OpenAPI Generator 生成串接 API 的 client。</p><figure name="8b81" id="8b81" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*xvabTez_j8TAEUGtD8BIvQ.png" data-width="1292" data-height="676" src="https://cdn-images-1.medium.com/max/800/1*xvabTez_j8TAEUGtD8BIvQ.png"></figure><div name="fd38" id="fd38" class="graf graf--mixtapeEmbed graf-after--figure"><a href="https://emoji-api.com/" data-href="https://emoji-api.com/" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://emoji-api.com/"><strong class="markup--strong markup--mixtapeEmbed-strong">Open Emoji API</strong><br><em class="markup--em markup--mixtapeEmbed-em">A free emoji API sourced directly from unicode.org - always up to date.</em>emoji-api.com</a><a href="https://emoji-api.com/" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="d22d0e04ad52800f70f8f89c49637477"></a></div><ul class="postList"><li name="fa90" id="fa90" class="graf graf--li graf-after--mixtapeEmbed">請 AI 依據 curl 的指令和結果寫出 openapi.yaml。</li><li name="39e5" id="39e5" class="graf graf--li graf-after--li">新增串接 API 的 target GeneratedClient。</li><li name="c08b" id="c08b" class="graf graf--li graf-after--li">加入 OpenAPI 文件。</li><li name="8b1c" id="8b1c" class="graf graf--li graf-after--li">加入設定檔 openapi-generator-config.yaml。</li><li name="017b" id="017b" class="graf graf--li graf-after--li">加入 Swift OpenAPI Generator 的相關 package。</li><li name="571a" id="571a" class="graf graf--li graf-after--li">設定 build plugin 為 OpenAPIGenerator。</li><li name="fc63" id="fc63" class="graf graf--li graf-after--li">定義串接 API 的 client。</li><li name="f158" id="f158" class="graf graf--li graf-after--li">在 App 裡使用 GeneratedClient 串接 API。</li><li name="2b0a" id="2b0a" class="graf graf--li graf-after--li">One more thing，上傳 JSON 資料的 Post API。</li></ul><h3 name="b4b3" id="b4b3" class="graf graf--h3 graf-after--li">請 AI 依據 curl 的指令和結果寫出 openapi.yaml</h3><p name="5c24" id="5c24" class="graf graf--p graf-after--h3">Open Emoji API 沒有提供 OpenAPI 文件，因此我們先請 AI 幫忙，請 GPT 依據 API <code class="markup--code markup--p-code">Search for emojis</code> 和 <code class="markup--code markup--p-code">Get categories</code> 的 curl 指令和結果寫出 openapi.yaml。</p><figure name="155c" id="155c" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*JYXJLLrW-omsn-qAptxbyw.png" data-width="1872" data-height="932" src="https://cdn-images-1.medium.com/max/800/1*JYXJLLrW-omsn-qAptxbyw.png"></figure><figure name="71ac" id="71ac" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*Mn4ziVnnim6iaBxxk9E0QQ.png" data-width="1820" data-height="920" src="https://cdn-images-1.medium.com/max/800/1*Mn4ziVnnim6iaBxxk9E0QQ.png"></figure><p name="7843" id="7843" class="graf graf--p graf-after--figure">以下是我們和 AI 的對話過程。</p><div name="2c9a" id="2c9a" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://chat.openai.com/share/5ead6a3d-014d-411e-be7e-a7ab478145a0" data-href="https://chat.openai.com/share/5ead6a3d-014d-411e-be7e-a7ab478145a0" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://chat.openai.com/share/5ead6a3d-014d-411e-be7e-a7ab478145a0"><strong class="markup--strong markup--mixtapeEmbed-strong">API for Emojis &amp; Categories</strong><br><em class="markup--em markup--mixtapeEmbed-em">Edit description</em>chat.openai.com</a><a href="https://chat.openai.com/share/5ead6a3d-014d-411e-be7e-a7ab478145a0" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="a28440d2ba2c88df8c9cf10fe6625e7a" data-thumbnail-img-id="0*BYntskvDccrvsLEe" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*BYntskvDccrvsLEe);"></a></div><p name="2b54" id="2b54" class="graf graf--p graf-after--mixtapeEmbed">AI 成功生成符合 OpenAPI 格式的 openapi.yaml。</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="yaml" name="1d48" id="1d48" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-attr">openapi:</span> <span class="hljs-number">3.0</span><span class="hljs-number">.0</span><br /><span class="hljs-attr">info:</span><br />  <span class="hljs-attr">title:</span> <span class="hljs-string">Emoji</span> <span class="hljs-string">API</span><br />  <span class="hljs-attr">version:</span> <span class="hljs-number">1.0</span><span class="hljs-number">.0</span><br /><span class="hljs-attr">servers:</span><br />  <span class="hljs-bullet">-</span> <span class="hljs-attr">url:</span> <span class="hljs-string">https://emoji-api.com</span><br /><br /><span class="hljs-attr">paths:</span><br />  <span class="hljs-string">/emojis:</span><br />    <span class="hljs-attr">get:</span><br />      <span class="hljs-attr">operationId:</span> <span class="hljs-string">searchEmojis</span><br />      <span class="hljs-attr">summary:</span> <span class="hljs-string">Search</span> <span class="hljs-string">for</span> <span class="hljs-string">emojis</span><br />      <span class="hljs-attr">parameters:</span><br />        <span class="hljs-bullet">-</span> <span class="hljs-attr">in:</span> <span class="hljs-string">query</span><br />          <span class="hljs-attr">name:</span> <span class="hljs-string">search</span><br />          <span class="hljs-attr">schema:</span><br />            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br />          <span class="hljs-attr">description:</span> <span class="hljs-string">The</span> <span class="hljs-string">search</span> <span class="hljs-string">query</span> <span class="hljs-string">for</span> <span class="hljs-string">finding</span> <span class="hljs-string">related</span> <span class="hljs-string">emojis</span><br />        <span class="hljs-bullet">-</span> <span class="hljs-attr">in:</span> <span class="hljs-string">query</span><br />          <span class="hljs-attr">name:</span> <span class="hljs-string">access_key</span><br />          <span class="hljs-attr">required:</span> <span class="hljs-literal">true</span><br />          <span class="hljs-attr">schema:</span><br />            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br />          <span class="hljs-attr">description:</span> <span class="hljs-string">Access</span> <span class="hljs-string">key</span> <span class="hljs-string">to</span> <span class="hljs-string">use</span> <span class="hljs-string">the</span> <span class="hljs-string">API</span><br />      <span class="hljs-attr">responses:</span><br />        <span class="hljs-attr">&#x27;200&#x27;:</span><br />          <span class="hljs-attr">description:</span> <span class="hljs-string">Successful</span> <span class="hljs-string">response</span><br />          <span class="hljs-attr">content:</span><br />            <span class="hljs-attr">application/json:</span><br />              <span class="hljs-attr">schema:</span><br />                <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br />                <span class="hljs-attr">items:</span><br />                  <span class="hljs-string">$ref:</span> <span class="hljs-string">&#x27;#/components/schemas/Emoji&#x27;</span><br />  <br />  <span class="hljs-string">/categories:</span><br />    <span class="hljs-attr">get:</span><br />      <span class="hljs-attr">operationId:</span> <span class="hljs-string">getCategories</span><br />      <span class="hljs-attr">summary:</span> <span class="hljs-string">Get</span> <span class="hljs-string">categories</span><br />      <span class="hljs-attr">parameters:</span><br />        <span class="hljs-bullet">-</span> <span class="hljs-attr">in:</span> <span class="hljs-string">query</span><br />          <span class="hljs-attr">name:</span> <span class="hljs-string">access_key</span><br />          <span class="hljs-attr">required:</span> <span class="hljs-literal">true</span><br />          <span class="hljs-attr">schema:</span><br />            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br />          <span class="hljs-attr">description:</span> <span class="hljs-string">Access</span> <span class="hljs-string">key</span> <span class="hljs-string">to</span> <span class="hljs-string">use</span> <span class="hljs-string">the</span> <span class="hljs-string">API</span><br />      <span class="hljs-attr">responses:</span><br />        <span class="hljs-attr">&#x27;200&#x27;:</span><br />          <span class="hljs-attr">description:</span> <span class="hljs-string">Successful</span> <span class="hljs-string">response</span><br />          <span class="hljs-attr">content:</span><br />            <span class="hljs-attr">application/json:</span><br />              <span class="hljs-attr">schema:</span><br />                <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br />                <span class="hljs-attr">items:</span><br />                  <span class="hljs-string">$ref:</span> <span class="hljs-string">&#x27;#/components/schemas/Category&#x27;</span><br /><br /><span class="hljs-attr">components:</span><br />  <span class="hljs-attr">schemas:</span><br />    <span class="hljs-attr">Emoji:</span><br />      <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br />      <span class="hljs-attr">properties:</span><br />        <span class="hljs-attr">slug:</span><br />          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br />        <span class="hljs-attr">character:</span><br />          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br />        <span class="hljs-attr">unicodeName:</span><br />          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br />        <span class="hljs-attr">codePoint:</span><br />          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br />        <span class="hljs-attr">group:</span><br />          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br />        <span class="hljs-attr">subGroup:</span><br />          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br /><br />    <span class="hljs-attr">Category:</span><br />      <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br />      <span class="hljs-attr">properties:</span><br />        <span class="hljs-attr">slug:</span><br />          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br />        <span class="hljs-attr">subCategories:</span><br />          <span class="hljs-attr">type:</span> <span class="hljs-string">array</span><br />          <span class="hljs-attr">items:</span><br />            <span class="hljs-attr">type:</span> <span class="hljs-string">string</span></span></pre><h3 name="2c49" id="2c49" class="graf graf--h3 graf-after--pre">新增串接 API 的 target GeneratedClient</h3><p name="7798" id="7798" class="graf graf--p graf-after--h3">我們可以在 App 的程式裡實作串接 API 的 client，不過依據 Apple 官方的建議，在 App 專案裡另外新增串接 API 的 target 更好，如此可避免 client 的檔名或型別名和原本 App 裡的程式衝突。</p><div name="5956" id="5956" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://swiftpackageindex.com/apple/swift-openapi-generator/0.1.8/tutorials/swift-openapi-generator/clientxcode" data-href="https://swiftpackageindex.com/apple/swift-openapi-generator/0.1.8/tutorials/swift-openapi-generator/clientxcode" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://swiftpackageindex.com/apple/swift-openapi-generator/0.1.8/tutorials/swift-openapi-generator/clientxcode"><strong class="markup--strong markup--mixtapeEmbed-strong">Documentation</strong><br><em class="markup--em markup--mixtapeEmbed-em">Please turn on JavaScript in your browser and refresh the page to view its content. The Swift Package Index is entirely…</em>swiftpackageindex.com</a><a href="https://swiftpackageindex.com/apple/swift-openapi-generator/0.1.8/tutorials/swift-openapi-generator/clientxcode" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="3795ba6b380fd5b4402f2854b55bb246"></a></div><p name="20ae" id="20ae" class="graf graf--p graf-after--mixtapeEmbed">從 Quick Actions 選擇 New &gt; Target。</p><figure name="d1d3" id="d1d3" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*OYWziF00t7AX34yRcuVGDA.png" data-width="992" data-height="260" src="https://cdn-images-1.medium.com/max/800/1*OYWziF00t7AX34yRcuVGDA.png"></figure><p name="a9a4" id="a9a4" class="graf graf--p graf-after--figure">選擇 iOS 下的 Framework。</p><figure name="32fa" id="32fa" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*ZqEI1hKxsZIQa3jIKIRBWA.png" data-width="1444" data-height="1016" src="https://cdn-images-1.medium.com/max/800/1*ZqEI1hKxsZIQa3jIKIRBWA.png"></figure><p name="422d" id="422d" class="graf graf--p graf-after--figure">取名為 GeneratedClient。</p><figure name="5663" id="5663" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*ydCAVrri9stxFOmTpuewRQ.png" data-width="1440" data-height="1018" src="https://cdn-images-1.medium.com/max/800/1*ydCAVrri9stxFOmTpuewRQ.png"></figure><p name="2c23" id="2c23" class="graf graf--p graf-after--figure">生成 GeneratedClient 的相關檔案和 target。</p><figure name="b3d7" id="b3d7" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*nXYyzexcLgjmD6HLSeBjQA.png" data-width="2800" data-height="818" src="https://cdn-images-1.medium.com/max/800/1*nXYyzexcLgjmD6HLSeBjQA.png"></figure><h3 name="baf8" id="baf8" class="graf graf--h3 graf-after--figure">加入 OpenAPI 文件</h3><p name="9937" id="9937" class="graf graf--p graf-after--h3">在 GeneratedClient 下加入剛剛 AI 生成的 openapi.yaml。</p><figure name="fe25" id="fe25" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*ZzVExPKEFJj05mXgCJ7T1A.png" data-width="2778" data-height="1436" src="https://cdn-images-1.medium.com/max/800/1*ZzVExPKEFJj05mXgCJ7T1A.png"></figure><h3 name="463b" id="463b" class="graf graf--h3 graf-after--figure">加入設定檔 openapi-generator-config.yaml</h3><p name="b0b8" id="b0b8" class="graf graf--p graf-after--h3">在 GeneratedClient 下加入設定檔 openapi-generator-config.yaml，設定生成 type 和 client 的相關程式。</p><figure name="4d58" id="4d58" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*RtGr6lpT0bShZjvIZYWRsQ.png" data-width="1284" data-height="574" src="https://cdn-images-1.medium.com/max/800/1*RtGr6lpT0bShZjvIZYWRsQ.png"></figure><pre data-code-block-mode="0" spellcheck="false" name="989d" id="989d" class="graf graf--pre graf-after--figure graf--preV2"><span class="pre--content">generate:<br>  - types<br>  - client</span></pre><h3 name="bd3c" id="bd3c" class="graf graf--h3 graf-after--pre">加入 Swift OpenAPI Generator 的相關 package</h3><ul class="postList"><li name="562a" id="562a" class="graf graf--li graf-after--h3">加入 Swift OpenAPI Generator。</li></ul><pre data-code-block-mode="0" spellcheck="false" name="eb83" id="eb83" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content">https://github.com/apple/swift-openapi-generator</span></pre><figure name="8e00" id="8e00" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*xa4kgQr2yZ6CXrB-_IGbbQ.png" data-width="2410" data-height="1196" src="https://cdn-images-1.medium.com/max/800/1*xa4kgQr2yZ6CXrB-_IGbbQ.png"></figure><p name="75a3" id="75a3" class="graf graf--p graf-after--figure">待會我們將在 build plugin 設定使用 Swift OpenAPI Generator，因此下圖的視窗不需設定 Add to Target，直接點選 Add Package 即可。</p><figure name="d104" id="d104" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*u8X-VV4YRnKwVWEp7UeBHg.png" data-width="1298" data-height="586" src="https://cdn-images-1.medium.com/max/800/1*u8X-VV4YRnKwVWEp7UeBHg.png"></figure><ul class="postList"><li name="802d" id="802d" class="graf graf--li graf-after--figure">加入 Swift OpenAPI Generator Runtime。</li></ul><pre data-code-block-mode="0" spellcheck="false" name="fcf0" id="fcf0" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content">https://github.com/apple/swift-openapi-runtime</span></pre><figure name="d098" id="d098" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*CAXfh9KSA_z1HBzfoX89MA.png" data-width="2420" data-height="1198" src="https://cdn-images-1.medium.com/max/800/1*CAXfh9KSA_z1HBzfoX89MA.png"></figure><p name="1e54" id="1e54" class="graf graf--p graf-after--figure">Add to Target 選擇 GeneratedClient。</p><figure name="503b" id="503b" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*ZHamJQ8hlXpKHzKdYSBeFw.png" data-width="1312" data-height="586" src="https://cdn-images-1.medium.com/max/800/1*ZHamJQ8hlXpKHzKdYSBeFw.png"></figure><ul class="postList"><li name="031f" id="031f" class="graf graf--li graf-after--figure">加入 URLSession Transport for Swift OpenAPI Generator。</li></ul><pre data-code-block-mode="0" spellcheck="false" name="eb31" id="eb31" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content">https://github.com/apple/swift-openapi-urlsession</span></pre><figure name="c87f" id="c87f" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*pAe90JkRee4NQ8zRbe1mJg.png" data-width="2402" data-height="1202" src="https://cdn-images-1.medium.com/max/800/1*pAe90JkRee4NQ8zRbe1mJg.png"></figure><p name="3ccc" id="3ccc" class="graf graf--p graf-after--figure">Add to Target 選擇 GeneratedClient。</p><figure name="e737" id="e737" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*uMFKKTBZOkOfooS6eduEGw.png" data-width="1304" data-height="588" src="https://cdn-images-1.medium.com/max/800/1*uMFKKTBZOkOfooS6eduEGw.png"></figure><figure name="5bd7" id="5bd7" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*avH__NvjaV0hh78brRSqRg.png" data-width="2078" data-height="1320" src="https://cdn-images-1.medium.com/max/800/1*avH__NvjaV0hh78brRSqRg.png"></figure><h3 name="ca6c" id="ca6c" class="graf graf--h3 graf-after--figure">設定 build plugin 為 OpenAPIGenerator</h3><p name="24af" id="24af" class="graf graf--p graf-after--h3">點選 TARGETS 下的 GeneratedClient，切換到 Build Phases 分頁，點選 Run Build Tool Plug-ins 下的 +。</p><figure name="d6d5" id="d6d5" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*4FfBcmE5lkNbVqP3khPltA.png" data-width="1672" data-height="692" src="https://cdn-images-1.medium.com/max/800/1*4FfBcmE5lkNbVqP3khPltA.png"></figure><p name="cb53" id="cb53" class="graf graf--p graf-after--figure">選擇 OpenAPIGenerator。</p><figure name="6b0b" id="6b0b" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*oHCWsFW_jDxGlWgX-pcRIg.png" data-width="786" data-height="898" src="https://cdn-images-1.medium.com/max/800/1*oHCWsFW_jDxGlWgX-pcRIg.png"></figure><figure name="fd8e" id="fd8e" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*gEF6-a7kuqT_iWgDLwnMgA.png" data-width="1290" data-height="346" src="https://cdn-images-1.medium.com/max/800/1*gEF6-a7kuqT_iWgDLwnMgA.png"></figure><p name="ae79" id="ae79" class="graf graf--p graf-after--figure">按 cmd +b build 程式，Swift OpenAPI Generator 依據 openapi.yaml 生成串接 API 的 swift 程式。</p><figure name="5769" id="5769" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*l3JbuXDkqzZ3lJFCg58yeQ.png" data-width="2118" data-height="1570" src="https://cdn-images-1.medium.com/max/800/1*l3JbuXDkqzZ3lJFCg58yeQ.png"></figure><h3 name="84e3" id="84e3" class="graf graf--h3 graf-after--figure">定義串接 API 的 client</h3><p name="2d43" id="2d43" class="graf graf--p graf-after--h3">OpenAPI Generator 已經幫我們寫好串接 API 的程式，不過通常我們會再定義一個方便 App 存取 API 資料的 client。</p><p name="0c60" id="0c60" class="graf graf--p graf-after--p">以下我們在 GeneratedClient 下加入 EmojiClient.swift。</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="741a" id="741a" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> OpenAPIURLSession<br /><br /><span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">EmojiClient</span> {<br /><br />    <span class="hljs-keyword">let</span> apiKey <span class="hljs-operator">=</span> <span class="hljs-string">&quot;9c082d35012ea20e30e76273a49b18b9cf1cd8c0&quot;</span><br />    <span class="hljs-keyword">let</span> client <span class="hljs-operator">=</span> <span class="hljs-type">Client</span>(<br />        serverURL: <span class="hljs-keyword">try!</span> <span class="hljs-type">Servers</span>.server1(),<br />        transport: <span class="hljs-type">URLSessionTransport</span>()<br />    )<br />    <br />    <span class="hljs-keyword">public</span> <span class="hljs-keyword">init</span>() {}<br /><br />    <span class="hljs-keyword">public</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">searchEmojis</span>(<span class="hljs-params">search</span>: <span class="hljs-type">String</span>) <span class="hljs-keyword">async</span> <span class="hljs-keyword">throws</span> -&gt; [<span class="hljs-type">Components</span>.<span class="hljs-type">Schemas</span>.<span class="hljs-type">Emoji</span>] {<br />       <br />        <span class="hljs-keyword">let</span> response <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> client.searchEmojis(<br />            .<span class="hljs-keyword">init</span>(query: .<span class="hljs-keyword">init</span>(search: search, access_key: apiKey))<br />        )<br />        <span class="hljs-keyword">switch</span> response {<br />        <span class="hljs-keyword">case</span> .ok(<span class="hljs-keyword">let</span> okResponse):<br />            <span class="hljs-keyword">switch</span> okResponse.body {<br />            <span class="hljs-keyword">case</span> .json(<span class="hljs-keyword">let</span> emojis):<br />                <span class="hljs-keyword">return</span> emojis<br />            }<br />        <span class="hljs-keyword">case</span> .undocumented(statusCode: <span class="hljs-keyword">let</span> statusCode, <span class="hljs-keyword">_</span>):<br />            <span class="hljs-built_in">print</span>(statusCode)<br />            <span class="hljs-keyword">return</span> []<br />        }<br />    }<br />    <br />    <span class="hljs-keyword">public</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">getCategories</span>() <span class="hljs-keyword">async</span> <span class="hljs-keyword">throws</span> -&gt; [<span class="hljs-type">Components</span>.<span class="hljs-type">Schemas</span>.<span class="hljs-type">Category</span>] {<br />        <span class="hljs-keyword">let</span> response <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> client.getCategories(<br />            .<span class="hljs-keyword">init</span>(query: .<span class="hljs-keyword">init</span>(access_key: apiKey))<br />        )<br />        <span class="hljs-keyword">switch</span> response {<br />        <span class="hljs-keyword">case</span> .ok(<span class="hljs-keyword">let</span> okResponse):<br />            <span class="hljs-keyword">switch</span> okResponse.body {<br />            <span class="hljs-keyword">case</span> .json(<span class="hljs-keyword">let</span> categories):<br />                <span class="hljs-keyword">return</span> categories<br />            }<br />        <span class="hljs-keyword">case</span> .undocumented(statusCode: <span class="hljs-keyword">let</span> statusCode, <span class="hljs-keyword">_</span>):<br />            <span class="hljs-built_in">print</span>(statusCode)<br />            <span class="hljs-keyword">return</span> []<br />        }<br />    }<br />}</span></pre><p name="0af2" id="0af2" class="graf graf--p graf-after--pre">說明</p><ul class="postList"><li name="f5ea" id="f5ea" class="graf graf--li graf-after--p">建立 Client。</li></ul><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="d3b5" id="d3b5" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> client <span class="hljs-operator">=</span> <span class="hljs-type">Client</span>(<br />    serverURL: <span class="hljs-keyword">try!</span> <span class="hljs-type">Servers</span>.server1(),<br />    transport: <span class="hljs-type">URLSessionTransport</span>()<br />)</span></pre><p name="d034" id="d034" class="graf graf--p graf-after--pre">server1 的網址對應 openapi.yaml 設定的 <a href="https://emoji-api.com" data-href="https://emoji-api.com" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">https://emoji-api.com</a>。</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="yaml" name="3942" id="3942" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-attr">servers:</span><br />  <span class="hljs-bullet">-</span> <span class="hljs-attr">url:</span> <span class="hljs-string">https://emoji-api.com</span></span></pre><ul class="postList"><li name="756c" id="756c" class="graf graf--li graf-after--pre">自動生成的 searchEmojis 和 getCategories。</li></ul><p name="8a61" id="8a61" class="graf graf--p graf-after--li">我們不用再辛苦撰寫串接 API 的程式，OpenAPI Generator 讀取 openapi.yaml 後自動生成 searchEmojis 和 getCategories。</p><figure name="5ae6" id="5ae6" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*4ACvZ-2oP8X1DNc9_PezFA.png" data-width="908" data-height="504" src="https://cdn-images-1.medium.com/max/800/1*4ACvZ-2oP8X1DNc9_PezFA.png"></figure><ul class="postList"><li name="d57f" id="d57f" class="graf graf--li graf-after--figure">解析回傳的 JSON 資料。</li></ul><p name="1fa9" id="1fa9" class="graf graf--p graf-after--li">OpenAPI Generator 會生成 JSON 對應的 Codable 型別，因此我們可以輕鬆將 JSON 轉換成 App 需要的資料。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="4f1e" id="4f1e" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">switch</span> response {<br /><span class="hljs-keyword">case</span> .ok(<span class="hljs-keyword">let</span> okResponse):<br />    <span class="hljs-keyword">switch</span> okResponse.body {<br />    <span class="hljs-keyword">case</span> .json(<span class="hljs-keyword">let</span> emojis):<br />        <span class="hljs-keyword">return</span> emojis<br />    }</span></pre><h3 name="e1a2" id="e1a2" class="graf graf--h3 graf-after--pre">在 App 裡使用 GeneratedClient 串接 API</h3><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="487d" id="487d" class="graf graf--pre graf-after--h3 graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> SwiftUI<br /><span class="hljs-keyword">import</span> GeneratedClient<br /><br /><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ContentView</span>: <span class="hljs-title class_">View</span> {<br />    <span class="hljs-meta">@State</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> emojis <span class="hljs-operator">=</span> [<span class="hljs-type">Components</span>.<span class="hljs-type">Schemas</span>.<span class="hljs-type">Emoji</span>]()<br />    <br />    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {<br />        <span class="hljs-type">List</span>(emojis, id:\.character) { emoji <span class="hljs-keyword">in</span><br />            <span class="hljs-type">HStack</span> {<br />                <span class="hljs-type">Text</span>(emoji.character <span class="hljs-operator">??</span> <span class="hljs-string">&quot;&quot;</span>)<br />                <span class="hljs-type">Text</span>(emoji.unicodeName <span class="hljs-operator">??</span> <span class="hljs-string">&quot;&quot;</span>)<br />            }<br />            .font(.largeTitle)<br />        }<br />        .task {<br />            <span class="hljs-keyword">do</span> {<br />                emojis <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> <span class="hljs-type">EmojiClient</span>().searchEmojis(search: <span class="hljs-string">&quot;computer&quot;</span>)<br />            } <span class="hljs-keyword">catch</span> {<br />                <br />            }<br />        }<br />    }<br />}</span></pre><figure name="3f51" id="3f51" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*qIU8eKgSsfaa-q942AUXXQ.png" data-width="1179" data-height="2556" src="https://cdn-images-1.medium.com/max/800/1*qIU8eKgSsfaa-q942AUXXQ.png"></figure><div name="cb84" id="cb84" class="graf graf--mixtapeEmbed graf-after--figure"><a href="https://github.com/AppPeterPan/DemoEmoji" data-href="https://github.com/AppPeterPan/DemoEmoji" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://github.com/AppPeterPan/DemoEmoji"><strong class="markup--strong markup--mixtapeEmbed-strong">GitHub - AppPeterPan/DemoEmoji</strong><br><em class="markup--em markup--mixtapeEmbed-em">Contribute to AppPeterPan/DemoEmoji development by creating an account on GitHub.</em>github.com</a><a href="https://github.com/AppPeterPan/DemoEmoji" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="6a909d0dd0fc0b10d49e979a751dc3bc" data-thumbnail-img-id="0*w2wKVl0fbeUT-HR-" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*w2wKVl0fbeUT-HR-);"></a></div><h3 name="4998" id="4998" class="graf graf--h3 graf-after--mixtapeEmbed">One more thing，上傳 JSON 資料的 Post API</h3><p name="e622" id="e622" class="graf graf--p graf-after--h3">剛剛看到的例子都是 Get API，以下我們再試試串接 ReqRes 的 Post API。</p><div name="82ae" id="82ae" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://reqres.in/" data-href="https://reqres.in/" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://reqres.in/"><strong class="markup--strong markup--mixtapeEmbed-strong">Reqres - <em class="markup--em markup--mixtapeEmbed-em">A hosted REST-API ready to respond to your AJAX requests</em></strong><br>A hosted REST-API ready to respond to your AJAX requestsreqres.in</a><a href="https://reqres.in/" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="3f830c9f1477420fe7b4f550a9255a95" data-thumbnail-img-id="0*PEoj7KC1d4gzjgma" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*PEoj7KC1d4gzjgma);"></a></div><p name="f8fd" id="f8fd" class="graf graf--p graf-after--mixtapeEmbed">ReqRes 的 Login API。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="bash" name="8c5d" id="8c5d" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">curl -X <span class="hljs-string">&#x27;POST&#x27;</span> \<br />  <span class="hljs-string">&#x27;https://reqres.in/api/login&#x27;</span> \<br />  -H <span class="hljs-string">&#x27;accept: application/json&#x27;</span> \<br />  -H <span class="hljs-string">&#x27;Content-Type: application/json&#x27;</span> \<br />  -d <span class="hljs-string">&#x27;{<br />  &quot;email&quot;: &quot;eve.holt@reqres.in&quot;,<br />  &quot;password&quot;: &quot;cityslicka&quot;<br />}&#x27;</span><br /><br />結果<br /><br />{<br />  <span class="hljs-string">&quot;token&quot;</span>: <span class="hljs-string">&quot;QpwL5tke4Pnpja7X4&quot;</span><br />}</span></pre><p name="65d2" id="65d2" class="graf graf--p graf-after--pre">AI 生成的 openapi.yaml。</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="yaml" name="f28c" id="f28c" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-attr">openapi:</span> <span class="hljs-number">3.0</span><span class="hljs-number">.0</span><br /><span class="hljs-attr">info:</span><br />  <span class="hljs-attr">title:</span> <span class="hljs-string">Simple</span> <span class="hljs-string">Authentication</span> <span class="hljs-string">API</span><br />  <span class="hljs-attr">version:</span> <span class="hljs-number">1.0</span><span class="hljs-number">.0</span><br /><br /><span class="hljs-attr">servers:</span><br />  <span class="hljs-bullet">-</span> <span class="hljs-attr">url:</span> <span class="hljs-string">https://reqres.in</span><br /><br /><span class="hljs-attr">paths:</span><br />  <span class="hljs-string">/api/login:</span><br />    <span class="hljs-attr">post:</span><br />      <span class="hljs-attr">operationId:</span> <span class="hljs-string">userLogin</span> <br />      <span class="hljs-attr">summary:</span> <span class="hljs-string">Authenticate</span> <span class="hljs-string">a</span> <span class="hljs-string">user.</span><br />      <span class="hljs-attr">description:</span> <span class="hljs-string">This</span> <span class="hljs-string">endpoint</span> <span class="hljs-string">is</span> <span class="hljs-string">used</span> <span class="hljs-string">for</span> <span class="hljs-string">authenticating</span> <span class="hljs-string">a</span> <span class="hljs-string">user</span> <span class="hljs-string">with</span> <span class="hljs-string">email</span> <span class="hljs-string">and</span> <span class="hljs-string">password.</span><br />      <span class="hljs-attr">requestBody:</span><br />        <span class="hljs-attr">required:</span> <span class="hljs-literal">true</span><br />        <span class="hljs-attr">content:</span><br />          <span class="hljs-attr">application/json:</span><br />            <span class="hljs-attr">schema:</span><br />              <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br />              <span class="hljs-attr">properties:</span><br />                <span class="hljs-attr">email:</span><br />                  <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br />                  <span class="hljs-attr">example:</span> <span class="hljs-string">eve.holt@reqres.in</span><br />                <span class="hljs-attr">password:</span><br />                  <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br />                  <span class="hljs-attr">example:</span> <span class="hljs-string">cityslicka</span><br />              <span class="hljs-attr">required:</span><br />                <span class="hljs-bullet">-</span> <span class="hljs-string">email</span><br />                <span class="hljs-bullet">-</span> <span class="hljs-string">password</span><br />      <span class="hljs-attr">responses:</span><br />        <span class="hljs-attr">&#x27;200&#x27;:</span><br />          <span class="hljs-attr">description:</span> <span class="hljs-string">Successful</span> <span class="hljs-string">login.</span><br />          <span class="hljs-attr">content:</span><br />            <span class="hljs-attr">application/json:</span><br />              <span class="hljs-attr">schema:</span><br />                <span class="hljs-attr">type:</span> <span class="hljs-string">object</span><br />                <span class="hljs-attr">properties:</span><br />                  <span class="hljs-attr">token:</span><br />                    <span class="hljs-attr">type:</span> <span class="hljs-string">string</span><br />                    <span class="hljs-attr">example:</span> <span class="hljs-string">QpwL5tke4Pnpja7X4</span><br />        <span class="hljs-attr">&#x27;400&#x27;:</span><br />          <span class="hljs-attr">description:</span> <span class="hljs-string">Invalid</span> <span class="hljs-string">input.</span></span></pre><p name="cf0d" id="cf0d" class="graf graf--p graf-after--pre">定義 client，Post 上傳的 JSON 資料透過以下程式生成 <code class="markup--code markup--p-code">.init(body: .json(.init(email: email, password: password)))</code>。</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="0e7f" id="0e7f" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> OpenAPIURLSession<br /><br /><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">APIError</span>: <span class="hljs-title class_">Error</span> {<br />    <span class="hljs-keyword">case</span> badRequest<br />    <span class="hljs-keyword">case</span> undocumented<br />}<br /><br /><span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">ReqResClient</span> {<br /><br />    <span class="hljs-keyword">let</span> client <span class="hljs-operator">=</span> <span class="hljs-type">Client</span>(<br />        serverURL: <span class="hljs-keyword">try!</span> <span class="hljs-type">Servers</span>.server1(),<br />        transport: <span class="hljs-type">URLSessionTransport</span>()<br />    )<br />    <br />    <span class="hljs-keyword">public</span> <span class="hljs-keyword">init</span>() {}<br /><br />    <span class="hljs-keyword">public</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">email</span>: <span class="hljs-type">String</span>, <span class="hljs-params">password</span>: <span class="hljs-type">String</span>) <span class="hljs-keyword">async</span> <span class="hljs-keyword">throws</span> -&gt; <span class="hljs-type">String</span> {<br />        <br />        <span class="hljs-keyword">let</span> response <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> client.userLogin(<br />            .<span class="hljs-keyword">init</span>(body: .json(.<span class="hljs-keyword">init</span>(email: email, password: password)))<br />        )<br />        <br />        <span class="hljs-keyword">switch</span> response {<br />        <span class="hljs-keyword">case</span> .ok(<span class="hljs-keyword">let</span> okResponse):<br />            <span class="hljs-keyword">switch</span> okResponse.body {<br />            <span class="hljs-keyword">case</span> .json(<span class="hljs-keyword">let</span> result):<br />                <span class="hljs-keyword">return</span> result.token <span class="hljs-operator">??</span> <span class="hljs-string">&quot;&quot;</span><br />            }<br />        <span class="hljs-keyword">case</span> .undocumented(statusCode: <span class="hljs-keyword">let</span> statusCode, <span class="hljs-keyword">_</span>):<br />            <span class="hljs-built_in">print</span>(statusCode)<br />            <span class="hljs-keyword">throw</span> <span class="hljs-type">APIError</span>.undocumented<br />        <span class="hljs-keyword">case</span> .badRequest(<span class="hljs-keyword">_</span>):<br />            <span class="hljs-keyword">throw</span> <span class="hljs-type">APIError</span>.badRequest<br />        }<br />    }<br />    <br />   <br />}</span></pre><h3 name="bc42" id="bc42" class="graf graf--h3 graf-after--pre">參考連結</h3><div name="6028" id="6028" class="graf graf--mixtapeEmbed graf-after--h3"><a href="https://developer.apple.com/wwdc23/10171" data-href="https://developer.apple.com/wwdc23/10171" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/wwdc23/10171"><strong class="markup--strong markup--mixtapeEmbed-strong">Meet Swift OpenAPI Generator - WWDC23 - Videos - Apple Developer</strong><br><em class="markup--em markup--mixtapeEmbed-em">Discover how Swift OpenAPI Generator can help you work with HTTP server APIs whether you&#39;re extending an iOS app or…</em>developer.apple.com</a><a href="https://developer.apple.com/wwdc23/10171" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="b307dcdee45a333f3f43c867e85dce26" data-thumbnail-img-id="0*IvJDiJOPgz12fbws" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*IvJDiJOPgz12fbws);"></a></div><div name="0986" id="0986" class="graf graf--mixtapeEmbed graf-after--mixtapeEmbed graf--trailing"><a href="https://swiftpackageindex.com/apple/swift-openapi-generator/0.1.8/documentation/swift-openapi-generator" data-href="https://swiftpackageindex.com/apple/swift-openapi-generator/0.1.8/documentation/swift-openapi-generator" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://swiftpackageindex.com/apple/swift-openapi-generator/0.1.8/documentation/swift-openapi-generator"><strong class="markup--strong markup--mixtapeEmbed-strong">Documentation</strong><br><em class="markup--em markup--mixtapeEmbed-em">Please turn on JavaScript in your browser and refresh the page to view its content. The Swift Package Index is entirely…</em>swiftpackageindex.com</a><a href="https://swiftpackageindex.com/apple/swift-openapi-generator/0.1.8/documentation/swift-openapi-generator" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="d27bd7ed1bb799540b3a53d2f4abd5e0"></a></div></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@apppeterpan" class="p-author h-card">彼得潘的 iOS App Neverland</a> on <a href="https://medium.com/p/be9654352d72"><time class="dt-published" datetime="2023-08-14T13:26:29.859Z">August 14, 2023</time></a>.</p><p><a href="https://medium.com/@apppeterpan/%E4%BD%BF%E7%94%A8-swift-openapi-generator-%E8%87%AA%E5%8B%95%E7%94%9F%E6%88%90%E4%B8%B2%E6%8E%A5-api-%E7%9A%84-client-be9654352d72" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on September 17, 2025.</p></footer></article></body></html>