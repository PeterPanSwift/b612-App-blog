<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>利用 IBSegueAction 傳資料到下個頁面的 controller — iOS 13 新功能</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">利用 IBSegueAction 傳資料到下個頁面的 controller — iOS 13 新功能</h1>
</header>
<section data-field="subtitle" class="p-summary">
當我們在頁面之間切換時，時常需要將資料傳到下一頁的 controller，比方下圖的分手情歌列表，我們點選某首歌的 cell 後切換到下一頁顯示它的經典歌詞。
</section>
<section data-field="body" class="e-content">
<section name="dd95" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="9fd2" id="9fd2" class="graf graf--h3 graf--leading graf--title">利用 <strong class="markup--strong markup--h3-strong">IBSegueAction 傳資料到下個頁面的 controller — iOS 13 新功能</strong></h3><p name="3779" id="3779" class="graf graf--p graf-after--h3">當我們在頁面之間切換時，時常需要將資料傳到下一頁的 controller，比方下圖的分手情歌列表，我們點選某首歌的 cell 後切換到下一頁顯示它的經典歌詞。</p></div><div class="section-inner sectionLayout--outsetRow" data-paragraph-count="2"><figure name="a9ef" id="a9ef" class="graf graf--figure graf--layoutOutsetRow is-partialWidth graf-after--p" style="width: 50%;"><img class="graf-image" data-image-id="1*oETxoF-hWIH8oN57yjC94A.jpeg" data-width="808" data-height="1382" src="https://cdn-images-1.medium.com/max/600/1*oETxoF-hWIH8oN57yjC94A.jpeg"></figure><figure name="19d9" id="19d9" class="graf graf--figure graf--layoutOutsetRowContinue is-partialWidth graf-after--figure" style="width: 50%;"><img class="graf-image" data-image-id="1*JAGflRT7Zo2ZqExb1TDTiw.jpeg" data-width="808" data-height="1382" src="https://cdn-images-1.medium.com/max/600/1*JAGflRT7Zo2ZqExb1TDTiw.jpeg"></figure></div><div class="section-inner sectionLayout--insetColumn"><p name="bb24" id="bb24" class="graf graf--p graf-after--figure">從 iOS 13 開始，類似這樣的應用我們可以搭配 IBSegueAction 實現。當 segue 綁定 IBSegueAction 定義的 function 時，App 在透過 segue 切換頁面時會呼叫 IBSegueAction 定義的 function，我們可在 function 裡建立下個頁面的 controller 和傳資料給 controller。接下來就讓我們以剛剛的分手情歌 App 為例一步步說明吧。</p><h3 name="229c" id="229c" class="graf graf--h3 graf-after--p">從 storyboard 設計畫面</h3><p name="f4d3" id="f4d3" class="graf graf--p graf-after--h3">列表頁是 SongTableViewController，明細頁是 SongDetailViewController。</p><figure name="d9ea" id="d9ea" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*7Nf7dHiY7D7Eh9rTHMhjgQ.jpeg" data-width="1028" data-height="934" src="https://cdn-images-1.medium.com/max/800/1*7Nf7dHiY7D7Eh9rTHMhjgQ.jpeg"></figure><h3 name="95ea" id="95ea" class="graf graf--h3 graf-after--figure">在 SongDetailViewController 定義 init，設定前一頁傳來的資料</h3><pre name="500c" id="500c" class="graf graf--pre graf-after--h3">class SongDetailViewController: UIViewController {</pre><pre name="d3c3" id="d3c3" class="graf graf--pre graf-after--pre"> <strong class="markup--strong markup--pre-strong">  let song: Song</strong></pre><pre name="65c4" id="65c4" class="graf graf--pre graf-after--pre">  <strong class="markup--strong markup--pre-strong"> init?(coder: NSCoder, song: Song) {</strong></pre><pre name="91db" id="91db" class="graf graf--pre graf-after--pre"><strong class="markup--strong markup--pre-strong">      self.song = song</strong></pre><pre name="8f1e" id="8f1e" class="graf graf--pre graf-after--pre"><strong class="markup--strong markup--pre-strong">      super.init(coder: coder)</strong></pre><pre name="86a4" id="86a4" class="graf graf--pre graf-after--pre"><strong class="markup--strong markup--pre-strong">   }</strong></pre><pre name="f2f2" id="f2f2" class="graf graf--pre graf-after--pre">   required init?(coder: NSCoder) {</pre><pre name="1de3" id="1de3" class="graf graf--pre graf-after--pre">      fatalError()</pre><pre name="4e4a" id="4e4a" class="graf graf--pre graf-after--pre">   }</pre><p name="bf5d" id="bf5d" class="graf graf--p graf-after--pre">當我們透過綁定 IBSegueAction 的 segue 切換頁面時，我們可以自己從程式建立下一頁的 controller，因此傳資料的關鍵就在我們自訂下一頁 controller 的 init，在 init 裡包含我們想傳遞的資料當參數。</p><p name="d5bf" id="d5bf" class="graf graf--p graf-after--p">假設我們希望從列表頁傳到 detail 頁的資料型別是 Song，因此我們定義 <code class="markup--code markup--p-code">init?(coder: NSCoder, song: Song)</code>，參數 song 將接收前一頁傳來的資料。值得注意的，我們必須同時包含型別 NSCoder 的參數，並在 init 裡呼叫 <code class="markup--code markup--p-code">super.init(coder: coder)</code>，因為我們的 controller 是在 storyboard 設計，它的初始必須經過 init(coder:)。</p><p name="22da" id="22da" class="graf graf--p graf-after--p">ps: required init?(coder: NSCoder) 也要定義，詳細原因可參考以下連結。</p><div name="d982" id="d982" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E9%98%B2%E6%AD%A2%E7%B5%95%E6%8A%80%E5%A4%B1%E5%82%B3%E7%9A%84-required-initializer-d3ff78f72e45" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E9%98%B2%E6%AD%A2%E7%B5%95%E6%8A%80%E5%A4%B1%E5%82%B3%E7%9A%84-required-initializer-d3ff78f72e45" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E9%98%B2%E6%AD%A2%E7%B5%95%E6%8A%80%E5%A4%B1%E5%82%B3%E7%9A%84-required-initializer-d3ff78f72e45"><strong class="markup--strong markup--mixtapeEmbed-strong">防止絕技失傳的 required initializer</strong><br><em class="markup--em markup--mixtapeEmbed-em">定義 Swift 類別時，子類別預設並不會繼承父類別的 initializer，除非滿足某些特殊的條件。</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E9%98%B2%E6%AD%A2%E7%B5%95%E6%8A%80%E5%A4%B1%E5%82%B3%E7%9A%84-required-initializer-d3ff78f72e45" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="d8d1499728b4a7192aacc34d7dd35fe7" data-thumbnail-img-id="1*-M0nb20W0Qreak-FV3YHAA.jpeg" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*-M0nb20W0Qreak-FV3YHAA.jpeg);"></a></div><h3 name="7ab9" id="7ab9" class="graf graf--h3 graf-after--mixtapeEmbed">在列表頁 SongTableViewController 定義 @<strong class="markup--strong markup--h3-strong">IBSegueAction function</strong></h3><p name="9309" id="9309" class="graf graf--p graf-after--h3">當我們的 segue 是從 controller A 到 controller B，而我們想透過 IBSegueAction 傳資料時，必須在 controller A 裡定義 @IBSegueAction 開頭的 function。</p><p name="8323" id="8323" class="graf graf--p graf-after--p">此 function 我們不用自己寫，可以像拉 @IBAction 一樣，用拉線的方式讓 Xcode 幫我們產生。如下圖所示，我們從 segue 拉線產生 IBSegueAction function，輸入它的名字 showDetail。</p><figure name="9d01" id="9d01" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*GcpwbWTi6NBQ4TKVxKHp0g.jpeg" data-width="1254" data-height="686" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*GcpwbWTi6NBQ4TKVxKHp0g.jpeg"></figure><figure name="b5a3" id="b5a3" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*OqTkx1AuM5EhW16udNLe2Q.jpeg" data-width="560" data-height="338" src="https://cdn-images-1.medium.com/max/800/1*OqTkx1AuM5EhW16udNLe2Q.jpeg"></figure><p name="95f5" id="95f5" class="graf graf--p graf-after--figure">如下圖所示，產生的 function 將以 @IBSegueAction 開頭，回傳下一頁的 controller 型別。</p><figure name="e96c" id="e96c" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*I5XQz_sbTnOUVh_3PWanFg.jpeg" data-width="1436" data-height="284" src="https://cdn-images-1.medium.com/max/800/1*I5XQz_sbTnOUVh_3PWanFg.jpeg"></figure><p name="fcbe" id="fcbe" class="graf graf--p graf-after--figure">接著我們修改 showDetail，將資料傳給下一頁的 SongDetailViewController。</p><pre name="1a34" id="1a34" class="graf graf--pre graf-after--p">@IBSegueAction func showDetail(coder: NSCoder) -&gt; SongDetailViewController? {</pre><pre name="0d59" id="0d59" class="graf graf--pre graf-after--pre">   if let row = tableView.indexPathForSelectedRow?.row {</pre><pre name="efa0" id="efa0" class="graf graf--pre graf-after--pre">      let song = songs[row]</pre><pre name="d126" id="d126" class="graf graf--pre graf-after--pre">      <strong class="markup--strong markup--pre-strong">return SongDetailViewController(coder: coder, song: song)</strong></pre><pre name="8bb1" id="8bb1" class="graf graf--pre graf-after--pre">   } else {</pre><pre name="414c" id="414c" class="graf graf--pre graf-after--pre">      return nil</pre><pre name="abdd" id="abdd" class="graf graf--pre graf-after--pre">   }</pre><pre name="17c1" id="17c1" class="graf graf--pre graf-after--pre">}</pre><p name="83b8" id="83b8" class="graf graf--p graf-after--pre">傳資料的關鍵在以下這行程式。我們在建立下一頁的 SongDetailViewController 時傳入 song，這也說明了為何我們之前要在 SongDetailViewController 裡定義 init。</p><pre name="6c75" id="6c75" class="graf graf--pre graf-after--p">return SongDetailViewController(coder: coder, song: song)</pre><p name="a830" id="a830" class="graf graf--p graf-after--pre">此時我們也可從 segue 的 Attributes inspector 看到它果然確確實實連到了 function showDetail:。</p><figure name="5ccf" id="5ccf" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*Ch5thGaUmhYZdXrRJ2jkAg.jpeg" data-width="522" data-height="480" src="https://cdn-images-1.medium.com/max/800/1*Ch5thGaUmhYZdXrRJ2jkAg.jpeg"></figure><p name="6984" id="6984" class="graf graf--p graf-after--figure">完整範例連結</p><div name="51fa" id="51fa" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://github.com/AppPeterPan/IBSegueActionDemo2" data-href="https://github.com/AppPeterPan/IBSegueActionDemo2" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://github.com/AppPeterPan/IBSegueActionDemo2"><strong class="markup--strong markup--mixtapeEmbed-strong">AppPeterPan/IBSegueActionDemo2</strong><br><em class="markup--em markup--mixtapeEmbed-em">You can&#39;t perform that action at this time. You signed in with another tab or window. You signed out in another tab or…</em>github.com</a><a href="https://github.com/AppPeterPan/IBSegueActionDemo2" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="ecf87bba81034d4baba173b911caeb50" data-thumbnail-img-id="0*N-5eXSNvivPq0sHx" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*N-5eXSNvivPq0sHx);"></a></div><h3 name="a6f3" id="a6f3" class="graf graf--h3 graf-after--mixtapeEmbed">另一種做法</h3><p name="c91d" id="c91d" class="graf graf--p graf-after--h3">如果不想在 SongDetailViewController 定義 init，我們也可以先用預設的 init(coder:) 產生 controller，然後再將資料存入它的 property。不過這時 property song 的宣告要改成 <code class="markup--code markup--p-code">var song: Song!</code>，因為它一開始沒有內容，要等我們設定後才有值。</p><pre name="03c6" id="03c6" class="graf graf--pre graf-after--p">@IBSegueAction func showDetail(_ coder: NSCoder) -&gt; SongDetailViewController? {</pre><pre name="88e9" id="88e9" class="graf graf--pre graf-after--pre">   if let row = tableView.indexPathForSelectedRow?.row {</pre><pre name="c70a" id="c70a" class="graf graf--pre graf-after--pre">      let controller = SongDetailViewController(coder: coder)</pre><pre name="26c2" id="26c2" class="graf graf--pre graf-after--pre">   <strong class="markup--strong markup--pre-strong">   controller?.song = songs[row]</strong></pre><pre name="7134" id="7134" class="graf graf--pre graf-after--pre">      return controller</pre><pre name="20e6" id="20e6" class="graf graf--pre graf-after--pre">   } else {</pre><pre name="75bf" id="75bf" class="graf graf--pre graf-after--pre">      return nil</pre><pre name="5772" id="5772" class="graf graf--pre graf-after--pre">   }</pre><pre name="5bbb" id="5bbb" class="graf graf--pre graf-after--pre">}</pre><h3 name="34a8" id="34a8" class="graf graf--h3 graf-after--pre">有多個 segue 時，可用 sender &amp; segue id 區分</h3><p name="7b58" id="7b58" class="graf graf--p graf-after--h3">當有多個 segue 連到同一個 @IBSegueAction function 時，我們可用 sender &amp; segue id 區分。</p><p name="5c34" id="5c34" class="graf graf--p graf-after--p">剛剛在拉線產生 IBSegueAction 時，我們可調整 Arguments，改變它的參數，因此選擇最複雜的 Sender &amp; Identifier 時，將多出參數 sender &amp; segueIdentifier。</p><figure name="36a7" id="36a7" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*vtSHaEdYRjw2SZ_CTgE3ng.jpeg" data-width="566" data-height="348" src="https://cdn-images-1.medium.com/max/800/1*vtSHaEdYRjw2SZ_CTgE3ng.jpeg"></figure><figure name="a113" id="a113" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*gh-YEAAPj-PvqaKaAKG9Og.jpeg" data-width="1718" data-height="356" src="https://cdn-images-1.medium.com/max/800/1*gh-YEAAPj-PvqaKaAKG9Og.jpeg"></figure><p name="a7f3" id="a7f3" class="graf graf--p graf-after--figure">sender 是觸發 segue 的元件，segueIdentifier 是 segue 的 id。</p><h3 name="5f7f" id="5f7f" class="graf graf--h3 graf-after--p">利用 IBSegueAction 傳資料的步驟說明</h3><p name="d524" id="d524" class="graf graf--p graf-after--h3">假設 controller A 從 segue 切換到 controller B。</p><ul class="postList"><li name="0688" id="0688" class="graf graf--li graf-after--p">controller B 宣告儲存資料的 property。</li><li name="4f9c" id="4f9c" class="graf graf--li graf-after--li">controller B 裡定義 init，參數包含前一頁要傳入的資料，在 init 裡利用參數設定 property。</li><li name="75aa" id="75aa" class="graf graf--li graf-after--li">從 segue 連線，在 controller A 裡產生 IBSegueAction function，在 function 裡建立 controller B 時傳入要給它的資料。</li></ul><h3 name="2e2f" id="2e2f" class="graf graf--h3 graf-after--li">和舊做法 prepare 的比較</h3><p name="e2b2" id="e2b2" class="graf graf--p graf-after--h3">當我們用 segue 切換頁面時，也可以透過 function prepare 傳資料到下個 controller。</p><div name="0db2" id="0db2" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://developer.apple.com/documentation/uikit/uiviewcontroller/1621490-prepare" data-href="https://developer.apple.com/documentation/uikit/uiviewcontroller/1621490-prepare" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/uikit/uiviewcontroller/1621490-prepare"><strong class="markup--strong markup--mixtapeEmbed-strong">prepare(for:sender:) - UIViewController | Apple Developer Documentation</strong><br><em class="markup--em markup--mixtapeEmbed-em">The default implementation of this method does nothing. Subclasses override this method and use it to configure the new…</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/uikit/uiviewcontroller/1621490-prepare" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="7a50daeeea553c5861cfb8805b5e7782"></a></div><p name="4c7a" id="4c7a" class="graf graf--p graf-after--mixtapeEmbed graf--trailing">不過相較之下它卻有個缺點。以剛剛的分手情歌為例，detail 頁面 controller 的 song 應該一定有值，而且不會改變，所以我們希望能將它定義成 let song: Song 。然而若以 function prepare 傳資料，不透過 IBSegueAction，下一頁的 controller 將由系統自動生成，我們無法在它生成時設定 song 的內容，因此只能將它宣告成 optional 的變數，var song: Song?。</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@apppeterpan" class="p-author h-card">彼得潘的 iOS App Neverland</a> on <a href="https://medium.com/p/50813ba3822"><time class="dt-published" datetime="2019-07-19T08:35:42.829Z">July 19, 2019</time></a>.</p><p><a href="https://medium.com/@apppeterpan/%E5%88%A9%E7%94%A8-ibsegueaction-%E5%82%B3%E8%B3%87%E6%96%99%E5%88%B0%E4%B8%8B%E5%80%8B%E9%A0%81%E9%9D%A2%E7%9A%84-controller-ios-13-%E6%96%B0%E5%8A%9F%E8%83%BD-50813ba3822" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on November 16, 2025.</p></footer></article></body></html>