<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>利用 MKGeoJSONDecoder 解析 GeoJSON &amp; 製作口罩地圖 App</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">利用 MKGeoJSONDecoder 解析 GeoJSON &amp; 製作口罩地圖 App</h1>
</header>
<section data-field="subtitle" class="p-summary">
認識 GeoJSON
</section>
<section data-field="body" class="e-content">
<section name="b737" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="ee0c" id="ee0c" class="graf graf--h3 graf--leading graf--title">利用 MKGeoJSONDecoder 解析 GeoJSON &amp; 製作口罩地圖 App</h3><h3 name="ed57" id="ed57" class="graf graf--h3 graf-after--h3">認識 GeoJSON</h3><p name="0313" id="0313" class="graf graf--p graf-after--h3">GeoJSON 是一種描述地理資訊的格式，最近網路上愈來愈多描述位置的 API 以 GeoJSON 格式呈現。</p><p name="4e50" id="4e50" class="graf graf--p graf-after--p">比方以下是一個 GeoJSON 的例子，features 是儲存位置資訊的 array，array 裡的成員以 geometry 記錄經緯度，以 properties 儲存位置的相關資訊，因此以下例子記錄著台北101 &amp; 敦南誠品的相關資訊。</p><pre name="01e7" id="01e7" class="graf graf--pre graf-after--p">{<br>       &quot;type&quot;: &quot;FeatureCollection&quot;,<br>       &quot;<strong class="markup--strong markup--pre-strong">features</strong>&quot;: [{<br>           &quot;type&quot;: &quot;Feature&quot;,<br>           &quot;<strong class="markup--strong markup--pre-strong">geometry</strong>&quot;: {<br>               &quot;type&quot;: &quot;Point&quot;,<br>               &quot;coordinates&quot;: [121.5645, 25.0340]<br>           },<br>           &quot;<strong class="markup--strong markup--pre-strong">properties</strong>&quot;: {<br>               &quot;name&quot;: &quot;台北101&quot;,<br>               &quot;address&quot;: &quot;台北市信義區市府路45號&quot;,<br>               &quot;website&quot;: &quot;<a href="https://www.taipei-101.com.tw" data-href="https://www.taipei-101.com.tw" class="markup--anchor markup--pre-anchor" rel="nofollow noopener" target="_blank">https://www.taipei-101.com.tw</a>&quot;<br>           }<br>       }, {<br>           &quot;type&quot;: &quot;Feature&quot;,<br>           &quot;<strong class="markup--strong markup--pre-strong">geometry</strong>&quot;: {<br>               &quot;type&quot;: &quot;Point&quot;,<br>               &quot;coordinates&quot;: [121.5496, 25.0392]<br>           },<br>           &quot;<strong class="markup--strong markup--pre-strong">properties</strong>&quot;: {<br>               &quot;name&quot;: &quot;敦南誠品&quot;,<br>               &quot;address&quot;: &quot;台北市敦化南路一段245號&quot;,<br>               &quot;website&quot;: &quot;<a href="https://www.eslite.com" data-href="https://www.eslite.com" class="markup--anchor markup--pre-anchor" rel="nofollow noopener" target="_blank">https://www.eslite.com</a>&quot;<br>           }<br>       }]<br>}</pre><p name="f8b9" id="f8b9" class="graf graf--p graf-after--pre">關於更多 GeoJSON 的說明，有興趣的朋友可參考以下連結。</p><div name="55fd" id="55fd" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://geojson.org" data-href="https://geojson.org" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://geojson.org"><strong class="markup--strong markup--mixtapeEmbed-strong">GeoJSON</strong><br><em class="markup--em markup--mixtapeEmbed-em">GeoJSON is a format for encoding a variety of geographic data structures. GeoJSON supports the following geometry…</em>geojson.org</a><a href="https://geojson.org" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="67c2875824fc4271214463025d829611"></a></div><div name="5485" id="5485" class="graf graf--mixtapeEmbed graf-after--mixtapeEmbed"><a href="https://tools.ietf.org/html/rfc7946" data-href="https://tools.ietf.org/html/rfc7946" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://tools.ietf.org/html/rfc7946"><strong class="markup--strong markup--mixtapeEmbed-strong">RFC 7946 - The GeoJSON Format</strong><br><em class="markup--em markup--mixtapeEmbed-em">Internet Engineering Task Force (IETF) H. Butler Request for Comments: 7946 Hobu Inc. Category: Standards Track M. Daly…</em>tools.ietf.org</a><a href="https://tools.ietf.org/html/rfc7946" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="7a24604603987e930102902ad28fb1b8"></a></div><h3 name="044c" id="044c" class="graf graf--h3 graf-after--mixtapeEmbed">利用 MKGeoJSONDecoder 解析 GeoJSON</h3><p name="8ed9" id="8ed9" class="graf graf--p graf-after--h3">由於 GeoJSON 也是一種 JSON，所以我們可以用 JSONDecoder 解析它。不過 iOS 13 的 MapKit 推出了專門解析 GeoJSON 的 MKGeoJSONDecoder，因此接下來我們將示範如何利用 MKGeoJSONDecoder 解析 GeoJSON，將台北101 &amp; 敦南誠品顯示在 Apple Map。</p><div name="bde0" id="bde0" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://developer.apple.com/documentation/mapkit/mkgeojsondecoder" data-href="https://developer.apple.com/documentation/mapkit/mkgeojsondecoder" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/mapkit/mkgeojsondecoder"><strong class="markup--strong markup--mixtapeEmbed-strong">MKGeoJSONDecoder</strong><br><em class="markup--em markup--mixtapeEmbed-em">An object that decodes GeoJSON objects into MapKit types.</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/mapkit/mkgeojsondecoder" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="7db5a7319a3240351a5b44a1f58d69b9"></a></div><ul class="postList"><li name="e769" id="e769" class="graf graf--li graf-after--mixtapeEmbed"><strong class="markup--strong markup--li-strong">將 GeoJSON 的字串變成 Data。</strong></li></ul><pre name="0b12" id="0b12" class="graf graf--pre graf-after--li">let geoJsonData = &quot;&quot;&quot;<br>{<br>       &quot;type&quot;: &quot;FeatureCollection&quot;,<br>       &quot;features&quot;: [{<br>           &quot;type&quot;: &quot;Feature&quot;,<br>           &quot;geometry&quot;: {<br>               &quot;type&quot;: &quot;Point&quot;,<br>               &quot;coordinates&quot;: [121.5645, 25.0340]<br>           },<br>           &quot;properties&quot;: {<br>               &quot;name&quot;: &quot;台北101&quot;,<br>               &quot;address&quot;: &quot;台北市信義區市府路45號&quot;,<br>               &quot;website&quot;: &quot;<a href="https://www.taipei-101.com.tw" data-href="https://www.taipei-101.com.tw" class="markup--anchor markup--pre-anchor" rel="nofollow noopener" target="_blank">https://www.taipei-101.com.tw</a>&quot;<br>           }<br>       }, {<br>           &quot;type&quot;: &quot;Feature&quot;,<br>           &quot;geometry&quot;: {<br>               &quot;type&quot;: &quot;Point&quot;,<br>               &quot;coordinates&quot;: [121.5496, 25.0392]<br>           },<br>           &quot;properties&quot;: {<br>               &quot;name&quot;: &quot;敦南誠品&quot;,<br>               &quot;address&quot;: &quot;台北市敦化南路一段245號&quot;,<br>               &quot;website&quot;: &quot;<a href="https://www.eslite.com" data-href="https://www.eslite.com" class="markup--anchor markup--pre-anchor" rel="nofollow noopener" target="_blank">https://www.eslite.com</a>&quot;<br>           }<br>       }]<br>}<br>&quot;&quot;&quot;.data(using: .utf8)!</pre><ul class="postList"><li name="9d45" id="9d45" class="graf graf--li graf-after--pre"><strong class="markup--strong markup--li-strong">利用 MKGeoJSONDecoder 解析 GeoJSON</strong></li></ul><p name="1388" id="1388" class="graf graf--p graf-after--li">在使用 MKGeoJSONDecoder 前，記得要先 <code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">import MapKit</strong></code>。</p><pre name="a7d2" id="a7d2" class="graf graf--pre graf-after--p">if let features = try? MKGeoJSONDecoder().decode(geoJsonData) as? [MKGeoJSONFeature] {<br>    print(features[0].geometry[0].coordinate)</pre><pre name="911a" id="911a" class="graf graf--pre graf-after--pre">}</pre><p name="9392" id="9392" class="graf graf--p graf-after--pre">MKGeoJSONDecoder 的 decode function 宣告如下，它將回傳型別 [MKGeoJSONObject] 的 array。</p><pre name="7c67" id="7c67" class="graf graf--pre graf-after--p">func decode(_ data: Data) throws -&gt; [MKGeoJSONObject]</pre><div name="d5bb" id="d5bb" class="graf graf--mixtapeEmbed graf-after--pre"><a href="https://developer.apple.com/documentation/mapkit/mkgeojsondecoder/3113994-decode" data-href="https://developer.apple.com/documentation/mapkit/mkgeojsondecoder/3113994-decode" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/mapkit/mkgeojsondecoder/3113994-decode"><strong class="markup--strong markup--mixtapeEmbed-strong">decode(_:)</strong><br><em class="markup--em markup--mixtapeEmbed-em">Edit description</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/mapkit/mkgeojsondecoder/3113994-decode" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="4f94750e0e58f870a568f4cda8db7d1e"></a></div><p name="31bf" id="31bf" class="graf graf--p graf-after--mixtapeEmbed">MKGeoJSONObject 是 protocol，剛剛 decode 回傳的 array 成員型別其實是遵從 protocol MKGeoJSONObject 的 MKGeoJSONFeature，因此我們利用 as? 轉型為 [MKGeoJSONFeature]。</p><div name="754d" id="754d" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://developer.apple.com/documentation/mapkit/mkgeojsonfeature" data-href="https://developer.apple.com/documentation/mapkit/mkgeojsonfeature" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/mapkit/mkgeojsonfeature"><strong class="markup--strong markup--mixtapeEmbed-strong">MKGeoJSONFeature</strong><br><em class="markup--em markup--mixtapeEmbed-em">Declaration A feature is an object with associated geometry and optional properties in JSON that you define. MapKit…</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/mapkit/mkgeojsonfeature" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="6444c9f7bb79f804a50ccd63b933e5ae"></a></div><p name="9ca7" id="9ca7" class="graf graf--p graf-after--mixtapeEmbed">MKGeoJSONFeature 的 property geometry 對應 GeoJSON 的 geometry 欄位，由於它的型別 MKShape 遵從 protocol MKAnnotation，因此我們可用 <code class="markup--code markup--p-code">features[0].geometry[0].coordinate</code> 讀出它的經緯度。</p><pre name="eb59" id="eb59" class="graf graf--pre graf-after--p">var geometry: [MKShape &amp; MKGeoJSONObject] { get }</pre><div name="eb86" id="eb86" class="graf graf--mixtapeEmbed graf-after--pre"><a href="https://developer.apple.com/documentation/mapkit/mkgeojsonfeature/3113996-geometry" data-href="https://developer.apple.com/documentation/mapkit/mkgeojsonfeature/3113996-geometry" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/mapkit/mkgeojsonfeature/3113996-geometry"><strong class="markup--strong markup--mixtapeEmbed-strong">geometry</strong><br><em class="markup--em markup--mixtapeEmbed-em">Edit description</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/mapkit/mkgeojsonfeature/3113996-geometry" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="eb8779f9e1311f5c03980bbe4e64e552"></a></div><p name="6a55" id="6a55" class="graf graf--p graf-after--mixtapeEmbed">MKGeoJSONFeature 的 property properties 對應 GeoJSON 的 properties 欄位，然而它的型別是 Data，因此我們要再利用 JSONDecoder 解析它的內容。</p><pre name="1a87" id="1a87" class="graf graf--pre graf-after--p">var properties: Data? { get }</pre><div name="a995" id="a995" class="graf graf--mixtapeEmbed graf-after--pre"><a href="https://developer.apple.com/documentation/mapkit/mkgeojsonfeature/3113998-properties" data-href="https://developer.apple.com/documentation/mapkit/mkgeojsonfeature/3113998-properties" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/mapkit/mkgeojsonfeature/3113998-properties"><strong class="markup--strong markup--mixtapeEmbed-strong">properties</strong><br><em class="markup--em markup--mixtapeEmbed-em">Edit description</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/mapkit/mkgeojsonfeature/3113998-properties" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="d3e5aad10fd2df9bd9c4d0551a4a4b32"></a></div><p name="8cb9" id="8cb9" class="graf graf--p graf-after--mixtapeEmbed">定義 properties 內容對應的 Decodable 型別 Store。</p><pre name="c56b" id="c56b" class="graf graf--pre graf-after--p">struct Store: Decodable {<br>    let name: String<br>    let address: String<br>    let website: URL</pre><pre name="5489" id="5489" class="graf graf--pre graf-after--pre">}</pre><p name="9b88" id="9b88" class="graf graf--p graf-after--pre">利用 JSONDecoder 將 Data 型別的 properties 轉換成 Store。</p><pre name="86a1" id="86a1" class="graf graf--pre graf-after--p">if let features = try? MKGeoJSONDecoder().decode(geoJsonData) as? [MKGeoJSONFeature] {<br>    for feature in features {<br>       <strong class="markup--strong markup--pre-strong"> if let data = feature.properties, let store = try? JSONDecoder().decode(Store.self, from: data) </strong>{<br>            print(store, feature.geometry[0].coordinate)<br>        }<br>    }<br>}</pre><p name="ab15" id="ab15" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">結果</strong></p><figure name="acfe" id="acfe" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*CEkcJwhP_RP33DFE9kKTBw.jpeg" data-width="2368" data-height="318" src="https://cdn-images-1.medium.com/max/800/1*CEkcJwhP_RP33DFE9kKTBw.jpeg"></figure><ul class="postList"><li name="01c2" id="01c2" class="graf graf--li graf-after--figure"><strong class="markup--strong markup--li-strong">將 MKGeoJSONDecoder 解析 GeoJSON 的結果呈現在 Apple Map</strong></li></ul><p name="2c5c" id="2c5c" class="graf graf--p graf-after--li">為了將資料變成顯示在地圖上的標記，我們定義遵從 protocol MKAnnotation 的 StoreAnnotation，利用 MKGeoJSONFeature &amp; JSONDecoder 設定它的 coordinate，title &amp; subtitle。</p><pre name="66ed" id="66ed" class="graf graf--pre graf-after--p">class StoreAnnotation: NSObject, MKAnnotation {<br>    var coordinate: CLLocationCoordinate2D<br>    var title: String? {<br>        store?.name<br>    }<br>    var subtitle: String? {<br>        store?.address<br>    }<br>    var store: Store?<br>    <br>    init(feature: MKGeoJSONFeature) {<br>        coordinate = feature.geometry[0].coordinate<br>        if let data = feature.properties, let store = try? JSONDecoder().decode(Store.self, from: data) {<br>            self.store = store<br>        }<br>    }<br>}</pre><p name="7169" id="7169" class="graf graf--p graf-after--pre">將 [MKGeoJSONFeature] 轉換成 [StoreAnnotation]，然後利用 addAnnotations 加到地圖上，最後再呼叫 showAnnotations 讓地圖自動縮放到顯示所有標記的範圍。</p><pre name="a10c" id="a10c" class="graf graf--pre graf-after--p">class ViewController: UIViewController {</pre><pre name="46bb" id="46bb" class="graf graf--pre graf-after--pre">    @IBOutlet weak var mapView: MKMapView!</pre><pre name="9d95" id="9d95" class="graf graf--pre graf-after--pre">    override func viewDidLoad() {<br>        super.viewDidLoad()<br>        // Do any additional setup after loading the view.<br>        <br>        if let features = try? MKGeoJSONDecoder().decode(geoJsonData) as? [MKGeoJSONFeature] {<br>           <strong class="markup--strong markup--pre-strong"> let storeAnnotations = features.map {<br>                StoreAnnotation(feature: $0)<br>            }<br>            mapView.addAnnotations(storeAnnotations)<br>            mapView.showAnnotations(storeAnnotations, animated: true)<br>            </strong><br>        }</pre><pre name="a2a1" id="a2a1" class="graf graf--pre graf-after--pre">    }</pre><pre name="5ff5" id="5ff5" class="graf graf--pre graf-after--pre">}</pre><p name="a8f4" id="a8f4" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">結果</strong></p><figure name="2626" id="2626" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*A2jPcvkq4kmB_9IG8aglew.jpeg" data-width="808" data-height="1474" src="https://cdn-images-1.medium.com/max/800/1*A2jPcvkq4kmB_9IG8aglew.jpeg"></figure><p name="fc8d" id="fc8d" class="graf graf--p graf-after--figure">對 MKGeoJSONDecoder 有興趣的朋友，也可參考以下 Apple 室內地圖的範例。</p><div name="9cc0" id="9cc0" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://developer.apple.com/documentation/mapkit/displaying_an_indoor_map" data-href="https://developer.apple.com/documentation/mapkit/displaying_an_indoor_map" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/mapkit/displaying_an_indoor_map"><strong class="markup--strong markup--mixtapeEmbed-strong">Displaying an Indoor Map</strong><br><em class="markup--em markup--mixtapeEmbed-em">The sample app demonstrates decoding, rendering, and styling of a small subset of the IMDF feature types and their…</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/mapkit/displaying_an_indoor_map" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="27e34835799a2a2559875b045d02c755"></a></div><h3 name="4db2" id="4db2" class="graf graf--h3 graf-after--mixtapeEmbed">利用 MKGeoJSONDecoder 解析口罩 API</h3><p name="65c9" id="65c9" class="graf graf--p graf-after--h3">學會使用 MKGeoJSONDecoder 後，接下來讓我們試試利用它解析 kiang 提供的藥局+衛生所即時口罩庫存 API 的 GeoJSON 資料。</p><p name="64fa" id="64fa" class="graf graf--p graf-after--p">API 網址如下</p><pre name="d4b4" id="d4b4" class="graf graf--pre graf-after--p"><a href="https://raw.githubusercontent.com/kiang/pharmacies/master/json/points.json" data-href="https://raw.githubusercontent.com/kiang/pharmacies/master/json/points.json" class="markup--anchor markup--pre-anchor" rel="noopener nofollow noopener" target="_blank">https://raw.githubusercontent.com/kiang/pharmacies/master/json/points.json</a></pre><p name="b2dc" id="b2dc" class="graf graf--p graf-after--pre">關於即時口罩庫存 API 的 JSON 內容，可先參考以下連結的說明。</p><div name="a1e9" id="a1e9" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E7%94%A8-jsondecoder-%E8%A7%A3%E6%9E%90%E5%8F%A3%E7%BD%A9%E5%89%A9%E9%A4%98%E6%95%B8%E9%87%8F-api-a32e967ec9c1" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E7%94%A8-jsondecoder-%E8%A7%A3%E6%9E%90%E5%8F%A3%E7%BD%A9%E5%89%A9%E9%A4%98%E6%95%B8%E9%87%8F-api-a32e967ec9c1" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E7%94%A8-jsondecoder-%E8%A7%A3%E6%9E%90%E5%8F%A3%E7%BD%A9%E5%89%A9%E9%A4%98%E6%95%B8%E9%87%8F-api-a32e967ec9c1"><strong class="markup--strong markup--mixtapeEmbed-strong">利用 JSONDecoder 解析口罩剩餘數量 API</strong><br><em class="markup--em markup--mixtapeEmbed-em">感謝大大們開發了口罩剩餘數量的 API，讓我們可以開發查詢口罩數量的網頁和 App，接下來就讓我們試試串接政府資料開放平臺 API &amp; kiang 大大提供的藥局+衛生所即時庫存，利用 JSONDecoder解析 API 回傳的 JSON…</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E7%94%A8-jsondecoder-%E8%A7%A3%E6%9E%90%E5%8F%A3%E7%BD%A9%E5%89%A9%E9%A4%98%E6%95%B8%E9%87%8F-api-a32e967ec9c1" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="6e0ccd1c0363dc610ba2e08a9e79812b" data-thumbnail-img-id="1*Z1Nas-KL94e7r9HjtZnmgA.jpeg" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*Z1Nas-KL94e7r9HjtZnmgA.jpeg);"></a></div><ul class="postList"><li name="7414" id="7414" class="graf graf--li graf-after--mixtapeEmbed"><strong class="markup--strong markup--li-strong">定義 properties 內容對應的 Decodable 型別 Mask</strong></li></ul><figure name="1277" id="1277" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*9M5lRmNriB8xduQGJ2-1XQ.jpeg" data-width="1036" data-height="680" src="https://cdn-images-1.medium.com/max/800/1*9M5lRmNriB8xduQGJ2-1XQ.jpeg"></figure><pre name="d280" id="d280" class="graf graf--pre graf-after--figure">struct Mask: Decodable {<br>    let name: String<br>    let phone: String<br>    let address: String<br>    let maskAdult: Int<br>    let maskChild: Int<br>    let updated: Date<br>    let available: String<br>    let note: String<br>    let customNote: String<br>    let website: String<br>    let county: String<br>    let town: String<br>    let cunli: String<br>    let servicePeriods: String<br>}</pre><p name="25e1" id="25e1" class="graf graf--p graf-after--pre">JSON 裡像 mask_adult &amp; mask_child 之類帶底線的名字被改成 Swift 習慣的 maskAdult &amp; maskChild，待會我們將透過將 JSONDecoder 的 keyDecodingStrategy 設為 <code class="markup--code markup--p-code">.convertFromSnakeCase</code> 做轉換。</p><pre name="6777" id="6777" class="graf graf--pre graf-after--p">decoder.keyDecodingStrategy = .convertFromSnakeCase</pre><ul class="postList"><li name="459c" id="459c" class="graf graf--li graf-after--pre"><strong class="markup--strong markup--li-strong">定義代表口罩資訊的地圖標記型別 MaskAnnotation</strong></li></ul><p name="be63" id="be63" class="graf graf--p graf-after--li">利用 MKGeoJSONFeature &amp; JSONDecoder 設定它的 coordinate，title &amp; subtitle。其中比較特別的是我們使用 enum DateDecodingStrategy 的 case custom((Decoder) throws -&gt; Date) 將時間字串轉換成 Date 型別。</p><pre name="6ced" id="6ced" class="graf graf--pre graf-after--p">class MaskAnnotation : NSObject, MKAnnotation {<br>    <br>    var coordinate: CLLocationCoordinate2D<br>    var title: String? {<br>        mask?.name<br>    }<br>    var subtitle: String? {<br>        &quot;成人:\(mask?.maskAdult ?? 0) 兒童:\(mask?.maskChild ?? 0)&quot;<br>    }<br>    var mask: Mask?<br>        <br>    init(feature: MKGeoJSONFeature) {<br>        <br>        coordinate = feature.geometry[0].coordinate<br>        if let data = feature.properties {<br>            let decoder = JSONDecoder()<br>            decoder.keyDecodingStrategy = .convertFromSnakeCase<br>           <strong class="markup--strong markup--pre-strong"> decoder.dateDecodingStrategy = .custom({ (decoder) -&gt; Date in<br>                let timeString = try decoder.singleValueContainer().decode(String.self)<br>                return DateFormatter.customFormatter.date(from: timeString) ?? Date()<br>            })</strong><br>            mask = try? decoder.decode(Mask.self, from: data)<br>        }<br>    }<br>    <br>}</pre><pre name="ae63" id="ae63" class="graf graf--pre graf-after--pre">extension DateFormatter {<br>    static let customFormatter: DateFormatter = {<br>        let formatter = DateFormatter()<br>        formatter.dateFormat = &quot;yyyy/MM/dd HH:mm:ss&quot;<br>        return formatter<br>    }()<br>}</pre><ul class="postList"><li name="ec21" id="ec21" class="graf graf--li graf-after--pre"><strong class="markup--strong markup--li-strong">將 MKGeoJSONDecoder 解析的口罩庫存呈現在 Apple Map</strong></li></ul><pre name="156f" id="156f" class="graf graf--pre graf-after--li">class ViewController: UIViewController {<br>    <br>    <a href="http://twitter.com/IBOutlet" data-href="http://twitter.com/IBOutlet" class="markup--anchor markup--pre-anchor" title="Twitter profile for @IBOutlet" rel="noopener" target="_blank">@IBOutlet</a> weak var mapView: MKMapView!<br>    <br>    override func viewDidLoad() {<br>        super.viewDidLoad()<br>        <br>        <br>        guard let url = URL(string: &quot;<a href="https://raw.githubusercontent.com/kiang/pharmacies/master/json/points.json" data-href="https://raw.githubusercontent.com/kiang/pharmacies/master/json/points.json" class="markup--anchor markup--pre-anchor" rel="nofollow noopener" target="_blank">https://raw.githubusercontent.com/kiang/pharmacies/master/json/points.json</a>&quot;) else {<br>            return<br>        }<br>        <br>        URLSession.shared.dataTask(with: url) { (data, response, error) in<br>            guard let data = data else { return }<br>            <br>            let decoder = MKGeoJSONDecoder()<br>            if let features = try? decoder.decode(data) as? [MKGeoJSONFeature] {<br>                <br>                let maskAnnotations = features.map {<br>                    MaskAnnotation(feature: $0)<br>                }<br>                <br>                DispatchQueue.main.async {<br>                    self.mapView.addAnnotations(maskAnnotations)<br>                    self.mapView.showAnnotations(maskAnnotations, animated: true)<br>                }<br>                <br>            }<br>            <br>            <br>        }.resume()<br>    }<br>}</pre><p name="4adf" id="4adf" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">結果</strong></p><p name="be15" id="be15" class="graf graf--p graf-after--p">點擊標記時將顯示 annotation 的 subtitle，看到我們<a href="https://baike.baidu.com/item/%E6%9C%9D%E6%80%9D%E6%9A%AE%E6%83%B3" data-href="https://baike.baidu.com/item/%E6%9C%9D%E6%80%9D%E6%9A%AE%E6%83%B3" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">朝思暮想</a>的口罩數量。</p><figure name="c352" id="c352" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*C17AZMc4_AQpBFEVbzajwA.png" data-width="1125" data-height="2436" src="https://cdn-images-1.medium.com/max/800/1*C17AZMc4_AQpBFEVbzajwA.png"></figure><h3 name="32d1" id="32d1" class="graf graf--h3 graf-after--figure">設定標記顏色</h3><p name="10c6" id="10c6" class="graf graf--p graf-after--h3">為了區分哪裡還能買到口罩，我們想要控制標記的顏色。因此我們將 controller 設為 mapView 的 delegate，定義控制 annotation view 模樣的相關 function。</p><p name="c5f0" id="c5f0" class="graf graf--p graf-after--p">另外地圖標記生成的原理跟表格 cell 類似，都運用了重覆利用的技巧節省記憶體，因此我們必須先呼叫 function <code class="markup--code markup--p-code">register(_:forAnnotationViewWithReuseIdentifier:)</code>，傳入生成的 annotation view 型別和 reuse id。在此我們傳入內建的 MKMarkerAnnotationView(可愛氣球模樣的標記)。</p><pre name="a1a3" id="a1a3" class="graf graf--pre graf-after--p">class ViewController: UIViewController {<br>    <br>    <a href="http://twitter.com/IBOutlet" data-href="http://twitter.com/IBOutlet" class="markup--anchor markup--pre-anchor" title="Twitter profile for @IBOutlet" rel="noopener" target="_blank">@IBOutlet</a> weak var mapView: MKMapView!<br>    <br>    override func viewDidLoad() {<br>        super.viewDidLoad()<br>        <br>      <strong class="markup--strong markup--pre-strong">  mapView.delegate = self<br>        mapView.register(MKMarkerAnnotationView.self, forAnnotationViewWithReuseIdentifier: &quot;\(MaskAnnotation.self)&quot;)</strong></pre><p name="1d93" id="1d93" class="graf graf--p graf-after--pre">標記顯示時將呼叫 MKMapViewDelegate 的 function mapView(_:viewFor:)，我們在裡面生成 annotation view，設定它的 markerTintColor 控制顏色。當 annotation 的 maskAdult 等於 0 時標記為紅色，大於 0 時標記為綠色。</p><pre name="0323" id="0323" class="graf graf--pre graf-after--p">extension ViewController: MKMapViewDelegate {<br>    func mapView(_ mapView: MKMapView, viewFor annotation: MKAnnotation) -&gt; MKAnnotationView? {<br>        guard let annotation = annotation as? MaskAnnotation else {<br>            return nil<br>        }<br>        let annotationView = mapView.dequeueReusableAnnotationView(withIdentifier: &quot;\(MaskAnnotation.self)&quot;, for: annotation) as? MKMarkerAnnotationView<br>       <strong class="markup--strong markup--pre-strong"> if let count = annotation.mask?.maskAdult, count == 0 {<br>            annotationView?.markerTintColor = .red<br>        } else {<br>            annotationView?.markerTintColor = .green<br>        }<br>        </strong><br>        return annotationView<br>    }<br>}</pre><p name="27a8" id="27a8" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">結果</strong></p><figure name="b666" id="b666" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*OvvsJiFSayjP4fyPVLkLuQ.jpeg" data-width="808" data-height="1474" src="https://cdn-images-1.medium.com/max/800/1*OvvsJiFSayjP4fyPVLkLuQ.jpeg"></figure><h3 name="a2d6" id="a2d6" class="graf graf--h3 graf-after--figure">客製口<strong class="markup--strong markup--h3-strong">罩標記圖片</strong></h3><p name="e6b0" id="e6b0" class="graf graf--p graf-after--h3">我們也可以客製標記的圖片，比方還有口罩時顯示戴著口罩的圖片，沒有口罩時顯示獨角獸的照片。(ps: 彼得潘找不到合適的圖片，只好先用可愛的獨角獸安慰買不到口罩的心情)。</p><figure name="f2ba" id="f2ba" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*zDXA6-XkU2isiZ-tLtRHLw.jpeg" data-width="666" data-height="746" src="https://cdn-images-1.medium.com/max/800/1*zDXA6-XkU2isiZ-tLtRHLw.jpeg"></figure><p name="b2cc" id="b2cc" class="graf graf--p graf-after--figure">採用客製圖片時，register 的 annotation view 型別記得要改用 MKAnnotationView。</p><pre name="5669" id="5669" class="graf graf--pre graf-after--p">mapView.register(<strong class="markup--strong markup--pre-strong">MKAnnotationView.self</strong>, forAnnotationViewWithReuseIdentifier: &quot;\(MaskAnnotation.self)&quot;)</pre><p name="06fd" id="06fd" class="graf graf--p graf-after--pre">然後在 function mapView(_:viewFor:) 裡依據口罩數量設定不同的圖片。</p><pre name="95e2" id="95e2" class="graf graf--pre graf-after--p">extension ViewController: MKMapViewDelegate {<br>    func mapView(_ mapView: MKMapView, viewFor annotation: MKAnnotation) -&gt; MKAnnotationView? {<br>        guard let annotation = annotation as? MaskAnnotation else {<br>            return nil<br>        }<br>        let annotationView = mapView.dequeueReusableAnnotationView(withIdentifier: &quot;\(MaskAnnotation.self)&quot;, for: annotation) <br>        <strong class="markup--strong markup--pre-strong">if let count = annotation.mask?.maskAdult, count == 0 {<br>            annotationView.image = UIImage(named: &quot;maskEmpty&quot;)<br>        } else {<br>            annotationView.image = UIImage(named: &quot;mask&quot;)<br>        }</strong><br>        <br>        return annotationView<br>    }<br>}</pre><p name="1b53" id="1b53" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">結果</strong></p></div><div class="section-inner sectionLayout--outsetRow" data-paragraph-count="2"><figure name="fbfe" id="fbfe" class="graf graf--figure graf--layoutOutsetRow is-partialWidth graf-after--p" style="width: 50%;"><img class="graf-image" data-image-id="1*-jSs26gHdKOV09CBfiM95g.jpeg" data-width="808" data-height="1474" src="https://cdn-images-1.medium.com/max/600/1*-jSs26gHdKOV09CBfiM95g.jpeg"></figure><figure name="9854" id="9854" class="graf graf--figure graf--layoutOutsetRowContinue is-partialWidth graf-after--figure" style="width: 50%;"><img class="graf-image" data-image-id="1*vifEOJQ0l4k3azubKGa3Eg.jpeg" data-width="808" data-height="1474" src="https://cdn-images-1.medium.com/max/600/1*vifEOJQ0l4k3azubKGa3Eg.jpeg"></figure></div><div class="section-inner sectionLayout--insetColumn"><h3 name="66c4" id="66c4" class="graf graf--h3 graf-after--figure">點選標記顯示詳細資訊</h3><p name="bac2" id="bac2" class="graf graf--p graf-after--h3">顯示可愛口罩圖片的標記挺好的，但是它有個很大的缺點，我們看不到口罩的相關資訊。</p><p name="e09c" id="e09c" class="graf graf--p graf-after--p">為了解決這個問題，我們可在產生 annotation view 時將它的 <code class="markup--code markup--p-code">canShowCallout</code> 設為 true，如此即可在點選標記時顯示 callout，在 callout 上顯示 annotation 的 title &amp; subtitle。</p><pre name="db93" id="db93" class="graf graf--pre graf-after--p">extension ViewController: MKMapViewDelegate {<br>    func mapView(_ mapView: MKMapView, viewFor annotation: MKAnnotation) -&gt; MKAnnotationView? {<br>        guard let annotation = annotation as? MaskAnnotation else {<br>            return nil<br>        }<br>        let annotationView = mapView.dequeueReusableAnnotationView(withIdentifier: &quot;\(MaskAnnotation.self)&quot;, for: annotation)<br>       <strong class="markup--strong markup--pre-strong"> annotationView.canShowCallout = true</strong><br>        if let count = annotation.mask?.maskAdult, count == 0 {<br>            annotationView.image = UIImage(named: &quot;maskEmpty&quot;)<br>        } else {<br>            annotationView.image = UIImage(named: &quot;mask&quot;)<br>        }<br>        <br>        return annotationView<br>    }<br>}</pre><p name="97d5" id="97d5" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">結果</strong></p><figure name="9a00" id="9a00" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*8StW9rWodNIs4DfqlFSRnA.jpeg" data-width="808" data-height="1474" src="https://cdn-images-1.medium.com/max/800/1*8StW9rWodNIs4DfqlFSRnA.jpeg"></figure><h3 name="a59e" id="a59e" class="graf graf--h3 graf-after--figure">偵測標記的點選</h3><p name="9ee2" id="9ee2" class="graf graf--p graf-after--h3">如果希望點選標記時做額外的事情，也可以定義 MKMapViewDelegate 的 function mapView(_:didSelect:)，它將在標記點選時觸發。</p><pre name="0367" id="0367" class="graf graf--pre graf-after--p">func mapView(_ mapView: MKMapView, didSelect view: MKAnnotationView) {</pre><pre name="a7b2" id="a7b2" class="graf graf--pre graf-after--pre">    print(&quot;select&quot;, view.annotation)       <br>}</pre><p name="8b7a" id="8b7a" class="graf graf--p graf-after--pre">比方 App 口罩天空在標記點選時從下方浮現灰色區塊顯示藥局資訊。</p></div><div class="section-inner sectionLayout--outsetRow" data-paragraph-count="2"><figure name="98ed" id="98ed" class="graf graf--figure graf--layoutOutsetRow is-partialWidth graf-after--p" style="width: 50%;"><img class="graf-image" data-image-id="1*AzKlOpaTFEWMQly_atSfeg.png" data-width="1125" data-height="2436" src="https://cdn-images-1.medium.com/max/600/1*AzKlOpaTFEWMQly_atSfeg.png"></figure><figure name="d775" id="d775" class="graf graf--figure graf--layoutOutsetRowContinue is-partialWidth graf-after--figure" style="width: 50%;"><img class="graf-image" data-image-id="1*o9LRtR9yYMNVuOMqpEuKCg.png" data-width="1125" data-height="2436" src="https://cdn-images-1.medium.com/max/600/1*o9LRtR9yYMNVuOMqpEuKCg.png"></figure></div><div class="section-inner sectionLayout--insetColumn"><h3 name="91f0" id="91f0" class="graf graf--h3 graf-after--figure">callout 的點選</h3><p name="82eb" id="82eb" class="graf graf--p graf-after--h3">剛剛的 callout 只能顯示 annotation 的 title &amp; subtitle，如果我們還有更多資訊想顯示，或是想做其它動作，比方打電話到藥局呢 ?</p><p name="d62c" id="d62c" class="graf graf--p graf-after--p">此時我們可利用 annotation view 的 rightCalloutAccessoryView 在它的右邊顯示額外的元件，比方以下例子的 infoButton。(ps: 也可以利用 leftCalloutAccessoryView 在左邊顯示額外的元件。)</p><pre name="13d0" id="13d0" class="graf graf--pre graf-after--p">func mapView(_ mapView: MKMapView, viewFor annotation: MKAnnotation) -&gt; MKAnnotationView? {<br>        guard let annotation = annotation as? MaskAnnotation else {<br>            return nil<br>        }<br>        let annotationView = mapView.dequeueReusableAnnotationView(withIdentifier: &quot;\(MaskAnnotation.self)&quot;, for: annotation)<br>        annotationView.canShowCallout = true<br>       <strong class="markup--strong markup--pre-strong"> let infoButton = UIButton(type: .detailDisclosure)<br>        annotationView.rightCalloutAccessoryView = infoButton</strong><br>        if let count = annotation.mask?.maskAdult, count == 0 {<br>            annotationView.image = UIImage(named: &quot;maskEmpty&quot;)<br>        } else {<br>            annotationView.image = UIImage(named: &quot;mask&quot;)<br>        }<br>        <br>        return annotationView<br>}</pre><p name="271a" id="271a" class="graf graf--p graf-after--pre">接著我們定義 MKMapViewDelegate 的 function mapView(_:annotationView:calloutAccessoryControlTapped:)。此 function 將在 callout accessory view 被點選時觸發，因此以下例子我們將在點選時切換到 DetailViewController，顯示藥局的詳細資訊。</p><pre name="ff76" id="ff76" class="graf graf--pre graf-after--p">func mapView(_ mapView: MKMapView, annotationView view: MKAnnotationView, calloutAccessoryControlTapped control: UIControl) {<br>        let annotation = view.annotation as? MaskAnnotation<br>        if let controller = storyboard?.instantiateViewController(identifier: &quot;DetailViewController&quot;) as? DetailViewController {<br>            controller.mask = annotation?.mask<br>            show(controller, sender: nil)<br>        }<br>        <br>}</pre><p name="a6f7" id="a6f7" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">結果</strong></p><figure name="1f4a" id="1f4a" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*LWSEHOVFHnJ1nO_GWnt0TA.jpeg" data-width="808" data-height="1474" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*LWSEHOVFHnJ1nO_GWnt0TA.jpeg"></figure><p name="d631" id="d631" class="graf graf--p graf-after--figure">關於地圖標記的顯示，其實還有很多有趣的變化，比方設定 annotationView 的 detailCalloutAccessoryView，或是繼承 MKAnnotationView，完全客製 annotation view 的模樣。有興趣的朋友可參考以下 Apple 官方的範例。</p><div name="8603" id="8603" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://developer.apple.com/documentation/mapkit/mapkit_annotations/annotating_a_map_with_custom_data" data-href="https://developer.apple.com/documentation/mapkit/mapkit_annotations/annotating_a_map_with_custom_data" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/mapkit/mapkit_annotations/annotating_a_map_with_custom_data"><strong class="markup--strong markup--mixtapeEmbed-strong">Annotating a Map with Custom Data</strong><br><em class="markup--em markup--mixtapeEmbed-em">This sample code project demonstrates how to display a map with custom annotations, each with a customized callout…</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/mapkit/mapkit_annotations/annotating_a_map_with_custom_data" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="b277908f4c6b787ed59fb8ec75546aca"></a></div><h3 name="5f26" id="5f26" class="graf graf--h3 graf-after--mixtapeEmbed">顯示附近的口罩</h3><p name="261e" id="261e" class="graf graf--p graf-after--h3">大部分的時候，我們只在乎離我們最近的口罩。因此我們可以勾選 Map View 的 User Location，讓它偵測使用者的位置。</p><figure name="9112" id="9112" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*CCuJWE_Aj26V9cpTEMSR6Q.jpeg" data-width="532" data-height="394" src="https://cdn-images-1.medium.com/max/800/1*CCuJWE_Aj26V9cpTEMSR6Q.jpeg"></figure><p name="ec43" id="ec43" class="graf graf--p graf-after--figure">為了偵測使用者的位置，我們得先徵求使用者的同意，因此請在 App 的 Info 頁面加入 <code class="markup--code markup--p-code">Privacy — Location When In Use Usage Description</code> 設定請求權限的文字。</p></div><div class="section-inner sectionLayout--outsetColumn"><figure name="8667" id="8667" class="graf graf--figure graf--layoutOutsetCenter graf-after--p"><img class="graf-image" data-image-id="1*GjlL-P6kxWVG7D51xArj2w.jpeg" data-width="1946" data-height="476" src="https://cdn-images-1.medium.com/max/1200/1*GjlL-P6kxWVG7D51xArj2w.jpeg"></figure></div><div class="section-inner sectionLayout--insetColumn"><p name="2982" id="2982" class="graf graf--p graf-after--figure">然後在程式裡 import CoreLocation，生成 CLLocationManager 物件呼叫 requestWhenInUseAuthorization 請求權限。</p><pre name="3dcc" id="3dcc" class="graf graf--pre graf-after--p">import UIKit<br>import MapKit<br><strong class="markup--strong markup--pre-strong">import CoreLocation</strong></pre><pre name="781d" id="781d" class="graf graf--pre graf-after--pre">class ViewController: UIViewController {<br>    <br>  <strong class="markup--strong markup--pre-strong">  let locationManager = CLLocationManager()</strong><br>    <br>    <a href="http://twitter.com/IBOutlet" data-href="http://twitter.com/IBOutlet" class="markup--anchor markup--pre-anchor" title="Twitter profile for @IBOutlet" rel="noopener" target="_blank">@IBOutlet</a> weak var mapView: MKMapView!<br>    <br>    override func viewDidLoad() {<br>        super.viewDidLoad()<br>       <strong class="markup--strong markup--pre-strong"> locationManager.requestWhenInUseAuthorization()</strong></pre><p name="3cb3" id="3cb3" class="graf graf--p graf-after--pre">然後我們再定義 MKMapViewDelegate 的 mapView(_:didUpdate:)，此 function 將在地圖取得使用者位置時觸發，因此我們可更新地圖的範圍，以使用者的位置 userLocation 當地圖的中心點，顯示附近 1000 公尺的藥局。</p><pre name="559c" id="559c" class="graf graf--pre graf-after--p">func mapView(_ mapView: MKMapView, didUpdate userLocation: MKUserLocation) {<br>        let region = MKCoordinateRegion(center: userLocation.coordinate, latitudinalMeters: 1000, longitudinalMeters: 1000)<br>        mapView.setRegion(region, animated: true)<br>}</pre><p name="8d87" id="8d87" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">結果</strong></p><figure name="afdb" id="afdb" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*m4VhAE6voME5IBvIZj62Jw.jpeg" data-width="808" data-height="1478" src="https://cdn-images-1.medium.com/max/800/1*m4VhAE6voME5IBvIZj62Jw.jpeg"></figure><h3 name="e914" id="e914" class="graf graf--h3 graf-after--figure"><strong class="markup--strong markup--h3-strong">One more thing，annotation clustering</strong></h3><p name="9f64" id="9f64" class="graf graf--p graf-after--h3">覺得地圖上標記太多太亂嗎 ? 有興趣的朋友可參考以下的 annotation clustering 範例，它可以將多個標記合併，然後在地圖放大觀看細節時再分開成一個個顯示。</p><div name="26a8" id="26a8" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://developer.apple.com/documentation/mapkit/mkannotationview/decluttering_a_map_with_mapkit_annotation_clustering" data-href="https://developer.apple.com/documentation/mapkit/mkannotationview/decluttering_a_map_with_mapkit_annotation_clustering" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/mapkit/mkannotationview/decluttering_a_map_with_mapkit_annotation_clustering"><strong class="markup--strong markup--mixtapeEmbed-strong">Decluttering a Map with MapKit Annotation Clustering</strong><br><em class="markup--em markup--mixtapeEmbed-em">TANDm is a fictional bike sharing app that uses annotation clustering to provide an uncluttered map. The app shows how…</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/mapkit/mkannotationview/decluttering_a_map_with_mapkit_annotation_clustering" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="d07655a6b2367ad75b01ed810b389d9d"></a></div></div><div class="section-inner sectionLayout--outsetRow" data-paragraph-count="2"><figure name="f1fe" id="f1fe" class="graf graf--figure graf--layoutOutsetRow is-partialWidth graf-after--mixtapeEmbed" style="width: 50%;"><img class="graf-image" data-image-id="1*f6-_tX_zT66oiQmOL8JGJw.jpeg" data-width="808" data-height="1474" src="https://cdn-images-1.medium.com/max/600/1*f6-_tX_zT66oiQmOL8JGJw.jpeg"></figure><figure name="8dc0" id="8dc0" class="graf graf--figure graf--layoutOutsetRowContinue is-partialWidth graf-after--figure" style="width: 50%;"><img class="graf-image" data-image-id="1*wJwG-TJ3VGjD79Myjcw54g.jpeg" data-width="808" data-height="1474" src="https://cdn-images-1.medium.com/max/600/1*wJwG-TJ3VGjD79Myjcw54g.jpeg"></figure></div><div class="section-inner sectionLayout--insetColumn"><h3 name="1222" id="1222" class="graf graf--h3 graf-after--figure">範例</h3><div name="3000" id="3000" class="graf graf--mixtapeEmbed graf-after--h3"><a href="https://github.com/AppPeterPan/MapMaskDemo" data-href="https://github.com/AppPeterPan/MapMaskDemo" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://github.com/AppPeterPan/MapMaskDemo"><strong class="markup--strong markup--mixtapeEmbed-strong">AppPeterPan/MapMaskDemo</strong><br><em class="markup--em markup--mixtapeEmbed-em">Contribute to AppPeterPan/MapMaskDemo development by creating an account on GitHub.</em>github.com</a><a href="https://github.com/AppPeterPan/MapMaskDemo" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="5b024d4ef2fc089cbfaf1084135cfae8" data-thumbnail-img-id="0*eg1-kVlPq78e9QEf" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*eg1-kVlPq78e9QEf);"></a></div><h3 name="9946" id="9946" class="graf graf--h3 graf-after--mixtapeEmbed">同學作品集</h3><div name="1358" id="1358" class="graf graf--mixtapeEmbed graf-after--h3"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E6%95%99%E5%AE%A4/unit-viii-mapkit-geojson-%E5%8F%A3%E7%BD%A9%E5%9C%B0%E5%9C%96%E4%B9%8B%E5%B8%B6%E5%8F%A3%E7%BD%A9%E5%87%BA%E9%96%80%E8%B2%B7%E5%8F%A3%E7%BD%A9-%E6%8E%92%E9%9A%8A%E9%82%84%E8%B2%B7%E4%B8%8D%E5%88%B0%E5%8F%A3%E7%BD%A9-%E5%8D%BB%E6%B5%AA%E8%B2%BB%E4%BA%86%E4%B8%80%E5%80%8B%E5%8F%A3%E7%BD%A9-7d4e77fc8f13" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E6%95%99%E5%AE%A4/unit-viii-mapkit-geojson-%E5%8F%A3%E7%BD%A9%E5%9C%B0%E5%9C%96%E4%B9%8B%E5%B8%B6%E5%8F%A3%E7%BD%A9%E5%87%BA%E9%96%80%E8%B2%B7%E5%8F%A3%E7%BD%A9-%E6%8E%92%E9%9A%8A%E9%82%84%E8%B2%B7%E4%B8%8D%E5%88%B0%E5%8F%A3%E7%BD%A9-%E5%8D%BB%E6%B5%AA%E8%B2%BB%E4%BA%86%E4%B8%80%E5%80%8B%E5%8F%A3%E7%BD%A9-7d4e77fc8f13" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E6%95%99%E5%AE%A4/unit-viii-mapkit-geojson-%E5%8F%A3%E7%BD%A9%E5%9C%B0%E5%9C%96%E4%B9%8B%E5%B8%B6%E5%8F%A3%E7%BD%A9%E5%87%BA%E9%96%80%E8%B2%B7%E5%8F%A3%E7%BD%A9-%E6%8E%92%E9%9A%8A%E9%82%84%E8%B2%B7%E4%B8%8D%E5%88%B0%E5%8F%A3%E7%BD%A9-%E5%8D%BB%E6%B5%AA%E8%B2%BB%E4%BA%86%E4%B8%80%E5%80%8B%E5%8F%A3%E7%BD%A9-7d4e77fc8f13"><strong class="markup--strong markup--mixtapeEmbed-strong">Unit VIII：「MapKit + GeoJSON」口罩地圖之帶口罩出門買口罩，排隊還買不到口罩，卻浪費了一個口罩</strong><br><em class="markup--em markup--mixtapeEmbed-em">iOS 新手練習起步走#8</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E6%95%99%E5%AE%A4/unit-viii-mapkit-geojson-%E5%8F%A3%E7%BD%A9%E5%9C%B0%E5%9C%96%E4%B9%8B%E5%B8%B6%E5%8F%A3%E7%BD%A9%E5%87%BA%E9%96%80%E8%B2%B7%E5%8F%A3%E7%BD%A9-%E6%8E%92%E9%9A%8A%E9%82%84%E8%B2%B7%E4%B8%8D%E5%88%B0%E5%8F%A3%E7%BD%A9-%E5%8D%BB%E6%B5%AA%E8%B2%BB%E4%BA%86%E4%B8%80%E5%80%8B%E5%8F%A3%E7%BD%A9-7d4e77fc8f13" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="cf9e665e059b0ce7d54d2c7b93537f8c" data-thumbnail-img-id="1*grCvdqKdoPIALiSJSYAUbQ.gif" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*grCvdqKdoPIALiSJSYAUbQ.gif);"></a></div><figure name="0dff" id="0dff" class="graf graf--figure graf--iframe graf-after--mixtapeEmbed graf--trailing"><iframe src="https://www.youtube.com/embed/WxZvXPTBC0A?feature=oembed" width="640" height="480" frameborder="0" scrolling="no"></iframe><figcaption class="imageCaption">有沒有口罩一個給我</figcaption></figure></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@apppeterpan" class="p-author h-card">彼得潘的 iOS App Neverland</a> on <a href="https://medium.com/p/c52acd7abb46"><time class="dt-published" datetime="2020-02-15T10:25:08.816Z">February 15, 2020</time></a>.</p><p><a href="https://medium.com/@apppeterpan/%E5%88%A9%E7%94%A8-mkgeojsondecoder-%E8%A7%A3%E6%9E%90-geojson-%E8%A3%BD%E4%BD%9C%E5%8F%A3%E7%BD%A9%E5%9C%B0%E5%9C%96-app-c52acd7abb46" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on September 17, 2025.</p></footer></article></body></html>