<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>解決 SwiftData 問題 failed to find a currently active container 的五種解法</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">解決 SwiftData 問題 failed to find a currently active container 的五種解法</h1>
</header>
<section data-field="subtitle" class="p-summary">
在 SwiftUI 的 preview 裡存取 SwiftData 的資料很方便，一般情況下只要呼叫 modifier modelContainer(for:inMemory:)。它將檢查是否有 model container，如果沒有則自動生成 model…
</section>
<section data-field="body" class="e-content">
<section name="05f0" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="994f" id="994f" class="graf graf--h3 graf--leading graf--title">解決 SwiftData 問題 failed to find a currently active container 的五種解法</h3><p name="9be0" id="9be0" class="graf graf--p graf-after--h3">在 SwiftUI 的 preview 裡存取 SwiftData 的資料很方便，一般情況下只要呼叫 modifier modelContainer(for:inMemory:)。它將檢查是否有 model container，如果沒有則自動生成 model container，例如以下例子的 <code class="markup--code markup--p-code">modelContainer(for: Quote.self, inMemory: true)</code>。</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="4eea" id="4eea" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> Foundation<br /><span class="hljs-keyword">import</span> SwiftData<br /><br /><span class="hljs-meta">@Model</span><br /><span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Quote</span> {<br />    <span class="hljs-keyword">var</span> text: <span class="hljs-type">String</span><br />    <span class="hljs-keyword">var</span> book: <span class="hljs-type">String</span><br />    <br />    <span class="hljs-keyword">init</span>(<span class="hljs-params">text</span>: <span class="hljs-type">String</span>, <span class="hljs-params">book</span>: <span class="hljs-type">String</span>) {<br />        <span class="hljs-keyword">self</span>.text <span class="hljs-operator">=</span> text<br />        <span class="hljs-keyword">self</span>.book <span class="hljs-operator">=</span> book<br />    }<br />}</span></pre><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="23fb" id="23fb" class="graf graf--pre graf-after--pre graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> SwiftUI<br /><span class="hljs-keyword">import</span> SwiftData<br /><br /><span class="hljs-keyword">struct</span> <span class="hljs-title class_">QuoteList</span>: <span class="hljs-title class_">View</span> {<br />    <span class="hljs-meta">@Query</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> quotes: [<span class="hljs-type">Quote</span>]<br />    <span class="hljs-meta">@Environment</span>(\.modelContext) <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> modelContext<br /><br />    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {<br />        <span class="hljs-type">ScrollView</span> {<br />            <span class="hljs-type">Image</span>(.waitingForYou)<br />                .resizable()<br />                .scaledToFit()<br />            <span class="hljs-type">Button</span>(<span class="hljs-string">&quot;create quote&quot;</span>) {<br />                <span class="hljs-keyword">let</span> now <span class="hljs-operator">=</span> <span class="hljs-type">Date</span>.now<br />                <span class="hljs-keyword">let</span> oneHourAgo <span class="hljs-operator">=</span> now <span class="hljs-operator">-</span> <span class="hljs-number">3600</span><br />                <span class="hljs-keyword">let</span> quote <span class="hljs-operator">=</span> <span class="hljs-type">Quote</span>(text: <span class="hljs-string">&quot;If, for example, you come at <span class="hljs-subst">\(now.formatted(Date.FormatStyle().hour()))</span>:00, then at <span class="hljs-subst">\(oneHourAgo.formatted(Date.FormatStyle().hour()))</span>:00 I shall begin to be happy.&quot;</span>, book: <span class="hljs-string">&quot;小王子&quot;</span>)<br />                modelContext.insert(quote)<br />            }<br />            <span class="hljs-type">ForEach</span>(quotes) { quote <span class="hljs-keyword">in</span><br />                <span class="hljs-type">Text</span>(quote.text)<br />            }<br />        }<br />       <br />    }<br />}<br /><br />#<span class="hljs-type">Preview</span> {<br />    <span class="hljs-type">QuoteList</span>()<br />        .modelContainer(for: <span class="hljs-type">Quote</span>.<span class="hljs-keyword">self</span>, inMemory: <span class="hljs-literal">true</span>)<br />}</span></pre><figure name="1731" id="1731" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*qS3S043Ncsj_Bcys0hfdug.png" data-width="1179" data-height="2556" src="https://cdn-images-1.medium.com/max/800/1*qS3S043Ncsj_Bcys0hfdug.png"></figure><p name="2b26" id="2b26" class="graf graf--p graf-after--figure">然而以下 preview 的寫法在 iOS 17 卻會造成 App 閃退。(ps: iOS 18 以上不會有問題。)</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="a52e" id="a52e" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> SwiftUI<br /><span class="hljs-keyword">import</span> SwiftData<br /><br /><span class="hljs-keyword">struct</span> <span class="hljs-title class_">QuoteDetail</span>: <span class="hljs-title class_">View</span> {<br />    <span class="hljs-keyword">var</span> quote: <span class="hljs-type">Quote</span><br />    <br />    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {<br />        <span class="hljs-type">VStack</span> {<br />            <span class="hljs-type">Image</span>(.waitingForYou)<br />                .resizable()<br />                .scaledToFit()<br />            <span class="hljs-type">Text</span>(quote.text)<br />        }<br />    }<br />}<br /><br />#<span class="hljs-type">Preview</span> {<br />    <span class="hljs-keyword">let</span> now <span class="hljs-operator">=</span> <span class="hljs-type">Date</span>.now<br />    <span class="hljs-keyword">let</span> oneHourAgo <span class="hljs-operator">=</span> now <span class="hljs-operator">-</span> <span class="hljs-number">3600</span><br />    <span class="hljs-keyword">let</span> quote <span class="hljs-operator">=</span> <span class="hljs-type">Quote</span>(text: <span class="hljs-string">&quot;If, for example, you come at <span class="hljs-subst">\(now.formatted(Date.FormatStyle().hour()))</span>:00, then at <span class="hljs-subst">\(oneHourAgo.formatted(Date.FormatStyle().hour()))</span>:00 I shall begin to be happy.&quot;</span>, book: <span class="hljs-string">&quot;小王子&quot;</span>)<br />    <span class="hljs-keyword">return</span> <span class="hljs-type">QuoteDetail</span>(quote: quote)<br />        .modelContainer(for: <span class="hljs-type">Quote</span>.<span class="hljs-keyword">self</span>, inMemory: <span class="hljs-literal">true</span>)<br />}</span></pre><p name="a79d" id="a79d" class="graf graf--p graf-after--pre">出現錯誤訊息 Fatal Error in ModelContainer.swift，failed to find a currently active container for xxx。</p><figure name="1b92" id="1b92" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*aIP6fGO2GWOB7etWJCNgJQ.png" data-width="1010" data-height="378" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*aIP6fGO2GWOB7etWJCNgJQ.png"></figure><p name="fe64" id="fe64" class="graf graf--p graf-after--figure">此問題是因為我們在 model container 產生前就建立 Swift Data 的 Quote 資料，這是不允許的，一定要先有 model container 才能建立相關的 model 資料。</p><p name="2f2e" id="2f2e" class="graf graf--p graf-after--p">因此只要先產生 model container 即可修正問題，以下是此問題可能的五種解法。</p><ul class="postList"><li name="5eb3" id="5eb3" class="graf graf--li graf-after--p">解法 1: 在 #Preview { } 裡先產生 ModelContainer。</li><li name="90ac" id="90ac" class="graf graf--li graf-after--li">解法 2: 定義提供資料給 Preview 的 SampleData，宣告 property 儲存 ModelContainer。</li><li name="9185" id="9185" class="graf graf--li graf-after--li">解法 3: 宣告給 Preview 使用的全域變數儲存 ModelContainer。</li><li name="360c" id="360c" class="graf graf--li graf-after--li">解法 4: 在 App 的 property 儲存 ModelContainer。</li><li name="8ead" id="8ead" class="graf graf--li graf-after--li">解法 5: 定義儲存 model container 的 ModelContainerPreview。</li></ul><h3 name="0b5a" id="0b5a" class="graf graf--h3 graf-after--li">解法 1: 在 #Preview { } 裡先產生 ModelContainer</h3><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="848d" id="848d" class="graf graf--pre graf-after--h3 graf--preV2"><span class="pre--content">#<span class="hljs-type">Preview</span> {<br />    <span class="hljs-keyword">let</span> modelContainer <span class="hljs-operator">=</span> <span class="hljs-keyword">try!</span> <span class="hljs-type">ModelContainer</span>(for: <span class="hljs-type">Quote</span>.<span class="hljs-keyword">self</span>, configurations: <span class="hljs-type">ModelConfiguration</span>(isStoredInMemoryOnly: <span class="hljs-literal">true</span>))<br />    <span class="hljs-keyword">let</span> now <span class="hljs-operator">=</span> <span class="hljs-type">Date</span>.now<br />    <span class="hljs-keyword">let</span> oneHourAgo <span class="hljs-operator">=</span> now <span class="hljs-operator">-</span> <span class="hljs-number">3600</span><br />    <span class="hljs-keyword">let</span> quote <span class="hljs-operator">=</span> <span class="hljs-type">Quote</span>(text: <span class="hljs-string">&quot;If, for example, you come at <span class="hljs-subst">\(now.formatted(Date.FormatStyle().hour()))</span>:00, then at <span class="hljs-subst">\(oneHourAgo.formatted(Date.FormatStyle().hour()))</span>:00 I shall begin to be happy.&quot;</span>, book: <span class="hljs-string">&quot;小王子&quot;</span>)<br />    <span class="hljs-keyword">return</span> <span class="hljs-type">QuoteDetail</span>(quote: quote)<br />        .modelContainer(modelContainer)<br />}</span></pre><figure name="884b" id="884b" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*1x2eIY5MaFYiKN2e-swxVA.png" data-width="1179" data-height="2556" src="https://cdn-images-1.medium.com/max/800/1*1x2eIY5MaFYiKN2e-swxVA.png"></figure><h3 name="51a1" id="51a1" class="graf graf--h3 graf-after--figure">解法 2: 定義提供資料給 Preview 的 SampleData，宣告 property 儲存 ModelContainer</h3><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="8535" id="8535" class="graf graf--pre graf-after--h3 graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> Foundation<br /><span class="hljs-keyword">import</span> SwiftData<br /><br /><span class="hljs-keyword">class</span> <span class="hljs-title class_">SampleData</span> {<br />    <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> shared <span class="hljs-operator">=</span> <span class="hljs-type">SampleData</span>()<br />    <br />    <span class="hljs-keyword">let</span> modelContainer: <span class="hljs-type">ModelContainer</span><br />    <br />    <span class="hljs-keyword">private</span> <span class="hljs-keyword">init</span>() {<br />        <span class="hljs-keyword">let</span> schema <span class="hljs-operator">=</span> <span class="hljs-type">Schema</span>([<br />            <span class="hljs-type">Quote</span>.<span class="hljs-keyword">self</span>,<br />        ])<br />        <span class="hljs-keyword">let</span> modelConfiguration <span class="hljs-operator">=</span> <span class="hljs-type">ModelConfiguration</span>(schema: schema, isStoredInMemoryOnly: <span class="hljs-literal">true</span>)<br />        <br />        <span class="hljs-keyword">do</span> {<br />            modelContainer <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> <span class="hljs-type">ModelContainer</span>(for: schema, configurations: [modelConfiguration])<br />        } <span class="hljs-keyword">catch</span> {<br />            <span class="hljs-built_in">fatalError</span>(<span class="hljs-string">&quot;Could not create ModelContainer: <span class="hljs-subst">\(error)</span>&quot;</span>)<br />        }<br />    }<br />    <br />    <span class="hljs-keyword">var</span> quote: <span class="hljs-type">Quote</span> {<br />        <span class="hljs-keyword">let</span> now <span class="hljs-operator">=</span> <span class="hljs-type">Date</span>.now<br />        <span class="hljs-keyword">let</span> oneHourAgo <span class="hljs-operator">=</span> now <span class="hljs-operator">-</span> <span class="hljs-number">3600</span><br />        <span class="hljs-keyword">return</span> <span class="hljs-type">Quote</span>(text: <span class="hljs-string">&quot;If, for example, you come at <span class="hljs-subst">\(now.formatted(Date.FormatStyle().hour()))</span>:00, then at <span class="hljs-subst">\(oneHourAgo.formatted(Date.FormatStyle().hour()))</span>:00 I shall begin to be happy.&quot;</span>, book: <span class="hljs-string">&quot;小王子&quot;</span>)<br />    }<br />}</span></pre><p name="49f2" id="49f2" class="graf graf--p graf-after--pre">在產生 SampleData.shared.quote 前，SampleData.shared 會先建立，因此會先產生 model container。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="d949" id="d949" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">#<span class="hljs-type">Preview</span> {<br />    <span class="hljs-type">QuoteDetail</span>(quote: <span class="hljs-type">SampleData</span>.shared.quote)<br />        .modelContainer(<span class="hljs-type">SampleData</span>.shared.modelContainer)<br />}</span></pre><p name="89ce" id="89ce" class="graf graf--p graf-after--pre">此解法參考 Apple 的 Create, update, and delete data 範例。</p><div name="13f2" id="13f2" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://developer.apple.com/tutorials/develop-in-swift/create-update-and-delete-data" data-href="https://developer.apple.com/tutorials/develop-in-swift/create-update-and-delete-data" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/tutorials/develop-in-swift/create-update-and-delete-data"><strong class="markup--strong markup--mixtapeEmbed-strong">Create, update, and delete data | Apple Developer Documentation</strong><br><em class="markup--em markup--mixtapeEmbed-em">When you base an app around a common data store, you should give people a way to create new items, update existing…</em>developer.apple.com</a><a href="https://developer.apple.com/tutorials/develop-in-swift/create-update-and-delete-data" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="6b8d02a342c64cf61e5b8ec84492e14e" data-thumbnail-img-id="0*Zrbdlc-iQzGBfCmo" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*Zrbdlc-iQzGBfCmo);"></a></div><h3 name="39eb" id="39eb" class="graf graf--h3 graf-after--mixtapeEmbed">解法 3: 宣告給 Preview 使用的全域變數儲存 ModelContainer</h3><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="c5b8" id="c5b8" class="graf graf--pre graf-after--h3 graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> SwiftData<br /><br /><span class="hljs-keyword">let</span> previewContainer: <span class="hljs-type">ModelContainer</span> <span class="hljs-operator">=</span> {<br />    <span class="hljs-keyword">do</span> {<br />        <span class="hljs-keyword">return</span> <span class="hljs-keyword">try</span> <span class="hljs-type">ModelContainer</span>(<br />            for: <span class="hljs-type">Quote</span>.<span class="hljs-keyword">self</span>,<br />            configurations: <span class="hljs-type">ModelConfiguration</span>(isStoredInMemoryOnly: <span class="hljs-literal">true</span>)<br />        )<br />    } <span class="hljs-keyword">catch</span> {<br />        <span class="hljs-built_in">fatalError</span>(<span class="hljs-string">&quot;Failed to create container&quot;</span>)<br />    }<br />}()</span></pre><p name="6a8b" id="6a8b" class="graf graf--p graf-after--pre">以下程式要先寫 <code class="markup--code markup--p-code">let previewContainer = previewContainer</code>，如此它才會在存取 previewContainer 時先產生 model container，後來才產生 Quote。</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="55f7" id="55f7" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">#<span class="hljs-type">Preview</span> {<br />    <span class="hljs-keyword">let</span> previewContainer <span class="hljs-operator">=</span> previewContainer<br />    <span class="hljs-keyword">let</span> now <span class="hljs-operator">=</span> <span class="hljs-type">Date</span>.now<br />    <span class="hljs-keyword">let</span> oneHourAgo <span class="hljs-operator">=</span> now <span class="hljs-operator">-</span> <span class="hljs-number">3600</span><br />    <span class="hljs-keyword">let</span> quote <span class="hljs-operator">=</span> <span class="hljs-type">Quote</span>(text: <span class="hljs-string">&quot;If, for example, you come at <span class="hljs-subst">\(now.formatted(Date.FormatStyle().hour()))</span>:00, then at <span class="hljs-subst">\(oneHourAgo.formatted(Date.FormatStyle().hour()))</span>:00 I shall begin to be happy.&quot;</span>, book: <span class="hljs-string">&quot;小王子&quot;</span>)<br />    <span class="hljs-keyword">return</span> <span class="hljs-type">QuoteDetail</span>(quote: quote)<br />        .modelContainer(previewContainer)<br />}</span></pre><p name="4841" id="4841" class="graf graf--p graf-after--pre">此解法參考 Apple 的 Building a document-based app using SwiftData。</p><div name="aa7c" id="aa7c" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://developer.apple.com/documentation/swiftui/building-a-document-based-app-using-swiftdata" data-href="https://developer.apple.com/documentation/swiftui/building-a-document-based-app-using-swiftdata" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/swiftui/building-a-document-based-app-using-swiftdata"><strong class="markup--strong markup--mixtapeEmbed-strong">Building a document-based app using SwiftData | Apple Developer Documentation</strong><br><em class="markup--em markup--mixtapeEmbed-em">Code along with the WWDC presenter to transform an app with SwiftData.</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/swiftui/building-a-document-based-app-using-swiftdata" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="dd7a13ef6a9998a5d2bca7d32bed7802" data-thumbnail-img-id="0*-M_HNmq3OmQdl1rH" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*-M_HNmq3OmQdl1rH);"></a></div><h3 name="96a5" id="96a5" class="graf graf--h3 graf-after--mixtapeEmbed">解法 4: 在 App 的 property 儲存 ModelContainer</h3><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="c99b" id="c99b" class="graf graf--pre graf-after--h3 graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> SwiftUI<br /><span class="hljs-keyword">import</span> SwiftData<br /><br /><span class="hljs-keyword">@main</span><br /><span class="hljs-keyword">struct</span> <span class="hljs-title class_">DemoApp</span>: <span class="hljs-title class_">App</span> {<br />    <span class="hljs-keyword">var</span> sharedModelContainer: <span class="hljs-type">ModelContainer</span> <span class="hljs-operator">=</span> {<br />        <span class="hljs-keyword">let</span> schema <span class="hljs-operator">=</span> <span class="hljs-type">Schema</span>([<br />            <span class="hljs-type">Quote</span>.<span class="hljs-keyword">self</span>,<br />        ])<br />        <span class="hljs-keyword">let</span> modelConfiguration <span class="hljs-operator">=</span> <span class="hljs-type">ModelConfiguration</span>(schema: schema, isStoredInMemoryOnly: <span class="hljs-literal">false</span>)<br />        <br />        <span class="hljs-keyword">do</span> {<br />            <span class="hljs-keyword">return</span> <span class="hljs-keyword">try</span> <span class="hljs-type">ModelContainer</span>(for: schema, configurations: [modelConfiguration])<br />        } <span class="hljs-keyword">catch</span> {<br />            <span class="hljs-built_in">fatalError</span>(<span class="hljs-string">&quot;Could not create ModelContainer: <span class="hljs-subst">\(error)</span>&quot;</span>)<br />        }<br />    }()</span></pre><p name="b834" id="b834" class="graf graf--p graf-after--pre">Preview 的 <code class="markup--code markup--p-code">modelContainer(for: Quote.self) </code>將聰明地找到 App property 儲存的 ModelContainer。</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="5514" id="5514" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">#<span class="hljs-type">Preview</span> {<br />    <span class="hljs-keyword">let</span> now <span class="hljs-operator">=</span> <span class="hljs-type">Date</span>.now<br />    <span class="hljs-keyword">let</span> oneHourAgo <span class="hljs-operator">=</span> now <span class="hljs-operator">-</span> <span class="hljs-number">3600</span><br />    <span class="hljs-keyword">let</span> quote <span class="hljs-operator">=</span> <span class="hljs-type">Quote</span>(text: <span class="hljs-string">&quot;If, for example, you come at <span class="hljs-subst">\(now.formatted(Date.FormatStyle().hour()))</span>:00, then at <span class="hljs-subst">\(oneHourAgo.formatted(Date.FormatStyle().hour()))</span>:00 I shall begin to be happy.&quot;</span>, book: <span class="hljs-string">&quot;小王子&quot;</span>)<br />    <span class="hljs-keyword">return</span> <span class="hljs-type">QuoteDetail</span>(quote: quote)<br />        .modelContainer(for: <span class="hljs-type">Quote</span>.<span class="hljs-keyword">self</span>, inMemory: <span class="hljs-literal">true</span>)}</span></pre><h3 name="d69d" id="d69d" class="graf graf--h3 graf-after--pre">解法 5: 定義儲存 model container 的 ModelContainerPreview</h3><p name="295e" id="295e" class="graf graf--p graf-after--h3">定義 ModelContainerPreview 來顯示包含 Swift Data 的資料，ModelContainerPreview 本身包含 ModelContainer，因此不用再擔心缺少 ModelContainer 造成的閃退問題。</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="74a1" id="74a1" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> SwiftUI<br /><span class="hljs-keyword">import</span> SwiftData<br /><br /><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ModelContainerPreview</span>&lt;<span class="hljs-title class_">Content</span>: <span class="hljs-title class_">View</span>&gt;: <span class="hljs-title class_">View</span> {<br />    <span class="hljs-keyword">var</span> content: () -&gt; <span class="hljs-type">Content</span><br />    <span class="hljs-keyword">let</span> container: <span class="hljs-type">ModelContainer</span><br /><br />    <span class="hljs-comment">/// Creates an instance of the model container preview.</span><br />    <span class="hljs-comment">///</span><br />    <span class="hljs-comment">/// This view creates the model container before displaying the preview</span><br />    <span class="hljs-comment">/// content. The view is intended for use in previews only.</span><br />    <span class="hljs-comment">///</span><br />    <span class="hljs-comment">///     #Preview {</span><br />    <span class="hljs-comment">///         ModelContainerPreview {</span><br />    <span class="hljs-comment">///             AnimalEditor(animal: nil)</span><br />    <span class="hljs-comment">///                 .environment(NavigationContext())</span><br />    <span class="hljs-comment">///             } modelContainer: {</span><br />    <span class="hljs-comment">///                 let schema = Schema([AnimalCategory.self, Animal.self])</span><br />    <span class="hljs-comment">///                 let configuration = ModelConfiguration(isStoredInMemoryOnly: true)</span><br />    <span class="hljs-comment">///                 let container = try ModelContainer(for: schema, configurations: [configuration])</span><br />    <span class="hljs-comment">///                 Task { @MainActor in</span><br />    <span class="hljs-comment">///                     AnimalCategory.insertSampleData(modelContext: container.mainContext)</span><br />    <span class="hljs-comment">///                 }</span><br />    <span class="hljs-comment">///             return container</span><br />    <span class="hljs-comment">///         }</span><br />    <span class="hljs-comment">///     }</span><br />    <span class="hljs-comment">///</span><br />    <span class="hljs-comment">/// - Parameters:</span><br />    <span class="hljs-comment">///   - content: A view that describes the content to preview.</span><br />    <span class="hljs-comment">///   - modelContainer: A closure that returns a model container.</span><br />    <span class="hljs-keyword">init</span>(<span class="hljs-meta">@ViewBuilder</span> <span class="hljs-params">content</span>: <span class="hljs-keyword">@escaping</span> () -&gt; <span class="hljs-type">Content</span>, <span class="hljs-params">modelContainer</span>: <span class="hljs-keyword">@escaping</span> () <span class="hljs-keyword">throws</span> -&gt; <span class="hljs-type">ModelContainer</span>) {<br />        <span class="hljs-keyword">self</span>.content <span class="hljs-operator">=</span> content<br />        <span class="hljs-keyword">do</span> {<br />            <span class="hljs-keyword">self</span>.container <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> <span class="hljs-type">MainActor</span>.assumeIsolated(modelContainer)<br />        } <span class="hljs-keyword">catch</span> {<br />            <span class="hljs-built_in">fatalError</span>(<span class="hljs-string">&quot;Failed to create the model container: <span class="hljs-subst">\(error.localizedDescription)</span>&quot;</span>)<br />        }<br />    }<br /><br />    <span class="hljs-comment">/// Creates a view that creates the provided model container before displaying</span><br />    <span class="hljs-comment">/// the preview content.</span><br />    <span class="hljs-comment">///</span><br />    <span class="hljs-comment">/// This view creates the model container before displaying the preview</span><br />    <span class="hljs-comment">/// content. The view is intended for use in previews only.</span><br />    <span class="hljs-comment">///</span><br />    <span class="hljs-comment">///     #Preview {</span><br />    <span class="hljs-comment">///         ModelContainerPreview(SampleModelContainer.main) {</span><br />    <span class="hljs-comment">///             AnimalEditor(animal: .kangaroo)</span><br />    <span class="hljs-comment">///                 .environment(NavigationContext())</span><br />    <span class="hljs-comment">///         }</span><br />    <span class="hljs-comment">///     }</span><br />    <span class="hljs-comment">///</span><br />    <span class="hljs-comment">/// - Parameters:</span><br />    <span class="hljs-comment">///   - modelContainer: A closure that returns a model container.</span><br />    <span class="hljs-comment">///   - content: A view that describes the content to preview.</span><br />    <span class="hljs-keyword">init</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">modelContainer</span>: <span class="hljs-keyword">@escaping</span> () <span class="hljs-keyword">throws</span> -&gt; <span class="hljs-type">ModelContainer</span>, <span class="hljs-meta">@ViewBuilder</span> <span class="hljs-params">content</span>: <span class="hljs-keyword">@escaping</span> () -&gt; <span class="hljs-type">Content</span>) {<br />        <span class="hljs-keyword">self</span>.<span class="hljs-keyword">init</span>(content: content, modelContainer: modelContainer)<br />    }<br /><br />    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {<br />        content()<br />            .modelContainer(container)<br />    }<br />}</span></pre><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="46f7" id="46f7" class="graf graf--pre graf-after--pre graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> SwiftData<br /><br /><span class="hljs-keyword">extension</span> <span class="hljs-title class_">ModelContainer</span> {<br />    <span class="hljs-keyword">static</span> <span class="hljs-keyword">var</span> sample: () <span class="hljs-keyword">throws</span> -&gt; <span class="hljs-type">ModelContainer</span> <span class="hljs-operator">=</span> {<br />        <span class="hljs-keyword">let</span> schema <span class="hljs-operator">=</span> <span class="hljs-type">Schema</span>([<span class="hljs-type">Quote</span>.<span class="hljs-keyword">self</span>])<br />        <span class="hljs-keyword">let</span> configuration <span class="hljs-operator">=</span> <span class="hljs-type">ModelConfiguration</span>(isStoredInMemoryOnly: <span class="hljs-literal">true</span>)<br />        <span class="hljs-keyword">let</span> container <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> <span class="hljs-type">ModelContainer</span>(for: schema, configurations: [configuration])<br />        <span class="hljs-keyword">return</span> container<br />    }<br />}</span></pre><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="cbe5" id="cbe5" class="graf graf--pre graf-after--pre graf--preV2"><span class="pre--content">#<span class="hljs-type">Preview</span> {<br />    <span class="hljs-type">ModelContainerPreview</span>(<span class="hljs-type">ModelContainer</span>.sample) {<br />        <span class="hljs-keyword">let</span> now <span class="hljs-operator">=</span> <span class="hljs-type">Date</span>.now<br />        <span class="hljs-keyword">let</span> oneHourAgo <span class="hljs-operator">=</span> now <span class="hljs-operator">-</span> <span class="hljs-number">3600</span><br />        <span class="hljs-keyword">let</span> quote <span class="hljs-operator">=</span> <span class="hljs-type">Quote</span>(text: <span class="hljs-string">&quot;If, for example, you come at <span class="hljs-subst">\(now.formatted(Date.FormatStyle().hour()))</span>:00, then at <span class="hljs-subst">\(oneHourAgo.formatted(Date.FormatStyle().hour()))</span>:00 I shall begin to be happy.&quot;</span>, book: <span class="hljs-string">&quot;小王子&quot;</span>)<br />        <span class="hljs-keyword">return</span> <span class="hljs-type">QuoteDetail</span>(quote: quote)<br />            .modelContainer(for: <span class="hljs-type">Quote</span>.<span class="hljs-keyword">self</span>)<br />    }<br />}</span></pre><p name="683e" id="683e" class="graf graf--p graf-after--pre">此解法參考 Apple 的 Adding and editing persistent data in your app。</p><div name="8ec9" id="8ec9" class="graf graf--mixtapeEmbed graf-after--p graf--trailing"><a href="https://developer.apple.com/documentation/swiftdata/adding-and-editing-persistent-data-in-your-app" data-href="https://developer.apple.com/documentation/swiftdata/adding-and-editing-persistent-data-in-your-app" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/swiftdata/adding-and-editing-persistent-data-in-your-app"><strong class="markup--strong markup--mixtapeEmbed-strong">Adding and editing persistent data in your app | Apple Developer Documentation</strong><br><em class="markup--em markup--mixtapeEmbed-em">Create a data entry form for collecting and changing data managed by SwiftData.</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/swiftdata/adding-and-editing-persistent-data-in-your-app" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="b841eb1ae4f98978d2b6e22a4ecfd48b" data-thumbnail-img-id="0*uB0p01jKncjMpjfz" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*uB0p01jKncjMpjfz);"></a></div></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@apppeterpan" class="p-author h-card">彼得潘的 iOS App Neverland</a> on <a href="https://medium.com/p/6bcdf5c29db0"><time class="dt-published" datetime="2024-05-26T09:01:31.007Z">May 26, 2024</time></a>.</p><p><a href="https://medium.com/@apppeterpan/%E8%A7%A3%E6%B1%BA-swiftdata-%E5%95%8F%E9%A1%8C-failed-to-find-a-currently-active-container-%E7%9A%84%E4%BA%94%E7%A8%AE%E8%A7%A3%E6%B3%95-6bcdf5c29db0" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on September 17, 2025.</p></footer></article></body></html>