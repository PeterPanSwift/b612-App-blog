<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Generics 程式範例 — Apple’s The Swift Programming Language</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Generics 程式範例 — Apple’s The Swift Programming Language</h1>
</header>
<section data-field="subtitle" class="p-summary">
The Problem That Generics Solve
</section>
<section data-field="body" class="e-content">
<section name="225c" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="0a1a" id="0a1a" class="graf graf--h3 graf--leading graf--title">Generics 程式範例 — Apple’s The Swift Programming Language</h3><div name="a434" id="a434" class="graf graf--mixtapeEmbed graf-after--h3"><a href="https://docs.swift.org/swift-book/LanguageGuide/Generics.html" data-href="https://docs.swift.org/swift-book/LanguageGuide/Generics.html" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://docs.swift.org/swift-book/LanguageGuide/Generics.html"><strong class="markup--strong markup--mixtapeEmbed-strong">Generics - The Swift Programming Language (Swift 4.2)</strong><br><em class="markup--em markup--mixtapeEmbed-em">Generic code enables you to write flexible, reusable functions and types that can work with any type, subject to…</em>docs.swift.org</a><a href="https://docs.swift.org/swift-book/LanguageGuide/Generics.html" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="c0184021e38ea33f5b30d5ae1c5e4b01" data-thumbnail-img-id="0*rHpfCB4C44wlI5sc" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*rHpfCB4C44wlI5sc);"></a></div><blockquote name="5890" id="5890" class="graf graf--blockquote graf-after--mixtapeEmbed"><strong class="markup--strong markup--blockquote-strong">The Problem That Generics Solve</strong></blockquote><p name="3e4a" id="3e4a" class="graf graf--p graf-after--blockquote">為了交換整數，浮數點和字串，必須寫三個不同的 function，雖然程式碼長得一模一樣。</p><pre name="eb66" id="eb66" class="graf graf--pre graf-after--p">func swapTwoInts(_ a: inout Int, _ b: inout Int) {</pre><pre name="1503" id="1503" class="graf graf--pre graf-after--pre">   let temporaryA = a</pre><pre name="bc46" id="bc46" class="graf graf--pre graf-after--pre">   a = b</pre><pre name="7e0c" id="7e0c" class="graf graf--pre graf-after--pre">   b = temporaryA</pre><pre name="66a0" id="66a0" class="graf graf--pre graf-after--pre">}</pre><pre name="e64b" id="e64b" class="graf graf--pre graf-after--pre">var someInt = 3</pre><pre name="02c5" id="02c5" class="graf graf--pre graf-after--pre">var anotherInt = 107</pre><pre name="a9a1" id="a9a1" class="graf graf--pre graf-after--pre">swapTwoInts(&amp;someInt, &amp;anotherInt)</pre><pre name="7523" id="7523" class="graf graf--pre graf-after--pre">print(&quot;someInt is now \(someInt), and anotherInt is now \(anotherInt)&quot;)</pre><pre name="5ab6" id="5ab6" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// Prints &quot;someInt is now 107, and anotherInt is now 3&quot;</em></pre><pre name="bb29" id="bb29" class="graf graf--pre graf-after--pre">func swapTwoStrings(_ a: inout String, _ b: inout String) {</pre><pre name="543d" id="543d" class="graf graf--pre graf-after--pre">   let temporaryA = a</pre><pre name="11f7" id="11f7" class="graf graf--pre graf-after--pre">   a = b</pre><pre name="5fdc" id="5fdc" class="graf graf--pre graf-after--pre">   b = temporaryA</pre><pre name="2430" id="2430" class="graf graf--pre graf-after--pre">}</pre><pre name="246c" id="246c" class="graf graf--pre graf-after--pre">func swapTwoDoubles(_ a: inout Double, _ b: inout Double) {</pre><pre name="c4cd" id="c4cd" class="graf graf--pre graf-after--pre">   let temporaryA = a</pre><pre name="0090" id="0090" class="graf graf--pre graf-after--pre">   a = b</pre><pre name="1a77" id="1a77" class="graf graf--pre graf-after--pre">   b = temporaryA</pre><pre name="37cf" id="37cf" class="graf graf--pre graf-after--pre">}</pre><blockquote name="3dc1" id="3dc1" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">Generic Functions</strong></blockquote><p name="61a2" id="61a2" class="graf graf--p graf-after--blockquote">利用 &lt;T&gt; 宣告型別的代號為 T。型別代號可自由取名，不一定要叫 T。</p><pre name="c96c" id="c96c" class="graf graf--pre graf-after--p">func swapTwoValues&lt;T&gt;(_ a: inout T, _ b: inout T) {</pre><pre name="9d88" id="9d88" class="graf graf--pre graf-after--pre">   let temporaryA = a</pre><pre name="d324" id="d324" class="graf graf--pre graf-after--pre">   a = b</pre><pre name="1729" id="1729" class="graf graf--pre graf-after--pre">   b = temporaryA</pre><pre name="7020" id="7020" class="graf graf--pre graf-after--pre">}</pre><pre name="8cc7" id="8cc7" class="graf graf--pre graf-after--pre">var someInt = 3</pre><pre name="d241" id="d241" class="graf graf--pre graf-after--pre">var anotherInt = 107</pre><pre name="377a" id="377a" class="graf graf--pre graf-after--pre">swapTwoValues(&amp;someInt, &amp;anotherInt)</pre><pre name="6b89" id="6b89" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// someInt is now 107, and anotherInt is now 3</em></pre><pre name="2628" id="2628" class="graf graf--pre graf-after--pre">var someString = &quot;hello&quot;</pre><pre name="312d" id="312d" class="graf graf--pre graf-after--pre">var anotherString = &quot;world&quot;</pre><pre name="1319" id="1319" class="graf graf--pre graf-after--pre">swapTwoValues(&amp;someString, &amp;anotherString)</pre><pre name="7bd9" id="7bd9" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// someString is now &quot;world&quot;, and anotherString is now &quot;hello&quot;</em></pre><blockquote name="65b0" id="65b0" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">Naming Type Parameters</strong></blockquote><p name="bd10" id="bd10" class="graf graf--p graf-after--blockquote">例子: T, U, V, Dictionary 的 key &amp; Value，Array 的 Element。</p><blockquote name="b6bc" id="b6bc" class="graf graf--blockquote graf-after--p"><strong class="markup--strong markup--blockquote-strong">Generic Types</strong></blockquote><p name="79a8" id="79a8" class="graf graf--p graf-after--blockquote">沒有 generic 的 IntStack 只能裝整數。</p><pre name="b2a3" id="b2a3" class="graf graf--pre graf-after--p">struct IntStack {</pre><pre name="6833" id="6833" class="graf graf--pre graf-after--pre">  var items = [Int]()</pre><pre name="d7de" id="d7de" class="graf graf--pre graf-after--pre">  mutating func push(_ item: Int) {</pre><pre name="6e5d" id="6e5d" class="graf graf--pre graf-after--pre">     items.append(item)</pre><pre name="c216" id="c216" class="graf graf--pre graf-after--pre">  }</pre><pre name="c5d9" id="c5d9" class="graf graf--pre graf-after--pre">  mutating func pop() -&gt; Int {</pre><pre name="9d1c" id="9d1c" class="graf graf--pre graf-after--pre">     return items.removeLast()</pre><pre name="10ef" id="10ef" class="graf graf--pre graf-after--pre">  }</pre><pre name="eab2" id="eab2" class="graf graf--pre graf-after--pre">}</pre><p name="9c0e" id="9c0e" class="graf graf--p graf-after--pre">加了 generic 的 Stack&lt;Element&gt; 可以裝任何型別的東西。</p><pre name="a5ff" id="a5ff" class="graf graf--pre graf-after--p">struct Stack&lt;Element&gt; {</pre><pre name="2291" id="2291" class="graf graf--pre graf-after--pre">   var items = [Element]()</pre><pre name="9b40" id="9b40" class="graf graf--pre graf-after--pre">   mutating func push(_ item: Element) {</pre><pre name="1372" id="1372" class="graf graf--pre graf-after--pre">      items.append(item)</pre><pre name="b191" id="b191" class="graf graf--pre graf-after--pre">   }</pre><pre name="6d44" id="6d44" class="graf graf--pre graf-after--pre">   mutating func pop() -&gt; Element {</pre><pre name="cb02" id="cb02" class="graf graf--pre graf-after--pre">      return items.removeLast()</pre><pre name="17f9" id="17f9" class="graf graf--pre graf-after--pre">   }</pre><pre name="ccb7" id="ccb7" class="graf graf--pre graf-after--pre">}</pre><pre name="58ae" id="58ae" class="graf graf--pre graf-after--pre">var stackOfStrings = Stack&lt;String&gt;()</pre><pre name="5d28" id="5d28" class="graf graf--pre graf-after--pre">stackOfStrings.push(&quot;uno&quot;)</pre><pre name="efc8" id="efc8" class="graf graf--pre graf-after--pre">stackOfStrings.push(&quot;dos&quot;)</pre><pre name="eae2" id="eae2" class="graf graf--pre graf-after--pre">stackOfStrings.push(&quot;tres&quot;)</pre><pre name="b64f" id="b64f" class="graf graf--pre graf-after--pre">stackOfStrings.push(&quot;cuatro&quot;)</pre><pre name="5d22" id="5d22" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// the stack now contains 4 strings</em></pre><pre name="f683" id="f683" class="graf graf--pre graf-after--pre">let fromTheTop = stackOfStrings.pop()</pre><pre name="15f2" id="15f2" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// fromTheTop is equal to &quot;cuatro&quot;, and the stack now contains 3 strings</em></pre><blockquote name="3f34" id="3f34" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">Extending a Generic Type</strong></blockquote><pre name="d4f8" id="d4f8" class="graf graf--pre graf-after--blockquote">extension Stack {</pre><pre name="2f1e" id="2f1e" class="graf graf--pre graf-after--pre">   var topItem: Element? {</pre><pre name="a5e6" id="a5e6" class="graf graf--pre graf-after--pre">      return items.isEmpty ? nil : items[items.count - 1]</pre><pre name="3948" id="3948" class="graf graf--pre graf-after--pre">   }</pre><pre name="ea0f" id="ea0f" class="graf graf--pre graf-after--pre">}</pre><pre name="17b4" id="17b4" class="graf graf--pre graf-after--pre">if let topItem = stackOfStrings.topItem {</pre><pre name="776d" id="776d" class="graf graf--pre graf-after--pre">   print(&quot;The top item on the stack is \(topItem).&quot;)</pre><pre name="3fbb" id="3fbb" class="graf graf--pre graf-after--pre">}</pre><pre name="7c06" id="7c06" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// Prints &quot;The top item on the stack is tres.&quot;</em></pre><blockquote name="97f7" id="97f7" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">Type Constraint Syntax</strong></blockquote><pre name="a168" id="a168" class="graf graf--pre graf-after--blockquote">func someFunction&lt;T: SomeClass, U: SomeProtocol&gt;(someT: T, someU: U) {</pre><pre name="f114" id="f114" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">   // function body goes here</em></pre><pre name="5cb3" id="5cb3" class="graf graf--pre graf-after--pre">}</pre><blockquote name="d1df" id="d1df" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">Type Constraints in Action</strong></blockquote><p name="c5d8" id="c5d8" class="graf graf--p graf-after--blockquote">沒有 generic 的版本</p><p name="668e" id="668e" class="graf graf--p graf-after--p">例子: finding the index of a value in an array</p><pre name="1ee0" id="1ee0" class="graf graf--pre graf-after--p">func findIndex(ofString valueToFind: String, in array: [String]) -&gt; Int? {</pre><pre name="db67" id="db67" class="graf graf--pre graf-after--pre">   for (index, value) in array.enumerated() {</pre><pre name="cdc4" id="cdc4" class="graf graf--pre graf-after--pre">      if value == valueToFind {</pre><pre name="e8d2" id="e8d2" class="graf graf--pre graf-after--pre">         return index</pre><pre name="c43a" id="c43a" class="graf graf--pre graf-after--pre">      }</pre><pre name="4e38" id="4e38" class="graf graf--pre graf-after--pre">   }</pre><pre name="07a6" id="07a6" class="graf graf--pre graf-after--pre">   return nil</pre><pre name="4f2e" id="4f2e" class="graf graf--pre graf-after--pre">}</pre><pre name="40d3" id="40d3" class="graf graf--pre graf-after--pre">let strings = [&quot;cat&quot;, &quot;dog&quot;, &quot;llama&quot;, &quot;parakeet&quot;, &quot;terrapin&quot;]</pre><pre name="143b" id="143b" class="graf graf--pre graf-after--pre">if let foundIndex = findIndex(ofString: &quot;llama&quot;, in: strings) {</pre><pre name="5f9b" id="5f9b" class="graf graf--pre graf-after--pre">   print(&quot;The index of llama is \(foundIndex)&quot;)</pre><pre name="5a1e" id="5a1e" class="graf graf--pre graf-after--pre">}</pre><pre name="0117" id="0117" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// Prints &quot;The index of llama is 2&quot;</em></pre><p name="7848" id="7848" class="graf graf--p graf-after--pre">generic 的例子</p><pre name="e250" id="e250" class="graf graf--pre graf-after--p">func findIndex&lt;T: Equatable&gt;(of valueToFind: T, in array:[T]) -&gt; Int? {</pre><pre name="ef84" id="ef84" class="graf graf--pre graf-after--pre">   for (index, value) in array.enumerated() {</pre><pre name="1155" id="1155" class="graf graf--pre graf-after--pre">      if value == valueToFind {</pre><pre name="d788" id="d788" class="graf graf--pre graf-after--pre">         return index  </pre><pre name="9764" id="9764" class="graf graf--pre graf-after--pre">      }</pre><pre name="0dbc" id="0dbc" class="graf graf--pre graf-after--pre">   }</pre><pre name="1115" id="1115" class="graf graf--pre graf-after--pre">   return nil</pre><pre name="61e8" id="61e8" class="graf graf--pre graf-after--pre">}</pre><pre name="94c7" id="94c7" class="graf graf--pre graf-after--pre">let doubleIndex = findIndex(of: 9.3, in: [3.14159, 0.1, 0.25])</pre><pre name="be66" id="be66" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// doubleIndex is an optional Int with no value, because 9.3 isn&#39;t in the array</em></pre><pre name="d1cb" id="d1cb" class="graf graf--pre graf-after--pre">let stringIndex = findIndex(of: &quot;Andrea&quot;, in: [&quot;Mike&quot;, &quot;Malcolm&quot;, &quot;Andrea&quot;])</pre><pre name="66fa" id="66fa" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// stringIndex is an optional Int containing a value of 2</em></pre><blockquote name="d527" id="d527" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">Associated Types</strong></blockquote><p name="1ccb" id="1ccb" class="graf graf--p graf-after--blockquote">在 protocol 裡利用 associatedtype 宣告型別代號。</p><blockquote name="d06b" id="d06b" class="graf graf--blockquote graf-after--p"><strong class="markup--strong markup--blockquote-strong">Associated Types in Action</strong></blockquote><p name="6d1f" id="6d1f" class="graf graf--p graf-after--blockquote">型別代號 Item 變成 Int。</p><pre name="25a5" id="25a5" class="graf graf--pre graf-after--p">protocol Container {</pre><pre name="4bdd" id="4bdd" class="graf graf--pre graf-after--pre">   associatedtype Item</pre><pre name="8877" id="8877" class="graf graf--pre graf-after--pre">   mutating func append(_ item: Item)</pre><pre name="f45b" id="f45b" class="graf graf--pre graf-after--pre">   var count: Int { get }</pre><pre name="14c2" id="14c2" class="graf graf--pre graf-after--pre">   subscript(i: Int) -&gt; Item { get }</pre><pre name="48a9" id="48a9" class="graf graf--pre graf-after--pre">}</pre><pre name="b001" id="b001" class="graf graf--pre graf-after--pre">struct IntStack: Container {</pre><pre name="a513" id="a513" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">   // original IntStack implementation</em></pre><pre name="18c0" id="18c0" class="graf graf--pre graf-after--pre">   var items = [Int]()</pre><pre name="6c49" id="6c49" class="graf graf--pre graf-after--pre">   mutating func push(_ item: Int) {</pre><pre name="7d95" id="7d95" class="graf graf--pre graf-after--pre">      items.append(item)</pre><pre name="4e9c" id="4e9c" class="graf graf--pre graf-after--pre">   }</pre><pre name="8659" id="8659" class="graf graf--pre graf-after--pre">   mutating func pop() -&gt; Int {</pre><pre name="574b" id="574b" class="graf graf--pre graf-after--pre">      return items.removeLast()</pre><pre name="9af9" id="9af9" class="graf graf--pre graf-after--pre">   }</pre><pre name="d469" id="d469" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">   // conformance to the Container protocol</em></pre><pre name="8b4a" id="8b4a" class="graf graf--pre graf-after--pre">   typealias Item = Int</pre><pre name="a961" id="a961" class="graf graf--pre graf-after--pre">   mutating func append(_ item: Int) {</pre><pre name="2b12" id="2b12" class="graf graf--pre graf-after--pre">      self.push(item)</pre><pre name="0d08" id="0d08" class="graf graf--pre graf-after--pre">   }</pre><pre name="0383" id="0383" class="graf graf--pre graf-after--pre">   var count: Int {</pre><pre name="0f74" id="0f74" class="graf graf--pre graf-after--pre">      return items.count</pre><pre name="b108" id="b108" class="graf graf--pre graf-after--pre">   }</pre><pre name="cbd2" id="cbd2" class="graf graf--pre graf-after--pre">   subscript(i: Int) -&gt; Int {</pre><pre name="a97a" id="a97a" class="graf graf--pre graf-after--pre">      return items[i]</pre><pre name="fff1" id="fff1" class="graf graf--pre graf-after--pre">   }</pre><pre name="47b5" id="47b5" class="graf graf--pre graf-after--pre">}</pre><p name="7182" id="7182" class="graf graf--p graf-after--pre">也可以省略 typealias Item = Int，因為 Swift 可以自動推理出 Item 是 Int。</p><p name="1a98" id="1a98" class="graf graf--p graf-after--p">Container 的型別代號 Item 等同於到時候型別代號 Element 的實際型別。</p><pre name="40e5" id="40e5" class="graf graf--pre graf-after--p">struct Stack&lt;Element&gt;: Container {</pre><pre name="553f" id="553f" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">   // original Stack&lt;Element&gt; implementation</em></pre><pre name="4750" id="4750" class="graf graf--pre graf-after--pre">   var items = [Element]()</pre><pre name="d382" id="d382" class="graf graf--pre graf-after--pre">   mutating func push(_ item: Element) {</pre><pre name="3ca2" id="3ca2" class="graf graf--pre graf-after--pre">      items.append(item)</pre><pre name="fcef" id="fcef" class="graf graf--pre graf-after--pre">   }</pre><pre name="ef03" id="ef03" class="graf graf--pre graf-after--pre">   mutating func pop() -&gt; Element {</pre><pre name="0313" id="0313" class="graf graf--pre graf-after--pre">      return items.removeLast()</pre><pre name="7c8e" id="7c8e" class="graf graf--pre graf-after--pre">   }</pre><pre name="15fc" id="15fc" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">   // conformance to the Container protocol</em></pre><pre name="fb29" id="fb29" class="graf graf--pre graf-after--pre">   mutating func append(_ item: Element) {</pre><pre name="3434" id="3434" class="graf graf--pre graf-after--pre">      self.push(item)</pre><pre name="4be3" id="4be3" class="graf graf--pre graf-after--pre">   }</pre><pre name="447d" id="447d" class="graf graf--pre graf-after--pre">   var count: Int {</pre><pre name="58a4" id="58a4" class="graf graf--pre graf-after--pre">      return items.count</pre><pre name="016f" id="016f" class="graf graf--pre graf-after--pre">   }</pre><pre name="e238" id="e238" class="graf graf--pre graf-after--pre">   subscript(i: Int) -&gt; Element {</pre><pre name="1039" id="1039" class="graf graf--pre graf-after--pre">      return items[i]</pre><pre name="1a70" id="1a70" class="graf graf--pre graf-after--pre">   }</pre><pre name="4915" id="4915" class="graf graf--pre graf-after--pre">}</pre><blockquote name="1cef" id="1cef" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">Extending an Existing Type to Specify an Associated Type</strong></blockquote><p name="343b" id="343b" class="graf graf--p graf-after--blockquote">Array 早已定義 append(_ item: Item)，var count: Int { get } &amp; subscript(i: Int) -&gt; Item { get }。</p><pre name="0a38" id="0a38" class="graf graf--pre graf-after--p">extension Array: Container {}</pre><blockquote name="8b45" id="8b45" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">Adding Constraints to an Associated Type</strong></blockquote><pre name="d90d" id="d90d" class="graf graf--pre graf-after--blockquote">protocol Container {</pre><pre name="c36a" id="c36a" class="graf graf--pre graf-after--pre">   associatedtype Item: Equatable</pre><pre name="a9b2" id="a9b2" class="graf graf--pre graf-after--pre">   mutating func append(_ item: Item)</pre><pre name="c192" id="c192" class="graf graf--pre graf-after--pre">   var count: Int { get }</pre><pre name="49db" id="49db" class="graf graf--pre graf-after--pre">   subscript(i: Int) -&gt; Item { get }</pre><pre name="ec65" id="ec65" class="graf graf--pre graf-after--pre">}</pre><blockquote name="71dd" id="71dd" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">Using a Protocol in Its Associated Type’s Constraints</strong></blockquote><pre name="e584" id="e584" class="graf graf--pre graf-after--blockquote">protocol SuffixableContainer: Container {</pre><pre name="261e" id="261e" class="graf graf--pre graf-after--pre">   associatedtype Suffix: SuffixableContainer where Suffix.Item == Item</pre><pre name="5502" id="5502" class="graf graf--pre graf-after--pre">   func suffix(_ size: Int) -&gt; Suffix</pre><pre name="49c8" id="49c8" class="graf graf--pre graf-after--pre">}</pre><pre name="aa0b" id="aa0b" class="graf graf--pre graf-after--pre">extension Stack: SuffixableContainer {</pre><pre name="f988" id="f988" class="graf graf--pre graf-after--pre">   func suffix(_ size: Int) -&gt; Stack {</pre><pre name="ea6d" id="ea6d" class="graf graf--pre graf-after--pre">      var result = Stack()</pre><pre name="a5ce" id="a5ce" class="graf graf--pre graf-after--pre">      for index in (count-size)..&lt;count {</pre><pre name="fa21" id="fa21" class="graf graf--pre graf-after--pre">         result.append(self[index])</pre><pre name="53b5" id="53b5" class="graf graf--pre graf-after--pre">      }</pre><pre name="2bae" id="2bae" class="graf graf--pre graf-after--pre">      return result</pre><pre name="ff56" id="ff56" class="graf graf--pre graf-after--pre">   }</pre><pre name="5162" id="5162" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">   // Inferred that Suffix is Stack.</em></pre><pre name="50d4" id="50d4" class="graf graf--pre graf-after--pre">}</pre><pre name="74b4" id="74b4" class="graf graf--pre graf-after--pre">extension IntStack: SuffixableContainer {</pre><pre name="038b" id="038b" class="graf graf--pre graf-after--pre">   func suffix(_ size: Int) -&gt; Stack&lt;Int&gt; {</pre><pre name="737e" id="737e" class="graf graf--pre graf-after--pre">      var result = Stack&lt;Int&gt;()</pre><pre name="b590" id="b590" class="graf graf--pre graf-after--pre">      for index in (count-size)..&lt;count {</pre><pre name="d6d4" id="d6d4" class="graf graf--pre graf-after--pre">         result.append(self[index])</pre><pre name="c7e5" id="c7e5" class="graf graf--pre graf-after--pre">      }</pre><pre name="a1f5" id="a1f5" class="graf graf--pre graf-after--pre">      return result</pre><pre name="1f86" id="1f86" class="graf graf--pre graf-after--pre">   }</pre><pre name="5944" id="5944" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">   // Inferred that Suffix is Stack&lt;Int&gt;.</em></pre><pre name="0f1c" id="0f1c" class="graf graf--pre graf-after--pre">}</pre><blockquote name="f52d" id="f52d" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">Generic Where Clauses</strong></blockquote><p name="9686" id="9686" class="graf graf--p graf-after--blockquote">利用 where 指定 generic 型別的條件。</p><pre name="2c07" id="2c07" class="graf graf--pre graf-after--p">func allItemsMatch&lt;C1: Container, C2: Container&gt;</pre><pre name="3d88" id="3d88" class="graf graf--pre graf-after--pre">(_ someContainer: C1, _ anotherContainer: C2) -&gt; Bool</pre><pre name="f893" id="f893" class="graf graf--pre graf-after--pre">where C1.Item == C2.Item, C1.Item: Equatable {</pre><pre name="d75a" id="d75a" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">   // Check that both containers contain the same number of items.</em></pre><pre name="277f" id="277f" class="graf graf--pre graf-after--pre">   if someContainer.count != anotherContainer.count {</pre><pre name="f450" id="f450" class="graf graf--pre graf-after--pre">      return false</pre><pre name="bde4" id="bde4" class="graf graf--pre graf-after--pre">   }</pre><pre name="7fc8" id="7fc8" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">   // Check each pair of items to see if they&#39;re equivalent.</em></pre><pre name="eb67" id="eb67" class="graf graf--pre graf-after--pre">   for i in 0..&lt;someContainer.count {</pre><pre name="9343" id="9343" class="graf graf--pre graf-after--pre">      if someContainer[i] != anotherContainer[i] {</pre><pre name="4d3f" id="4d3f" class="graf graf--pre graf-after--pre">         return false</pre><pre name="0418" id="0418" class="graf graf--pre graf-after--pre">      }</pre><pre name="54c8" id="54c8" class="graf graf--pre graf-after--pre">   }</pre><pre name="3202" id="3202" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">   // All items match, so return true.</em></pre><pre name="e399" id="e399" class="graf graf--pre graf-after--pre">   return true</pre><pre name="14c9" id="14c9" class="graf graf--pre graf-after--pre">}</pre><pre name="420b" id="420b" class="graf graf--pre graf-after--pre">var stackOfStrings = Stack&lt;String&gt;()</pre><pre name="ec38" id="ec38" class="graf graf--pre graf-after--pre">stackOfStrings.push(&quot;uno&quot;)</pre><pre name="0528" id="0528" class="graf graf--pre graf-after--pre">stackOfStrings.push(&quot;dos&quot;)</pre><pre name="806e" id="806e" class="graf graf--pre graf-after--pre">stackOfStrings.push(&quot;tres&quot;)</pre><pre name="07c0" id="07c0" class="graf graf--pre graf-after--pre">var arrayOfStrings = [&quot;uno&quot;, &quot;dos&quot;, &quot;tres&quot;]</pre><pre name="7f51" id="7f51" class="graf graf--pre graf-after--pre">if allItemsMatch(stackOfStrings, arrayOfStrings) {</pre><pre name="f1d1" id="f1d1" class="graf graf--pre graf-after--pre">   print(&quot;All items match.&quot;)</pre><pre name="365e" id="365e" class="graf graf--pre graf-after--pre">} else {</pre><pre name="f3c8" id="f3c8" class="graf graf--pre graf-after--pre">   print(&quot;Not all items match.&quot;)</pre><pre name="3f6b" id="3f6b" class="graf graf--pre graf-after--pre">}</pre><pre name="6482" id="6482" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// Prints &quot;All items match.&quot;</em></pre><blockquote name="e57e" id="e57e" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">Extensions with a Generic Where Clause</strong></blockquote><p name="910c" id="910c" class="graf graf--p graf-after--blockquote">當 Element 遵從 Equatable 時，增添 function isTop(_)。</p><pre name="3eff" id="3eff" class="graf graf--pre graf-after--p">extension Stack where Element: Equatable {</pre><pre name="1c5a" id="1c5a" class="graf graf--pre graf-after--pre">   func isTop(_ item: Element) -&gt; Bool {</pre><pre name="78a4" id="78a4" class="graf graf--pre graf-after--pre">      guard let topItem = items.last else {</pre><pre name="8d4d" id="8d4d" class="graf graf--pre graf-after--pre">         return false</pre><pre name="8207" id="8207" class="graf graf--pre graf-after--pre">      }</pre><pre name="69f1" id="69f1" class="graf graf--pre graf-after--pre">      return topItem == item</pre><pre name="2943" id="2943" class="graf graf--pre graf-after--pre">   }</pre><pre name="336b" id="336b" class="graf graf--pre graf-after--pre">}</pre><pre name="d17c" id="d17c" class="graf graf--pre graf-after--pre">if stackOfStrings.isTop(&quot;tres&quot;) {</pre><pre name="25c4" id="25c4" class="graf graf--pre graf-after--pre">   print(&quot;Top element is tres.&quot;) </pre><pre name="9a4f" id="9a4f" class="graf graf--pre graf-after--pre">} else {</pre><pre name="07e6" id="07e6" class="graf graf--pre graf-after--pre">   print(&quot;Top element is something else.&quot;)</pre><pre name="a018" id="a018" class="graf graf--pre graf-after--pre">}</pre><pre name="554c" id="554c" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// Prints &quot;Top element is tres.&quot;</em></pre><p name="55a4" id="55a4" class="graf graf--p graf-after--pre">NotEquatable 沒有遵從 Equatable，所以不能呼叫 isTop(_)。</p><pre name="253f" id="253f" class="graf graf--pre graf-after--p">struct NotEquatable { }</pre><pre name="f8c3" id="f8c3" class="graf graf--pre graf-after--pre">var notEquatableStack = Stack&lt;NotEquatable&gt;()</pre><pre name="578f" id="578f" class="graf graf--pre graf-after--pre">let notEquatableValue = NotEquatable()</pre><pre name="5d06" id="5d06" class="graf graf--pre graf-after--pre">notEquatableStack.push(notEquatableValue)</pre><pre name="9324" id="9324" class="graf graf--pre graf-after--pre">notEquatableStack.isTop(notEquatableValue)  <em class="markup--em markup--pre-em">// Error</em></pre><p name="faaa" id="faaa" class="graf graf--p graf-after--pre">當 Item 型別遵從 Equatable 時，增添 function startsWith(_)。</p><pre name="eb95" id="eb95" class="graf graf--pre graf-after--p">extension Container where Item: Equatable {</pre><pre name="02b7" id="02b7" class="graf graf--pre graf-after--pre">   func startsWith(_ item: Item) -&gt; Bool {</pre><pre name="e9ea" id="e9ea" class="graf graf--pre graf-after--pre">      return count &gt;= 1 &amp;&amp; self[0] == item</pre><pre name="f6ca" id="f6ca" class="graf graf--pre graf-after--pre">   }</pre><pre name="8757" id="8757" class="graf graf--pre graf-after--pre">}</pre><pre name="0296" id="0296" class="graf graf--pre graf-after--pre">if [9, 9, 9].startsWith(42) {</pre><pre name="4a43" id="4a43" class="graf graf--pre graf-after--pre">   print(&quot;Starts with 42.&quot;)</pre><pre name="e1da" id="e1da" class="graf graf--pre graf-after--pre">} else {</pre><pre name="5234" id="5234" class="graf graf--pre graf-after--pre">   print(&quot;Starts with something else.&quot;)</pre><pre name="12cc" id="12cc" class="graf graf--pre graf-after--pre">}</pre><pre name="53d7" id="53d7" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// Prints &quot;Starts with something else.&quot;</em></pre><p name="7037" id="7037" class="graf graf--p graf-after--pre">當 Item 的型別是 Double 時，增添 function average()。</p><pre name="5a81" id="5a81" class="graf graf--pre graf-after--p">extension Container where Item == Double {</pre><pre name="64cb" id="64cb" class="graf graf--pre graf-after--pre">   func average() -&gt; Double {</pre><pre name="7b3b" id="7b3b" class="graf graf--pre graf-after--pre">      var sum = 0.0</pre><pre name="00ac" id="00ac" class="graf graf--pre graf-after--pre">      for index in 0..&lt;count {</pre><pre name="e244" id="e244" class="graf graf--pre graf-after--pre">         sum += self[index]</pre><pre name="0014" id="0014" class="graf graf--pre graf-after--pre">      }</pre><pre name="350e" id="350e" class="graf graf--pre graf-after--pre">      return sum / Double(count)</pre><pre name="ab7b" id="ab7b" class="graf graf--pre graf-after--pre">   }</pre><pre name="60d8" id="60d8" class="graf graf--pre graf-after--pre">}</pre><pre name="8df6" id="8df6" class="graf graf--pre graf-after--pre">print([1260.0, 1200.0, 98.6, 37.0].average())</pre><pre name="209d" id="209d" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// Prints &quot;648.9&quot;</em></pre><blockquote name="8626" id="8626" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">Associated Types with a Generic Where Clause</strong></blockquote><p name="ccd1" id="ccd1" class="graf graf--p graf-after--blockquote">宣告 associatedtype 時，可搭配 where 指定條件。</p><pre name="b6c5" id="b6c5" class="graf graf--pre graf-after--p">protocol Container {</pre><pre name="1bc9" id="1bc9" class="graf graf--pre graf-after--pre">   associatedtype Item</pre><pre name="e10d" id="e10d" class="graf graf--pre graf-after--pre">   mutating func append(_ item: Item)</pre><pre name="c4a3" id="c4a3" class="graf graf--pre graf-after--pre">   var count: Int { get }</pre><pre name="5cb0" id="5cb0" class="graf graf--pre graf-after--pre">   subscript(i: Int) -&gt; Item { get }</pre><pre name="995e" id="995e" class="graf graf--pre graf-after--pre">   associatedtype Iterator: IteratorProtocol where Iterator.Element == Item</pre><pre name="9302" id="9302" class="graf graf--pre graf-after--pre">   func makeIterator() -&gt; Iterator</pre><pre name="6fdd" id="6fdd" class="graf graf--pre graf-after--pre">}</pre><p name="24c3" id="24c3" class="graf graf--p graf-after--pre">指定 Item 要遵從 Comparable。</p><pre name="b3d4" id="b3d4" class="graf graf--pre graf-after--p">protocol ComparableContainer: Container where Item: Comparable { }</pre><blockquote name="0162" id="0162" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">Generic Subscripts</strong></blockquote><pre name="0f39" id="0f39" class="graf graf--pre graf-after--blockquote">extension Container {</pre><pre name="c778" id="c778" class="graf graf--pre graf-after--pre">   subscript&lt;Indices: Sequence&gt;(indices: Indices) -&gt; [Item]</pre><pre name="b9de" id="b9de" class="graf graf--pre graf-after--pre">where Indices.Iterator.Element == Int {</pre><pre name="14b6" id="14b6" class="graf graf--pre graf-after--pre">      var result = [Item]()</pre><pre name="64a9" id="64a9" class="graf graf--pre graf-after--pre">      for index in indices {</pre><pre name="1d47" id="1d47" class="graf graf--pre graf-after--pre">         result.append(self[index])</pre><pre name="4dfc" id="4dfc" class="graf graf--pre graf-after--pre">      }</pre><pre name="b856" id="b856" class="graf graf--pre graf-after--pre">      return result</pre><pre name="1b7e" id="1b7e" class="graf graf--pre graf-after--pre">   }</pre><pre name="591d" id="591d" class="graf graf--pre graf-after--pre">}</pre><p name="23b2" id="23b2" class="graf graf--p graf-after--pre graf--trailing">Indices 遵從 Sequence，Sequence 裡宣告 associatedtype Iterator : IteratorProtocol，而 IteratorProtocol 裡宣告 associatedtype Element，因此可以寫 Indices.Iterator.Element。</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@apppeterpan" class="p-author h-card">彼得潘的 iOS App Neverland</a> on <a href="https://medium.com/p/c420e4571fcb"><time class="dt-published" datetime="2018-09-25T04:03:01.818Z">September 25, 2018</time></a>.</p><p><a href="https://medium.com/@apppeterpan/generics-%E7%A8%8B%E5%BC%8F%E7%AF%84%E4%BE%8B-apples-the-swift-programming-language-c420e4571fcb" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on November 16, 2025.</p></footer></article></body></html>