<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>利用 performBatchUpdates 更新 cell 高度 &amp; 實現點選 cell 展開 / 收縮下方內容(expand / collapse)</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">利用 performBatchUpdates 更新 cell 高度 &amp; 實現點選 cell 展開 / 收縮下方內容(expand / collapse)</h1>
</header>
<section data-field="subtitle" class="p-summary">
當我們用 table view 或 collection view 顯示 App 畫面時，有時我們會想更新 cell 的高度，比方以下兩種情境:
</section>
<section data-field="body" class="e-content">
<section name="b5d9" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="0629" id="0629" class="graf graf--h3 graf--leading graf--title">利用 performBatchUpdates 更新 cell 高度 &amp; 實現點選 cell 展開 / 收縮下方內容(expand / collapse)</h3><p name="2627" id="2627" class="graf graf--p graf-after--h3">當我們用 table view 或 collection view 顯示 App 畫面時，有時我們會想更新 cell 的高度，比方以下兩種情境:</p><ul class="postList"><li name="f1bf" id="f1bf" class="graf graf--li graf-after--p">cell 高度隨 cell 顯示的內容調整，比方 cell 因文字從一行變十行而長高。</li><li name="8561" id="8561" class="graf graf--li graf-after--li">點選 cell 展開 / 收縮下方內容，比方以下 Apple 的範例，用 cell 高度是否為 0 控制 date picker 的顯示。</li></ul><figure name="9e7c" id="9e7c" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*M3Kn9JVEOeHbijBVepB1gA.png" data-width="1276" data-height="1306" src="https://cdn-images-1.medium.com/max/800/1*M3Kn9JVEOeHbijBVepB1gA.png"></figure><p name="75c6" id="75c6" class="graf graf--p graf-after--figure">接下來我們將介紹如何利用 performBatchUpdates 更新 cell 高度 &amp; 實現點選 cell 展開 / 收縮的功能。</p><p name="ea2f" id="ea2f" class="graf graf--p graf-after--p">ps: 從 iOS 16 開始有更簡單的方法，相關說明可參考以下連結。</p><div name="57be" id="57be" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E8%87%AA%E5%8B%95%E6%9B%B4%E6%96%B0%E9%AB%98%E5%BA%A6%E7%9A%84-cell-ios-16-uikit-%E6%96%B0%E5%8A%9F%E8%83%BD-c2de7adfe34c" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E8%87%AA%E5%8B%95%E6%9B%B4%E6%96%B0%E9%AB%98%E5%BA%A6%E7%9A%84-cell-ios-16-uikit-%E6%96%B0%E5%8A%9F%E8%83%BD-c2de7adfe34c" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E8%87%AA%E5%8B%95%E6%9B%B4%E6%96%B0%E9%AB%98%E5%BA%A6%E7%9A%84-cell-ios-16-uikit-%E6%96%B0%E5%8A%9F%E8%83%BD-c2de7adfe34c"><strong class="markup--strong markup--mixtapeEmbed-strong">自動更新高度的 cell — iOS 16 UIKit 新功能</strong><br><em class="markup--em markup--mixtapeEmbed-em">從 iOS 16 開始，table view &amp; collection view cell 變得更強大了，cell 在內容或條件改變時會自動更新高度。</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E8%87%AA%E5%8B%95%E6%9B%B4%E6%96%B0%E9%AB%98%E5%BA%A6%E7%9A%84-cell-ios-16-uikit-%E6%96%B0%E5%8A%9F%E8%83%BD-c2de7adfe34c" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="a03f4cf13800226759f80a99cfe853d4" data-thumbnail-img-id="1*FC_XV9c5gNQtcAayVrfu9g.png" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*FC_XV9c5gNQtcAayVrfu9g.png);"></a></div><h3 name="2af9" id="2af9" class="graf graf--h3 graf-after--mixtapeEmbed">cell 顯示的內容改變時更新 cell 高度</h3><h4 name="185d" id="185d" class="graf graf--h4 graf-after--h3">目標</h4><p name="beb6" id="beb6" class="graf graf--p graf-after--h4">點選顯示歌詞，cell 今天長高了，因為它的內容變成華仔感人的歌詞。</p><figure name="f777" id="f777" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*GJe-a_YJ2lig2U_9Q6JKzg.png" data-width="1276" data-height="1306" src="https://cdn-images-1.medium.com/max/800/1*GJe-a_YJ2lig2U_9Q6JKzg.png"></figure><h4 name="22e0" id="22e0" class="graf graf--h4 graf-after--figure"><strong class="markup--strong markup--h4-strong">storyboard 畫面設計</strong></h4><ul class="postList"><li name="4879" id="4879" class="graf graf--li graf-after--h4">加入 navigation controller &amp; table view controller</li><li name="a4d8" id="a4d8" class="graf graf--li graf-after--li">cell 裡加入 label，設定 label 跟 content view 邊界間距 10 的 auto layout 條件，label 的 lines 設為 0。</li><li name="146a" id="146a" class="graf graf--li graf-after--li">navigation bar 的右邊加入 bar button item，文字設為顯示歌詞。</li></ul><figure name="42ec" id="42ec" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*gm5ep7aaIbmztF1fJGLU8g.png" data-width="1738" data-height="1182" src="https://cdn-images-1.medium.com/max/800/1*gm5ep7aaIbmztF1fJGLU8g.png"></figure><h4 name="8ffe" id="8ffe" class="graf graf--h4 graf-after--figure">設定 table view controller &amp; table view cell</h4><ul class="postList"><li name="0a1e" id="0a1e" class="graf graf--li graf-after--h4">新增繼承 UITableViewController 的 LyricsTableViewController。</li><li name="935f" id="935f" class="graf graf--li graf-after--li">新增繼承 UITableViewCell 的 LyricsTableViewCell。</li><li name="e761" id="e761" class="graf graf--li graf-after--li">將 storyboard 裡的 view controller 類別設為 LyricsTableViewController。</li><li name="0e0f" id="0e0f" class="graf graf--li graf-after--li">將 cell 的類別 &amp; Reuse ID 設為 LyricsTableViewCell。</li><li name="3347" id="3347" class="graf graf--li graf-after--li">連結 cell 裡 label 的 outlet 到 LyricsTableViewCell。</li></ul><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="cc72" id="cc72" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LyricsTableViewCell</span>: <span class="hljs-title class_">UITableViewCell</span> {<br />    <span class="hljs-keyword">@IBOutlet</span> <span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> label: <span class="hljs-type">UILabel</span>!</span></pre><ul class="postList"><li name="d32a" id="d32a" class="graf graf--li graf-after--pre">連結顯示歌詞 button 的 action 到 LyricsTableViewController。</li></ul><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="9d4f" id="9d4f" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content"><span class="hljs-keyword">@IBAction</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">showLyrics</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">sender</span>: <span class="hljs-keyword">Any</span>) {<br />        <br />}</span></pre><figure name="37dd" id="37dd" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*0EEYqw9q-BkeSQvVU31fqQ.png" data-width="1630" data-height="1136" src="https://cdn-images-1.medium.com/max/800/1*0EEYqw9q-BkeSQvVU31fqQ.png"></figure><h4 name="6137" id="6137" class="graf graf--h4 graf-after--figure">定義顯示表格的 LyricsTableViewController</h4><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="b564" id="b564" class="graf graf--pre graf-after--h4 graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> UIKit<br /><br /><span class="hljs-keyword">class</span> <span class="hljs-title class_">LyricsTableViewController</span>: <span class="hljs-title class_">UITableViewController</span> {  <br />    <br />    <span class="hljs-keyword">var</span> lyrics <span class="hljs-operator">=</span> [<br />        <span class="hljs-string">&quot;今天&quot;</span>,<br />        <span class="hljs-string">&quot;昨天&quot;</span><br />    ]<br />    <br />    <span class="hljs-keyword">@IBAction</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">showLyrics</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">sender</span>: <span class="hljs-keyword">Any</span>) {<br />        <br />    }<br />    <br />    <br />    <span class="hljs-comment">// MARK: - Table view data source</span><br />    <br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">numberOfSections</span>(<span class="hljs-params">in</span> <span class="hljs-params">tableView</span>: <span class="hljs-type">UITableView</span>) -&gt; <span class="hljs-type">Int</span> {<br />        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br />    }<br />    <br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">tableView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">tableView</span>: <span class="hljs-type">UITableView</span>, <span class="hljs-params">numberOfRowsInSection</span> <span class="hljs-params">section</span>: <span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">Int</span> {<br />        <span class="hljs-keyword">return</span> lyrics.count<br />    }<br />    <br />    <br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">tableView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">tableView</span>: <span class="hljs-type">UITableView</span>, <span class="hljs-params">cellForRowAt</span> <span class="hljs-params">indexPath</span>: <span class="hljs-type">IndexPath</span>) -&gt; <span class="hljs-type">UITableViewCell</span> {<br />        <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> cell <span class="hljs-operator">=</span> tableView.dequeueReusableCell(withIdentifier: <span class="hljs-string">&quot;<span class="hljs-subst">\(LyricsTableViewCell.<span class="hljs-keyword">self</span>)</span>&quot;</span>, for: indexPath) <span class="hljs-keyword">as?</span> <span class="hljs-type">LyricsTableViewCell</span> <span class="hljs-keyword">else</span> {<br />            <span class="hljs-keyword">return</span> <span class="hljs-type">UITableViewCell</span>()<br />        }<br />        <br />        cell.label.text <span class="hljs-operator">=</span> lyrics[indexPath.row]<br />        <span class="hljs-keyword">return</span> cell<br />    }<br />   <br />}</span></pre><h4 name="5157" id="5157" class="graf graf--h4 graf-after--pre">點選 button 顯示歌詞，更新 cell 高度</h4><p name="de89" id="de89" class="graf graf--p graf-after--h4">有兩種做法。</p><ul class="postList"><li name="cdda" id="cdda" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">方法 1: 使用 reloadRows</strong></li></ul><p name="a033" id="a033" class="graf graf--p graf-after--li">修改 array 的內容，然後呼叫 reloadRows 更新表格。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="e553" id="e553" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">@IBAction</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">showLyrics</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">sender</span>: <span class="hljs-keyword">Any</span>) {<br />        lyrics[<span class="hljs-number">0</span>] <span class="hljs-operator">=</span>  <span class="hljs-string">&quot;&quot;&quot;<br />               等了好久 終於等到今天<br />               夢了好久 終於把夢實現<br />               前途漫漫任我闖 幸虧還有你在身旁<br />               &quot;&quot;&quot;</span><br />        tableView.reloadRows(at: [<span class="hljs-type">IndexPath</span>(row: <span class="hljs-number">0</span>, section: <span class="hljs-number">0</span>)], with: .automatic)<br />}</span></pre><ul class="postList"><li name="952b" id="952b" class="graf graf--li graf-after--pre"><strong class="markup--strong markup--li-strong">方法 2: 使用 performBatchUpdates</strong></li></ul><p name="8b54" id="8b54" class="graf graf--p graf-after--li">此方法比較麻煩，不過本篇的主角是 performBatchUpdates，因此我們還是看一下 performBatchUpdates 的做法。修改 array 的資料，取得第一個 cell，修改它的 label 內容，然後呼叫 performBatchUpdate 觸發表格更新高度。值得注意的，當我們呼叫 performBatchUpdate 時，決定 cell 數量的 numberOfSections(in:) &amp; tableView(_:numberOfRowsInSection:) 會被觸發，但是 tableView(_:cellForRowAt:) 不會被觸發。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="a437" id="a437" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">@IBAction</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">showLyrics</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">sender</span>: <span class="hljs-keyword">Any</span>) {<br />        lyrics[<span class="hljs-number">0</span>] <span class="hljs-operator">=</span>  <span class="hljs-string">&quot;&quot;&quot;<br />               等了好久 終於等到今天<br />               夢了好久 終於把夢實現<br />               前途漫漫任我闖 幸虧還有你在身旁<br />               &quot;&quot;&quot;</span><br />        <span class="hljs-keyword">let</span> indexPath <span class="hljs-operator">=</span> <span class="hljs-type">IndexPath</span>(row: <span class="hljs-number">0</span>, section: <span class="hljs-number">0</span>)<br />        <span class="hljs-keyword">let</span> cell <span class="hljs-operator">=</span> tableView.cellForRow(at: indexPath) <span class="hljs-keyword">as?</span> <span class="hljs-type">LyricsTableViewCell</span><br />        cell<span class="hljs-operator">?</span>.label.text <span class="hljs-operator">=</span> lyrics[<span class="hljs-number">0</span>]<br />        tableView.performBatchUpdates(<span class="hljs-literal">nil</span>)<br />}</span></pre><p name="4a09" id="4a09" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">結果</strong></p><p name="75c5" id="75c5" class="graf graf--p graf-after--p">點選今天，cell 長高顯示歌詞等了好久 …在身旁。</p><figure name="72d0" id="72d0" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*GJe-a_YJ2lig2U_9Q6JKzg.png" data-width="1276" data-height="1306" src="https://cdn-images-1.medium.com/max/800/1*GJe-a_YJ2lig2U_9Q6JKzg.png"></figure><p name="a22e" id="a22e" class="graf graf--p graf-after--figure">ps:</p><p name="89d0" id="89d0" class="graf graf--p graf-after--p">若是只修改 label 的文字內容，沒有呼叫 performBatchUpdate，將如下圖所示，cell 的高度不會更新。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="16fd" id="16fd" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">@IBAction</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">showLyrics</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">sender</span>: <span class="hljs-keyword">Any</span>) {<br />        lyrics[<span class="hljs-number">0</span>] <span class="hljs-operator">=</span>  <span class="hljs-string">&quot;&quot;&quot;<br />               等了好久 終於等到今天<br />               夢了好久 終於把夢實現<br />               前途漫漫任我闖 幸虧還有你在身旁<br />               &quot;&quot;&quot;</span><br />        <span class="hljs-keyword">let</span> indexPath <span class="hljs-operator">=</span> <span class="hljs-type">IndexPath</span>(row: <span class="hljs-number">0</span>, section: <span class="hljs-number">0</span>)<br />        <span class="hljs-keyword">let</span> cell <span class="hljs-operator">=</span> tableView.cellForRow(at: indexPath) <span class="hljs-keyword">as?</span> <span class="hljs-type">LyricsTableViewCell</span><br />        cell<span class="hljs-operator">?</span>.label.text <span class="hljs-operator">=</span> lyrics[<span class="hljs-number">0</span>]<br />}</span></pre><figure name="adf9" id="adf9" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*QNgdpv-8Sqlm93DdtHX2NQ.png" data-width="1170" data-height="2532" src="https://cdn-images-1.medium.com/max/800/1*QNgdpv-8Sqlm93DdtHX2NQ.png"></figure><h3 name="0dcc" id="0dcc" class="graf graf--h3 graf-after--figure">點選 cell 展開 / 收縮下方內容</h3><h4 name="f4fe" id="f4fe" class="graf graf--h4 graf-after--h3">目標</h4><p name="a45f" id="a45f" class="graf graf--p graf-after--h4">點選 Birthday cell，展開 / 收縮下方的 date picker。</p><figure name="8502" id="8502" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*6XErxYFyyrPjIXMr3JDbeg.png" data-width="1238" data-height="1290" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*6XErxYFyyrPjIXMr3JDbeg.png"></figure><h4 name="b474" id="b474" class="graf graf--h4 graf-after--figure">storyboard 畫面設計</h4><ul class="postList"><li name="1fa9" id="1fa9" class="graf graf--li graf-after--h4">在 storyboard 加入 table view controller。</li><li name="a9de" id="a9de" class="graf graf--li graf-after--li">新增繼承 UITableViewController 的 BirthdayTableViewController。</li><li name="809d" id="809d" class="graf graf--li graf-after--li">將 storyboard 裡的 view controller 類別設為 BirthdayTableViewController。</li><li name="02b8" id="02b8" class="graf graf--li graf-after--li">將 table view 的 content 設為 Static Cells，第一個 cell 顯示 label，第二個 cell 顯示 date picker，畫面和 auto layout 條件設定如下。</li></ul><figure name="8455" id="8455" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*5Tx_gY9etdm8T0W0ukm1mw.png" data-width="1208" data-height="1152" src="https://cdn-images-1.medium.com/max/800/1*5Tx_gY9etdm8T0W0ukm1mw.png"></figure><ul class="postList"><li name="8e0a" id="8e0a" class="graf graf--li graf-after--figure">連結 cell 裡 label 的 outlet 到 BirthdayTableViewController。</li></ul><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="e5f4" id="e5f4" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BirthdayTableViewController</span>: <span class="hljs-title class_">UITableViewController</span> {<br />    <br />    <span class="hljs-keyword">@IBOutlet</span> <span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> birthdayLabel: <span class="hljs-type">UILabel</span>!</span></pre><h4 name="e681" id="e681" class="graf graf--h4 graf-after--pre">畫面出現時顯示今天日期</h4><p name="7752" id="7752" class="graf graf--p graf-after--h4">在 viewDidLoad 設定 birthdayLabel 顯示今天日期。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="e85b" id="e85b" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BirthdayTableViewController</span>: <span class="hljs-title class_">UITableViewController</span> {<br />    <br />    <span class="hljs-keyword">@IBOutlet</span> <span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> birthdayLabel: <span class="hljs-type">UILabel</span>!<br /><br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {<br />        <span class="hljs-keyword">super</span>.viewDidLoad()<br />       <br />        birthdayLabel.text <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Birthday: <span class="hljs-subst">\(Date.now.formatted(date: .numeric, time: .omitted))</span>&quot;</span><br />    }<br />}</span></pre><figure name="8c7d" id="8c7d" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*jmR8mAJZAGnAF7vYE2vHHQ.png" data-width="1170" data-height="2532" src="https://cdn-images-1.medium.com/max/800/1*jmR8mAJZAGnAF7vYE2vHHQ.png"></figure><h4 name="9d76" id="9d76" class="graf graf--h4 graf-after--figure"><strong class="markup--strong markup--h4-strong">定義 cell 對應的 IndexPath</strong></h4><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="f30f" id="f30f" class="graf graf--pre graf-after--h4 graf--preV2"><span class="pre--content"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BirthdayTableViewController</span>: <span class="hljs-title class_">UITableViewController</span> {<br /><br />    <span class="hljs-keyword">let</span> birthdayLabelCellIndexPath <span class="hljs-operator">=</span> <span class="hljs-type">IndexPath</span>(row: <span class="hljs-number">0</span>, section: <span class="hljs-number">0</span>)<br />    <span class="hljs-keyword">let</span> birthdayPickerCellIndexPath <span class="hljs-operator">=</span> <span class="hljs-type">IndexPath</span>(row: <span class="hljs-number">1</span>, section: <span class="hljs-number">0</span>)</span></pre><h4 name="fc64" id="fc64" class="graf graf--h4 graf-after--pre">點選 birthday cell，展開 / 收縮下方的 date picker</h4><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="a98b" id="a98b" class="graf graf--pre graf-after--h4 graf--preV2"><span class="pre--content"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BirthdayTableViewController</span>: <span class="hljs-title class_">UITableViewController</span> {<br />    <span class="hljs-keyword">let</span> birthdayLabelCellIndexPath <span class="hljs-operator">=</span> <span class="hljs-type">IndexPath</span>(row: <span class="hljs-number">0</span>, section: <span class="hljs-number">0</span>)<br />    <span class="hljs-keyword">let</span> birthdayPickerCellIndexPath <span class="hljs-operator">=</span> <span class="hljs-type">IndexPath</span>(row: <span class="hljs-number">1</span>, section: <span class="hljs-number">0</span>)<br />    <span class="hljs-keyword">@IBOutlet</span> <span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> birthdayLabel: <span class="hljs-type">UILabel</span>!<br />    <br />    <span class="hljs-keyword">var</span> showBirthdayPicker <span class="hljs-operator">=</span> <span class="hljs-literal">false</span> {<br />        <span class="hljs-keyword">didSet</span> {<br />            tableView.performBatchUpdates(<span class="hljs-literal">nil</span>)<br />        }<br />    }<br />    <br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {<br />        <span class="hljs-keyword">super</span>.viewDidLoad()<br />        <br />        birthdayLabel.text <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Birthday: <span class="hljs-subst">\(Date.now.formatted(date: .numeric, time: .omitted))</span>&quot;</span><br />    }<br />    <br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">tableView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">tableView</span>: <span class="hljs-type">UITableView</span>, <span class="hljs-params">heightForRowAt</span> <span class="hljs-params">indexPath</span>: <span class="hljs-type">IndexPath</span>) -&gt; <span class="hljs-type">CGFloat</span> {<br />        <br />        <span class="hljs-keyword">if</span> indexPath <span class="hljs-operator">==</span> birthdayPickerCellIndexPath,<br />           showBirthdayPicker <span class="hljs-operator">==</span> <span class="hljs-literal">false</span> {<br />            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br />        } <span class="hljs-keyword">else</span> {<br />            <span class="hljs-keyword">return</span> <span class="hljs-type">UITableView</span>.automaticDimension<br />        }<br />    }<br />    <br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">tableView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">tableView</span>: <span class="hljs-type">UITableView</span>, <span class="hljs-params">didSelectRowAt</span> <span class="hljs-params">indexPath</span>: <span class="hljs-type">IndexPath</span>) {<br />        tableView.deselectRow(at: indexPath, animated: <span class="hljs-literal">true</span>)<br />        <span class="hljs-keyword">if</span> indexPath <span class="hljs-operator">==</span> birthdayLabelCellIndexPath {<br />            showBirthdayPicker.toggle()<br />        }<br />    }    <br />}</span></pre><p name="b5c3" id="b5c3" class="graf graf--p graf-after--pre">說明</p><ul class="postList"><li name="ee84" id="ee84" class="graf graf--li graf-after--p">以 showBirthdayPicker 控制是否顯示 date picker。當 showBirthdayPicker 為 false 時，在 tableView(_:heightForRowAt:) 將 date picker cell 的高度設為 0。當 showBirthdayPicker 改變時必須呼叫 performBatchUpdates，如此才能觸發 cell 高度更新。</li></ul><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="0b02" id="0b02" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content"><span class="hljs-keyword">var</span> showBirthdayPicker <span class="hljs-operator">=</span> <span class="hljs-literal">false</span> {<br />        <span class="hljs-keyword">didSet</span> {<br />            tableView.performBatchUpdates(<span class="hljs-literal">nil</span>)<br />        }<br />}<br /><br /><span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">tableView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">tableView</span>: <span class="hljs-type">UITableView</span>, <span class="hljs-params">heightForRowAt</span> <span class="hljs-params">indexPath</span>: <span class="hljs-type">IndexPath</span>) -&gt; <span class="hljs-type">CGFloat</span> {<br />        <br />        <span class="hljs-keyword">if</span> indexPath <span class="hljs-operator">==</span> birthdayPickerCellIndexPath,<br />           showBirthdayPicker <span class="hljs-operator">==</span> <span class="hljs-literal">false</span> {<br />            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br />        } <span class="hljs-keyword">else</span> {<br />            <span class="hljs-keyword">return</span> <span class="hljs-type">UITableView</span>.automaticDimension<br />        }<br />}</span></pre><ul class="postList"><li name="fdc6" id="fdc6" class="graf graf--li graf-after--pre">點選 Birthday cell 時修改 showBirthdayPicker，控制 date picker 的顯示 / 隱藏。</li></ul><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="77bb" id="77bb" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content"><span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">tableView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">tableView</span>: <span class="hljs-type">UITableView</span>, <span class="hljs-params">didSelectRowAt</span> <span class="hljs-params">indexPath</span>: <span class="hljs-type">IndexPath</span>) {<br />        tableView.deselectRow(at: indexPath, animated: <span class="hljs-literal">true</span>)<br />        <span class="hljs-keyword">if</span> indexPath <span class="hljs-operator">==</span> birthdayLabelCellIndexPath {<br />            showBirthdayPicker.toggle()<br />        }<br />}</span></pre><p name="ad31" id="ad31" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">結果</strong></p><figure name="3114" id="3114" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*6XErxYFyyrPjIXMr3JDbeg.png" data-width="1238" data-height="1290" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*6XErxYFyyrPjIXMr3JDbeg.png"></figure><h3 name="18af" id="18af" class="graf graf--h3 graf-after--figure">其它參考連結</h3><p name="4911" id="4911" class="graf graf--p graf-after--h3">Apple Develop in Swift Data Collection 的 Lesson 1.9 <br>Complex Input Screens &amp; Lab Employee Roster。</p><div name="e263" id="e263" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://books.apple.com/tw/book/develop-in-swift-data-collections/id6468968766?l=en-GB" data-href="https://books.apple.com/tw/book/develop-in-swift-data-collections/id6468968766?l=en-GB" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://books.apple.com/tw/book/develop-in-swift-data-collections/id6468968766?l=en-GB"><strong class="markup--strong markup--mixtapeEmbed-strong">‎Develop in Swift Data Collections</strong><br><em class="markup--em markup--mixtapeEmbed-em">Download and read the ebook version of Develop in Swift Data Collections by Apple Education on Apple Books. Students…</em>books.apple.com</a><a href="https://books.apple.com/tw/book/develop-in-swift-data-collections/id6468968766?l=en-GB" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="78d885ca96cb34318cb082ba9b854d8f" data-thumbnail-img-id="0*3KufRYlG8pMDIWTn" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*3KufRYlG8pMDIWTn);"></a></div><p name="d3a2" id="d3a2" class="graf graf--p graf-after--mixtapeEmbed">Apple 範例裡更新 cell 高度利用 beginUpdates &amp; endUpdates，不過 Apple 官方目前比較建議使用 performBatchUpdates。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="c33c" id="c33c" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">tableView.beginUpdates()<br />tableView.endUpdates()</span></pre><figure name="1b5b" id="1b5b" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*kbKiGcuPEJHgQDXPWF0_Rg.png" data-width="1288" data-height="1312" src="https://cdn-images-1.medium.com/max/800/1*kbKiGcuPEJHgQDXPWF0_Rg.png"></figure><figure name="19d9" id="19d9" class="graf graf--figure graf-after--figure graf--trailing"><img class="graf-image" data-image-id="1*GsoZkJyJf_Bidiu_sluHHg.png" data-width="1300" data-height="1308" src="https://cdn-images-1.medium.com/max/800/1*GsoZkJyJf_Bidiu_sluHHg.png"></figure></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@apppeterpan" class="p-author h-card">彼得潘的 iOS App Neverland</a> on <a href="https://medium.com/p/e762503e5adc"><time class="dt-published" datetime="2022-01-06T09:52:33.557Z">January 6, 2022</time></a>.</p><p><a href="https://medium.com/@apppeterpan/%E5%88%A9%E7%94%A8-performbatchupdates-%E6%9B%B4%E6%96%B0-cell-%E9%AB%98%E5%BA%A6-%E5%AF%A6%E7%8F%BE%E9%BB%9E%E9%81%B8-cell-%E5%B1%95%E9%96%8B-%E6%94%B6%E7%B8%AE%E4%B8%8B%E6%96%B9%E5%85%A7%E5%AE%B9-e762503e5adc" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on November 16, 2025.</p></footer></article></body></html>