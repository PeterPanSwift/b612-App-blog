<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>利用 AVPlayerLooper 重覆播放音樂和影片</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">利用 AVPlayerLooper 重覆播放音樂和影片</h1>
</header>
<section data-field="subtitle" class="p-summary">
彼得潘很喜歡重覆聽同一首歌，重覆看同一部電影，所以接下來，就讓我們試試用 iOS 10 的 AVPlayerLooper 實現重覆播放的功能吧。
</section>
<section data-field="body" class="e-content">
<section name="83a0" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="f32a" id="f32a" class="graf graf--h3 graf--leading graf--title">利用 AVPlayerLooper 重覆播放音樂和影片</h3><p name="3546" id="3546" class="graf graf--p graf-after--h3">彼得潘很喜歡重覆聽同一首歌，重覆看同一部電影，所以接下來，就讓我們用 iOS 10 的 AVPlayerLooper 實現重覆播放的功能吧。</p><div name="da28" id="da28" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://developer.apple.com/documentation/avfoundation/avplayerlooper" data-href="https://developer.apple.com/documentation/avfoundation/avplayerlooper" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/avfoundation/avplayerlooper"><strong class="markup--strong markup--mixtapeEmbed-strong">AVPlayerLooper | Apple Developer Documentation</strong><br><em class="markup--em markup--mixtapeEmbed-em">An object that loops media content using a queue player.</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/avfoundation/avplayerlooper" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="851a4542fe61e96aed5d6b66b877817e" data-thumbnail-img-id="0*YAdjmOxfImdpso0X" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*YAdjmOxfImdpso0X);"></a></div><h3 name="8b5e" id="8b5e" class="graf graf--h3 graf-after--mixtapeEmbed"><strong class="markup--strong markup--h3-strong">只能聽一次的音樂</strong></h3><p name="ec89" id="ec89" class="graf graf--p graf-after--h3">從前彼得潘想聽歌時，會找 AVPlayer 幫忙。(聽歌還要寫程式，真累 !) 比方以下範例分別為 SwiftUI &amp; UIKit App 畫面出現時播放音樂的範例。</p><p name="e5a8" id="e5a8" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">SwiftUI 版本</strong></p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="4ed1" id="4ed1" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> SwiftUI<br /><span class="hljs-keyword">import</span> AVFoundation<br /><br /><span class="hljs-keyword">import</span> AVFoundationstruct ContentView: View {<br />    <br />    <span class="hljs-keyword">let</span> player <span class="hljs-operator">=</span> <span class="hljs-type">AVPlayer</span>()<br />    <br />    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {<br />        <span class="hljs-type">Text</span>(<span class="hljs-string">&quot;Hello, World!&quot;</span>)<br />            .onAppear {<br />                <span class="hljs-keyword">let</span> fileUrl <span class="hljs-operator">=</span> <span class="hljs-type">Bundle</span>.main.url(forResource: <span class="hljs-string">&quot;music&quot;</span>, withExtension: <span class="hljs-string">&quot;mp4&quot;</span>)<span class="hljs-operator">!</span><br />                <span class="hljs-keyword">let</span> playerItem <span class="hljs-operator">=</span> <span class="hljs-type">AVPlayerItem</span>(url: fileUrl)<br />                <span class="hljs-keyword">self</span>.player.replaceCurrentItem(with: playerItem)<br />                <span class="hljs-keyword">self</span>.player.play()<br />        }<br />    }<br />}</span></pre><p name="abc5" id="abc5" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">UIKit 版本</strong></p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="71ab" id="71ab" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> UIKit<br /><span class="hljs-keyword">import</span> AVFoundation<br /><br /><span class="hljs-keyword">import</span> AVFoundationclass ViewController: UIViewController {<br />    <br />    <span class="hljs-keyword">let</span> player <span class="hljs-operator">=</span> <span class="hljs-type">AVPlayer</span>()<br />    <br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {<br />        <span class="hljs-keyword">super</span>.viewDidLoad()<br />        <br />        <span class="hljs-keyword">let</span> fileUrl <span class="hljs-operator">=</span> <span class="hljs-type">Bundle</span>.main.url(forResource: <span class="hljs-string">&quot;music&quot;</span>, withExtension: <span class="hljs-string">&quot;mp4&quot;</span>)<span class="hljs-operator">!</span><br />        <span class="hljs-keyword">let</span> playerItem <span class="hljs-operator">=</span> <span class="hljs-type">AVPlayerItem</span>(url: fileUrl)<br />        player.replaceCurrentItem(with: playerItem)<br />        player.play()<br />    }}<br />}</span></pre><p name="8127" id="8127" class="graf graf--p graf-after--pre">值得注意的，以上範例的 player 要在 body 或 viewDidLoad 之前宣告，如果在 body 或viewDidLoad 裡宣告 player， body &amp; viewDidLoad { } 的程式跑完時，player 就會被清掉，造成音樂無法播放。</p><h3 name="25af" id="25af" class="graf graf--h3 graf-after--p">重覆播放音樂</h3><p name="3841" id="3841" class="graf graf--p graf-after--h3">可惜以上的程式播放的音樂只能聽一次，播完後就進入可怕的無聲世界。一旦沒有音樂，彼得潘是無法寫程式的，因此讓我們趕緊加入讓音樂單曲循環的 AVPlayerLooper 。</p><p name="c5e4" id="c5e4" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">SwiftUI 版本</strong></p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="e927" id="e927" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> SwiftUI<br /><span class="hljs-keyword">import</span> AVFoundation<br /><br /><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ContentView</span>: <span class="hljs-title class_">View</span> {<br />    <span class="hljs-meta">@State</span> <span class="hljs-keyword">var</span> looper: <span class="hljs-type">AVPlayerLooper</span>?<br />    <br />    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {<br />        <br />        <span class="hljs-type">Text</span>(<span class="hljs-string">&quot;Hello, World!&quot;</span>)<br />            .onAppear {<br />                <span class="hljs-keyword">let</span> player <span class="hljs-operator">=</span> <span class="hljs-type">AVQueuePlayer</span>()<br />                <span class="hljs-keyword">let</span> fileUrl <span class="hljs-operator">=</span> <span class="hljs-type">Bundle</span>.main.url(forResource: <span class="hljs-string">&quot;music&quot;</span>, withExtension: <span class="hljs-string">&quot;mp4&quot;</span>)<span class="hljs-operator">!</span><br />                <span class="hljs-keyword">let</span> item <span class="hljs-operator">=</span> <span class="hljs-type">AVPlayerItem</span>(url: fileUrl)<br />                <span class="hljs-keyword">self</span>.looper <span class="hljs-operator">=</span> <span class="hljs-type">AVPlayerLooper</span>(player: player, templateItem: item)<br />                player.play()<br />        }<br />    }<br />}</span></pre><p name="b52b" id="b52b" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">UIKit 版本</strong></p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="457a" id="457a" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> AVFoundation<br /><span class="hljs-keyword">import</span> UIKit<br /><br /><span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewController</span>: <span class="hljs-title class_">UIViewController</span> {<br />   <span class="hljs-keyword">var</span> looper: <span class="hljs-type">AVPlayerLooper</span>?<br />   <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {<br />      <span class="hljs-keyword">super</span>.viewDidLoad()<br />      <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> url <span class="hljs-operator">=</span> <span class="hljs-type">URL</span>(string: <span class="hljs-string">&quot;https://audio-ssl.itunes.apple.com/apple-assets-us-std-000001/AudioPreview118/v4/69/0e/98/690e98db-440d-cb0c-2bff-91b00a05bdda/mzaf_1674062311671795807.plus.aac.p.m4a&quot;</span>) {<br />         <span class="hljs-keyword">let</span> player <span class="hljs-operator">=</span> <span class="hljs-type">AVQueuePlayer</span>()<br />         <span class="hljs-keyword">let</span> item <span class="hljs-operator">=</span> <span class="hljs-type">AVPlayerItem</span>(url: url)<br />         looper <span class="hljs-operator">=</span> <span class="hljs-type">AVPlayerLooper</span>(player: player, templateItem: item)<br />         player.play()<br />      }<br />   }<br />}</span></pre><p name="40a0" id="40a0" class="graf graf--p graf-after--pre">說明</p><p name="db0a" id="db0a" class="graf graf--p graf-after--p">在 body 或 viewDidLoad 之前宣告讓我們重覆播放音樂的 AVPlayerLooper，原因和在 body 或 viewDidLoad 之前宣告 player 的範例一樣。利用 AVPlayerLooper 重覆播放音樂時，重點在以下三行程式。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="7832" id="7832" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> player <span class="hljs-operator">=</span> <span class="hljs-type">AVQueuePlayer</span>()<br /><span class="hljs-keyword">let</span> item <span class="hljs-operator">=</span> <span class="hljs-type">AVPlayerItem</span>(url: url)<br />looper <span class="hljs-operator">=</span> <span class="hljs-type">AVPlayerLooper</span>(player: player, templateItem: item)</span></pre><p name="9933" id="9933" class="graf graf--p graf-after--pre">生成 AVQueuePlayer 物件。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="ffef" id="ffef" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> player <span class="hljs-operator">=</span> <span class="hljs-type">AVQueuePlayer</span>()</span></pre><p name="a9f6" id="a9f6" class="graf graf--p graf-after--pre">利用 AVPlayerItem 生成要播放的音樂。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="7f1d" id="7f1d" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> item <span class="hljs-operator">=</span> <span class="hljs-type">AVPlayerItem</span>(url: url)</span></pre><p name="d6a1" id="d6a1" class="graf graf--p graf-after--pre">生成 AVPlayerLooper，傳入剛剛生成的 player &amp; item。到時候 AVPlayerLooper 將讓 item 重覆播放。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="f14b" id="f14b" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">looper <span class="hljs-operator">=</span> <span class="hljs-type">AVPlayerLooper</span>(player: player, templateItem: item)</span></pre><h3 name="8010" id="8010" class="graf graf--h3 graf-after--pre">在背景播放音樂</h3><div name="32f5" id="32f5" class="graf graf--mixtapeEmbed graf-after--h3"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E8%A8%AD%E5%AE%9A-background-mode-%E5%9C%A8%E8%83%8C%E6%99%AF%E6%92%AD%E6%94%BE%E9%9F%B3%E6%A8%82-9bab5db75cc9" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E8%A8%AD%E5%AE%9A-background-mode-%E5%9C%A8%E8%83%8C%E6%99%AF%E6%92%AD%E6%94%BE%E9%9F%B3%E6%A8%82-9bab5db75cc9" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E8%A8%AD%E5%AE%9A-background-mode-%E5%9C%A8%E8%83%8C%E6%99%AF%E6%92%AD%E6%94%BE%E9%9F%B3%E6%A8%82-9bab5db75cc9"><strong class="markup--strong markup--mixtapeEmbed-strong">設定 Background Mode 在背景播放音樂</strong><br><em class="markup--em markup--mixtapeEmbed-em">開發音樂播放的 App 時，我們時常需要讓音樂在背景也能繼續播放，這樣的功能是如何實現的呢 ? 只要調整 Background Mode &amp; 設定 AVAudioSession 即可實現。</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E8%A8%AD%E5%AE%9A-background-mode-%E5%9C%A8%E8%83%8C%E6%99%AF%E6%92%AD%E6%94%BE%E9%9F%B3%E6%A8%82-9bab5db75cc9" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="bdbda01a0dd345dc8b96029bb2cd85b9" data-thumbnail-img-id="1*fpnYAG_nAk-SLyc3xugtQw.jpeg" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*fpnYAG_nAk-SLyc3xugtQw.jpeg);"></a></div><h3 name="7c49" id="7c49" class="graf graf--h3 graf-after--mixtapeEmbed"><strong class="markup--strong markup--h3-strong">重覆播放影片</strong></h3><p name="3056" id="3056" class="graf graf--p graf-after--h3">重覆播放影片的方法和音樂差不多，只是我們必須另外生成 AVPlayerViewController 顯示影片。</p><p name="7c83" id="7c83" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">UIKit 版本</strong></p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="2378" id="2378" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> AVKit<br /><span class="hljs-keyword">import</span> UIKit<br /><br /><span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewController</span>: <span class="hljs-title class_">UIViewController</span> {<br />   <span class="hljs-keyword">var</span> looper: <span class="hljs-type">AVPlayerLooper</span>?<br />   <span class="hljs-keyword">@IBAction</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">play</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">sender</span>: <span class="hljs-keyword">Any</span>) {<br />      <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> url <span class="hljs-operator">=</span> <span class="hljs-type">URL</span>(string: <span class="hljs-string">&quot;https://video-ssl.itunes.apple.com/apple-assets-us-std-000001/Video128/v4/ac/7c/62/ac7c6274-60ea-5b7c-4c99-f08d78bfe574/mzvf_484000410198456586.640x352.h264lc.U.p.m4v&quot;</span>) {<br />         <span class="hljs-keyword">let</span> item <span class="hljs-operator">=</span> <span class="hljs-type">AVPlayerItem</span>(url: url)<br />         <span class="hljs-keyword">let</span> player <span class="hljs-operator">=</span> <span class="hljs-type">AVQueuePlayer</span>()<br />         looper <span class="hljs-operator">=</span> <span class="hljs-type">AVPlayerLooper</span>(player: player, templateItem: item)<br />         <span class="hljs-keyword">let</span> playerViewController <span class="hljs-operator">=</span> <span class="hljs-type">AVPlayerViewController</span>()<br />         playerViewController.player <span class="hljs-operator">=</span> player<br />         present(playerViewController, animated: <span class="hljs-literal">true</span>, completion: {<br />            playerViewController.player<span class="hljs-operator">?</span>.play()<br />         })<br />      }<br />   }<br />}</span></pre><p name="56e3" id="56e3" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">SwiftUI 版本</strong></p><p name="f4dc" id="f4dc" class="graf graf--p graf-after--p">從 SwiftUI 顯示 AVPlayerViewController 比較麻煩，必須利用 UIViewControllerRepresentable 將 controller 的畫面包裝成 SwiftUI view，有興趣的朋友可參考以下連結的說明。</p><div name="e261" id="e261" class="graf graf--mixtapeEmbed graf-after--p graf--trailing"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%9C%A8-swiftui-app-%E5%8A%A0%E5%85%A5-view-controller-1a79353ea3aa" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%9C%A8-swiftui-app-%E5%8A%A0%E5%85%A5-view-controller-1a79353ea3aa" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%9C%A8-swiftui-app-%E5%8A%A0%E5%85%A5-view-controller-1a79353ea3aa"><strong class="markup--strong markup--mixtapeEmbed-strong">在 SwiftUI App 加入 view controller &amp; 從 SwiftUI 畫面切換到 Storyboard 畫面</strong><br><em class="markup--em markup--mixtapeEmbed-em">SwiftUI 有很多很棒很炫的功能，幫助我們更容易地開發 iOS App，不過因為它才剛出生，所以一些傳統 iOS App 常用的 UI 元件還不支援，比方它缺少以下這些元件:</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%9C%A8-swiftui-app-%E5%8A%A0%E5%85%A5-view-controller-1a79353ea3aa" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="cfdaac549d2461b213660ffbfed46d11" data-thumbnail-img-id="1*oVbI6wkohs-pYRxwK7__7A.jpeg" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*oVbI6wkohs-pYRxwK7__7A.jpeg);"></a></div></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@apppeterpan" class="p-author h-card">彼得潘的 iOS App Neverland</a> on <a href="https://medium.com/p/a9142d48465e"><time class="dt-published" datetime="2019-01-19T08:34:42.495Z">January 19, 2019</time></a>.</p><p><a href="https://medium.com/@apppeterpan/%E5%88%A9%E7%94%A8-avplayerlooper-%E9%87%8D%E8%A6%86%E6%92%AD%E6%94%BE%E9%9F%B3%E6%A8%82%E5%92%8C%E5%BD%B1%E7%89%87-a9142d48465e" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on November 16, 2025.</p></footer></article></body></html>