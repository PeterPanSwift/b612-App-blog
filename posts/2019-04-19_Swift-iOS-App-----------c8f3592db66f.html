<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Swift iOS App 下載圖片的幾種方法</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Swift iOS App 下載圖片的幾種方法</h1>
</header>
<section data-field="subtitle" class="p-summary">
開發 iOS App 時，我們時常需要撰寫下載圖片的程式，常見的抓圖程式是利用我們熟悉的 URLSessionDataTask，例如以下點選 button 下載圖片的例子:
</section>
<section data-field="body" class="e-content">
<section name="48bf" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="8b58" id="8b58" class="graf graf--h3 graf--leading graf--title">Swift iOS App 下載圖片的幾種方法</h3><p name="4b04" id="4b04" class="graf graf--p graf-after--h3">開發 iOS App 時，我們時常需要撰寫下載圖片的程式，常見的抓圖程式是利用我們熟悉的 URLSessionDataTask，例如以下點選 button 下載圖片的例子:</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="9f40" id="9f40" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">@IBAction</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">download</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">sender</span>: <span class="hljs-keyword">Any</span>) {<br />   imageView.image <span class="hljs-operator">=</span> <span class="hljs-literal">nil</span><br />   <span class="hljs-keyword">let</span> url <span class="hljs-operator">=</span> <span class="hljs-type">URL</span>(string: <span class="hljs-string">&quot;https://images-na.ssl-images-amazon.com/images/I/51f-7KjjFeL._SX317_BO1,204,203,200_.jpg&quot;</span>)<span class="hljs-operator">!</span><br />   <span class="hljs-type">URLSession</span>.shared.dataTask(with: url) { data, response, error <span class="hljs-keyword">in</span><br />      <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> data, <br />         <span class="hljs-keyword">let</span> image <span class="hljs-operator">=</span> <span class="hljs-type">UIImage</span>(data: data) {<br />         <span class="hljs-type">DispatchQueue</span>.main.async {<br />            <span class="hljs-keyword">self</span>.imageView.image <span class="hljs-operator">=</span> image<br />         }<br />      }  <br />   }.resume()<br />}</span></pre><h3 name="434d" id="434d" class="graf graf--h3 graf-after--pre">預設 cache 的小圖</h3><p name="3ce6" id="3ce6" class="graf graf--p graf-after--h3">當圖片是小圖時(剛剛程式裡的圖片大概 46 kB)，iOS 還會幫我們 cache，讓我們下次抓取一樣的圖時可以直接讀 cache，不用再重抓等待。比方剛剛的程式執行後，我們可利用 <code class="markup--code markup--p-code">NSHomeDirectory()</code> 找出 App 資料夾的路徑，然後從裡面找到暫存的圖檔。</p><pre name="a29f" id="a29f" class="graf graf--pre graf-after--p">/Users/shih-yingpan/Library/Developer/CoreSimulator/Devices/43C39FF6-341C-4CFE-B987-14E1A188DDA8/data/Containers/Data/Application/217FE133-2A4D-4516-BAF8-7166D980B1A5</pre><p name="eff2" id="eff2" class="graf graf--p graf-after--pre">從 Finder 打開 App 的資料夾，在它的 <code class="markup--code markup--p-code">Library/Caches/com.peter.DemoCache/fsCacheData/</code> 下可找到圖片。(com.peter.DemoCache 是 App 的 bundle ID)</p><figure name="d4af" id="d4af" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*lfK9G4QGMRIc8V2gXKmpHw.jpeg" data-width="2126" data-height="1024" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*lfK9G4QGMRIc8V2gXKmpHw.jpeg"></figure><h3 name="bb04" id="bb04" class="graf graf--h3 graf-after--figure">不會 cache 的大圖</h3><p name="545c" id="545c" class="graf graf--p graf-after--h3">不過當圖片太大時，就沒那麼幸運了。這時候 iOS 不會幫我們 cache，所以每次都要重新下載。</p><p name="5669" id="5669" class="graf graf--p graf-after--p">範例: 690 kB 的大圖網址</p><p name="f2fd" id="f2fd" class="graf graf--p graf-after--p"><a href="https://i.pinimg.com/originals/df/80/f3/df80f367ffb8669baeabcd5564f1b638.jpg" data-href="https://i.pinimg.com/originals/df/80/f3/df80f367ffb8669baeabcd5564f1b638.jpg" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">https://i.pinimg.com/originals/df/80/f3/df80f367ffb8669baeabcd5564f1b638.jpg</a></p><p name="0359" id="0359" class="graf graf--p graf-after--p">除了從點選 button 下載同一張圖，圖片還是要過一會才顯示得知沒有 cache 外，我們也可從 Finder 打開 App 的資料夾，發現裡面沒有大圖的圖檔。</p><figure name="4fc6" id="4fc6" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*RLxgJ4dRpYX4gNTEWyZz3w.jpeg" data-width="1306" data-height="660" src="https://cdn-images-1.medium.com/max/800/1*RLxgJ4dRpYX4gNTEWyZz3w.jpeg"></figure><h3 name="ae8b" id="ae8b" class="graf graf--h3 graf-after--figure">增加 cache 容量讓大圖也能 cache</h3><p name="b050" id="b050" class="graf graf--p graf-after--h3">原本大圖不會被 cache 是因為預設的 cache 容量不夠大，因此我們只要在 AppDelegate 的 application(_:didFinishLaunchingWithOptions:) 加入以下程式，增加 memory &amp; disk cache 的容量，即可讓大圖也能 cache。</p><ul class="postList"><li name="457d" id="457d" class="graf graf--li graf-after--p">方法 1: 修改 URLCache.shared</li></ul><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="69d3" id="69d3" class="graf graf--pre graf-after--li graf--preV2"><span class="pre--content"><span class="hljs-type">URLCache</span>.shared.memoryCapacity <span class="hljs-operator">=</span> <span class="hljs-number">25_000_000</span><br /><span class="hljs-type">URLCache</span>.shared.diskCapacity <span class="hljs-operator">=</span> <span class="hljs-number">100_000_000</span></span></pre><ul class="postList"><li name="26b1" id="26b1" class="graf graf--li graf-after--pre">方法 2: 產生新的 URLCache</li></ul><p name="61a8" id="61a8" class="graf graf--p graf-after--li">diskPath 也可以傳入 nil，此時資料將存在預設路徑的資料夾。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="d47a" id="d47a" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> temporaryDirectory <span class="hljs-operator">=</span> <span class="hljs-type">NSTemporaryDirectory</span>()<br /><span class="hljs-keyword">let</span> urlCache <span class="hljs-operator">=</span> <span class="hljs-type">URLCache</span>(memoryCapacity: <span class="hljs-number">25_000_000</span>, diskCapacity: <span class="hljs-number">50_000_000</span>, diskPath: temporaryDirectory)<br /><span class="hljs-type">URLCache</span>.shared <span class="hljs-operator">=</span> urlCache</span></pre><p name="098a" id="098a" class="graf graf--p graf-after--pre">此時點選 button 下載圖片，從 Finder 打開 App 的資料夾，終於發現大圖的圖檔了。因為大圖被 cache，所以現在我們點選 button 下載同一張圖時，將發現速度快很多，圖片幾乎馬上出現，不過還是會有閃一下的小小缺點。</p><figure name="04a4" id="04a4" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*Wptep-Twa5zjgy8JBm_eAg.jpeg" data-width="1316" data-height="716" src="https://cdn-images-1.medium.com/max/800/1*Wptep-Twa5zjgy8JBm_eAg.jpeg"></figure><h3 name="a584" id="a584" class="graf graf--h3 graf-after--figure">利用 NSCache 暫存網路圖片</h3><p name="2119" id="2119" class="graf graf--p graf-after--h3">想要有更好的效果，希望點選 button 下載同一張圖時，連閃都不會閃嗎?</p><p name="64ff" id="64ff" class="graf graf--p graf-after--p">其實是做得到的 ! 我們可以利用以下連結介紹的 NSCache 暫存圖片，或是將圖片暫存在 temporary directory。</p><div name="5521" id="5521" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-nscache-%E6%9A%AB%E5%AD%98%E7%B6%B2%E8%B7%AF%E5%9C%96%E7%89%87-70983260ceff" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-nscache-%E6%9A%AB%E5%AD%98%E7%B6%B2%E8%B7%AF%E5%9C%96%E7%89%87-70983260ceff" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-nscache-%E6%9A%AB%E5%AD%98%E7%B6%B2%E8%B7%AF%E5%9C%96%E7%89%87-70983260ceff"><strong class="markup--strong markup--mixtapeEmbed-strong">利用 NSCache 暫存網路圖片</strong><br><em class="markup--em markup--mixtapeEmbed-em">開發 iOS App 時，我們時常從網路上抓圖，定義類似以下的抓圖 function。</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-nscache-%E6%9A%AB%E5%AD%98%E7%B6%B2%E8%B7%AF%E5%9C%96%E7%89%87-70983260ceff" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="d2e192d23eb72a59c549ffdfd9b3d30d" data-thumbnail-img-id="1*cKbq8UQav4vr8voEFP0MIA.jpeg" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*cKbq8UQav4vr8voEFP0MIA.jpeg);"></a></div><h3 name="3ba2" id="3ba2" class="graf graf--h3 graf-after--mixtapeEmbed">將圖片暫存在 temporary directory</h3><p name="9695" id="9695" class="graf graf--p graf-after--h3">每次下載前先檢查圖檔是否已存在，如果已存在就直接讀檔，不需再啟動 URLSessionDataTask。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="6b8d" id="6b8d" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">@IBAction</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">download</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">sender</span>: <span class="hljs-keyword">Any</span>) {<br />   <span class="hljs-keyword">let</span> url <span class="hljs-operator">=</span> <span class="hljs-type">URL</span>(string: <span class="hljs-string">&quot;https://i.pinimg.com/originals/df/80/f3/df80f367ffb8669baeabcd5564f1b638.jpg&quot;</span>)<span class="hljs-operator">!</span><br />   <span class="hljs-keyword">let</span> tempDirectory <span class="hljs-operator">=</span> <span class="hljs-type">FileManager</span>.default.temporaryDirectory<br />   <span class="hljs-keyword">let</span> imageFileUrl <span class="hljs-operator">=</span> tempDirectory.appendingPathComponent(url.lastPathComponent)<br />   <span class="hljs-keyword">if</span> <span class="hljs-type">FileManager</span>.default.fileExists(atPath: imageFileUrl.path) {<br />      <span class="hljs-keyword">let</span> image <span class="hljs-operator">=</span> <span class="hljs-type">UIImage</span>(contentsOfFile: imageFileUrl.path)<br />      <span class="hljs-keyword">self</span>.imageView.image <span class="hljs-operator">=</span> image<br />   } <span class="hljs-keyword">else</span> {<br />      <span class="hljs-keyword">self</span>.imageView.image <span class="hljs-operator">=</span> <span class="hljs-literal">nil</span><br />      <span class="hljs-type">URLSession</span>.shared.dataTask(with: url) { data, response, error <span class="hljs-keyword">in</span><br />         <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> data, <br />            <span class="hljs-keyword">let</span> image <span class="hljs-operator">=</span> <span class="hljs-type">UIImage</span>(data: data) {<br />            <span class="hljs-keyword">try?</span> data.write(to: imageFileUrl)<br />            <span class="hljs-type">DispatchQueue</span>.main.async {<br />               <span class="hljs-keyword">self</span>.imageView.image <span class="hljs-operator">=</span> image<br />            }<br />         }<br />      }.resume()<br />   }<br />}</span></pre><h3 name="7410" id="7410" class="graf graf--h3 graf-after--pre">使用抓圖套件</h3><p name="7f1a" id="7f1a" class="graf graf--p graf-after--h3">如果懶得自己寫程式抓圖，採用套件也是不錯的方法，像知名的套件 Kingfisher &amp; SDWebImage 都跟剛剛自己將圖暫存在 temporary directory 有一樣好的效果，而且套件本身還加了許多進階的功能。</p><div name="1ec8" id="1ec8" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://github.com/onevcat/Kingfisher" data-href="https://github.com/onevcat/Kingfisher" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://github.com/onevcat/Kingfisher"><strong class="markup--strong markup--mixtapeEmbed-strong">onevcat/Kingfisher</strong><br><em class="markup--em markup--mixtapeEmbed-em">A lightweight, pure-Swift library for downloading and caching images from the web. - onevcat/Kingfisher</em>github.com</a><a href="https://github.com/onevcat/Kingfisher" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="ac7df29d878719cf1e60deab10917239" data-thumbnail-img-id="0*m3sTAEF44v7XZdkq" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*m3sTAEF44v7XZdkq);"></a></div><div name="26c1" id="26c1" class="graf graf--mixtapeEmbed graf-after--mixtapeEmbed"><a href="https://github.com/SDWebImage/SDWebImage" data-href="https://github.com/SDWebImage/SDWebImage" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://github.com/SDWebImage/SDWebImage"><strong class="markup--strong markup--mixtapeEmbed-strong">SDWebImage/SDWebImage</strong><br><em class="markup--em markup--mixtapeEmbed-em">Asynchronous image downloader with cache support as a UIImageView category - SDWebImage/SDWebImage</em>github.com</a><a href="https://github.com/SDWebImage/SDWebImage" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="54878660edeb387ce4263dd3d51db8ec" data-thumbnail-img-id="0*aAccfxlKXrA2McIG" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*aAccfxlKXrA2McIG);"></a></div><p name="8722" id="8722" class="graf graf--p graf-after--mixtapeEmbed">如下圖所示，Kingfisher 套件一樣會將圖案存在 cache 裡，不過它會在 Caches 下另建資料夾 com.onevcat.Kingfisher.ImageCache.default。</p><figure name="8499" id="8499" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*k1FJh0aPUu9qnKxrbr5dpg.jpeg" data-width="1716" data-height="764" src="https://cdn-images-1.medium.com/max/800/1*k1FJh0aPUu9qnKxrbr5dpg.jpeg"></figure><p name="750c" id="750c" class="graf graf--p graf-after--figure">研究 Kingfisher 的程式碼後，發現它果然會從 disk cache 讀取圖片，如果讀不到才會連網抓圖。</p><figure name="76dc" id="76dc" class="graf graf--figure graf-after--p graf--trailing"><img class="graf-image" data-image-id="1*jImV_Mg6S2Hv70CXyXz3QQ.jpeg" data-width="1830" data-height="984" src="https://cdn-images-1.medium.com/max/800/1*jImV_Mg6S2Hv70CXyXz3QQ.jpeg"></figure></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@apppeterpan" class="p-author h-card">彼得潘的 iOS App Neverland</a> on <a href="https://medium.com/p/c8f3592db66f"><time class="dt-published" datetime="2019-04-19T14:28:12.292Z">April 19, 2019</time></a>.</p><p><a href="https://medium.com/@apppeterpan/swift-ios-app-%E4%B8%8B%E8%BC%89%E5%9C%96%E7%89%87%E7%9A%84%E5%B9%BE%E7%A8%AE%E6%96%B9%E6%B3%95-c8f3592db66f" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on September 17, 2025.</p></footer></article></body></html>