<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>從 Swift 將多張圖片組合成 gif 圖片</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">從 Swift 將多張圖片組合成 gif 圖片</h1>
</header>
<section data-field="subtitle" class="p-summary">
gif 是常見的動畫圖片格式，它背後的原理其實很簡單，利用多張圖片快速播放實現動畫的效果。
</section>
<section data-field="body" class="e-content">
<section name="b64d" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="c082" id="c082" class="graf graf--h3 graf--leading graf--title">從 Swift 將多張圖片組合成 gif 圖片</h3><p name="72e2" id="72e2" class="graf graf--p graf-after--h3">gif 是常見的動畫圖片格式，它背後的原理其實很簡單，利用多張圖片快速播放實現動畫的效果。</p><p name="4d94" id="4d94" class="graf graf--p graf-after--p">從 Swift 我們也可利用多個 UIImage 生成 gif 圖片，從程式控制 gif 播放的次數和速度。接下來讓我們一步步將 peter 4 張帥氣的彩色圖片變成 gif 吧。</p><h3 name="d7c9" id="d7c9" class="graf graf--h3 graf-after--p">在 asset 加入 4 張帥氣的 peter</h3><figure name="da5c" id="da5c" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="1*IArquzqiYauX8M2zs7Ud6Q.png" data-width="1966" data-height="1526" src="https://cdn-images-1.medium.com/max/800/1*IArquzqiYauX8M2zs7Ud6Q.png"></figure><h3 name="387c" id="387c" class="graf graf--h3 graf-after--figure">加入函式庫 Photos</h3><p name="cbdc" id="cbdc" class="graf graf--p graf-after--h3">待會寫到的程式會用到函式庫 Photos，因此請先加入 Photos。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="608a" id="608a" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> Photos</span></pre><h3 name="bb2e" id="bb2e" class="graf graf--h3 graf-after--pre">定義產生 gif 圖片的 generateGif</h3><p name="e781" id="e781" class="graf graf--p graf-after--h3">generateGif 將產生 gif，並將 gif 存在我們指定的 URL。</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="730f" id="730f" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">generateGif</span>(<span class="hljs-params">photos</span>: [<span class="hljs-type">UIImage</span>], <span class="hljs-params">url</span>: <span class="hljs-type">URL</span>, <span class="hljs-params">loopCount</span>: <span class="hljs-type">Int</span>, <span class="hljs-params">delayTime</span>: <span class="hljs-type">Double</span>) -&gt; <span class="hljs-type">Bool</span> {<br />    <span class="hljs-keyword">let</span> fileProperties <span class="hljs-operator">=</span> [kCGImagePropertyGIFDictionary: [kCGImagePropertyGIFLoopCount: loopCount]]<br />    <span class="hljs-keyword">let</span> gifProperties <span class="hljs-operator">=</span> [kCGImagePropertyGIFDictionary: [kCGImagePropertyGIFDelayTime: delayTime]]<br />    <span class="hljs-keyword">guard</span> <span class="hljs-keyword">let</span> destination <span class="hljs-operator">=</span> <span class="hljs-type">CGImageDestinationCreateWithURL</span>(url <span class="hljs-keyword">as</span> <span class="hljs-type">CFURL</span>, <span class="hljs-type">UTType</span>.gif.identifier <span class="hljs-keyword">as</span> <span class="hljs-type">CFString</span>, photos.count, <span class="hljs-literal">nil</span>) <span class="hljs-keyword">else</span> {<br />        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br />    }<br />    <span class="hljs-type">CGImageDestinationSetProperties</span>(destination, fileProperties <span class="hljs-keyword">as</span> <span class="hljs-type">CFDictionary</span>)<br />    <span class="hljs-keyword">for</span> photo <span class="hljs-keyword">in</span> photos {<br />        <span class="hljs-type">CGImageDestinationAddImage</span>(destination, photo.cgImage<span class="hljs-operator">!</span>, gifProperties <span class="hljs-keyword">as</span> <span class="hljs-type">CFDictionary</span>)<br />    }<br />    <span class="hljs-keyword">return</span> <span class="hljs-type">CGImageDestinationFinalize</span>(destination) <br />}</span></pre><p name="ec27" id="ec27" class="graf graf--p graf-after--pre">利用 CGImageDestinationAddImage 加入組合出 gif 的圖片，function generateGif 的參數說明如下。</p><ul class="postList"><li name="36c9" id="36c9" class="graf graf--li graf-after--p">photos: 圖片的 array，圖片的型別為 UIImage。</li><li name="a23e" id="a23e" class="graf graf--li graf-after--li">url: 產生的 gif 檔的 URL。</li><li name="8595" id="8595" class="graf graf--li graf-after--li">loopCount: 動畫的次數，0 表示無限循環。</li><li name="5e80" id="5e80" class="graf graf--li graf-after--li">delayTime: 換下一張圖的時間，比方 0.1 表示每 0.1 秒換一張圖。</li></ul><h3 name="dc35" id="dc35" class="graf graf--h3 graf-after--li">將 gif 存到相簿</h3><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="7e7b" id="7e7b" class="graf graf--pre graf-after--h3 graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> name <span class="hljs-operator">=</span> <span class="hljs-type">UUID</span>().uuidString<br /><span class="hljs-keyword">let</span> url <span class="hljs-operator">=</span> <span class="hljs-type">URL</span>.documentsDirectory.appending(path: name).appendingPathExtension(for: .gif)<br /><span class="hljs-keyword">let</span> pngImages <span class="hljs-operator">=</span> [<br />    <span class="hljs-type">UIImage</span>(named: <span class="hljs-string">&quot;peter0&quot;</span>)<span class="hljs-operator">!</span>,<br />    <span class="hljs-type">UIImage</span>(named: <span class="hljs-string">&quot;peter1&quot;</span>)<span class="hljs-operator">!</span>,<br />    <span class="hljs-type">UIImage</span>(named: <span class="hljs-string">&quot;peter2&quot;</span>)<span class="hljs-operator">!</span>,<br />    <span class="hljs-type">UIImage</span>(named: <span class="hljs-string">&quot;peter3&quot;</span>)<span class="hljs-operator">!</span><br />]<br /><span class="hljs-keyword">if</span> generateGif(photos: pngImages, url: url, loopCount: <span class="hljs-number">0</span>, delayTime: <span class="hljs-number">0.1</span>) {<br />    <span class="hljs-type">PHPhotoLibrary</span>.shared().performChanges({<br />        <span class="hljs-keyword">let</span> request <span class="hljs-operator">=</span> <span class="hljs-type">PHAssetCreationRequest</span>.forAsset()<br />        request.addResource(with: .photo, fileURL: url, options: <span class="hljs-literal">nil</span>)<br />    })<br />}</span></pre><p name="e249" id="e249" class="graf graf--p graf-after--pre">呼叫 generateGif 產生 gif，然後呼叫 PHAssetCreationRequest 的 addResource 將 gif 存到相簿。</p><h3 name="a383" id="a383" class="graf graf--h3 graf-after--p">生成的 Gif</h3><p name="2fa8" id="2fa8" class="graf graf--p graf-after--h3">以下我們看看幾種生成的 gif。</p><ul class="postList"><li name="cb55" id="cb55" class="graf graf--li graf-after--p">loopCount 傳入 0，delayTime 傳入 0.1，產生快速播放且無限循環的 gif。</li></ul><figure name="0ba4" id="0ba4" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*sszZWQwct_ht08QZ6cbVtw.gif" data-width="295" data-height="472" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*sszZWQwct_ht08QZ6cbVtw.gif"></figure><ul class="postList"><li name="8a70" id="8a70" class="graf graf--li graf-after--figure">loopCount 傳入 2，delayTime 傳入 2，產生慢慢播放且只播兩次的 gif。</li></ul><figure name="e8a8" id="e8a8" class="graf graf--figure graf-after--li graf--trailing"><img class="graf-image" data-image-id="1*CZnbcBep1rtuOjyw9r3H2A.gif" data-width="295" data-height="472" src="https://cdn-images-1.medium.com/max/800/1*CZnbcBep1rtuOjyw9r3H2A.gif"></figure></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@apppeterpan" class="p-author h-card">彼得潘的 iOS App Neverland</a> on <a href="https://medium.com/p/cfa9ad6010f5"><time class="dt-published" datetime="2023-01-05T07:02:59.923Z">January 5, 2023</time></a>.</p><p><a href="https://medium.com/@apppeterpan/%E5%BE%9E-swift-%E5%B0%87%E5%A4%9A%E5%BC%B5%E5%9C%96%E7%89%87%E7%B5%84%E5%90%88%E6%88%90-gif-%E5%9C%96%E7%89%87-cfa9ad6010f5" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on November 16, 2025.</p></footer></article></body></html>