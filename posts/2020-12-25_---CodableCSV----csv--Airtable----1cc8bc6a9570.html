<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>利用 CodableCSV 解析 csv，以Airtable 為例</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">利用 CodableCSV 解析 csv，以Airtable 為例</h1>
</header>
<section data-field="subtitle" class="p-summary">
開發 iOS App 時，我們時常串接 JSON 格式的資料。不過世上的資料格式何其多，雖然 JSON 是最常用的，有時我們也會處理到其它格式，比方以逗號或 tab 分隔的 csv。
</section>
<section data-field="body" class="e-content">
<section name="aa46" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="20f4" id="20f4" class="graf graf--h3 graf--leading graf--title">利用 CodableCSV 解析 csv，以Airtable 為例</h3><p name="1adc" id="1adc" class="graf graf--p graf-after--h3">開發 iOS App 時，我們時常串接 JSON 格式的資料。不過世上的資料格式何其多，雖然 JSON 是最常用的，有時我們也會處理到其它格式，比方以逗號或 tab 分隔的 csv。</p><div name="93ac" id="93ac" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://en.wikipedia.org/wiki/Comma-separated_values" data-href="https://en.wikipedia.org/wiki/Comma-separated_values" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://en.wikipedia.org/wiki/Comma-separated_values"><strong class="markup--strong markup--mixtapeEmbed-strong">Comma-separated values</strong><br><em class="markup--em markup--mixtapeEmbed-em">A comma-separated values ( CSV) file is a delimited text file that uses a comma to separate values. Each line of the…</em>en.wikipedia.org</a><a href="https://en.wikipedia.org/wiki/Comma-separated_values" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="9d23c31f2dcc1ace9296037f327563a4" data-thumbnail-img-id="0*bD8bQ5zV5_ZcFlEB" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*bD8bQ5zV5_ZcFlEB);"></a></div><p name="627e" id="627e" class="graf graf--p graf-after--mixtapeEmbed">在解析 JSON 時，我們可以透過 JSONDecoder 方便地將資料轉換成遵從 Decodable 的自訂型別。那 csv 呢? 很可惜，並沒有內建 CSVDecoder，所以我們只能自力自強，自己寫程式解析。</p><p name="fab5" id="fab5" class="graf graf--p graf-after--p">不過最近彼得潘研究了一下，網路上有大大幫我們寫好了解析 csv 的 CSVDecoder，所以我們一樣可以將 csv 的內容轉換成遵從 Decodable 的自訂型別。接下來我們就以 Airtable 輸出的 csv 為例說明吧。</p><h3 name="6672" id="6672" class="graf graf--h3 graf-after--p">利用 Airtable 製作電影資料</h3><p name="07a9" id="07a9" class="graf graf--p graf-after--h3">參考以下連結的教學在 Airtable 輸入資料。</p><div name="3645" id="3645" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-airtable-%E8%A3%BD%E4%BD%9C-ios-app-%E9%80%A3%E7%B5%90%E7%9A%84%E5%BE%8C%E5%8F%B0%E8%B3%87%E6%96%99-e22378536acb" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-airtable-%E8%A3%BD%E4%BD%9C-ios-app-%E9%80%A3%E7%B5%90%E7%9A%84%E5%BE%8C%E5%8F%B0%E8%B3%87%E6%96%99-e22378536acb" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-airtable-%E8%A3%BD%E4%BD%9C-ios-app-%E9%80%A3%E7%B5%90%E7%9A%84%E5%BE%8C%E5%8F%B0%E8%B3%87%E6%96%99-e22378536acb"><strong class="markup--strong markup--mixtapeEmbed-strong">利用 Airtable 製作 iOS App 連結的後台資料</strong><br><em class="markup--em markup--mixtapeEmbed-em">Airtable 擁有強大的資料表單功能，如下圖所示，美美的表格可以在瞬間完成，而且欄位裡可輸入多種類型的資料，比方文字，時間，圖片，多選的選項等都不是問題。</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-airtable-%E8%A3%BD%E4%BD%9C-ios-app-%E9%80%A3%E7%B5%90%E7%9A%84%E5%BE%8C%E5%8F%B0%E8%B3%87%E6%96%99-e22378536acb" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="7673891ba1175157d9c60360f3dc3eef" data-thumbnail-img-id="1*tEYm-sF-JzMnJfJCUrlTrQ.png" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*tEYm-sF-JzMnJfJCUrlTrQ.png);"></a></div><p name="81e7" id="81e7" class="graf graf--p graf-after--mixtapeEmbed">彼得潘輸入了三部電影，包含以下欄位:</p><ul class="postList"><li name="8b22" id="8b22" class="graf graf--li graf-after--p">name(Single line text)</li><li name="d00c" id="d00c" class="graf graf--li graf-after--li">releaseDate(Date)</li><li name="571a" id="571a" class="graf graf--li graf-after--li">images(Attachment)</li><li name="68e1" id="68e1" class="graf graf--li graf-after--li">genre(Multiple select)</li><li name="3fd3" id="3fd3" class="graf graf--li graf-after--li">imdb(Number)</li><li name="9ad3" id="9ad3" class="graf graf--li graf-after--li">trailer(URL)</li></ul><figure name="65d1" id="65d1" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*EZjKemrK3R6jYApGBiBoHg.png" data-width="2860" data-height="474" src="https://cdn-images-1.medium.com/max/800/1*EZjKemrK3R6jYApGBiBoHg.png"></figure><h3 name="bcfc" id="bcfc" class="graf graf--h3 graf-after--figure">輸出 csv</h3><p name="dad3" id="dad3" class="graf graf--p graf-after--h3">點選下圖的三個小圓點，然後點選 Download CSV。</p><figure name="ca6a" id="ca6a" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*pQOCoTNJUJFxAjSfGK3_Zw.png" data-width="774" data-height="630" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*pQOCoTNJUJFxAjSfGK3_Zw.png"></figure><h3 name="3e50" id="3e50" class="graf graf--h3 graf-after--figure">csv 的真面目</h3><p name="96bd" id="96bd" class="graf graf--p graf-after--h3">好奇 csv 的內容嗎? 有興趣的朋友可用 TextEdit 打開它，一睹它的廬山真面目。</p><figure name="fc0b" id="fc0b" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*7NWWoSeqxCRb7vbfkDABtg.png" data-width="888" data-height="514" src="https://cdn-images-1.medium.com/max/800/1*7NWWoSeqxCRb7vbfkDABtg.png"></figure><p name="5482" id="5482" class="graf graf--p graf-after--figure">如以下例子所示，它果然以逗號做分隔，第一行是當初 table 的欄位名稱，第二行開始是資料。</p><pre name="3c21" id="3c21" class="graf graf--pre graf-after--p">name,releaseDate,images,genre,imdb,trailer<br>神力女超人1984,12/17/2020,&quot;KCmsxbTj8PyMHGEii0DY-757x1080.jpg (<a href="https://dl.airtable.com/.attachments/f93ca429626562410e21013dce805676/281e1ab8/KCmsxbTj8PyMHGEii0DY-757x1080.jpg%29,juaoOmPsQHebFbfDu5QU-1900x2375.jpeg" data-href="https://dl.airtable.com/.attachments/f93ca429626562410e21013dce805676/281e1ab8/KCmsxbTj8PyMHGEii0DY-757x1080.jpg),juaoOmPsQHebFbfDu5QU-1900x2375.jpeg" class="markup--anchor markup--pre-anchor" rel="nofollow noopener" target="_blank">https://dl.airtable.com/.attachments/f93ca429626562410e21013dce805676/281e1ab8/KCmsxbTj8PyMHGEii0DY-757x1080.jpg),juaoOmPsQHebFbfDu5QU-1900x2375.jpeg</a> (<a href="https://dl.airtable.com/.attachments/613c84a0c2ce3ac109796a5c59d7001c/4b0b2f12/juaoOmPsQHebFbfDu5QU-1900x2375.jpeg" data-href="https://dl.airtable.com/.attachments/613c84a0c2ce3ac109796a5c59d7001c/4b0b2f12/juaoOmPsQHebFbfDu5QU-1900x2375.jpeg" class="markup--anchor markup--pre-anchor" rel="nofollow noopener" target="_blank">https://dl.airtable.com/.attachments/613c84a0c2ce3ac109796a5c59d7001c/4b0b2f12/juaoOmPsQHebFbfDu5QU-1900x2375.jpeg</a>)&quot;,&quot;動作,冒險,劇情&quot;,7.3,<a href="https://www.youtube.com/watch?v=Mw3u7Arx3Ss" data-href="https://www.youtube.com/watch?v=Mw3u7Arx3Ss" class="markup--anchor markup--pre-anchor" rel="nofollow noopener" target="_blank">https://www.youtube.com/watch?v=Mw3u7Arx3Ss</a><br>鬼滅之刃劇場版 無限列車篇,10/30/2020,hFH7arAJqBIZaUdOGiuC-1182x1691.jpg (<a href="https://dl.airtable.com/.attachments/2b726239194e85c6cd52e7d228657345/a14a1924/hFH7arAJqBIZaUdOGiuC-1182x1691.jpg" data-href="https://dl.airtable.com/.attachments/2b726239194e85c6cd52e7d228657345/a14a1924/hFH7arAJqBIZaUdOGiuC-1182x1691.jpg" class="markup--anchor markup--pre-anchor" rel="nofollow noopener" target="_blank">https://dl.airtable.com/.attachments/2b726239194e85c6cd52e7d228657345/a14a1924/hFH7arAJqBIZaUdOGiuC-1182x1691.jpg</a>),動畫,8.3,<a href="https://www.youtube.com/watch?v=mR88lNYVqto" data-href="https://www.youtube.com/watch?v=mR88lNYVqto" class="markup--anchor markup--pre-anchor" rel="nofollow noopener" target="_blank">https://www.youtube.com/watch?v=mR88lNYVqto</a><br>孤味,11/6/2020,7ZbNJdYQsNCYp0IvZfkA-504x720.jpg (<a href="https://dl.airtable.com/.attachments/ad3cdb32d77e1e32cd72fd618c87387a/deda6c8c/7ZbNJdYQsNCYp0IvZfkA-504x720.jpg" data-href="https://dl.airtable.com/.attachments/ad3cdb32d77e1e32cd72fd618c87387a/deda6c8c/7ZbNJdYQsNCYp0IvZfkA-504x720.jpg" class="markup--anchor markup--pre-anchor" rel="nofollow noopener" target="_blank">https://dl.airtable.com/.attachments/ad3cdb32d77e1e32cd72fd618c87387a/deda6c8c/7ZbNJdYQsNCYp0IvZfkA-504x720.jpg</a>),劇情,7.8,<a href="https://www.youtube.com/watch?v=UKHhlhQROH4" data-href="https://www.youtube.com/watch?v=UKHhlhQROH4" class="markup--anchor markup--pre-anchor" rel="nofollow noopener" target="_blank">https://www.youtube.com/watch?v=UKHhlhQROH4</a></pre><h3 name="8989" id="8989" class="graf graf--h3 graf-after--pre">將 csv 加到 assets</h3><p name="82f0" id="82f0" class="graf graf--p graf-after--h3">將 csv 檔加到 assets，命名為 movies。</p><figure name="3c0d" id="3c0d" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*NElSRz5LkvLRu2iFIO_4Cw.png" data-width="1564" data-height="544" src="https://cdn-images-1.medium.com/max/800/1*NElSRz5LkvLRu2iFIO_4Cw.png"></figure><h3 name="9062" id="9062" class="graf graf--h3 graf-after--figure">在專案裡利用 SPM 加入套件 CodableCSV</h3><p name="3ed4" id="3ed4" class="graf graf--p graf-after--h3">參考以下連結的教學，利用 SPM 加入幫我們解析 csv 的套件 CodableCSV。</p><div name="7d2b" id="7d2b" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E4%BD%BF%E7%94%A8-spm-%E5%AE%89%E8%A3%9D%E7%AC%AC%E4%B8%89%E6%96%B9%E5%A5%97%E4%BB%B6-xcode-11-%E6%96%B0%E5%8A%9F%E8%83%BD-2c4ffcf85b4b" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E4%BD%BF%E7%94%A8-spm-%E5%AE%89%E8%A3%9D%E7%AC%AC%E4%B8%89%E6%96%B9%E5%A5%97%E4%BB%B6-xcode-11-%E6%96%B0%E5%8A%9F%E8%83%BD-2c4ffcf85b4b" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E4%BD%BF%E7%94%A8-spm-%E5%AE%89%E8%A3%9D%E7%AC%AC%E4%B8%89%E6%96%B9%E5%A5%97%E4%BB%B6-xcode-11-%E6%96%B0%E5%8A%9F%E8%83%BD-2c4ffcf85b4b"><strong class="markup--strong markup--mixtapeEmbed-strong">使用 SPM 安裝第三方套件 — Xcode 11 新功能</strong><br><em class="markup--em markup--mixtapeEmbed-em">開發 iOS App 時，我們有許多管理安裝第三方套件的方法，其中最為人熟知的三大套件管理天王為 CocoaPods，SPM(Swift Package Manager) &amp; Carthage。</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E4%BD%BF%E7%94%A8-spm-%E5%AE%89%E8%A3%9D%E7%AC%AC%E4%B8%89%E6%96%B9%E5%A5%97%E4%BB%B6-xcode-11-%E6%96%B0%E5%8A%9F%E8%83%BD-2c4ffcf85b4b" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="68d7ca0f1f357213624de0f00073e1ac" data-thumbnail-img-id="1*MsiitLtlD6QsFEh13mIVWA.jpeg" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*MsiitLtlD6QsFEh13mIVWA.jpeg);"></a></div><p name="7890" id="7890" class="graf graf--p graf-after--mixtapeEmbed">CodableCSV 的連結如下</p><pre name="09fb" id="09fb" class="graf graf--pre graf-after--p"><a href="https://github.com/dehesa/CodableCSV" data-href="https://github.com/dehesa/CodableCSV" class="markup--anchor markup--pre-anchor" rel="nofollow noopener" target="_blank">https://github.com/dehesa/CodableCSV</a></pre><figure name="da3e" id="da3e" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*rp0ej-loYMcX8aZVnSyW5w.png" data-width="1424" data-height="838" src="https://cdn-images-1.medium.com/max/800/1*rp0ej-loYMcX8aZVnSyW5w.png"></figure><figure name="69db" id="69db" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*t3qety2QBYYgVongfiWTMg.png" data-width="2136" data-height="540" src="https://cdn-images-1.medium.com/max/800/1*t3qety2QBYYgVongfiWTMg.png"></figure><h3 name="f2d5" id="f2d5" class="graf graf--h3 graf-after--figure">定義對應 csv 資料的型別: 簡單版</h3><p name="e178" id="e178" class="graf graf--p graf-after--h3">以下先介紹如何解析內容為字串，數字和 URL 的欄位，內容為 Date，Attachment &amp; Multiple select 的欄位比較複雜，待會再介紹。</p><p name="5969" id="5969" class="graf graf--p graf-after--p">新增 Movie.swift 檔，加入以下程式。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="14de" id="14de" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Movie</span>: <span class="hljs-title class_">Codable</span> {<br />    <span class="hljs-keyword">let</span> name: <span class="hljs-type">String</span><br />    <span class="hljs-keyword">let</span> imdb: <span class="hljs-type">Double</span><br />    <span class="hljs-keyword">let</span> trailer: <span class="hljs-type">URL</span><br />}</span></pre><p name="8066" id="8066" class="graf graf--p graf-after--pre">說明:</p><p name="2c4b" id="2c4b" class="graf graf--p graf-after--p">宣告 property 時，名稱對應欄位名稱，型別的規則如下</p><p name="374d" id="374d" class="graf graf--p graf-after--p">(1) 文字內容宣告成 String<br>(2) 數字宣告成 Double 或 Int<br>(3) 網址宣告成 URL</p><p name="b388" id="b388" class="graf graf--p graf-after--p">因此以剛剛的電影資料為例，name 是 String，imdb 是 Double，trailer 是 URL。</p><h3 name="26af" id="26af" class="graf graf--h3 graf-after--p">宣告 static 變數 data 儲存讀取 csv 產生的 array: 基本版</h3><p name="20e8" id="20e8" class="graf graf--p graf-after--h3">在 Movie.swift 加入 extension Movie { } 的程式.</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="c251" id="c251" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> UIKit<br /><span class="hljs-keyword">import</span> CodableCSV<br /><br /><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Movie</span>: <span class="hljs-title class_">Codable</span> {<br />    <span class="hljs-keyword">let</span> name: <span class="hljs-type">String</span><br />    <span class="hljs-keyword">let</span> imdb: <span class="hljs-type">Double</span><br />    <span class="hljs-keyword">let</span> trailer: <span class="hljs-type">URL</span><br />}<br /><br /><span class="hljs-keyword">extension</span> <span class="hljs-title class_">Movie</span> {<br />    <span class="hljs-keyword">static</span> <span class="hljs-keyword">var</span> data: [<span class="hljs-keyword">Self</span>] {<br />        <span class="hljs-keyword">var</span> array <span class="hljs-operator">=</span> [<span class="hljs-keyword">Self</span>]()<br />        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> data <span class="hljs-operator">=</span> <span class="hljs-type">NSDataAsset</span>(name: <span class="hljs-string">&quot;movies&quot;</span>)<span class="hljs-operator">?</span>.data {<br />            <span class="hljs-keyword">let</span> decoder <span class="hljs-operator">=</span> <span class="hljs-type">CSVDecoder</span> {<br />                <span class="hljs-variable">$0</span>.headerStrategy <span class="hljs-operator">=</span> .firstLine<br />            }<br />            <span class="hljs-keyword">do</span> {<br />                array <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> decoder.decode([<span class="hljs-keyword">Self</span>].<span class="hljs-keyword">self</span>, from: data)<br />            } <span class="hljs-keyword">catch</span> {<br />                <span class="hljs-built_in">print</span>(error)<br />            }<br />        }<br />        <span class="hljs-keyword">return</span> array<br />    }<br />}</span></pre><p name="34a2" id="34a2" class="graf graf--p graf-after--pre">從 asset 讀取 csv 的 data，然後利用 CSVDecoder 解析。比較特別的地方是我們另外設定 headerStrategy。headerStrategy 設為 firstLine 表示 csv 的第一行是欄位名稱。</p><p name="63e9" id="63e9" class="graf graf--p graf-after--p">ps: 寫作業的同學若是看不懂以上程式，可先複製貼上，相關的原理之後會教。</p><h3 name="61cd" id="61cd" class="graf graf--h3 graf-after--p">測試</h3><p name="9d8d" id="9d8d" class="graf graf--p graf-after--h3">利用 Movie.data 讀取 cvs 產生的電影 array，然後將它印出。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="e354" id="e354" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> UIKit<br /><br /><span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewController</span>: <span class="hljs-title class_">UIViewController</span> {<br />    <span class="hljs-keyword">let</span> movies <span class="hljs-operator">=</span> <span class="hljs-type">Movie</span>.data<br />    <br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {<br />        <span class="hljs-keyword">super</span>.viewDidLoad()<br />            <br />        <span class="hljs-built_in">print</span>(movies)<br />    }<br />}</span></pre><h3 name="0a6d" id="0a6d" class="graf graf--h3 graf-after--pre">搭配 Airtable 自訂的 table 時，如何修改範例</h3><p name="c3ff" id="c3ff" class="graf graf--p graf-after--h3">學會剛剛介紹的方法後，想要搭配 Airtable 自訂的 table 時，其實只要遵照幾個規則，修改剛剛範例的幾個地方。</p><ul class="postList"><li name="6928" id="6928" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">修改自訂的型別名稱</strong></li></ul><p name="34e5" id="34e5" class="graf graf--p graf-after--li">比方 Airtable 建立的 table 是書的資料，因此將型別取名為 Book，剛剛的 struct Movie: Codable &amp; extension Movie 改成 struct Book: Codable &amp; extension Book。</p><ul class="postList"><li name="2971" id="2971" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">修改 asset 的名字</strong></li></ul><p name="e0aa" id="e0aa" class="graf graf--p graf-after--li">比方 cvs 的 asset 叫 books，產生 NSDataAsset 時傳入 books。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="5773" id="5773" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-type">NSDataAsset</span>(name: <span class="hljs-string">&quot;books&quot;</span>)</span></pre><ul class="postList"><li name="b5ba" id="b5ba" class="graf graf--li graf-after--pre"><strong class="markup--strong markup--li-strong">依據 table 的欄位名稱宣告型別裡的 property</strong></li></ul><p name="5557" id="5557" class="graf graf--p graf-after--li">比方 table 是書的資料，欄位有 name &amp; price，因為我們宣告 property name &amp; price。property 的型別則依據以下原則:</p><p name="21a6" id="21a6" class="graf graf--p graf-after--p">(1) 文字內容宣告成 String<br>(2) 數字宣告成 Double 或 Int<br>(3) 網址宣告成 URL</p><p name="35ed" id="35ed" class="graf graf--p graf-after--p">當 table 裡的欄位只是簡單的文字，數字或網址，透過以上方法即可處理。不過強大的 Airtable 還可以包含 Date，Attachment &amp; Multiple select 等複雜的欄位，有興趣的朋友可參考以下進階版的處理方法。</p><h3 name="f918" id="f918" class="graf graf--h3 graf-after--p">定義對應 csv 資料的型別: 進階版</h3><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="1516" id="1516" class="graf graf--pre graf-after--h3 graf--preV2"><span class="pre--content"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Movie</span>: <span class="hljs-title class_">Codable</span> {<br />    <span class="hljs-keyword">let</span> name: <span class="hljs-type">String</span>   <br />    <span class="hljs-keyword">let</span> imdb: <span class="hljs-type">Double</span><br />    <span class="hljs-keyword">let</span> trailer: <span class="hljs-type">URL</span><br />    <span class="hljs-keyword">let</span> releaseDate: <span class="hljs-type">Date</span><br />    <span class="hljs-keyword">let</span> images: [<span class="hljs-type">URL</span>]<br />    <span class="hljs-keyword">let</span> genre: [<span class="hljs-type">String</span>]<br />    <br />    <span class="hljs-keyword">init</span>(<span class="hljs-params">from</span> <span class="hljs-params">decoder</span>: <span class="hljs-type">Decoder</span>) <span class="hljs-keyword">throws</span> {<br />        <span class="hljs-keyword">let</span> container <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> decoder.container(keyedBy: <span class="hljs-type">CodingKeys</span>.<span class="hljs-keyword">self</span>)<br />        name <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> container.decode(<span class="hljs-type">String</span>.<span class="hljs-keyword">self</span>, forKey: .name)<br />        imdb <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> container.decode(<span class="hljs-type">Double</span>.<span class="hljs-keyword">self</span>, forKey: .imdb)<br />        trailer <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> container.decode(<span class="hljs-type">URL</span>.<span class="hljs-keyword">self</span>, forKey: .trailer)<br />        releaseDate <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> container.decode(<span class="hljs-type">Date</span>.<span class="hljs-keyword">self</span>, forKey: .releaseDate)<br />        <span class="hljs-keyword">let</span> genreString <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> container.decode(<span class="hljs-type">String</span>.<span class="hljs-keyword">self</span>, forKey: .genre)<br />        genre <span class="hljs-operator">=</span> genreString.components(separatedBy: <span class="hljs-string">&quot;,&quot;</span>)<br />        <span class="hljs-keyword">let</span> imagesString <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> container.decode(<span class="hljs-type">String</span>.<span class="hljs-keyword">self</span>, forKey: .images)<br />        images <span class="hljs-operator">=</span> imagesString.components(separatedBy: <span class="hljs-string">&quot;,&quot;</span>).map {<br />            <span class="hljs-type">URL</span>(string: <span class="hljs-variable">$0</span>.components(separatedBy: <span class="hljs-string">&quot;(&quot;</span>)[<span class="hljs-number">1</span>].replacingOccurrences(of: <span class="hljs-string">&quot;)&quot;</span>, with: <span class="hljs-string">&quot;&quot;</span>))<span class="hljs-operator">!</span><br />        }<br />        <br />    }<br />}</span></pre><p name="b481" id="b481" class="graf graf--p graf-after--pre">欄位 releaseDate 是時間，因此 property 的型別宣告為 Date。images &amp; genre 當初在 Airtable 的型別為 Attachment &amp; Multiple select，因此它們的內容可以有多個，可以有多張圖片跟多個類別。當有多筆資料時，它們的內容將變成以雙引號描述的字串，裡頭再用逗號分隔，比方以下神力女超人1984 的例子。</p><pre name="943d" id="943d" class="graf graf--pre graf-after--p"><strong class="markup--strong markup--pre-strong">name,releaseDate,images,genre,imdb,trailer</strong><br>神力女超人1984,12/17/2020,<strong class="markup--strong markup--pre-strong">&quot;KCmsxbTj8PyMHGEii0DY-757x1080.jpg (</strong><a href="https://dl.airtable.com/.attachments/f93ca429626562410e21013dce805676/281e1ab8/KCmsxbTj8PyMHGEii0DY-757x1080.jpg%29,juaoOmPsQHebFbfDu5QU-1900x2375.jpeg" data-href="https://dl.airtable.com/.attachments/f93ca429626562410e21013dce805676/281e1ab8/KCmsxbTj8PyMHGEii0DY-757x1080.jpg),juaoOmPsQHebFbfDu5QU-1900x2375.jpeg" class="markup--anchor markup--pre-anchor" rel="nofollow noopener noopener noopener" target="_blank"><strong class="markup--strong markup--pre-strong">https://dl.airtable.com/.attachments/f93ca429626562410e21013dce805676/281e1ab8/KCmsxbTj8PyMHGEii0DY-757x1080.jpg),juaoOmPsQHebFbfDu5QU-1900x2375.jpeg</strong></a><strong class="markup--strong markup--pre-strong"> (</strong><a href="https://dl.airtable.com/.attachments/613c84a0c2ce3ac109796a5c59d7001c/4b0b2f12/juaoOmPsQHebFbfDu5QU-1900x2375.jpeg" data-href="https://dl.airtable.com/.attachments/613c84a0c2ce3ac109796a5c59d7001c/4b0b2f12/juaoOmPsQHebFbfDu5QU-1900x2375.jpeg" class="markup--anchor markup--pre-anchor" rel="nofollow noopener noopener noopener" target="_blank"><strong class="markup--strong markup--pre-strong">https://dl.airtable.com/.attachments/613c84a0c2ce3ac109796a5c59d7001c/4b0b2f12/juaoOmPsQHebFbfDu5QU-1900x2375.jpeg</strong></a><strong class="markup--strong markup--pre-strong">)&quot;</strong>,<strong class="markup--strong markup--pre-strong">&quot;動作,冒險,劇情&quot;</strong>,7.3,<a href="https://www.youtube.com/watch?v=Mw3u7Arx3Ss" data-href="https://www.youtube.com/watch?v=Mw3u7Arx3Ss" class="markup--anchor markup--pre-anchor" rel="nofollow noopener noopener noopener" target="_blank">https://www.youtube.com/watch?v=Mw3u7Arx3Ss</a><br>鬼滅之刃劇場版 無限列車篇,10/30/2020,hFH7arAJqBIZaUdOGiuC-1182x1691.jpg (<a href="https://dl.airtable.com/.attachments/2b726239194e85c6cd52e7d228657345/a14a1924/hFH7arAJqBIZaUdOGiuC-1182x1691.jpg" data-href="https://dl.airtable.com/.attachments/2b726239194e85c6cd52e7d228657345/a14a1924/hFH7arAJqBIZaUdOGiuC-1182x1691.jpg" class="markup--anchor markup--pre-anchor" rel="nofollow noopener noopener noopener" target="_blank">https://dl.airtable.com/.attachments/2b726239194e85c6cd52e7d228657345/a14a1924/hFH7arAJqBIZaUdOGiuC-1182x1691.jpg</a>),動畫,8.3,<a href="https://www.youtube.com/watch?v=mR88lNYVqto" data-href="https://www.youtube.com/watch?v=mR88lNYVqto" class="markup--anchor markup--pre-anchor" rel="nofollow noopener noopener noopener" target="_blank">https://www.youtube.com/watch?v=mR88lNYVqto</a><br>孤味,11/6/2020,7ZbNJdYQsNCYp0IvZfkA-504x720.jpg (<a href="https://dl.airtable.com/.attachments/ad3cdb32d77e1e32cd72fd618c87387a/deda6c8c/7ZbNJdYQsNCYp0IvZfkA-504x720.jpg" data-href="https://dl.airtable.com/.attachments/ad3cdb32d77e1e32cd72fd618c87387a/deda6c8c/7ZbNJdYQsNCYp0IvZfkA-504x720.jpg" class="markup--anchor markup--pre-anchor" rel="nofollow noopener noopener noopener" target="_blank">https://dl.airtable.com/.attachments/ad3cdb32d77e1e32cd72fd618c87387a/deda6c8c/7ZbNJdYQsNCYp0IvZfkA-504x720.jpg</a>),劇情,7.8,<a href="https://www.youtube.com/watch?v=UKHhlhQROH4" data-href="https://www.youtube.com/watch?v=UKHhlhQROH4" class="markup--anchor markup--pre-anchor" rel="nofollow noopener noopener noopener" target="_blank">https://www.youtube.com/watch?v=UKHhlhQROH4</a></pre><p name="ca86" id="ca86" class="graf graf--p graf-after--pre">在剛剛的例子裡，我們將 images &amp; genre 的型別宣告為 array，分別為 [URL] &amp; [String]。其中 images 的內容是 Attachment，對應的資料是檔案，所以 csv 的內容為檔案的連結網址，因此我們將 images 宣告為 [URL]。</p><p name="7483" id="7483" class="graf graf--p graf-after--p">不過 CSVDecoder 沒那麼聰明，無法自動處理 property 是 array 的 case，我們必須自己定義 init(from:) 解析，對 init(from:) 不熟的朋友可先參考以下連結的說明，再研究剛剛的程式碼。</p><p name="8a8a" id="8a8a" class="graf graf--p graf-after--p">ps: 如果沒有型別 array 的 property，則會簡單許多，不用定義 init(from:)。</p><div name="530a" id="530a" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E8%87%AA%E8%A8%82-init-from-decoder-%E8%A7%A3%E6%9E%90-json-f9c8d420cda4" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E8%87%AA%E8%A8%82-init-from-decoder-%E8%A7%A3%E6%9E%90-json-f9c8d420cda4" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E8%87%AA%E8%A8%82-init-from-decoder-%E8%A7%A3%E6%9E%90-json-f9c8d420cda4"><strong class="markup--strong markup--mixtapeEmbed-strong">定義 Decodable 的 init(from:) 解析 JSON</strong><br><em class="markup--em markup--mixtapeEmbed-em">透過 JSONDecoder，我們可以方便地將 JSON 資料變成遵從 protocol Decodable 的自訂型別，而且大部分的時候我們只要宣告型別裡的 property，不用自己撰寫解析 JSON 的 init(from…</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E8%87%AA%E8%A8%82-init-from-decoder-%E8%A7%A3%E6%9E%90-json-f9c8d420cda4" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="f2f0a35aa460b7489fcc5705881cd7d1" data-thumbnail-img-id="1*8bdlwtE_6dUJIbgSi6JIlw.jpeg" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*8bdlwtE_6dUJIbgSi6JIlw.jpeg);"></a></div><h3 name="1505" id="1505" class="graf graf--h3 graf-after--mixtapeEmbed">宣告 static 變數 data 儲存讀取 csv 產生的 array: 進階版</h3><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="762c" id="762c" class="graf graf--pre graf-after--h3 graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> UIKit<br /><span class="hljs-keyword">import</span> CodableCSV<br /><br /><span class="hljs-keyword">extension</span> <span class="hljs-title class_">Movie</span> {<br />    <span class="hljs-keyword">static</span> <span class="hljs-keyword">var</span> data: [<span class="hljs-keyword">Self</span>] {<br />        <span class="hljs-keyword">var</span> array <span class="hljs-operator">=</span> [<span class="hljs-keyword">Self</span>]()<br />        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> data <span class="hljs-operator">=</span> <span class="hljs-type">NSDataAsset</span>(name: <span class="hljs-string">&quot;movies&quot;</span>)<span class="hljs-operator">?</span>.data {<br />            <span class="hljs-keyword">let</span> decoder <span class="hljs-operator">=</span> <span class="hljs-type">CSVDecoder</span> {<br />                <span class="hljs-variable">$0</span>.headerStrategy <span class="hljs-operator">=</span> .firstLine<br />                <span class="hljs-keyword">let</span> formatter <span class="hljs-operator">=</span> <span class="hljs-type">DateFormatter</span>()<br />                formatter.dateFormat <span class="hljs-operator">=</span> <span class="hljs-string">&quot;MM/dd/yyyy&quot;</span><br />                <span class="hljs-variable">$0</span>.dateStrategy <span class="hljs-operator">=</span> .formatted(formatter)<br />            }<br />            <span class="hljs-keyword">do</span> {<br />                array <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> decoder.decode([<span class="hljs-keyword">Self</span>].<span class="hljs-keyword">self</span>, from: data)<br />            } <span class="hljs-keyword">catch</span> {<br />                <span class="hljs-built_in">print</span>(error)<br />            }<br />        }<br />        <span class="hljs-keyword">return</span> array<br />    }<br />}</span></pre><p name="dae2" id="dae2" class="graf graf--p graf-after--pre">比較特別的地方是我們另外設定 dateStrategy，將 dateStrategy 設為自訂的 DateFormatter 讓 CSVDecoder 知道如何將時間字串轉換為 Date。若無 Date 型別的 property，則可拿掉 dateStrategy 的設定。</p><h3 name="09b3" id="09b3" class="graf graf--h3 graf-after--p"><strong class="markup--strong markup--h3-strong">依據 table 的欄位名稱宣告型別裡的 property: 進階版</strong></h3><p name="5c56" id="5c56" class="graf graf--p graf-after--h3">了解以上進階版的做法後，依據 table 的欄位名稱宣告型別裡的 property 時規則如下</p><p name="155f" id="155f" class="graf graf--p graf-after--p">(1) 文字內容宣告成 String<br>(2) 數字宣告成 Double 或 Int<br>(3) 網址宣告成 URL<br>(4) 時間宣告成 Date<br>(5) 內容是 Attachments 時，型別應宣告為 [URL]<br>(6) 內容是 Multiple select 時，型別應宣告為 [String]</p><p name="6da3" id="6da3" class="graf graf--p graf-after--p graf--trailing">如果只有 1 ~ 4 的 case ，則不用定義 init(from:)。若有 5 或 6 的 case，則須參考剛剛範例的寫法定義 init(from:)。</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@apppeterpan" class="p-author h-card">彼得潘的 iOS App Neverland</a> on <a href="https://medium.com/p/1cc8bc6a9570"><time class="dt-published" datetime="2020-12-25T07:42:52.442Z">December 25, 2020</time></a>.</p><p><a href="https://medium.com/@apppeterpan/%E5%88%A9%E7%94%A8-codablecsv-%E8%A7%A3%E6%9E%90-csv-%E4%BB%A5airtable-%E7%82%BA%E4%BE%8B-1cc8bc6a9570" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on September 17, 2025.</p></footer></article></body></html>