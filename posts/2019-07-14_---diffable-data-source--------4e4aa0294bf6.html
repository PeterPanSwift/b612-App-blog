<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>利用 diffable data source 顯示表格內容</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">利用 diffable data source 顯示表格內容</h1>
</header>
<section data-field="subtitle" class="p-summary">
從 iOS 13 開始，搭配全新的 UITableViewDiffableDataSource，現在從程式設定表格內容變得更方便了。
</section>
<section data-field="body" class="e-content">
<section name="85ca" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="3736" id="3736" class="graf graf--h3 graf--leading graf--title">利用 diffable data source 顯示表格內容</h3><p name="da11" id="da11" class="graf graf--p graf-after--h3">從 iOS 13 開始，搭配全新的 UITableViewDiffableDataSource，現在從程式設定表格內容變得更方便了。</p><div name="501e" id="501e" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://developer.apple.com/documentation/uikit/uitableviewdiffabledatasource" data-href="https://developer.apple.com/documentation/uikit/uitableviewdiffabledatasource" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/uikit/uitableviewdiffabledatasource"><strong class="markup--strong markup--mixtapeEmbed-strong">UITableViewDiffableDataSource - UIKit | Apple Developer Documentation</strong><br><em class="markup--em markup--mixtapeEmbed-em">This documentation contains preliminary information about an API or technology in development. This information is…</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/uikit/uitableviewdiffabledatasource" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="215132e275c467ff6a54eb3cdce5d289"></a></div><p name="1653" id="1653" class="graf graf--p graf-after--mixtapeEmbed">UITableViewDiffableDataSource 有很多厲害的地方，比方當表格呈現的資料內容有變化時，它可以比較差異，然後以生動的動畫顯示新增刪除的效果。(ps: diffable 是差異的意思，由名字可看出它是個擅長比較差異的狠角色)</p><p name="f24f" id="f24f" class="graf graf--p graf-after--p">接下來我們就以顯示蜘蛛人電影的表格為例， 一步步認識 UITableViewDiffableDataSource 吧。</p><figure name="462a" id="462a" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*0bt8n1l9a908QB96FLGCAg.jpeg" data-width="802" data-height="1368" src="https://cdn-images-1.medium.com/max/800/1*0bt8n1l9a908QB96FLGCAg.jpeg"><figcaption class="imageCaption">以 UITableViewDiffableDataSource 實現的蜘蛛人電影表格</figcaption></figure><h3 name="4151" id="4151" class="graf graf--h3 graf-after--figure">建立繼承 UITableViewController 的 MovieTableViewController</h3><p name="3720" id="3720" class="graf graf--p graf-after--h3">我們將在 MovieTableViewController 撰寫設定表格內容的程式。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="ab83" id="ab83" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MovieTableViewController</span>: <span class="hljs-title class_">UITableViewController</span> {<br /><br />}</span></pre><h3 name="0e7f" id="0e7f" class="graf graf--h3 graf-after--pre">在 storyboard 加入 table view controller，將 class 設為 MovieTableViewController</h3></div><div class="section-inner sectionLayout--outsetRow" data-paragraph-count="2"><figure name="56c8" id="56c8" class="graf graf--figure graf--layoutOutsetRow is-partialWidth graf-after--h3" style="width: 34.636%;"><img class="graf-image" data-image-id="1*O54IT7Tk-kIN6y0rM0zxUA.jpeg" data-width="1048" data-height="954" src="https://cdn-images-1.medium.com/max/600/1*O54IT7Tk-kIN6y0rM0zxUA.jpeg"></figure><figure name="665a" id="665a" class="graf graf--figure graf--layoutOutsetRowContinue is-partialWidth graf-after--figure" style="width: 65.364%;"><img class="graf-image" data-image-id="1*02i-gyr4yP6sdEsJTJshhg.jpeg" data-width="560" data-height="270" src="https://cdn-images-1.medium.com/max/800/1*02i-gyr4yP6sdEsJTJshhg.jpeg"></figure></div><div class="section-inner sectionLayout--insetColumn"><h3 name="ceed" id="ceed" class="graf graf--h3 graf-after--figure">將 table view cell 的 Identifier 設為 movieCell</h3><p name="4274" id="4274" class="graf graf--p graf-after--h3">我們在程式裡要產生 storyboard 裡設計的 cell，因此我們將 cell 的 Identifier 設為 movieCell，之後才能從程式指名產生名叫 movieCell 的 cell。</p></div><div class="section-inner sectionLayout--outsetRow" data-paragraph-count="2"><figure name="05f2" id="05f2" class="graf graf--figure graf--layoutOutsetRow is-partialWidth graf-after--p" style="width: 62.975%;"><img class="graf-image" data-image-id="1*ebYfY6hLzOQHzlo3HHqk6w.jpeg" data-width="950" data-height="238" src="https://cdn-images-1.medium.com/max/800/1*ebYfY6hLzOQHzlo3HHqk6w.jpeg"></figure><figure name="3724" id="3724" class="graf graf--figure graf--layoutOutsetRowContinue is-partialWidth graf-after--figure" style="width: 37.025%;"><img class="graf-image" data-image-id="1*bi5U1n3q1hCisyD06x-lXg.jpeg" data-width="554" data-height="236" src="https://cdn-images-1.medium.com/max/600/1*bi5U1n3q1hCisyD06x-lXg.jpeg"></figure></div><div class="section-inner sectionLayout--insetColumn"><h3 name="1b7b" id="1b7b" class="graf graf--h3 graf-after--figure">設定 table view 的 row height</h3><p name="ecba" id="ecba" class="graf graf--p graf-after--h3">為了看清楚帥氣的蜘蛛人照片，我們將 cell 調大一點，高度設為 198。</p><figure name="77d8" id="77d8" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*KaTTG7a3WVu5wKv0-Pq37A.jpeg" data-width="1050" data-height="418" src="https://cdn-images-1.medium.com/max/800/1*KaTTG7a3WVu5wKv0-Pq37A.jpeg"></figure><h3 name="8e5f" id="8e5f" class="graf graf--h3 graf-after--figure">table view 的 section &amp; item</h3><p name="a71b" id="a71b" class="graf graf--p graf-after--h3">table view 顯示內容時，它會先以 section 分類，然後每個 section 底下再顯示東西(item)。比方通訊錄 App 會依字母分類 section，以下圖為例，P 是一個 section，section P 下的內容是名字 P 開頭的朋友，它顯示了大英雄 Peter Pan &amp; Peter Park。而 T 是另一個 section，底下顯示可愛的 Tinker Bell。</p><figure name="660e" id="660e" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*4e1A9ThrcvOUUiYLv5V_Wg.jpeg" data-width="1390" data-height="706" src="https://cdn-images-1.medium.com/max/800/1*4e1A9ThrcvOUUiYLv5V_Wg.jpeg"></figure><h3 name="e5ce" id="e5ce" class="graf graf--h3 graf-after--figure">在 MovieTableViewController 裡宣告型別 UITableViewDiffableDataSource 的 property dataSource</h3><p name="2a07" id="2a07" class="graf graf--p graf-after--h3">了解表格 section &amp; item 的概念後，讓我們回過頭看看主角 class UITableViewDiffableDataSource。它的宣告如下，SectionIdentifierType, &amp; ItemIdentifierType 是它的 generic type。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="b1e4" id="b1e4" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">class</span> <span class="hljs-title class_">UITableViewDiffableDataSource</span>&lt;<span class="hljs-title class_">SectionIdentifierType</span>, <span class="hljs-title class_">ItemIdentifierType</span>&gt; : <span class="hljs-title class_">NSObject</span> <span class="hljs-title class_">where</span> <span class="hljs-title class_">SectionIdentifierType</span> : <span class="hljs-title class_">Hashable</span>, <span class="hljs-title class_">ItemIdentifierType</span> : <span class="hljs-title class_">Hashable</span></span></pre><p name="20ca" id="20ca" class="graf graf--p graf-after--pre">UITableViewDiffableDataSource 控制表格顯示的內容時，為了能在資料變化時辨識差異，知道哪些是新增刪除的資料，它需要我們設定 generic type，描述能辨識 section &amp; item 的型別。因此我們在 MovieTableViewController 裡宣告型別 UITableViewDiffableDataSource 的 property dataSource 時，加上 <code class="markup--code markup--p-code">&lt;Section, Movie&gt;</code>說明它的 section 辨識型別是 Section，內容辨識型別是 Movie。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="7206" id="7206" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">var</span> dataSource: <span class="hljs-type">UITableViewDiffableDataSource</span>&lt;<span class="hljs-type">Section</span>, <span class="hljs-type">Movie</span>&gt;!</span></pre><p name="b4d2" id="b4d2" class="graf graf--p graf-after--pre">以下為 Section &amp; Movie 的定義。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="0f3b" id="0f3b" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">enum</span> <span class="hljs-title class_">Section</span> {<br />   <span class="hljs-keyword">case</span> movie<br />}<br /><br /><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Movie</span>: <span class="hljs-title class_">Hashable</span> {<br />   <span class="hljs-keyword">var</span> name: <span class="hljs-type">String</span><br />   <span class="hljs-keyword">var</span> <span class="hljs-keyword">actor</span>: <span class="hljs-title class_">String</span><br />   <span class="hljs-title class_">var</span> <span class="hljs-title class_">year</span>: <span class="hljs-title class_">Int</span><br />}</span></pre><p name="aa6f" id="aa6f" class="graf graf--p graf-after--pre">值得注意的，根據 UITableViewDiffableDataSource 的定義，section &amp; item 的辨識型別必須遵從 protocol Hashable，因為這樣表格的 section &amp; item 資料才能產生可判斷是否為同一筆資料的 hash value，UITableViewDiffableDataSource 將用 hash value 判斷資料的變化，然後再以生動的動畫呈現新增刪除的效果。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="30ea" id="30ea" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">class</span> <span class="hljs-title class_">UITableViewDiffableDataSource</span>&lt;<span class="hljs-title class_">SectionIdentifierType</span>, <span class="hljs-title class_">ItemIdentifierType</span>&gt; : <span class="hljs-title class_">NSObject</span> <span class="hljs-title class_">where</span> <span class="hljs-title class_">SectionIdentifierType</span> : <span class="hljs-title class_">Hashable</span>, <span class="hljs-title class_">ItemIdentifierType</span> : <span class="hljs-title class_">Hashable</span></span></pre><p name="c4c1" id="c4c1" class="graf graf--p graf-after--pre">關於 protocol Hashable 的相關介紹可參考以下連結。</p><div name="7a55" id="7a55" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/swift-%E7%9A%84-hashable-protocol-6df8adfdcb54" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/swift-%E7%9A%84-hashable-protocol-6df8adfdcb54" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/swift-%E7%9A%84-hashable-protocol-6df8adfdcb54"><strong class="markup--strong markup--mixtapeEmbed-strong">Swift 的 Hashable protocol</strong><br><em class="markup--em markup--mixtapeEmbed-em">Swift 裡有一個特別的 Hashable protocol，我們在很多地方都可以看到它的蹤跡。</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/swift-%E7%9A%84-hashable-protocol-6df8adfdcb54" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="be07081914538004cc4ff12ea71af6ad" data-thumbnail-img-id="1*WNs3MCWZIKAas7mWk-hUTQ.jpeg" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*WNs3MCWZIKAas7mWk-hUTQ.jpeg);"></a></div><p name="8198" id="8198" class="graf graf--p graf-after--mixtapeEmbed">section 的辨識型別我們習慣用 enum 定義，因為表格的 section 的主要目的是分類，而 enum 的 case 很適合用來描述分類，因此表格 section 的數量即是 enum 裡 case 的數量。比方當電影列表 App 不分類時 ，enum 裡只需要一個 case movie。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="ddb0" id="ddb0" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">enum</span> <span class="hljs-title class_">Section</span> {<br />   <span class="hljs-keyword">case</span> movie<br />}</span></pre><p name="b730" id="b730" class="graf graf--p graf-after--pre">但我們也可以設計包含多個 section 的電影列表，每個 section 代表不同類型的電影，比方分成喜劇，恐怖，動作片。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="1c00" id="1c00" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">enum</span> <span class="hljs-title class_">Section</span> {<br />   <span class="hljs-keyword">case</span> comedy<br />   <span class="hljs-keyword">case</span> horror<br />   <span class="hljs-keyword">case</span> action<br />}</span></pre><p name="6ef3" id="6ef3" class="graf graf--p graf-after--pre">由於 enum 定義的型別本身就遵從 Hashable，所以定義 enum 時我們不用再加上<code class="markup--code markup--p-code"> : Hashable</code>。(ps: 搭配 associated value 的 enum 例外。)</p><p name="5896" id="5896" class="graf graf--p graf-after--p">而 item 的辨識型別我們習慣使用表格要顯示的資料型別，因此在這裡我們使用 struct 定義的型別 Movie。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="96e6" id="96e6" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Movie</span>: <span class="hljs-title class_">Hashable</span> {<br />   <span class="hljs-keyword">var</span> name: <span class="hljs-type">String</span><br />   <span class="hljs-keyword">var</span> <span class="hljs-keyword">actor</span>: <span class="hljs-title class_">String</span><br />   <span class="hljs-title class_">var</span> <span class="hljs-title class_">year</span>: <span class="hljs-title class_">Int</span><br />}</span></pre><p name="b494" id="b494" class="graf graf--p graf-after--pre">由於 Movie 的 property 也都遵從 Hashable，因此我們只要在 Movie 後接<code class="markup--code markup--p-code"> : Hashable</code>，Swift 將自動幫我們定義產生 hash value 的相關程式。不過若是 property 不遵從 Hashable，或是我們想自己實現產生 hash value 的程式，有時我們得自己定義 function hash(into:) &amp; ==，相關資訊可參考以下連結。</p><div name="20f0" id="20f0" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/swift-%E7%9A%84-hashable-protocol-6df8adfdcb54" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/swift-%E7%9A%84-hashable-protocol-6df8adfdcb54" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/swift-%E7%9A%84-hashable-protocol-6df8adfdcb54"><strong class="markup--strong markup--mixtapeEmbed-strong">Swift 的 Hashable protocol</strong><br><em class="markup--em markup--mixtapeEmbed-em">Swift 裡有一個特別的 Hashable protocol，我們在很多地方都可以看到它的蹤跡。</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/swift-%E7%9A%84-hashable-protocol-6df8adfdcb54" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="be07081914538004cc4ff12ea71af6ad" data-thumbnail-img-id="1*WNs3MCWZIKAas7mWk-hUTQ.jpeg" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*WNs3MCWZIKAas7mWk-hUTQ.jpeg);"></a></div><h3 name="69f5" id="69f5" class="graf graf--h3 graf-after--mixtapeEmbed">宣告儲存蜘蛛人電影的 property movies</h3><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="0fff" id="0fff" class="graf graf--pre graf-after--h3 graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> movies <span class="hljs-operator">=</span> [<br />  <span class="hljs-type">Movie</span>(name: <span class="hljs-string">&quot;蜘蛛人:返校日&quot;</span>, actor: <span class="hljs-string">&quot;湯姆&quot;</span>, year: <span class="hljs-number">2017</span>),    <br />  <span class="hljs-type">Movie</span>(name: <span class="hljs-string">&quot;蜘蛛人:驚奇再起&quot;</span>, actor: <span class="hljs-string">&quot;安德魯&quot;</span>, year: <span class="hljs-number">2012</span>),<br />  <span class="hljs-type">Movie</span>(name: <span class="hljs-string">&quot;蜘蛛人&quot;</span>, actor: <span class="hljs-string">&quot;陶比&quot;</span>, year: <span class="hljs-number">2002</span>)<br />]</span></pre><h3 name="bbc7" id="bbc7" class="graf graf--h3 graf-after--pre">在 viewDidLoad 裡利用 UITableViewDiffableDataSource 呈現表格內容</h3><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="11b3" id="11b3" class="graf graf--pre graf-after--h3 graf--preV2"><span class="pre--content"><span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {<br />   <span class="hljs-keyword">super</span>.viewDidLoad()<br />   dataSource <span class="hljs-operator">=</span> <span class="hljs-type">UITableViewDiffableDataSource</span>&lt;<span class="hljs-type">Section</span>, <span class="hljs-type">Movie</span>&gt;(tableView: tableView) { tableView, indexPath, itemIdentifier <span class="hljs-keyword">in</span><br />      <span class="hljs-keyword">let</span> cell <span class="hljs-operator">=</span> tableView.dequeueReusableCell(withIdentifier: <span class="hljs-string">&quot;movieCell&quot;</span>, for: indexPath)<br />      cell.textLabel<span class="hljs-operator">?</span>.text <span class="hljs-operator">=</span> itemIdentifier.name<br />      cell.imageView<span class="hljs-operator">?</span>.image <span class="hljs-operator">=</span> <span class="hljs-type">UIImage</span>(named: itemIdentifier.actor)<br />      <span class="hljs-keyword">return</span> cell<br />   }<br />   tableView.dataSource <span class="hljs-operator">=</span> dataSource<br />   <span class="hljs-keyword">var</span> snapshot <span class="hljs-operator">=</span> <span class="hljs-type">NSDiffableDataSourceSnapshot</span>&lt;<span class="hljs-type">Section</span>, <span class="hljs-type">Movie</span>&gt;()<br />   snapshot.appendSections([.movie])<br />   snapshot.appendItems(movies)<br />   dataSource.apply(snapshot, animatingDifferences: <span class="hljs-literal">false</span>)<br />}</span></pre><p name="4353" id="4353" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">說明</strong></p><p name="b89b" id="b89b" class="graf graf--p graf-after--p">利用 UITableViewDiffableDataSource 呈現表格內容，主要可分成以下兩個重要的步驟。</p><h3 name="28e4" id="28e4" class="graf graf--h3 graf-after--p">產生 UITableViewDiffableDataSource &amp; 設定 cell 內容</h3><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="aa92" id="aa92" class="graf graf--pre graf-after--h3 graf--preV2"><span class="pre--content">dataSource <span class="hljs-operator">=</span> <span class="hljs-type">UITableViewDiffableDataSource</span>&lt;<span class="hljs-type">Section</span>, <span class="hljs-type">Movie</span>&gt;(tableView: tableView) { tableView, indexPath, itemIdentifier <span class="hljs-keyword">in</span><br />    <span class="hljs-keyword">let</span> cell <span class="hljs-operator">=</span> tableView.dequeueReusableCell(withIdentifier: <span class="hljs-string">&quot;movieCell&quot;</span>, for: indexPath)<br />    cell.textLabel<span class="hljs-operator">?</span>.text <span class="hljs-operator">=</span> itemIdentifier.name<br />    cell.imageView<span class="hljs-operator">?</span>.image <span class="hljs-operator">=</span> <span class="hljs-type">UIImage</span>(named: itemIdentifier.actor)<br />    <span class="hljs-keyword">return</span> cell<br />}<br />tableView.dataSource <span class="hljs-operator">=</span> dataSource</span></pre><ul class="postList"><li name="4c73" id="4c73" class="graf graf--li graf-after--pre"><strong class="markup--strong markup--li-strong">產生 UITableViewDiffableDataSource 物件</strong></li></ul><p name="3c71" id="3c71" class="graf graf--p graf-after--li">UITableViewDiffableDataSource 的 init 定義如下。</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="less" name="57fa" id="57fa" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-selector-tag">init</span>(<span class="hljs-attribute">tableView</span>: UITableView, <span class="hljs-attribute">cellProvider</span>: <span class="hljs-variable">@escaping</span> UITableViewDiffableDataSource&lt;SectionIdentifierType, ItemIdentifierType&gt;.CellProvider)</span></pre><p name="1f3c" id="1f3c" class="graf graf--p graf-after--pre">型別 CellProvider 的定義如下。cellProvider 第三個參數的型別將等於我們建立 UITableViewDiffableDataSource 時指定的 ItemIdentifierType，因此在這裡它的型別是 Movie。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="6471" id="6471" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">typealias</span> <span class="hljs-type">CellProvider</span> <span class="hljs-operator">=</span> (<span class="hljs-type">UITableView</span>, <span class="hljs-type">IndexPath</span>, <span class="hljs-type">ItemIdentifierType</span>) -&gt; <span class="hljs-type">UITableViewCell</span>?</span></pre><p name="0170" id="0170" class="graf graf--p graf-after--pre">產生 UITableViewDiffableDataSource 物件時，重點在第二個參數 cellProvider 。</p><figure name="1884" id="1884" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*Lae-uXuSvq2Hl4jOvZDl7Q.png" data-width="2144" data-height="140" src="https://cdn-images-1.medium.com/max/800/1*Lae-uXuSvq2Hl4jOvZDl7Q.png"></figure><p name="806f" id="806f" class="graf graf--p graf-after--figure">表格顯示時將呼叫 closure，得到要顯示的 cell。比方若表格要顯示蜘蛛人的三部電影，closure 將被呼叫三次，我們可由 closure 的第三個參數取得 cell 要顯示的電影，然後將它的內容設定到回傳的 cell 上。</p><ul class="postList"><li name="303a" id="303a" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">將 UITableViewDiffableDataSource 物件設為表格的 dataSource</strong></li></ul><p name="4b42" id="4b42" class="graf graf--p graf-after--li">當表格顯示內容時，它會找它的 property dataSource 幫忙。而 UITableViewDiffableDataSource 遵從了 UITableViewDataSource，因此我們可將 UITableViewDiffableDataSource 物件設為表格的 dataSource，交由 UITableViewDiffableDataSource 控制表格顯示的內容。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="fd43" id="fd43" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">class</span> <span class="hljs-title class_">UITableViewDiffableDataSource</span>&lt;<span class="hljs-title class_">SectionIdentifierType</span>, <span class="hljs-title class_">ItemIdentifierType</span>&gt; : <span class="hljs-title class_">NSObject</span>, <span class="hljs-title class_">UITableViewDataSource</span> <span class="hljs-title class_">where</span> <span class="hljs-title class_">SectionIdentifierType</span> : <span class="hljs-title class_">Hashable</span>, <span class="hljs-title class_">ItemIdentifierType</span> : <span class="hljs-title class_">Hashable</span></span></pre><p name="fd68" id="fd68" class="graf graf--p graf-after--pre">此處有個特別的地方。有些聰明的朋友會想到何不直接將產生的 UITableViewDiffableDataSource 存入 tableView.dataSource ? 為何要麻煩地先在 controller 宣告 dataSource property，然後先存入 controller 的 dataSource，再存入 table view 的 dataSource 呢 ?</p><figure name="027b" id="027b" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*IqkEuGxrA2iVH7LMNX_coQ.jpeg" data-width="1762" data-height="324" src="https://cdn-images-1.medium.com/max/800/1*IqkEuGxrA2iVH7LMNX_coQ.jpeg"></figure><p name="9d4c" id="9d4c" class="graf graf--p graf-after--figure">如上圖所示，倘若我們直接存入 table view 的 dataSource，將產生問題，Instance will be immediately deallocated because property dataSource is weak。</p><p name="1cbf" id="1cbf" class="graf graf--p graf-after--p">因為 UITableView 的 dataSource 是 weak，所以這樣存入的東西馬上就會死掉，可憐的 UITableViewDiffableDataSource，它還來不及顯示蜘蛛人就出師未捷身先死。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="313e" id="313e" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">weak</span> <span class="hljs-keyword">open</span> <span class="hljs-keyword">var</span> dataSource: <span class="hljs-type">UITableViewDataSource</span>?</span></pre><h3 name="9c4d" id="9c4d" class="graf graf--h3 graf-after--pre">產生指定表格內容的 NSDiffableDataSourceSnapshot</h3><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="1931" id="1931" class="graf graf--pre graf-after--h3 graf--preV2"><span class="pre--content"><span class="hljs-keyword">var</span> snapshot <span class="hljs-operator">=</span> <span class="hljs-type">NSDiffableDataSourceSnapshot</span>&lt;<span class="hljs-type">Section</span>, <span class="hljs-type">Movie</span>&gt;()<br />snapshot.appendSections([.movie])<br />snapshot.appendItems(movies)<br />dataSource.apply(snapshot, animatingDifferences: <span class="hljs-literal">false</span>)</span></pre><p name="7bfe" id="7bfe" class="graf graf--p graf-after--pre">將 UITableViewDiffableDataSource 設為 table view 的 dataSource 後，表格還是一片空白，因為它還不知道要顯示什麼。我們還少了一個關鍵步驟，利用 NSDiffableDataSourceSnapshot 指定表格的內容。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="bc23" id="bc23" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> snapshot <span class="hljs-operator">=</span> <span class="hljs-type">NSDiffableDataSourceSnapshot</span>&lt;<span class="hljs-type">Section</span>, <span class="hljs-type">Movie</span>&gt;()</span></pre><p name="796d" id="796d" class="graf graf--p graf-after--pre">產生決定表格內容的 NSDiffableDataSourceSnapshot。NSDiffableDataSourceSnapshot 的定義如下，SectionIdentifierType &amp; ItemIdentifierType 是它的 generic type，它必須和當初 UITableViewDiffableDataSource 指定的 generic type 一致，因此我們傳入 Section &amp; Movie</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="46be" id="46be" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">class</span> <span class="hljs-title class_">NSDiffableDataSourceSnapshot</span>&lt;<span class="hljs-title class_">SectionIdentifierType</span>, <span class="hljs-title class_">ItemIdentifierType</span>&gt; <span class="hljs-title class_">where</span> <span class="hljs-title class_">SectionIdentifierType</span> : <span class="hljs-title class_">Hashable</span>, <span class="hljs-title class_">ItemIdentifierType</span> : <span class="hljs-title class_">Hashable</span></span></pre><div name="3db7" id="3db7" class="graf graf--mixtapeEmbed graf-after--pre"><a href="https://developer.apple.com/documentation/uikit/nsdiffabledatasourcesnapshot" data-href="https://developer.apple.com/documentation/uikit/nsdiffabledatasourcesnapshot" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/uikit/nsdiffabledatasourcesnapshot"><strong class="markup--strong markup--mixtapeEmbed-strong">NSDiffableDataSourceSnapshot - UIKit | Apple Developer Documentation</strong><br><em class="markup--em markup--mixtapeEmbed-em">This documentation contains preliminary information about an API or technology in development. This information is…</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/uikit/nsdiffabledatasourcesnapshot" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="572f6e4278cee71bd8964f0f4aa3c4da"></a></div><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="0cec" id="0cec" class="graf graf--pre graf-after--mixtapeEmbed graf--preV2"><span class="pre--content">snapshot.appendSections([.movie])</span></pre><p name="697d" id="697d" class="graf graf--p graf-after--pre">加入 section ，讓電影列表有一個 movie section。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="44ec" id="44ec" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">snapshot.appendItems(movies)</span></pre><p name="937a" id="937a" class="graf graf--p graf-after--pre">加入 section 下的 items。在此我們傳入包含三部蜘蛛人電影的 array movies ，因此 section 下將顯示三個 cell。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="0583" id="0583" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">dataSource.apply(snapshot, animatingDifferences: <span class="hljs-literal">false</span>)</span></pre><p name="919b" id="919b" class="graf graf--p graf-after--pre">從 UITableViewDiffableDataSource 物件呼叫 function apply(_:animatingDifferences:) 設定表格顯示的內容。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="6f25" id="6f25" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">apply</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">snapshot</span>: <span class="hljs-type">NSDiffableDataSourceSnapshot</span>&lt;<span class="hljs-type">SectionIdentifierType</span>, <span class="hljs-type">ItemIdentifierType</span>&gt;, <span class="hljs-params">animatingDifferences</span>: <span class="hljs-type">Bool</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>)</span></pre><p name="b414" id="b414" class="graf graf--p graf-after--pre">參數說明</p><p name="57d1" id="57d1" class="graf graf--p graf-after--p">snapshot: 表格顯示的內容。</p><p name="e321" id="e321" class="graf graf--p graf-after--p">animatingDifferences: 是否有動畫。</p><div name="0bd9" id="0bd9" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://developer.apple.com/documentation/uikit/uitableviewdiffabledatasource/3255147-apply" data-href="https://developer.apple.com/documentation/uikit/uitableviewdiffabledatasource/3255147-apply" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/uikit/uitableviewdiffabledatasource/3255147-apply"><strong class="markup--strong markup--mixtapeEmbed-strong">apply(_:animatingDifferences:) - UITableViewDiffableDataSource | Apple Developer Documentation</strong><br><em class="markup--em markup--mixtapeEmbed-em">This documentation contains preliminary information about an API or technology in development. This information is…</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/uikit/uitableviewdiffabledatasource/3255147-apply" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="9e251d874e995e3d5dedeb77590682bd"></a></div><p name="57e6" id="57e6" class="graf graf--p graf-after--mixtapeEmbed"><strong class="markup--strong markup--p-strong">結果</strong></p><figure name="32f3" id="32f3" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*0bt8n1l9a908QB96FLGCAg.jpeg" data-width="802" data-height="1368" src="https://cdn-images-1.medium.com/max/800/1*0bt8n1l9a908QB96FLGCAg.jpeg"></figure><h3 name="3823" id="3823" class="graf graf--h3 graf-after--figure">UITableViewDiffableDataSource 搭配自訂 cell 類別</h3><p name="237c" id="237c" class="graf graf--p graf-after--h3">剛剛的表格採用的是內建的 cell 樣式，為了發揮我們的美術天份，顯示我們自己設計的表格，我們也可以搭配自訂的 cell 樣式。</p><p name="92f8" id="92f8" class="graf graf--p graf-after--p">產生 UITableViewDiffableDataSource 時，我們可在 cellProvider 的 closure 裡回傳自訂類別的 cell，如以下例子，我們利用 as! MovieTableViewCell 轉型。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="e394" id="e394" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">dataSource <span class="hljs-operator">=</span> <span class="hljs-type">UITableViewDiffableDataSource</span>&lt;<span class="hljs-type">Section</span>, <span class="hljs-type">Movie</span>&gt;(tableView: tableView) { tableView, indexPath, itemIdentifier <span class="hljs-keyword">in</span><br />   <span class="hljs-keyword">let</span> cell <span class="hljs-operator">=</span> tableView.dequeueReusableCell(withIdentifier: <span class="hljs-string">&quot;movieCell&quot;</span>, for: indexPath) <span class="hljs-keyword">as!</span> <span class="hljs-type">MovieTableViewCell</span><br />   cell.nameLabel.text <span class="hljs-operator">=</span> itemIdentifier.name <br />   cell.yearLabel.text <span class="hljs-operator">=</span> itemIdentifier.year.description<br />   cell.coverImageView.image <span class="hljs-operator">=</span> <span class="hljs-type">UIImage</span>(named: itemIdentifier.actor)<br />   <span class="hljs-keyword">return</span> cell<br />}</span></pre><figure name="4654" id="4654" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*SxagbyLxCeh9M_yakPomjw.jpeg" data-width="540" data-height="252" src="https://cdn-images-1.medium.com/max/800/1*SxagbyLxCeh9M_yakPomjw.jpeg"></figure><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="e1b1" id="e1b1" class="graf graf--pre graf-after--figure graf--preV2"><span class="pre--content"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MovieTableViewCell</span>: <span class="hljs-title class_">UITableViewCell</span> {<br />   <span class="hljs-keyword">@IBOutlet</span> <span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> yearLabel: <span class="hljs-type">UILabel</span>!<br />   <span class="hljs-keyword">@IBOutlet</span> <span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> nameLabel: <span class="hljs-type">UILabel</span>!<br />   <span class="hljs-keyword">@IBOutlet</span> <span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> coverImageView: <span class="hljs-type">UIImageView</span>!</span></pre><figure name="f8a8" id="f8a8" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*Hklb4LCOyh5om7JOYCohaA.jpeg" data-width="802" data-height="1368" src="https://cdn-images-1.medium.com/max/800/1*Hklb4LCOyh5om7JOYCohaA.jpeg"></figure><h3 name="107c" id="107c" class="graf graf--h3 graf-after--figure">搭配多個 section 的 NSDiffableDataSourceSnapshot</h3><p name="79c4" id="79c4" class="graf graf--p graf-after--h3">電影列表時常會將電影分類，分成多個 section，因此接著讓我們試試顯示彼得潘最愛的兩個類型，愛情片 &amp; 英雄片的電影列表。</p><p name="a80f" id="a80f" class="graf graf--p graf-after--p">首先我們在 enum Section 裡定義 2 個 case，romance &amp; adventure。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="e375" id="e375" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">enum</span> <span class="hljs-title class_">Section</span> {<br />   <span class="hljs-keyword">case</span> romance<br />   <span class="hljs-keyword">case</span> adventure<br />}</span></pre><p name="005a" id="005a" class="graf graf--p graf-after--pre">接著在 NSDiffableDataSourceSnapshot 加入 section &amp; item 的內容。在這裡我們改呼叫 appendItems(_:toSection:)，透過參數 sectionIdentifier 指定 items 對應的 section。</p><figure name="fe52" id="fe52" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*rN3HzDl_2A0F6WCqHCp98w.jpeg" data-width="1530" data-height="178" src="https://cdn-images-1.medium.com/max/800/1*rN3HzDl_2A0F6WCqHCp98w.jpeg"></figure><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="1d23" id="1d23" class="graf graf--pre graf-after--figure graf--preV2"><span class="pre--content"><span class="hljs-keyword">var</span> snapshot <span class="hljs-operator">=</span> <span class="hljs-type">NSDiffableDataSourceSnapshot</span>&lt;<span class="hljs-type">Section</span>, <span class="hljs-type">Movie</span>&gt;()<br />snapshot.appendSections([.romance, .adventure])<br /><span class="hljs-keyword">let</span> romanceMovies <span class="hljs-operator">=</span> [<span class="hljs-type">Movie</span>(name: <span class="hljs-string">&quot;生命中的美好缺憾&quot;</span>, actor: <span class="hljs-string">&quot;雪琳&quot;</span>, year: <span class="hljs-number">2014</span>), <span class="hljs-type">Movie</span>(name: <span class="hljs-string">&quot;真愛每一天&quot;</span>, actor: <span class="hljs-string">&quot;瑞秋&quot;</span>, year: <span class="hljs-number">2013</span>), <span class="hljs-type">Movie</span>(name: <span class="hljs-string">&quot;手札情緣&quot;</span>, actor: <span class="hljs-string">&quot;雷恩&quot;</span>, year: <span class="hljs-number">2004</span>)]<br />snapshot.appendItems(romanceMovies, toSection: .romance)<br /><span class="hljs-keyword">let</span> adventureMovies <span class="hljs-operator">=</span> [<span class="hljs-type">Movie</span>(name: <span class="hljs-string">&quot;蜘蛛人:返校日&quot;</span>, actor: <span class="hljs-string">&quot;湯姆&quot;</span>, year: <span class="hljs-number">2017</span>), <span class="hljs-type">Movie</span>(name: <span class="hljs-string">&quot;蜘蛛人:驚奇再起&quot;</span>, actor: <span class="hljs-string">&quot;安德魯&quot;</span>, year: <span class="hljs-number">2012</span>),<span class="hljs-type">Movie</span>(name: <span class="hljs-string">&quot;蜘蛛人&quot;</span>, actor: <span class="hljs-string">&quot;陶比&quot;</span>, year: <span class="hljs-number">2002</span>)]<br />snapshot.appendItems(adventureMovies, toSection: .adventure)<br />dataSource.apply(snapshot, animatingDifferences: <span class="hljs-literal">false</span>)</span></pre><figure name="a371" id="a371" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*UlBVvhzBDfBmimL2mO3mpA.jpeg" data-width="802" data-height="1368" src="https://cdn-images-1.medium.com/max/800/1*UlBVvhzBDfBmimL2mO3mpA.jpeg"></figure><p name="4259" id="4259" class="graf graf--p graf-after--figure">嫌剛剛的愛情片 &amp; 英雄片連在一起，讓我們分不清手札情緣是戀人的手札還是蜘蛛人的手札嗎 ?</p><p name="028a" id="028a" class="graf graf--p graf-after--p">很簡單，我們只要將 table view 的 style 設為 Inset Grouped，即可讓 section 之間有明顯的區隔，每個 section 的內容被包覆在區塊裡。</p><figure name="4a68" id="4a68" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*mSShTqTgLLT3HRwXHG7mtA.jpeg" data-width="552" data-height="354" src="https://cdn-images-1.medium.com/max/800/1*mSShTqTgLLT3HRwXHG7mtA.jpeg"></figure><div name="ba46" id="ba46" class="graf graf--mixtapeEmbed graf-after--figure"><a href="https://developer.apple.com/documentation/uikit/uitableview/style/insetgrouped" data-href="https://developer.apple.com/documentation/uikit/uitableview/style/insetgrouped" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/uikit/uitableview/style/insetgrouped"><strong class="markup--strong markup--mixtapeEmbed-strong">UITableView.Style.insetGrouped - UITableView.Style | Apple Developer Documentation</strong><br><em class="markup--em markup--mixtapeEmbed-em">This documentation contains preliminary information about an API or technology in development. This information is…</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/uikit/uitableview/style/insetgrouped" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="fab03d8dabd24f3056d717d0301ad868"></a></div><figure name="5704" id="5704" class="graf graf--figure graf-after--mixtapeEmbed"><img class="graf-image" data-image-id="1*cYtaf0IOvigD7rEAon97vQ.jpeg" data-width="802" data-height="1368" src="https://cdn-images-1.medium.com/max/800/1*cYtaf0IOvigD7rEAon97vQ.jpeg"></figure><h3 name="1e74" id="1e74" class="graf graf--h3 graf-after--figure">取得點選 cell 的資料內容</h3><p name="1838" id="1838" class="graf graf--p graf-after--h3">為了讓電影 App 更完整，我們希望點選某個 cell 的電影後，跳到下一頁顯示它的詳細資訊，因此我們需要知道被點選 cell 對應的電影，然後將它傳到下一頁。</p><p name="599e" id="599e" class="graf graf--p graf-after--p">當表格的某個 cell 被點選時，我們可由 indexPathForSelectedRow 得知被選取的 IndexPath。因此我們可透過 UITableViewDiffableDataSource 的 function itemIdentifier(for:) 傳入 IndexPath，取得此位置對應的資料。</p><div name="fe1b" id="fe1b" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://developer.apple.com/documentation/uikit/uitableviewdiffabledatasource/3255154-itemidentifier" data-href="https://developer.apple.com/documentation/uikit/uitableviewdiffabledatasource/3255154-itemidentifier" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/uikit/uitableviewdiffabledatasource/3255154-itemidentifier"><strong class="markup--strong markup--mixtapeEmbed-strong">itemIdentifier(for:) - UITableViewDiffableDataSource | Apple Developer Documentation</strong><br><em class="markup--em markup--mixtapeEmbed-em">This documentation contains preliminary information about an API or technology in development. This information is…</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/uikit/uitableviewdiffabledatasource/3255154-itemidentifier" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="71d1d2fcf46f9350c226b17204f78478"></a></div><p name="f61c" id="f61c" class="graf graf--p graf-after--mixtapeEmbed">以下範例從 cell 拉 segue 到 MovieDetailViewController，我們在 MovieTableViewController 的 prepare 裡將電影傳給 MovieDetailViewController。</p><figure name="f687" id="f687" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*c_U7p_t1rPhqY8_2CWDCLA.jpeg" data-width="998" data-height="622" src="https://cdn-images-1.medium.com/max/800/1*c_U7p_t1rPhqY8_2CWDCLA.jpeg"></figure><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="a64b" id="a64b" class="graf graf--pre graf-after--figure graf--preV2"><span class="pre--content"><span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">prepare</span>(<span class="hljs-params">for</span> <span class="hljs-params">segue</span>: <span class="hljs-type">UIStoryboardSegue</span>, <span class="hljs-params">sender</span>: <span class="hljs-keyword">Any</span><span class="hljs-operator">?</span>) {<br />   <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> indexPath <span class="hljs-operator">=</span> tableView.indexPathForSelectedRow {<br />      <span class="hljs-keyword">let</span> controller <span class="hljs-operator">=</span> segue.destination <span class="hljs-keyword">as?</span> <span class="hljs-type">MovieDetailViewController</span><br />      controller<span class="hljs-operator">?</span>.movie <span class="hljs-operator">=</span> dataSource.itemIdentifier(for: indexPath)<br />   }<br />}</span></pre></div><div class="section-inner sectionLayout--outsetRow" data-paragraph-count="2"><figure name="e2f6" id="e2f6" class="graf graf--figure graf--layoutOutsetRow is-partialWidth graf-after--pre" style="width: 50%;"><img class="graf-image" data-image-id="1*Rx6s3EtB8IHYeL106nZ5nA.jpeg" data-width="802" data-height="1368" data-is-featured="true" src="https://cdn-images-1.medium.com/max/600/1*Rx6s3EtB8IHYeL106nZ5nA.jpeg"></figure><figure name="a364" id="a364" class="graf graf--figure graf--layoutOutsetRowContinue is-partialWidth graf-after--figure" style="width: 50%;"><img class="graf-image" data-image-id="1*mZw8N3pQnuS-sQNln84yug.jpeg" data-width="802" data-height="1368" src="https://cdn-images-1.medium.com/max/600/1*mZw8N3pQnuS-sQNln84yug.jpeg"></figure></div><div class="section-inner sectionLayout--insetColumn"><h3 name="270a" id="270a" class="graf graf--h3 graf-after--figure"><strong class="markup--strong markup--h3-strong">完整範例參考</strong></h3><div name="dc91" id="dc91" class="graf graf--mixtapeEmbed graf-after--h3"><a href="https://github.com/AppPeterPan/TableViewDiffableDataSourceDemo" data-href="https://github.com/AppPeterPan/TableViewDiffableDataSourceDemo" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://github.com/AppPeterPan/TableViewDiffableDataSourceDemo"><strong class="markup--strong markup--mixtapeEmbed-strong">AppPeterPan/TableViewDiffableDataSourceDemo</strong><br><em class="markup--em markup--mixtapeEmbed-em">Contribute to AppPeterPan/TableViewDiffableDataSourceDemo development by creating an account on GitHub.</em>github.com</a><a href="https://github.com/AppPeterPan/TableViewDiffableDataSourceDemo" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="7f44bc2f5ab50503c2f7418fd126be79" data-thumbnail-img-id="0*gG4PAoeLpJmmFZ4a" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*gG4PAoeLpJmmFZ4a);"></a></div><h3 name="f690" id="f690" class="graf graf--h3 graf-after--mixtapeEmbed">UICollectionViewDiffableDataSource</h3><p name="9fd7" id="9fd7" class="graf graf--p graf-after--h3">table view 的好兄弟 collection view 很喜歡模仿 table view，所以它也可以用類似的方法呈現內容。有興趣的朋友可進一步研究 UICollectionViewDiffableDataSource，使用的方式基本上跟 UITableViewDiffableDataSource 差不多。</p><div name="8597" id="8597" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://developer.apple.com/documentation/uikit/uicollectionviewdiffabledatasource" data-href="https://developer.apple.com/documentation/uikit/uicollectionviewdiffabledatasource" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/uikit/uicollectionviewdiffabledatasource"><strong class="markup--strong markup--mixtapeEmbed-strong">UICollectionViewDiffableDataSource - UIKit | Apple Developer Documentation</strong><br><em class="markup--em markup--mixtapeEmbed-em">This documentation contains preliminary information about an API or technology in development. This information is…</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/uikit/uicollectionviewdiffabledatasource" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="340684a7845f6807cf8faed8038b5441"></a></div><p name="920d" id="920d" class="graf graf--p graf-after--mixtapeEmbed graf--trailing">以上即是 UITableViewDiffableDataSource 的基本介紹，當然它還有許多進階的應用，尤其在表格資料改變的時候。關於這些進階的操作，我們將在之後的文章再做說明。</p></div></div></section><section name="b80d" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="54b0" id="54b0" class="graf graf--p graf--leading">參考資訊: Advances in UI Data Sources — WWDC 2019</p><div name="466d" id="466d" class="graf graf--mixtapeEmbed graf-after--p graf--trailing"><a href="https://developer.apple.com/videos/play/wwdc2019/220/" data-href="https://developer.apple.com/videos/play/wwdc2019/220/" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/videos/play/wwdc2019/220/"><strong class="markup--strong markup--mixtapeEmbed-strong">Advances in UI Data Sources - WWDC 2019 - Videos - Apple Developer</strong><br><em class="markup--em markup--mixtapeEmbed-em">Use UI Data Sources to simplify updating your table view and collection view items using automatic diffing. High…</em>developer.apple.com</a><a href="https://developer.apple.com/videos/play/wwdc2019/220/" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="0658c108dbaaba4b58b56ffa8ed78c12" data-thumbnail-img-id="0*cVaIrwcN0H_3yLuB" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*cVaIrwcN0H_3yLuB);"></a></div></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@apppeterpan" class="p-author h-card">彼得潘的 iOS App Neverland</a> on <a href="https://medium.com/p/4e4aa0294bf6"><time class="dt-published" datetime="2019-07-14T08:01:26.003Z">July 14, 2019</time></a>.</p><p><a href="https://medium.com/@apppeterpan/%E5%88%A9%E7%94%A8-diffable-data-source-%E9%A1%AF%E7%A4%BA%E8%A1%A8%E6%A0%BC%E5%85%A7%E5%AE%B9-4e4aa0294bf6" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on September 17, 2025.</p></footer></article></body></html>