<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>檢查條件是否滿足和讓 App 自殺的 assert，precondition 和 fatalError</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">檢查條件是否滿足和讓 App 自殺的 assert，precondition 和 fatalError</h1>
</header>
<section data-field="subtitle" class="p-summary">
開發 iOS App 時，我們會遇到兩種錯誤，一種是 App 可以繼續運作，比方網路斷線，無法顯示資料，像以下 IG App 顯示無法連線上網。
</section>
<section data-field="body" class="e-content">
<section name="a91e" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="433b" id="433b" class="graf graf--h3 graf--leading graf--title">檢查條件是否滿足和讓 App 自殺的 assert，precondition 和 fatalError</h3><p name="a270" id="a270" class="graf graf--p graf-after--h3">開發 iOS App 時，我們會遇到兩種錯誤，一種是 App 可以繼續運作，比方網路斷線，無法顯示資料，像以下 IG App 顯示無法連線上網。</p><figure name="92bd" id="92bd" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*CNNLWBoY0JKoNUm2sKGdiQ.png" data-width="1242" data-height="2208" src="https://cdn-images-1.medium.com/max/800/1*CNNLWBoY0JKoNUm2sKGdiQ.png"></figure><p name="24f3" id="24f3" class="graf graf--p graf-after--figure">但還有另一種比較嚴重的錯誤，它會讓 App 無法繼續運作，此時我們只能狠下心來結束 App 的生命。而 App 自殺的方法很多，有 assert，precondition 和 fatalError 三種，接下來就讓我們好好來研究 App 完全自殺手冊吧。</p><blockquote name="62f7" id="62f7" class="graf graf--blockquote graf-after--p"><strong class="markup--strong markup--blockquote-strong">一. assert</strong></blockquote><p name="479d" id="479d" class="graf graf--p graf-after--blockquote">檢查 condition 是否為 true。如果不是 true，App 將閃退並顯示 message。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="8150" id="8150" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">assert</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">condition</span>: <span class="hljs-keyword">@autoclosure</span> () -&gt; <span class="hljs-type">Bool</span>, <span class="hljs-keyword">_</span> <span class="hljs-params">message</span>: <span class="hljs-keyword">@autoclosure</span> () -&gt; <span class="hljs-type">String</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">default</span>, <span class="hljs-params">file</span>: <span class="hljs-type">StaticString</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">#file</span>, <span class="hljs-params">line</span>: <span class="hljs-type">UInt</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">#line</span>)</span></pre><div name="18d8" id="18d8" class="graf graf--mixtapeEmbed graf-after--pre"><a href="https://developer.apple.com/documentation/swift/assert%28_:_:file:line:%29" data-href="https://developer.apple.com/documentation/swift/assert(_:_:file:line:)" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/swift/assert(_:_:file:line:)"><strong class="markup--strong markup--mixtapeEmbed-strong">assert(_:_:file:line:) | Apple Developer Documentation</strong><br><em class="markup--em markup--mixtapeEmbed-em">Performs a traditional C-style assert with an optional message.</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/swift/assert%28_:_:file:line:%29" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="eb696491098a5fc43d7955d170634ae9" data-thumbnail-img-id="0*0BGDrYYSsc0cWUK7" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*0BGDrYYSsc0cWUK7);"></a></div><figure name="8a05" id="8a05" class="graf graf--figure graf-after--mixtapeEmbed"><img class="graf-image" data-image-id="1*yzxjRZJyQ3bhsg7v1pugLQ.jpeg" data-width="1168" data-height="118" src="https://cdn-images-1.medium.com/max/800/1*yzxjRZJyQ3bhsg7v1pugLQ.jpeg"></figure><p name="ddfc" id="ddfc" class="graf graf--p graf-after--figure">參數說明:</p><p name="0445" id="0445" class="graf graf--p graf-after--p">condition: 想要滿足的條件。</p><p name="17f4" id="17f4" class="graf graf--p graf-after--p">message: 當條件不滿足，App 閃退死掉時顯示的遺言訊息。</p><p name="6ec7" id="6ec7" class="graf graf--p graf-after--p">例子:</p><p name="9abc" id="9abc" class="graf graf--p graf-after--p">單字 App 需要讀取 vocabulary.txt 顯示單字，如果讀不到，這個 App 基本上就是廢物，沒有活在世上的意義 ! 所以我們利用 assert 檢查 url != nil，當它是 nil 時讓 App 閃退。</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="baa1" id="baa1" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> url <span class="hljs-operator">=</span> <span class="hljs-type">Bundle</span>.main.url(forResource: <span class="hljs-string">&quot;vocabulary&quot;</span>, withExtension: <span class="hljs-string">&quot;txt&quot;</span>)<br /><span class="hljs-built_in">assert</span>(url <span class="hljs-operator">!=</span> <span class="hljs-literal">nil</span>, <span class="hljs-string">&quot;no vocabulary.txt&quot;</span>)</span></pre><p name="8804" id="8804" class="graf graf--p graf-after--pre">當 url 是 nil 時的閃退畫面。</p><figure name="e221" id="e221" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*-aNdSogNbEj_KD0FUPTqLg.jpeg" data-width="1804" data-height="264" src="https://cdn-images-1.medium.com/max/800/1*-aNdSogNbEj_KD0FUPTqLg.jpeg"></figure><p name="8702" id="8702" class="graf graf--p graf-after--figure">assert 還有個長得跟它很像的兄弟，assertionFailure，專門用在我們已經事先做過檢查，已經確定要強制 App 閃退的時候。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="1d6f" id="1d6f" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">assertionFailure</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">message</span>: <span class="hljs-keyword">@autoclosure</span> () -&gt; <span class="hljs-type">String</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">default</span>, <span class="hljs-params">file</span>: <span class="hljs-type">StaticString</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">#file</span>, <span class="hljs-params">line</span>: <span class="hljs-type">UInt</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">#line</span>)</span></pre><div name="a5c1" id="a5c1" class="graf graf--mixtapeEmbed graf-after--pre"><a href="https://developer.apple.com/documentation/swift/assertionfailure%28_:file:line:%29" data-href="https://developer.apple.com/documentation/swift/assertionfailure(_:file:line:)" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/swift/assertionfailure(_:file:line:)"><strong class="markup--strong markup--mixtapeEmbed-strong">assertionFailure(_:file:line:) | Apple Developer Documentation</strong><br><em class="markup--em markup--mixtapeEmbed-em">Indicates that an internal consistency check failed.</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/swift/assertionfailure%28_:file:line:%29" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="10203f4d4580103f00a251facc7e1694" data-thumbnail-img-id="0*2uLSCLibG2UMg7ux" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*2uLSCLibG2UMg7ux);"></a></div><p name="6393" id="6393" class="graf graf--p graf-after--mixtapeEmbed">例子:</p><p name="6229" id="6229" class="graf graf--p graf-after--p">當分數 &lt; 0 時讓 App 閃退。</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="01ca" id="01ca" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">if</span> grade <span class="hljs-operator">&gt;=</span> <span class="hljs-number">60</span> {<br />   <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;及格了！&quot;</span>)<br />} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> grade <span class="hljs-operator">&gt;=</span> <span class="hljs-number">0</span> {<br />   <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;不及格，但至少分數 &gt;= 0&quot;</span>)<br />} <span class="hljs-keyword">else</span> {<br />   <span class="hljs-built_in">assertionFailure</span>(<span class="hljs-string">&quot;&lt; 0 的分數&quot;</span>)<br />}</span></pre><blockquote name="9fa6" id="9fa6" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">二. precondition</strong></blockquote><p name="2f8c" id="2f8c" class="graf graf--p graf-after--blockquote">看來使用 assert 已經可以讓 App 成功自殺，我們為何還要學習 precondition 呢 ?</p><p name="3145" id="3145" class="graf graf--p graf-after--p">precondition 功能跟 assert 差不多，同樣分兩種，有檢查條件是否滿足的 precondition，也有強制閃退的 preconditionFailure。</p><figure name="9457" id="9457" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*daQ5O2m-TSTlQvb3j3G3Sw.jpeg" data-width="1232" data-height="302" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*daQ5O2m-TSTlQvb3j3G3Sw.jpeg"></figure><div name="5b54" id="5b54" class="graf graf--mixtapeEmbed graf-after--figure"><a href="https://developer.apple.com/documentation/swift/precondition%28_:_:file:line:%29" data-href="https://developer.apple.com/documentation/swift/precondition(_:_:file:line:)" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/swift/precondition(_:_:file:line:)"><strong class="markup--strong markup--mixtapeEmbed-strong">precondition(_:_:file:line:) | Apple Developer Documentation</strong><br><em class="markup--em markup--mixtapeEmbed-em">Checks a necessary condition for making forward progress.</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/swift/precondition%28_:_:file:line:%29" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="a7b82f7211157f190d8a5d83820d6014" data-thumbnail-img-id="0*w3lpgoH8_HZqBKDD" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*w3lpgoH8_HZqBKDD);"></a></div><div name="987c" id="987c" class="graf graf--mixtapeEmbed graf-after--mixtapeEmbed"><a href="https://developer.apple.com/documentation/swift/preconditionfailure%28_:file:line:%29" data-href="https://developer.apple.com/documentation/swift/preconditionfailure(_:file:line:)" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/swift/preconditionfailure(_:file:line:)"><strong class="markup--strong markup--mixtapeEmbed-strong">preconditionFailure(_:file:line:) | Apple Developer Documentation</strong><br><em class="markup--em markup--mixtapeEmbed-em">Indicates that a precondition was violated.</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/swift/preconditionfailure%28_:file:line:%29" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="dfc476286aa9866483c124b1a8c88e42" data-thumbnail-img-id="0*B9e2DJMxbrAvmJd0" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*B9e2DJMxbrAvmJd0);"></a></div><p name="53dc" id="53dc" class="graf graf--p graf-after--mixtapeEmbed">但它跟 assert 有個主要的差別。assert 只會在 Optimization Level 為 No Optimization(-Onone) 時發揮作用，precondition 則在任何時候都能作用(除非 Optimization Level 為 Ounchecked)。</p><p name="d8a0" id="d8a0" class="graf graf--p graf-after--p">從 App 的 Build Settings 頁面，我們可看到在 Debug 模式時， Optimization Level 預設為 No Optimization，Release 模式時為 Optimize for Speed，因此 assert 只會在 Debug 模式時發揮作用。</p><figure name="2af4" id="2af4" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*RPKUeYWY-8jrtZub4OH3sA.jpeg" data-width="1716" data-height="642" src="https://cdn-images-1.medium.com/max/800/1*RPKUeYWY-8jrtZub4OH3sA.jpeg"></figure><p name="e553" id="e553" class="graf graf--p graf-after--figure">那 App 什麼時候會是 Debug 模式呢 ? 一般當我們從 Xcode 將 App 裝到模擬器或實機時就是 Debug 模式。因為我們會按下三角形的 Run，而從 App 的 Scheme 設定，我們可發現 Run 的 Build Configuration 為 Debug。</p><figure name="e470" id="e470" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*dvzaUViJLmHqbxCa2wuVHA.jpeg" data-width="342" data-height="214" src="https://cdn-images-1.medium.com/max/800/1*dvzaUViJLmHqbxCa2wuVHA.jpeg"></figure><figure name="5416" id="5416" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*VGV7h-FVMzlHxkRVSJ_6Nw.jpeg" data-width="1742" data-height="980" src="https://cdn-images-1.medium.com/max/800/1*VGV7h-FVMzlHxkRVSJ_6Nw.jpeg"></figure><p name="8999" id="8999" class="graf graf--p graf-after--figure">當我們用 Archive 製作上架或給朋友測試(TestFlight or Ad Hoc)的 App 時，Build Configuration 則是 Release。</p><figure name="95ab" id="95ab" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*ww7rrjdNwbKj4t3YfRyKLg.jpeg" data-width="1766" data-height="990" src="https://cdn-images-1.medium.com/max/800/1*ww7rrjdNwbKj4t3YfRyKLg.jpeg"></figure><p name="e056" id="e056" class="graf graf--p graf-after--figure">因此只有我們自己開發測試的 App 會因為 assert 死掉，當使用者從 App Store 或 TestFlight 下載 App 時，App 執行到 assert 的程式還是可以活得好好的。</p><p name="f22a" id="f22a" class="graf graf--p graf-after--p">所以到底要用 assert 還是 precondition 呢? 一般在自己開發測試階段，可以搭配 assert 檢查一些最好要滿足的條件，讓 App 提早閃退，提早發現問題。但上架的 App 若無法滿足 assert 描述的條件，則可忽略它，不影響使用者繼續操作 App。</p><p name="b9ce" id="b9ce" class="graf graf--p graf-after--p">然而若有一定要滿足，當條件不滿足 App 不該繼續操作的情況，則搭配 precondition，讓它可以作用在開發和上架的 App，比方以下 switch 檢查分數的例子，分數小於 0 的情況永遠不該發生，所以跑到 default 時用 preconditionFailure 讓 App 自殺。</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="29fa" id="29fa" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">switch</span> grade {<br /><span class="hljs-keyword">case</span> <span class="hljs-number">60</span><span class="hljs-operator">...</span><span class="hljs-number">100</span>:<br />   <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;及格了！&quot;</span>)<br /><span class="hljs-keyword">case</span> <span class="hljs-number">0</span><span class="hljs-operator">...</span><span class="hljs-number">60</span>:<br />   <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;不及格，但至少分數 &gt;= 0&quot;</span>)<br /><span class="hljs-keyword">default</span>:<br />   <span class="hljs-built_in">preconditionFailure</span>(<span class="hljs-string">&quot;&lt; 0 的分數&quot;</span>)<br />}</span></pre><blockquote name="8c6e" id="8c6e" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">三. fatalError</strong></blockquote><p name="2503" id="2503" class="graf graf--p graf-after--blockquote">強制 App 自殺閃退。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="37ac" id="37ac" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">fatalError</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">message</span>: <span class="hljs-keyword">@autoclosure</span> () -&gt; <span class="hljs-type">String</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">default</span>, <span class="hljs-params">file</span>: <span class="hljs-type">StaticString</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">#file</span>, <span class="hljs-params">line</span>: <span class="hljs-type">UInt</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">#line</span>) -&gt; <span class="hljs-type">Never</span></span></pre><div name="109c" id="109c" class="graf graf--mixtapeEmbed graf-after--pre"><a href="https://developer.apple.com/documentation/swift/fatalerror%28_:file:line:%29" data-href="https://developer.apple.com/documentation/swift/fatalerror(_:file:line:)" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/swift/fatalerror(_:file:line:)"><strong class="markup--strong markup--mixtapeEmbed-strong">fatalError(_:file:line:) | Apple Developer Documentation</strong><br><em class="markup--em markup--mixtapeEmbed-em">Unconditionally prints a given message and stops execution.</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/swift/fatalerror%28_:file:line:%29" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="fb91212fd419b8b89baac42c9ccf6b9e" data-thumbnail-img-id="0*jmc84WQNokQ864hw" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*jmc84WQNokQ864hw);"></a></div><p name="8678" id="8678" class="graf graf--p graf-after--mixtapeEmbed">fatalError 跟 assertionFailure，preconditionFailure 類似，都能讓 App 自殺。主要的差別在它不受 optimization level 的影響，因此它會同時作用在測試和上架的 App。</p><p name="c1f9" id="c1f9" class="graf graf--p graf-after--p">什麼時候會用到 fatalError 呢 ? Apple 提到我們可以在開發階段，在一些還未實作的功能寫 <code class="markup--code markup--p-code">fatalError(&quot;Unimplemented&quot;)</code> ，如此到時 App 執行到此處閃退，即可提醒我們要補上之前尚末完成的功能。</p><p name="0c83" id="0c83" class="graf graf--p graf-after--p">Apple 文件的英文描述</p><pre name="b721" id="b721" class="graf graf--pre graf-after--p graf--trailing">You can use the <code class="markup--code markup--pre-code">fatalError(_:file:line:)</code> function during prototyping and early development to create stubs for functionality that hasn’t been implemented yet, by writing <code class="markup--code markup--pre-code">fatalError(&quot;Unimplemented&quot;)</code> as the stub implementation. Because fatal errors are never optimized out, unlike assertions or preconditions, you can be sure that execution always halts if it encounters a stub implementation.</pre></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@apppeterpan" class="p-author h-card">彼得潘的 iOS App Neverland</a> on <a href="https://medium.com/p/4ba8f437471f"><time class="dt-published" datetime="2018-09-02T09:10:46.812Z">September 2, 2018</time></a>.</p><p><a href="https://medium.com/@apppeterpan/%E6%AA%A2%E6%9F%A5%E6%A2%9D%E4%BB%B6%E6%98%AF%E5%90%A6%E6%BB%BF%E8%B6%B3%E5%92%8C%E8%AE%93-app-%E8%87%AA%E6%AE%BA%E7%9A%84-assert-precondition-%E5%92%8C-fatalerror-4ba8f437471f" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on September 17, 2025.</p></footer></article></body></html>