<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>自動更新高度的 cell — iOS 16 UIKit 新功能</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">自動更新高度的 cell — iOS 16 UIKit 新功能</h1>
</header>
<section data-field="subtitle" class="p-summary">
從 iOS 16 開始，table view &amp; collection view cell 變得更強大了，cell 在內容或條件改變時會自動更新高度。
</section>
<section data-field="body" class="e-content">
<section name="04f9" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="6f78" id="6f78" class="graf graf--h3 graf--leading graf--title">自動更新大小的 cell — iOS 16 UIKit 新功能</h3><p name="5891" id="5891" class="graf graf--p graf-after--h3">從 iOS 16 開始，table view &amp; collection view cell 變得更強大了，cell 在內容或條件改變時會自動更新大小。</p><p name="0a5f" id="0a5f" class="graf graf--p graf-after--p">接下來讓我們建立一個預設顯示歌名，點選 cell 後顯示歌詞更新高度的 First Love 表格吧。</p><h3 name="4154" id="4154" class="graf graf--h3 graf-after--p">資料型別 Song &amp; array loveSongs</h3><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="10d9" id="10d9" class="graf graf--pre graf-after--h3 graf--preV2"><span class="pre--content"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Song</span> {<br />    <span class="hljs-keyword">let</span> name: <span class="hljs-type">String</span><br />    <span class="hljs-keyword">let</span> lyrics: <span class="hljs-type">String</span><br />    <span class="hljs-keyword">var</span> showLyrics <span class="hljs-operator">=</span> <span class="hljs-literal">false</span><br />}<br /><br /><span class="hljs-keyword">extension</span> <span class="hljs-title class_">Song</span> {<br />    <span class="hljs-keyword">static</span> <span class="hljs-keyword">var</span> loveSongs: [<span class="hljs-type">Song</span>] {<br />        [<br />            <span class="hljs-type">Song</span>(name: <span class="hljs-string">&quot;First Love&quot;</span>, lyrics: <span class="hljs-string">&quot;&quot;&quot;<br />最後のキスは<br />タバコのflavorがした<br />ニガくてせつない香り<br /><br />明日の今頃には<br />あなたはどこにいるんだろう<br />誰を想ってるんだろう<br /><br />You are always gonna be my love<br />いつか誰かとまた恋に落ちても<br />I&#x27;ll remember to love<br />You taught me how<br />You are always gonna be the one<br />今はまだ悲しいlove song<br />新しい歌 うたえるまで<br />&quot;&quot;&quot;</span>),<br />            <span class="hljs-type">Song</span>(name: <span class="hljs-string">&quot;初戀&quot;</span>, lyrics: <span class="hljs-string">&quot;&quot;&quot;<br />うるさいほどに高鳴る胸が<br />柄にもなく竦む足が今<br />静かに頬を伝う涙が<br />私に知らせる これが初恋と<br /><br />I need you, I need you<br />I need you, I need you<br />I need you, I need you<br />I need you, I need you<br />&quot;&quot;&quot;</span>)<br />        ]<br />    }<br />}</span></pre><h3 name="583c" id="583c" class="graf graf--h3 graf-after--pre">App 畫面設計</h3><figure name="ef1e" id="ef1e" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="1*PUMSanBEEg7qg7-2Tkz37A.png" data-width="1340" data-height="1230" src="https://cdn-images-1.medium.com/max/800/1*PUMSanBEEg7qg7-2Tkz37A.png"></figure><h3 name="167c" id="167c" class="graf graf--h3 graf-after--figure">cell 型別 SongTableViewCell</h3><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="f4e1" id="f4e1" class="graf graf--pre graf-after--h3 graf--preV2"><span class="pre--content"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SongTableViewCell</span>: <span class="hljs-title class_">UITableViewCell</span> {<br />    <br />    <span class="hljs-keyword">@IBOutlet</span> <span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> label: <span class="hljs-type">UILabel</span>!<br /><br />}</span></pre><h3 name="2493" id="2493" class="graf graf--h3 graf-after--pre">controller 型別 SongTableViewController</h3><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="89be" id="89be" class="graf graf--pre graf-after--h3 graf--preV2"><span class="pre--content"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SongTableViewController</span>: <span class="hljs-title class_">UITableViewController</span> {<br />    <br />    <span class="hljs-keyword">var</span> songs <span class="hljs-operator">=</span> <span class="hljs-type">Song</span>.loveSongs<br /><br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {<br />        <span class="hljs-keyword">super</span>.viewDidLoad()<br />       <br />    }<br /><br />    <span class="hljs-comment">// MARK: - Table view data source    </span><br /><br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">tableView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">tableView</span>: <span class="hljs-type">UITableView</span>, <span class="hljs-params">numberOfRowsInSection</span> <span class="hljs-params">section</span>: <span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">Int</span> {<br />        <span class="hljs-keyword">return</span> songs.count<br />    }<br /><br />    <br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">tableView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">tableView</span>: <span class="hljs-type">UITableView</span>, <span class="hljs-params">cellForRowAt</span> <span class="hljs-params">indexPath</span>: <span class="hljs-type">IndexPath</span>) -&gt; <span class="hljs-type">UITableViewCell</span> {<br />        <span class="hljs-keyword">let</span> cell <span class="hljs-operator">=</span> tableView.dequeueReusableCell(withIdentifier: <span class="hljs-string">&quot;<span class="hljs-subst">\(SongTableViewCell.<span class="hljs-keyword">self</span>)</span>&quot;</span>, for: indexPath) <span class="hljs-keyword">as!</span> <span class="hljs-type">SongTableViewCell</span><br /><br />        <span class="hljs-keyword">let</span> song <span class="hljs-operator">=</span> songs[indexPath.row]<br />        cell.label.text <span class="hljs-operator">=</span> song.showLyrics <span class="hljs-operator">?</span> song.lyrics : song.name<br />        <span class="hljs-keyword">return</span> cell<br />    }<br />    <br />}</span></pre><h3 name="554f" id="554f" class="graf graf--h3 graf-after--pre">從 cell 呼叫 invalidateIntrinsicContentSize 更新高度</h3><p name="5e78" id="5e78" class="graf graf--p graf-after--h3">在 controller 裡定義 tableView(_:didSelectRowAt:)，點選 cell 時顯示歌詞。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="47da" id="47da" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">tableView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">tableView</span>: <span class="hljs-type">UITableView</span>, <span class="hljs-params">didSelectRowAt</span> <span class="hljs-params">indexPath</span>: <span class="hljs-type">IndexPath</span>) {<br />    <span class="hljs-keyword">let</span> cell <span class="hljs-operator">=</span> tableView.cellForRow(at: indexPath) <span class="hljs-keyword">as!</span> <span class="hljs-type">SongTableViewCell</span><br />    songs[indexPath.item].showLyrics <span class="hljs-operator">=</span> <span class="hljs-literal">true</span><br />    cell.label.text <span class="hljs-operator">=</span> songs[indexPath.item].lyrics<br />    cell.invalidateIntrinsicContentSize()        <br />}</span></pre><p name="fdc2" id="fdc2" class="graf graf--p graf-after--pre">設定 label 內容後，呼叫 <code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">invalidateIntrinsicContentSize</strong></code> 即可讓 cell 自動依據內容更新高度。</p><figure name="c720" id="c720" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*FC_XV9c5gNQtcAayVrfu9g.png" data-width="1288" data-height="1198" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*FC_XV9c5gNQtcAayVrfu9g.png"></figure><p name="82ab" id="82ab" class="graf graf--p graf-after--figure">ps: 值得注意的，iOS 16 才會聰明地在呼叫 <code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">invalidateIntrinsicContentSize</strong></code> 後更新高度，iOS 15 若要更新高度，請改從 table view 呼叫 performBatchUpdates。</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="00b2" id="00b2" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">tableView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">tableView</span>: <span class="hljs-type">UITableView</span>, <span class="hljs-params">didSelectRowAt</span> <span class="hljs-params">indexPath</span>: <span class="hljs-type">IndexPath</span>) {<br />        <span class="hljs-keyword">let</span> cell <span class="hljs-operator">=</span> tableView.cellForRow(at: indexPath) <span class="hljs-keyword">as!</span> <span class="hljs-type">SongTableViewCell</span><br />        songs[indexPath.item].showLyrics <span class="hljs-operator">=</span> <span class="hljs-literal">true</span><br />        cell.label.text <span class="hljs-operator">=</span> songs[indexPath.item].lyrics<br />        tableView.performBatchUpdates(<span class="hljs-literal">nil</span>)<br />}</span></pre><div name="df85" id="df85" class="graf graf--mixtapeEmbed graf-after--pre"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-performbatchupdates-%E6%9B%B4%E6%96%B0-cell-%E9%AB%98%E5%BA%A6-%E5%AF%A6%E7%8F%BE%E9%BB%9E%E9%81%B8-cell-%E5%B1%95%E9%96%8B-%E6%94%B6%E7%B8%AE%E4%B8%8B%E6%96%B9%E5%85%A7%E5%AE%B9-e762503e5adc" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-performbatchupdates-%E6%9B%B4%E6%96%B0-cell-%E9%AB%98%E5%BA%A6-%E5%AF%A6%E7%8F%BE%E9%BB%9E%E9%81%B8-cell-%E5%B1%95%E9%96%8B-%E6%94%B6%E7%B8%AE%E4%B8%8B%E6%96%B9%E5%85%A7%E5%AE%B9-e762503e5adc" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-performbatchupdates-%E6%9B%B4%E6%96%B0-cell-%E9%AB%98%E5%BA%A6-%E5%AF%A6%E7%8F%BE%E9%BB%9E%E9%81%B8-cell-%E5%B1%95%E9%96%8B-%E6%94%B6%E7%B8%AE%E4%B8%8B%E6%96%B9%E5%85%A7%E5%AE%B9-e762503e5adc"><strong class="markup--strong markup--mixtapeEmbed-strong">利用 performBatchUpdates 更新 cell 高度 &amp; 實現點選 cell 展開 / 收縮下方內容(expand / collapse)</strong><br><em class="markup--em markup--mixtapeEmbed-em">當我們用 table view 或 collection view 顯示 App 畫面時，有時我們會想更新 cell 的高度，比方以下兩種情境:</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-performbatchupdates-%E6%9B%B4%E6%96%B0-cell-%E9%AB%98%E5%BA%A6-%E5%AF%A6%E7%8F%BE%E9%BB%9E%E9%81%B8-cell-%E5%B1%95%E9%96%8B-%E6%94%B6%E7%B8%AE%E4%B8%8B%E6%96%B9%E5%85%A7%E5%AE%B9-e762503e5adc" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="87ea6055e1945c2a28436666bb7cdd51" data-thumbnail-img-id="1*6XErxYFyyrPjIXMr3JDbeg.png" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*6XErxYFyyrPjIXMr3JDbeg.png);"></a></div><h3 name="13a3" id="13a3" class="graf graf--h3 graf-after--mixtapeEmbed">內容或條件改變時自動更新高度</h3><p name="78b3" id="78b3" class="graf graf--p graf-after--h3">懶得呼叫 <code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">invalidateIntrinsicContentSize </strong></code>嗎 ? 那麼你可以將 table view 的 <code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">selfSizingInvalidation</strong></code> 從預設的 <code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">enabled</strong></code> 改成 <code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">enabledIncludingConstraints</strong></code>，如此 cell 將自動在內容或條件改變時更新高度。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="756c" id="756c" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {<br />   <span class="hljs-keyword">super</span>.viewDidLoad()<br />    <br />   tableView.selfSizingInvalidation <span class="hljs-operator">=</span> .enabledIncludingConstraints<br />}<br /><br /><span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">tableView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">tableView</span>: <span class="hljs-type">UITableView</span>, <span class="hljs-params">didSelectRowAt</span> <span class="hljs-params">indexPath</span>: <span class="hljs-type">IndexPath</span>) {<br />    <span class="hljs-keyword">let</span> cell <span class="hljs-operator">=</span> tableView.cellForRow(at: indexPath) <span class="hljs-keyword">as!</span> <span class="hljs-type">SongTableViewCell</span><br />    songs[indexPath.item].showLyrics <span class="hljs-operator">=</span> <span class="hljs-literal">true</span><br />    cell.label.text <span class="hljs-operator">=</span> songs[indexPath.item].lyrics<br />}</span></pre><h3 name="89f6" id="89f6" class="graf graf--h3 graf-after--pre">專案連結</h3><div name="ed5d" id="ed5d" class="graf graf--mixtapeEmbed graf-after--h3"><a href="https://github.com/AppPeterPan/DemoCellSelfSizingInvalidation" data-href="https://github.com/AppPeterPan/DemoCellSelfSizingInvalidation" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://github.com/AppPeterPan/DemoCellSelfSizingInvalidation"><strong class="markup--strong markup--mixtapeEmbed-strong">GitHub - AppPeterPan/DemoCellSelfSizingInvalidation</strong><br><em class="markup--em markup--mixtapeEmbed-em">You can&#39;t perform that action at this time. You signed in with another tab or window. You signed out in another tab or…</em>github.com</a><a href="https://github.com/AppPeterPan/DemoCellSelfSizingInvalidation" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="44a015eafe6f51d76ef4aa34975d021e" data-thumbnail-img-id="0*DPdhx10b2QL3ovnJ" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*DPdhx10b2QL3ovnJ);"></a></div><figure name="780d" id="780d" class="graf graf--figure graf--iframe graf-after--mixtapeEmbed graf--trailing"><iframe src="https://www.youtube.com/embed/7U7rb3OXo3c?feature=oembed" width="700" height="393" frameborder="0" scrolling="no"></iframe></figure></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@apppeterpan" class="p-author h-card">彼得潘的 iOS App Neverland</a> on <a href="https://medium.com/p/c2de7adfe34c"><time class="dt-published" datetime="2022-12-16T07:41:26.424Z">December 16, 2022</time></a>.</p><p><a href="https://medium.com/@apppeterpan/%E8%87%AA%E5%8B%95%E6%9B%B4%E6%96%B0%E9%AB%98%E5%BA%A6%E7%9A%84-cell-ios-16-uikit-%E6%96%B0%E5%8A%9F%E8%83%BD-c2de7adfe34c" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on September 17, 2025.</p></footer></article></body></html>