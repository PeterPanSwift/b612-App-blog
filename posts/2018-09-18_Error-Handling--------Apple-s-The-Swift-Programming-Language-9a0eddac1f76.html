<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Error Handling 程式範例 — Apple’s The Swift Programming Language</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Error Handling 程式範例 — Apple’s The Swift Programming Language</h1>
</header>
<section data-field="subtitle" class="p-summary">
Representing and Throwing Errors
</section>
<section data-field="body" class="e-content">
<section name="94fd" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="70d6" id="70d6" class="graf graf--h3 graf--leading graf--title">Error Handling 程式範例 — Apple’s The Swift Programming Language</h3><div name="7de2" id="7de2" class="graf graf--mixtapeEmbed graf-after--h3"><a href="https://docs.swift.org/swift-book/LanguageGuide/ErrorHandling.html" data-href="https://docs.swift.org/swift-book/LanguageGuide/ErrorHandling.html" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://docs.swift.org/swift-book/LanguageGuide/ErrorHandling.html"><strong class="markup--strong markup--mixtapeEmbed-strong">Error Handling - The Swift Programming Language (Swift 4.2)</strong><br><em class="markup--em markup--mixtapeEmbed-em">Error handling is the process of responding to and recovering from error conditions in your program. Swift provides…</em>docs.swift.org</a><a href="https://docs.swift.org/swift-book/LanguageGuide/ErrorHandling.html" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="4e6f65ee929318b7adba970bbb6c4276"></a></div><blockquote name="0656" id="0656" class="graf graf--blockquote graf-after--mixtapeEmbed"><strong class="markup--strong markup--blockquote-strong">Representing and Throwing Errors</strong></blockquote><pre name="1e7f" id="1e7f" class="graf graf--pre graf-after--blockquote">enum VendingMachineError: Error {</pre><pre name="ddec" id="ddec" class="graf graf--pre graf-after--pre">   case invalidSelection</pre><pre name="e9f6" id="e9f6" class="graf graf--pre graf-after--pre">   case insufficientFunds(coinsNeeded: Int)</pre><pre name="045a" id="045a" class="graf graf--pre graf-after--pre">   case outOfStock</pre><pre name="fc69" id="fc69" class="graf graf--pre graf-after--pre">}</pre><pre name="15b3" id="15b3" class="graf graf--pre graf-after--pre">throw VendingMachineError.insufficientFunds(coinsNeeded: 5)</pre><p name="d7af" id="d7af" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">Propagating Errors Using Throwing Functions</strong></p><p name="f94f" id="f94f" class="graf graf--p graf-after--p">function vend 丟出的錯誤，會傳給 function buyFavoriteSnack，buyFavoriteSnack 再繼續將錯誤丟出。</p><pre name="061c" id="061c" class="graf graf--pre graf-after--p">struct Item {</pre><pre name="b611" id="b611" class="graf graf--pre graf-after--pre">   var price: Int</pre><pre name="f776" id="f776" class="graf graf--pre graf-after--pre">   var count: Int</pre><pre name="d244" id="d244" class="graf graf--pre graf-after--pre">}</pre><pre name="fc98" id="fc98" class="graf graf--pre graf-after--pre">class VendingMachine {</pre><pre name="1e99" id="1e99" class="graf graf--pre graf-after--pre">   var inventory = [</pre><pre name="cdd8" id="cdd8" class="graf graf--pre graf-after--pre">      &quot;Candy Bar&quot;: Item(price: 12, count: 7),</pre><pre name="7e9e" id="7e9e" class="graf graf--pre graf-after--pre">      &quot;Chips&quot;: Item(price: 10, count: 4),</pre><pre name="dad8" id="dad8" class="graf graf--pre graf-after--pre">      &quot;Pretzels&quot;: Item(price: 7, count: 11)</pre><pre name="fc34" id="fc34" class="graf graf--pre graf-after--pre">   ]</pre><pre name="94e3" id="94e3" class="graf graf--pre graf-after--pre">   var coinsDeposited = 0</pre><pre name="6d9d" id="6d9d" class="graf graf--pre graf-after--pre">   func vend(itemNamed name: String) throws {</pre><pre name="d30d" id="d30d" class="graf graf--pre graf-after--pre">      guard let item = inventory[name] else {</pre><pre name="d115" id="d115" class="graf graf--pre graf-after--pre">         throw VendingMachineError.invalidSelection</pre><pre name="3f96" id="3f96" class="graf graf--pre graf-after--pre">      }</pre><pre name="6a85" id="6a85" class="graf graf--pre graf-after--pre">      guard item.count &gt; 0 else {</pre><pre name="471a" id="471a" class="graf graf--pre graf-after--pre">         throw VendingMachineError.outOfStock</pre><pre name="530a" id="530a" class="graf graf--pre graf-after--pre">      }</pre><pre name="fad2" id="fad2" class="graf graf--pre graf-after--pre">      guard item.price &lt;= coinsDeposited else {</pre><pre name="c671" id="c671" class="graf graf--pre graf-after--pre">         throw VendingMachineError.insufficientFunds(coinsNeeded: item.price - coinsDeposited)</pre><pre name="20bd" id="20bd" class="graf graf--pre graf-after--pre">      }</pre><pre name="f9d3" id="f9d3" class="graf graf--pre graf-after--pre">      coinsDeposited -= item.price</pre><pre name="18cd" id="18cd" class="graf graf--pre graf-after--pre">      var newItem = item</pre><pre name="a65b" id="a65b" class="graf graf--pre graf-after--pre">      newItem.count -= 1</pre><pre name="085b" id="085b" class="graf graf--pre graf-after--pre">      inventory[name] = newItem</pre><pre name="6520" id="6520" class="graf graf--pre graf-after--pre">      print(&quot;Dispensing \(name)&quot;)</pre><pre name="a284" id="a284" class="graf graf--pre graf-after--pre">   }</pre><pre name="2eac" id="2eac" class="graf graf--pre graf-after--pre">}</pre><pre name="6ea8" id="6ea8" class="graf graf--pre graf-after--pre">let favoriteSnacks = [</pre><pre name="ad8b" id="ad8b" class="graf graf--pre graf-after--pre">&quot;Alice&quot;: &quot;Chips&quot;,</pre><pre name="918e" id="918e" class="graf graf--pre graf-after--pre">&quot;Bob&quot;: &quot;Licorice&quot;,</pre><pre name="f5df" id="f5df" class="graf graf--pre graf-after--pre">&quot;Eve&quot;: &quot;Pretzels&quot;,</pre><pre name="92f6" id="92f6" class="graf graf--pre graf-after--pre">]</pre><pre name="b22c" id="b22c" class="graf graf--pre graf-after--pre">func buyFavoriteSnack(person: String, vendingMachine: VendingMachine) throws {</pre><pre name="6b5b" id="6b5b" class="graf graf--pre graf-after--pre">   let snackName = favoriteSnacks[person] ?? &quot;Candy Bar&quot;</pre><pre name="02af" id="02af" class="graf graf--pre graf-after--pre">   try vendingMachine.vend(itemNamed: snackName)</pre><pre name="2618" id="2618" class="graf graf--pre graf-after--pre">}</pre><p name="e87b" id="e87b" class="graf graf--p graf-after--pre">initializer 也可以丟出錯誤。</p><pre name="5cdf" id="5cdf" class="graf graf--pre graf-after--p">struct PurchasedSnack {</pre><pre name="f953" id="f953" class="graf graf--pre graf-after--pre">   let name: String</pre><pre name="e913" id="e913" class="graf graf--pre graf-after--pre">   init(name: String, vendingMachine: VendingMachine) throws {</pre><pre name="0c14" id="0c14" class="graf graf--pre graf-after--pre">      try vendingMachine.vend(itemNamed: name)</pre><pre name="ac9b" id="ac9b" class="graf graf--pre graf-after--pre">      self.name = name</pre><pre name="6330" id="6330" class="graf graf--pre graf-after--pre">   }</pre><pre name="0f0e" id="0f0e" class="graf graf--pre graf-after--pre">}</pre><blockquote name="056c" id="056c" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">Handling Errors Using Do-Catch</strong></blockquote><pre name="8f1b" id="8f1b" class="graf graf--pre graf-after--blockquote">var vendingMachine = VendingMachine()</pre><pre name="e803" id="e803" class="graf graf--pre graf-after--pre">vendingMachine.coinsDeposited = 8</pre><pre name="ef90" id="ef90" class="graf graf--pre graf-after--pre">do {</pre><pre name="32c2" id="32c2" class="graf graf--pre graf-after--pre">   try buyFavoriteSnack(person: &quot;Alice&quot;, vendingMachine: vendingMachine)</pre><pre name="fba6" id="fba6" class="graf graf--pre graf-after--pre">   print(&quot;Success! Yum.&quot;)</pre><pre name="2745" id="2745" class="graf graf--pre graf-after--pre">} catch VendingMachineError.invalidSelection {</pre><pre name="2057" id="2057" class="graf graf--pre graf-after--pre">   print(&quot;Invalid Selection.&quot;)</pre><pre name="65d8" id="65d8" class="graf graf--pre graf-after--pre">} catch VendingMachineError.outOfStock {</pre><pre name="8e9b" id="8e9b" class="graf graf--pre graf-after--pre">   print(&quot;Out of Stock.&quot;)</pre><pre name="424d" id="424d" class="graf graf--pre graf-after--pre">} catch VendingMachineError.insufficientFunds(let coinsNeeded) {</pre><pre name="1121" id="1121" class="graf graf--pre graf-after--pre">   print(&quot;Insufficient funds. Please insert an additional \(coinsNeeded) coins.&quot;)</pre><pre name="3011" id="3011" class="graf graf--pre graf-after--pre">} catch {</pre><pre name="bd4b" id="bd4b" class="graf graf--pre graf-after--pre">   print(&quot;Unexpected error: \(error).&quot;)</pre><pre name="fc5d" id="fc5d" class="graf graf--pre graf-after--pre">}</pre><pre name="de1d" id="de1d" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// Prints &quot;Insufficient funds. Please insert an additional 2 coins.&quot;</em></pre><p name="1f45" id="1f45" class="graf graf--p graf-after--pre">catch VendingMachineError.insufficientFunds(let coinsNeeded) 也可以寫成 catch let VendingMachineError.insufficientFunds(coinsNeeded)。</p><p name="b9d0" id="b9d0" class="graf graf--p graf-after--p">do catch 也可以不 catch 所有的錯誤，比方以下程式 function nourish 只 catch VendingMachineError 型別的錯誤(利用 catch is 可檢查錯誤是否是某個型別)。所以 VendingMachineError 以外的錯誤會被丟出，交由呼叫 nourish 的程式處理。</p><pre name="850a" id="850a" class="graf graf--pre graf-after--p">func nourish(with item: String) throws {</pre><pre name="2cca" id="2cca" class="graf graf--pre graf-after--pre">   do {</pre><pre name="3b47" id="3b47" class="graf graf--pre graf-after--pre">      try vendingMachine.vend(itemNamed: item)</pre><pre name="0104" id="0104" class="graf graf--pre graf-after--pre">   } catch is VendingMachineError {</pre><pre name="c932" id="c932" class="graf graf--pre graf-after--pre">      print(&quot;Invalid selection, out of stock, or not enough money.&quot;)</pre><pre name="6b9d" id="6b9d" class="graf graf--pre graf-after--pre">   }</pre><pre name="b237" id="b237" class="graf graf--pre graf-after--pre">}</pre><pre name="fa91" id="fa91" class="graf graf--pre graf-after--pre">do {</pre><pre name="938c" id="938c" class="graf graf--pre graf-after--pre">   try nourish(with: &quot;Beet-Flavored Chips&quot;)</pre><pre name="d360" id="d360" class="graf graf--pre graf-after--pre">} catch {</pre><pre name="5707" id="5707" class="graf graf--pre graf-after--pre">   print(&quot;Unexpected non-vending-machine-related error: \(error)&quot;)</pre><pre name="d9f1" id="d9f1" class="graf graf--pre graf-after--pre">}</pre><pre name="9c65" id="9c65" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">// Prints &quot;Invalid selection, out of stock, or not enough money.&quot;</em></pre><blockquote name="97a5" id="97a5" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">Converting Errors to Optional Values</strong></blockquote><p name="5759" id="5759" class="graf graf--p graf-after--blockquote">try?。回傳的東西會變成 optional，當產生錯誤時會回傳 nil。</p><p name="c3b8" id="c3b8" class="graf graf--p graf-after--p">應用例子:</p><pre name="3e5c" id="3e5c" class="graf graf--pre graf-after--p">func fetchData() -&gt; Data? {</pre><pre name="0edf" id="0edf" class="graf graf--pre graf-after--pre">   if let data = try? fetchDataFromDisk() { return data }</pre><pre name="e330" id="e330" class="graf graf--pre graf-after--pre">   if let data = try? fetchDataFromServer() { return data }</pre><pre name="280a" id="280a" class="graf graf--pre graf-after--pre">   return nil</pre><pre name="e4d4" id="e4d4" class="graf graf--pre graf-after--pre">}</pre><blockquote name="7a0d" id="7a0d" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">Disabling Error Propagation</strong></blockquote><p name="499a" id="499a" class="graf graf--p graf-after--blockquote">try!。一定會成功，如果失敗的話會閃退。</p><pre name="e3f6" id="e3f6" class="graf graf--pre graf-after--p">let photo = try! loadImage(atPath: &quot;./Resources/John Appleseed.jpg&quot;)</pre><blockquote name="dac2" id="dac2" class="graf graf--blockquote graf-after--pre"><strong class="markup--strong markup--blockquote-strong">Specifying Cleanup Actions</strong></blockquote><p name="bee2" id="bee2" class="graf graf--p graf-after--blockquote">利用 defer { } 描述想要之後再執行的程式碼。</p><pre name="e29b" id="e29b" class="graf graf--pre graf-after--p">func processFile(filename: String) throws {</pre><pre name="38aa" id="38aa" class="graf graf--pre graf-after--pre">   if exists(filename) {</pre><pre name="5425" id="5425" class="graf graf--pre graf-after--pre">      let file = open(filename)</pre><pre name="fee1" id="fee1" class="graf graf--pre graf-after--pre">      defer {</pre><pre name="b556" id="b556" class="graf graf--pre graf-after--pre">         close(file)</pre><pre name="3b12" id="3b12" class="graf graf--pre graf-after--pre">      }</pre><pre name="a3d1" id="a3d1" class="graf graf--pre graf-after--pre">      while let line = try file.readline() {</pre><pre name="b167" id="b167" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">         // Work with the file.</em></pre><pre name="21ce" id="21ce" class="graf graf--pre graf-after--pre">      }</pre><pre name="8e12" id="8e12" class="graf graf--pre graf-after--pre"><em class="markup--em markup--pre-em">      // close(file) is called here, at the end of the scope.</em></pre><pre name="ab92" id="ab92" class="graf graf--pre graf-after--pre">   }</pre><pre name="903a" id="903a" class="graf graf--pre graf-after--pre graf--trailing">}</pre></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@apppeterpan" class="p-author h-card">彼得潘的 iOS App Neverland</a> on <a href="https://medium.com/p/9a0eddac1f76"><time class="dt-published" datetime="2018-09-18T07:51:50.924Z">September 18, 2018</time></a>.</p><p><a href="https://medium.com/@apppeterpan/error-handling-%E7%A8%8B%E5%BC%8F%E7%AF%84%E4%BE%8B-apples-the-swift-programming-language-9a0eddac1f76" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on September 17, 2025.</p></footer></article></body></html>