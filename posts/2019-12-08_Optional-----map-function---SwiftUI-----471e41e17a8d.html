<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Optional 型別的 map function 和 SwiftUI 的結合</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Optional 型別的 map function 和 SwiftUI 的結合</h1>
</header>
<section data-field="subtitle" class="p-summary">
Swift 有許多 optional 的相關語法，為了安全我們通常採用 if let 或 guard let 讀取 optional 的內容後再做運算，不過 Optional 型別的 map function 也是滿不錯的方法，接下來就讓我們一步步打開它神秘的面紗吧。
</section>
<section data-field="body" class="e-content">
<section name="7eef" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="ee28" id="ee28" class="graf graf--h3 graf--leading graf--title">Optional 型別的 map function 和 SwiftUI 的結合</h3><p name="ce06" id="ce06" class="graf graf--p graf-after--h3">Swift 有許多 optional 的相關語法，為了安全我們通常採用 if let 或 guard let 讀取 optional 的內容後再做運算，不過 Optional 型別的 map function 也是滿不錯的方法，接下來就讓我們一步步打開它神秘的面紗吧。</p><h3 name="693b" id="693b" class="graf graf--h3 graf-after--p">Optional 型別的 map function</h3><p name="9a1d" id="9a1d" class="graf graf--p graf-after--h3">比方以下例子，我們利用 if let 讀取 name 後再將它印出。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="03b6" id="03b6" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> name: <span class="hljs-type">String</span>? <span class="hljs-operator">=</span> <span class="hljs-string">&quot;peter&quot;</span><br /><span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> name {<br />   <span class="hljs-built_in">print</span>(name)<br />}</span></pre><p name="dd71" id="dd71" class="graf graf--p graf-after--pre">透過型別 Optional 的 map function ，我們可以將剛剛的程式變得更精簡。map 的宣告如下。</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="b96a" id="b96a" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">func</span> <span class="hljs-title function_">map</span>&lt;<span class="hljs-type">U</span>&gt;(<span class="hljs-keyword">_</span> <span class="hljs-params">transform</span>: (<span class="hljs-type">Wrapped</span>) <span class="hljs-keyword">throws</span> -&gt; <span class="hljs-type">U</span>) <span class="hljs-keyword">rethrows</span> -&gt; <span class="hljs-type">U</span>?</span></pre><div name="0c42" id="0c42" class="graf graf--mixtapeEmbed graf-after--pre"><a href="https://developer.apple.com/documentation/swift/optional/map%28_:%29" data-href="https://developer.apple.com/documentation/swift/optional/map(_:)" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/swift/optional/map(_:)"><strong class="markup--strong markup--mixtapeEmbed-strong">map(_:) | Apple Developer Documentation</strong><br><em class="markup--em markup--mixtapeEmbed-em">Evaluates the given closure when this instance is not , passing the unwrapped value as a parameter.</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/swift/optional/map%28_:%29" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="594e5db4a2fbc1221f5018ceb245eff6" data-thumbnail-img-id="0*UuhvTr72bHu7i3_q" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*UuhvTr72bHu7i3_q);"></a></div><p name="43d7" id="43d7" class="graf graf--p graf-after--mixtapeEmbed">呼叫 map 時我們可以傳入 closure，closure 只在 optional 不為 nil 時會執行。它將有一個參數，代表 optional 的內容。因此以下程式 closure 裡的參數 $0 就是字串 peter，我們不用再加上可怕的 ! 讀取。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="5b57" id="5b57" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> name: <span class="hljs-type">String</span>? <span class="hljs-operator">=</span> <span class="hljs-string">&quot;peter&quot;</span><br />name.map { <span class="hljs-built_in">print</span>(<span class="hljs-variable">$0</span>) }</span></pre><p name="caf2" id="caf2" class="graf graf--p graf-after--pre">ps: $0 是 closure 的參數省略語法，有興趣的可參考以下連結的說明。</p><div name="6c99" id="6c99" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/closure-%E5%8F%83%E6%95%B8%E7%9A%84%E7%9C%81%E7%95%A5-%E7%A5%9E%E5%A5%87%E7%9A%84-0-1-2-shorthand-argument-names-ade1b883e7da" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/closure-%E5%8F%83%E6%95%B8%E7%9A%84%E7%9C%81%E7%95%A5-%E7%A5%9E%E5%A5%87%E7%9A%84-0-1-2-shorthand-argument-names-ade1b883e7da" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/closure-%E5%8F%83%E6%95%B8%E7%9A%84%E7%9C%81%E7%95%A5-%E7%A5%9E%E5%A5%87%E7%9A%84-0-1-2-shorthand-argument-names-ade1b883e7da"><strong class="markup--strong markup--mixtapeEmbed-strong">closure 參數的省略，神奇的 $0，$1 &amp; $2 (Shorthand Argument Names)</strong><br><em class="markup--em markup--mixtapeEmbed-em">Swift 的 closure 有很多精簡省略的寫法，幫助我們加班打 code 不再手酸。接下來我們將介紹其中最特別，最像火星文的參數省略寫法。</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/closure-%E5%8F%83%E6%95%B8%E7%9A%84%E7%9C%81%E7%95%A5-%E7%A5%9E%E5%A5%87%E7%9A%84-0-1-2-shorthand-argument-names-ade1b883e7da" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="dce40063b95fa5576c3836c3292e3e59" data-thumbnail-img-id="1*FVjh63gW3ZdyaCK9wiSv_Q.jpeg" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*FVjh63gW3ZdyaCK9wiSv_Q.jpeg);"></a></div><p name="71d0" id="71d0" class="graf graf--p graf-after--mixtapeEmbed">結果: 在 console 印出 peter</p><pre name="fbe3" id="fbe3" class="graf graf--pre graf-after--p"><strong class="markup--strong markup--pre-strong">peter</strong></pre><p name="36f5" id="36f5" class="graf graf--p graf-after--pre">相反的，當 name 的內容為 nil 時，map 將直接回傳 nil，不會執行 closure 的程式。</p><figure name="6a13" id="6a13" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*-MGU3RSGuDqd3gxK30EXCQ.jpeg" data-width="902" data-height="186" src="https://cdn-images-1.medium.com/max/800/1*-MGU3RSGuDqd3gxK30EXCQ.jpeg"></figure><p name="980a" id="980a" class="graf graf--p graf-after--figure">因此，function map 回傳的型別也會是 optional， 比方以下例子我們判斷 bmi 的數字回傳描述體重是否正常的字串。</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="c795" id="c795" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">let</span> bmi: <span class="hljs-type">Double</span>? <span class="hljs-operator">=</span> <span class="hljs-number">20</span><br /><span class="hljs-keyword">var</span> message: <span class="hljs-type">String</span>? <span class="hljs-operator">=</span> bmi.map {<br />    <span class="hljs-keyword">switch</span> <span class="hljs-variable">$0</span> {<br />    <span class="hljs-keyword">case</span> <span class="hljs-number">18.5</span> <span class="hljs-operator">..&lt;</span> <span class="hljs-number">24</span>:<br />        <span class="hljs-string">&quot;完美&quot;</span><br />    <span class="hljs-keyword">case</span> <span class="hljs-operator">..&lt;</span><span class="hljs-number">18.5</span>:<br />        <span class="hljs-string">&quot;太瘦了&quot;</span><br />    <span class="hljs-keyword">case</span> <span class="hljs-number">24</span><span class="hljs-operator">...</span>:<br />        <span class="hljs-string">&quot;太胖了&quot;</span><br />    <span class="hljs-keyword">default</span>:<br />        <span class="hljs-string">&quot;&quot;</span><br />    }<br />}</span></pre><p name="d17d" id="d17d" class="graf graf--p graf-after--pre">此時 message 的型別將是代表 optional 的 String?。</p><figure name="cb9a" id="cb9a" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*nWg2LpvyvC_93l5xlSW-WQ.jpeg" data-width="1038" data-height="418" src="https://cdn-images-1.medium.com/max/800/1*nWg2LpvyvC_93l5xlSW-WQ.jpeg"></figure><h3 name="25ea" id="25ea" class="graf graf--h3 graf-after--figure">幫助 SwiftUI 處理 otpional 的 map function</h3><p name="7010" id="7010" class="graf graf--p graf-after--h3">開發 SwiftUI App 時，我們遇到 optional 的機率已經比以前低了不少，不過有時還是會遇到，就像夜路走多了總會遇到鬼一樣。</p><p name="76c0" id="76c0" class="graf graf--p graf-after--p">大大們常說遇到 optional 用 if let 讀取比較安全，不要使用暴力的 !。不過如下圖所示，當我們在 SwiftUI 常見的 VStack { } 裡使用 if let 時，卻冒出了紅色錯誤。</p><pre name="8a89" id="8a89" class="graf graf--pre graf-after--p">Closure containing control flow statement cannot be used with function builder ViewBuilder</pre><figure name="9595" id="9595" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*mPGV_jC1M9JB-_w_zHVNjg.jpeg" data-width="1714" data-height="948" src="https://cdn-images-1.medium.com/max/800/1*mPGV_jC1M9JB-_w_zHVNjg.jpeg"></figure><p name="7781" id="7781" class="graf graf--p graf-after--figure">難道是大大欺騙我們 ? 別誤會，大大真的是真心不騙，這裡錯誤的原因是因為 VStack 接收的 closure 參數 content 加了 <a href="http://twitter.com/ViewBuilder" data-href="http://twitter.com/ViewBuilder" class="markup--anchor markup--p-anchor" title="Twitter profile for @ViewBuilder" rel="noopener" target="_blank">@ViewBuilder</a>，因此我們只能在 closure 裡寫一些 ViewBuilder 支援的語法。很遺憾的它支援了 if else，卻不支援它的好兄弟 if let。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="1ca2" id="1ca2" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">init</span>(<span class="hljs-params">alignment</span>: <span class="hljs-type">HorizontalAlignment</span> <span class="hljs-operator">=</span> .center, <span class="hljs-params">spacing</span>: <span class="hljs-type">CGFloat</span>? <span class="hljs-operator">=</span> <span class="hljs-literal">nil</span>, <span class="hljs-meta">@ViewBuilder</span> <span class="hljs-params">content</span>: () -&gt; <span class="hljs-type">Content</span>)</span></pre><p name="107c" id="107c" class="graf graf--p graf-after--pre">關於 ViewBuilder 的相關說明，有興趣的可參考以下連結。</p><div name="abcc" id="abcc" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/viewbuilder-ambiguous-reference-to-member-buildblock-c7325ae5567f" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/viewbuilder-ambiguous-reference-to-member-buildblock-c7325ae5567f" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/viewbuilder-ambiguous-reference-to-member-buildblock-c7325ae5567f"><strong class="markup--strong markup--mixtapeEmbed-strong">SwiftUI ViewBuilder 可以寫的程式</strong><br><em class="markup--em markup--mixtapeEmbed-em">撰寫 SwiftUI 程式時，我們時常看到類似 VStack 這樣的程式，{ } 裡寫了多行產生 UI 元件的程式。</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/viewbuilder-ambiguous-reference-to-member-buildblock-c7325ae5567f" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="e9a80ac1720ed13caf45f9a79e266c16" data-thumbnail-img-id="1*fnfgdEQ7V-hFabXcReWraQ.png" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*fnfgdEQ7V-hFabXcReWraQ.png);"></a></div><p name="6180" id="6180" class="graf graf--p graf-after--mixtapeEmbed">看來是老天爺逼我們使用 !，我們是人在江湖，身不由己。不過我們還是可以保險一點先用 if 檢查它是否為 nil，不為 nil 時才用 ! 讀取。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="2089" id="2089" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ProfileView</span>: <span class="hljs-title class_">View</span> {<br />    <span class="hljs-keyword">var</span> userName: <span class="hljs-type">String</span><br />    <span class="hljs-keyword">var</span> imageName: <span class="hljs-type">String</span>?<br />    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {<br />        <span class="hljs-type">VStack</span> {<br />            <span class="hljs-type">Text</span>(userName)<br />            <span class="hljs-keyword">if</span> imageName <span class="hljs-operator">!=</span> <span class="hljs-literal">nil</span> {<br />                <span class="hljs-type">Image</span>(imageName<span class="hljs-operator">!</span>)<br />                    .resizable()<br />                    .scaledToFit()<br />            }<br />        }<br />    }<br />}<br /><br />#<span class="hljs-type">Preview</span> {<br />    <span class="hljs-type">ProfileView</span>(userName: <span class="hljs-string">&quot;Peter&quot;</span>, imageName: <span class="hljs-string">&quot;pic&quot;</span>)<br />}</span></pre><figure name="62e2" id="62e2" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*aHVnCDlMEMSRY29586NJTg.jpeg" data-width="750" data-height="1268" src="https://cdn-images-1.medium.com/max/800/1*aHVnCDlMEMSRY29586NJTg.jpeg"></figure><p name="fcb1" id="fcb1" class="graf graf--p graf-after--figure">不過如果你真的很討厭 !，就像彼得潘討厭 Hook 一樣，那麼採用 Optional 型別的 map function 也是不錯的方法。我們改從 Optional 型別的 imageName 呼叫 map，當它有值時，closure 裡的程式將從參數 $0 取得圖片名字後生成 Image。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="fc3b" id="fc3b" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ProfileView</span>: <span class="hljs-title class_">View</span> {<br />    <span class="hljs-keyword">var</span> userName: <span class="hljs-type">String</span><br />    <span class="hljs-keyword">var</span> imageName: <span class="hljs-type">String</span>?<br />    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {<br />        <span class="hljs-type">VStack</span> {<br />            <span class="hljs-type">Text</span>(userName)<br />            imageName.map {<br />                <span class="hljs-type">Image</span>(<span class="hljs-variable">$0</span>)<br />                    .resizable()<br />                    .scaledToFit()<br />            }<br />            <br />        }<br />    }<br />}</span></pre><p name="afbe" id="afbe" class="graf graf--p graf-after--pre">當 imageName 等於 nil 時，function map 將直接回傳 nil，而 SwiftUI 看到 nil 還是可以活得好好的，因為它很聰明，它知道 nil 的東西不需要顯示。比方以下程式變數 image 為 nil，因此 VStack 只會顯示文字。</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="swift" name="6743" id="6743" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ProfileView</span>: <span class="hljs-title class_">View</span> {<br />    <span class="hljs-keyword">var</span> userName: <span class="hljs-type">String</span><br />    <span class="hljs-keyword">var</span> image: <span class="hljs-type">Image</span>?<br />    <span class="hljs-keyword">var</span> body: <span class="hljs-keyword">some</span> <span class="hljs-type">View</span> {<br />        <span class="hljs-type">VStack</span> {<br />            <span class="hljs-type">Text</span>(userName)<br />            image<br />        }<br />    }<br />}</span></pre><figure name="a744" id="a744" class="graf graf--figure graf-after--pre graf--trailing"><img class="graf-image" data-image-id="1*ANHL6A2dDAfBIEXLtFlBHw.jpeg" data-width="676" data-height="1078" src="https://cdn-images-1.medium.com/max/800/1*ANHL6A2dDAfBIEXLtFlBHw.jpeg"></figure></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@apppeterpan" class="p-author h-card">彼得潘的 iOS App Neverland</a> on <a href="https://medium.com/p/471e41e17a8d"><time class="dt-published" datetime="2019-12-08T13:12:13.989Z">December 8, 2019</time></a>.</p><p><a href="https://medium.com/@apppeterpan/optional-%E5%9E%8B%E5%88%A5%E7%9A%84-map-function-%E5%92%8C-swiftui-%E7%9A%84%E7%B5%90%E5%90%88-471e41e17a8d" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on September 17, 2025.</p></footer></article></body></html>