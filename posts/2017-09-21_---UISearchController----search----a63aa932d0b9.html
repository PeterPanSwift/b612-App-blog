<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>利用 UISearchController 實現 search 功能</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">利用 UISearchController 實現 search 功能</h1>
</header>
<section data-field="subtitle" class="p-summary">
我們可以在 navigation bar 裡顯示 search bar
</section>
<section data-field="body" class="e-content">
<section name="1605" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="7f29" id="7f29" class="graf graf--h3 graf--leading graf--title"><strong class="markup--strong markup--h3-strong">利用 </strong>UISearchController 實現 search 功能</h3><p name="c222" id="c222" class="graf graf--p graf-after--h3">開發 iOS App 時，我們時常需要實現搜尋資料的功能。如下圖所示，在 iOS App 時常會看到長在 navigation bar 的 search bar。</p></div><div class="section-inner sectionLayout--outsetRow" data-paragraph-count="2"><figure name="f73f" id="f73f" class="graf graf--figure graf--layoutOutsetRow is-partialWidth graf-after--p" style="width: 50%;"><img class="graf-image" data-image-id="1*AcYxLn5EfbUiUrE5x--LTA.png" data-width="1125" data-height="2436" src="https://cdn-images-1.medium.com/max/600/1*AcYxLn5EfbUiUrE5x--LTA.png"></figure><figure name="833d" id="833d" class="graf graf--figure graf--layoutOutsetRowContinue is-partialWidth graf-after--figure" style="width: 50%;"><img class="graf-image" data-image-id="1*lZ7MMaeQPvH3WNPrby7egw.png" data-width="1125" data-height="2436" src="https://cdn-images-1.medium.com/max/600/1*lZ7MMaeQPvH3WNPrby7egw.png"></figure></div><div class="section-inner sectionLayout--insetColumn"><p name="4b13" id="4b13" class="graf graf--p graf-after--figure">在 search bar 輸入文字時，search bar 還會自動移到畫面上方，挪出更多空間呈現資料內容。</p><figure name="41f3" id="41f3" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*_Rc-ObkxgyNE-0KQgKUStg.png" data-width="1125" data-height="2436" src="https://cdn-images-1.medium.com/max/800/1*_Rc-ObkxgyNE-0KQgKUStg.png"></figure><p name="de0c" id="de0c" class="graf graf--p graf-after--figure">以上的功能透過 UISearchController 將可快速實現。接下來我們將示範利用 UISearchController 實現長在 navigation bar 的 search bar。</p><p name="4e3f" id="4e3f" class="graf graf--p graf-after--p">在加入 search 功能前，先讓我們利用表格顯示情歌王子林隆璇的那些歌兒。</p><figure name="cb43" id="cb43" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*9QJjw4gEuAXFSoTdJ8NdNw.png" data-width="1622" data-height="1026" src="https://cdn-images-1.medium.com/max/800/1*9QJjw4gEuAXFSoTdJ8NdNw.png"></figure><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="c681" id="c681" class="graf graf--pre graf-after--figure graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> UIKit<br /><br /><span class="hljs-keyword">class</span> <span class="hljs-title class_">LoveSongTableViewController</span>: <span class="hljs-title class_">UITableViewController</span> {<br />    <span class="hljs-keyword">let</span> songs <span class="hljs-operator">=</span> [<span class="hljs-string">&quot;為愛往前飛&quot;</span>, <span class="hljs-string">&quot;我愛你這樣深&quot;</span>, <span class="hljs-string">&quot;難以抗拒你容顏&quot;</span>, <span class="hljs-string">&quot;流言&quot;</span>, <span class="hljs-string">&quot;你那麼愛她&quot;</span>, <span class="hljs-string">&quot;我還是愛你到老&quot;</span>, <span class="hljs-string">&quot;我是多麼認真對你&quot;</span>, <span class="hljs-string">&quot;體會&quot;</span>, <span class="hljs-string">&quot;怎麼開始忘了&quot;</span>, <span class="hljs-string">&quot;藏經閣&quot;</span>, <span class="hljs-string">&quot;白天不懂夜的黑&quot;</span>]<br />    <br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {<br />        <span class="hljs-keyword">super</span>.viewDidLoad()<br />    }<br /><br />    <span class="hljs-comment">// MARK: - Table view data source</span><br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">tableView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">tableView</span>: <span class="hljs-type">UITableView</span>, <span class="hljs-params">numberOfRowsInSection</span> <span class="hljs-params">section</span>: <span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">Int</span> {<br />        <span class="hljs-keyword">return</span> songs.count<br />    }<br />    <br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">tableView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">tableView</span>: <span class="hljs-type">UITableView</span>, <span class="hljs-params">cellForRowAt</span> <span class="hljs-params">indexPath</span>: <span class="hljs-type">IndexPath</span>) -&gt; <span class="hljs-type">UITableViewCell</span> {<br />        <span class="hljs-keyword">let</span> cell <span class="hljs-operator">=</span> tableView.dequeueReusableCell(withIdentifier: <span class="hljs-string">&quot;LoveSongCell&quot;</span>, for: indexPath)<br />        <span class="hljs-keyword">let</span> song <span class="hljs-operator">=</span> songs[indexPath.row]<br />        cell.textLabel<span class="hljs-operator">?</span>.text <span class="hljs-operator">=</span> song<br />        <span class="hljs-keyword">return</span> cell<br />    }<br />    <br />}</span></pre><figure name="95d3" id="95d3" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*_NfMcF3S1TUcZz1AGwL7dg.png" data-width="1170" data-height="2532" src="https://cdn-images-1.medium.com/max/800/1*_NfMcF3S1TUcZz1AGwL7dg.png"></figure><h3 name="5a17" id="5a17" class="graf graf--h3 graf-after--figure">在 navigation bar 顯示 search bar</h3><p name="7fab" id="7fab" class="graf graf--p graf-after--h3">設定 navigation item 的 searchController。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="0e1e" id="0e1e" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {<br />    <span class="hljs-keyword">super</span>.viewDidLoad()<br />        <br />    <span class="hljs-keyword">let</span> searchController <span class="hljs-operator">=</span> <span class="hljs-type">UISearchController</span>()<br />    navigationItem.searchController <span class="hljs-operator">=</span> searchController<br />}</span></pre><figure name="87e6" id="87e6" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*MCUpBCC7oHbUMWkyuAr4ag.png" data-width="1170" data-height="2532" src="https://cdn-images-1.medium.com/max/800/1*MCUpBCC7oHbUMWkyuAr4ag.png"></figure><p name="4ff9" id="4ff9" class="graf graf--p graf-after--figure">在 search bar 輸入文字時，bar 將自動移到畫面上方。</p><figure name="779c" id="779c" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*v6euvBgy8eE2NR3hEnZTaw.png" data-width="1170" data-height="2532" src="https://cdn-images-1.medium.com/max/800/1*v6euvBgy8eE2NR3hEnZTaw.png"></figure><h3 name="7bd3" id="7bd3" class="graf graf--h3 graf-after--figure">畫面捲動時是否顯示 search bar</h3><p name="5195" id="5195" class="graf graf--p graf-after--h3">當我們捲動畫面時，預設 search bar 會隨著捲動隱藏在 navigation bar 下。</p><figure name="be3b" id="be3b" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*09bvNNzmhOe5IJ2Gv1IRIw.png" data-width="1170" data-height="2532" src="https://cdn-images-1.medium.com/max/800/1*09bvNNzmhOe5IJ2Gv1IRIw.png"></figure><p name="26c7" id="26c7" class="graf graf--p graf-after--figure">將 navigationItem 的 hidesSearchBarWhenScrolling 設為 false，畫面捲動時 search bar 將持續顯示在 navigation bar 上。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="f755" id="f755" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {<br />    <span class="hljs-keyword">super</span>.viewDidLoad()<br />        <br />    <span class="hljs-keyword">let</span> searchController <span class="hljs-operator">=</span> <span class="hljs-type">UISearchController</span>()<br />    navigationItem.searchController <span class="hljs-operator">=</span> searchController<br />    navigationItem.hidesSearchBarWhenScrolling <span class="hljs-operator">=</span> <span class="hljs-literal">false</span><br />}</span></pre><figure name="65cb" id="65cb" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*siwIH-qGeKZP-DMnQhZHQg.png" data-width="1170" data-height="2532" src="https://cdn-images-1.medium.com/max/800/1*siwIH-qGeKZP-DMnQhZHQg.png"></figure><p name="5a01" id="5a01" class="graf graf--p graf-after--figure">現在畫面上有了 search bar，不過它是騙人的，不管我們打什麼字，表格還是顯示原本的內容，接下來我們將進入重頭戲，真正地實現 search 功能。</p><figure name="be8a" id="be8a" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*EpG0kcddDU6uMv_WtQ2XaA.png" data-width="1170" data-height="2532" src="https://cdn-images-1.medium.com/max/800/1*EpG0kcddDU6uMv_WtQ2XaA.png"></figure><h3 name="9f56" id="9f56" class="graf graf--h3 graf-after--figure">實現 search 功能</h3><p name="5623" id="5623" class="graf graf--p graf-after--h3">將 LoveSongTableViewController 設為 UISearchController 的 searchResultsUpdater。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="605e" id="605e" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LoveSongTableViewController</span>: <span class="hljs-title class_">UITableViewController</span> {<br />    <span class="hljs-keyword">let</span> songs <span class="hljs-operator">=</span> [<span class="hljs-string">&quot;為愛往前飛&quot;</span>, <span class="hljs-string">&quot;我愛你這樣深&quot;</span>, <span class="hljs-string">&quot;難以抗拒你容顏&quot;</span>, <span class="hljs-string">&quot;流言&quot;</span>, <span class="hljs-string">&quot;你那麼愛她&quot;</span>, <span class="hljs-string">&quot;我還是愛你到老&quot;</span>, <span class="hljs-string">&quot;我是多麼認真對你&quot;</span>, <span class="hljs-string">&quot;體會&quot;</span>, <span class="hljs-string">&quot;怎麼開始忘了&quot;</span>, <span class="hljs-string">&quot;藏經閣&quot;</span>, <span class="hljs-string">&quot;白天不懂夜的黑&quot;</span>]<br />    <br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {<br />        <span class="hljs-keyword">super</span>.viewDidLoad()<br />        <br />        <span class="hljs-keyword">let</span> searchController <span class="hljs-operator">=</span> <span class="hljs-type">UISearchController</span>()<br />        searchController.searchResultsUpdater <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span><br />        navigationItem.searchController <span class="hljs-operator">=</span> searchController<br />        navigationItem.hidesSearchBarWhenScrolling <span class="hljs-operator">=</span> <span class="hljs-literal">false</span><br />    }</span></pre><p name="1e4d" id="1e4d" class="graf graf--p graf-after--pre">然後讓 LoveSongTableViewController 遵從 protocol UISearchResultsUpdating，定義 function updateSearchResults(for:)。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="d33e" id="d33e" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">extension</span> <span class="hljs-title class_">LoveSongTableViewController</span>: <span class="hljs-title class_">UISearchResultsUpdating</span> {<br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">updateSearchResults</span>(<span class="hljs-params">for</span> <span class="hljs-params">searchController</span>: <span class="hljs-type">UISearchController</span>) {<br />        <br />    }<br />}</span></pre><p name="2abb" id="2abb" class="graf graf--p graf-after--pre">當我們在 search bar 輸入文字時，它將觸發 UISearchResultsUpdating 的 function updateSearchResults(for:)，因此我們可在 function 裡依據 search bar 的文字調整表格對應的 array 內容。</p><p name="eba6" id="eba6" class="graf graf--p graf-after--p">在 LoveSongTableViewController 宣告 property filteredSongs，利用它儲存表格顯示的 array 內容。當使用者沒有 search 時，filteredSongs 的內容將是 songs，也就是全部的歌曲。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="726c" id="726c" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LoveSongTableViewController</span>: <span class="hljs-title class_">UITableViewController</span> {<br />    <span class="hljs-keyword">let</span> songs <span class="hljs-operator">=</span> [<span class="hljs-string">&quot;為愛往前飛&quot;</span>, <span class="hljs-string">&quot;我愛你這樣深&quot;</span>, <span class="hljs-string">&quot;難以抗拒你容顏&quot;</span>, <span class="hljs-string">&quot;流言&quot;</span>, <span class="hljs-string">&quot;你那麼愛她&quot;</span>, <span class="hljs-string">&quot;我還是愛你到老&quot;</span>, <span class="hljs-string">&quot;我是多麼認真對你&quot;</span>, <span class="hljs-string">&quot;體會&quot;</span>, <span class="hljs-string">&quot;怎麼開始忘了&quot;</span>, <span class="hljs-string">&quot;藏經閣&quot;</span>, <span class="hljs-string">&quot;白天不懂夜的黑&quot;</span>]<br />    <span class="hljs-keyword">lazy</span> <span class="hljs-keyword">var</span> filteredSongs <span class="hljs-operator">=</span> songs<br />      <br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {<br />        <span class="hljs-keyword">super</span>.viewDidLoad()<br />        <br />        <span class="hljs-keyword">let</span> searchController <span class="hljs-operator">=</span> <span class="hljs-type">UISearchController</span>()<br />        searchController.searchResultsUpdater <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span><br />        navigationItem.searchController <span class="hljs-operator">=</span> searchController<br />        navigationItem.hidesSearchBarWhenScrolling <span class="hljs-operator">=</span> <span class="hljs-literal">false</span><br />    }<br /><br />    <span class="hljs-comment">// MARK: - Table view data source</span><br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">tableView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">tableView</span>: <span class="hljs-type">UITableView</span>, <span class="hljs-params">numberOfRowsInSection</span> <span class="hljs-params">section</span>: <span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">Int</span> {<br />        <span class="hljs-keyword">return</span> filteredSongs.count<br />    }<br />    <br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">tableView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">tableView</span>: <span class="hljs-type">UITableView</span>, <span class="hljs-params">cellForRowAt</span> <span class="hljs-params">indexPath</span>: <span class="hljs-type">IndexPath</span>) -&gt; <span class="hljs-type">UITableViewCell</span> {<br />        <span class="hljs-keyword">let</span> cell <span class="hljs-operator">=</span> tableView.dequeueReusableCell(withIdentifier: <span class="hljs-string">&quot;LoveSongCell&quot;</span>, for: indexPath)<br />        <span class="hljs-keyword">let</span> song <span class="hljs-operator">=</span> filteredSongs[indexPath.row]<br />        cell.textLabel<span class="hljs-operator">?</span>.text <span class="hljs-operator">=</span> song<br />        <span class="hljs-keyword">return</span> cell<br />    }<br />    <br />}</span></pre><p name="0ff4" id="0ff4" class="graf graf--p graf-after--pre">值得注意的，宣告 filteredSongs 時，我們特別加上 lazy。它將讓程式更有效率，在第一次存取 filteredSongs 時才設定 filteredSongs 的內容。</p><div name="2922" id="2922" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E8%AE%93%E5%B1%AC%E6%80%A7%E8%AE%8A%E6%87%B6%E7%9A%84-swift-lazy-%E5%92%92%E8%AA%9E-cfcc16840bd2" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E8%AE%93%E5%B1%AC%E6%80%A7%E8%AE%8A%E6%87%B6%E7%9A%84-swift-lazy-%E5%92%92%E8%AA%9E-cfcc16840bd2" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E8%AE%93%E5%B1%AC%E6%80%A7%E8%AE%8A%E6%87%B6%E7%9A%84-swift-lazy-%E5%92%92%E8%AA%9E-cfcc16840bd2"><strong class="markup--strong markup--mixtapeEmbed-strong">讓屬性變懶的 swift lazy 咒語</strong><br><em class="markup--em markup--mixtapeEmbed-em">swift 的 stored property 有著一定要初始的天性，在東西建立時，一定得確保東西的每一個 stored property 都已完成初始( property 有內容或是設為…</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E8%AE%93%E5%B1%AC%E6%80%A7%E8%AE%8A%E6%87%B6%E7%9A%84-swift-lazy-%E5%92%92%E8%AA%9E-cfcc16840bd2" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="fc9997ec026edbfaf838117be6656ef6" data-thumbnail-img-id="1*-KonqwNC-8jhtEvHRh0naQ.jpeg" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*-KonqwNC-8jhtEvHRh0naQ.jpeg);"></a></div><p name="4a33" id="4a33" class="graf graf--p graf-after--mixtapeEmbed">依據 search bar 的文字調整 filteredSongs，然後呼叫 reloadData 更新表格。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="2434" id="2434" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">extension</span> <span class="hljs-title class_">LoveSongTableViewController</span>: <span class="hljs-title class_">UISearchResultsUpdating</span> {<br /><br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">updateSearchResults</span>(<span class="hljs-params">for</span> <span class="hljs-params">searchController</span>: <span class="hljs-type">UISearchController</span>) {<br />        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> searchText <span class="hljs-operator">=</span> searchController.searchBar.text,<br />           searchText.isEmpty <span class="hljs-operator">==</span> <span class="hljs-literal">false</span>  {<br />            filteredSongs <span class="hljs-operator">=</span> songs.filter({ song <span class="hljs-keyword">in</span><br />                song.localizedStandardContains(searchText)<br />            })<br />        } <span class="hljs-keyword">else</span> {<br />            filteredSongs <span class="hljs-operator">=</span> songs<br />        }<br />        tableView.reloadData()<br />    }    <br />}</span></pre></div><div class="section-inner sectionLayout--outsetRow" data-paragraph-count="2"><figure name="f2a0" id="f2a0" class="graf graf--figure graf--layoutOutsetRow is-partialWidth graf-after--pre" style="width: 50%;"><img class="graf-image" data-image-id="1*SMvzuXDGrz-w8GP0ksZRhQ.png" data-width="1170" data-height="2532" src="https://cdn-images-1.medium.com/max/600/1*SMvzuXDGrz-w8GP0ksZRhQ.png"></figure><figure name="040e" id="040e" class="graf graf--figure graf--layoutOutsetRowContinue is-partialWidth graf-after--figure" style="width: 50%;"><img class="graf-image" data-image-id="1*5AtmMkAuNOiVojzMOON0nA.png" data-width="1170" data-height="2532" src="https://cdn-images-1.medium.com/max/600/1*5AtmMkAuNOiVojzMOON0nA.png"></figure></div><div class="section-inner sectionLayout--insetColumn"><h3 name="2bd0" id="2bd0" class="graf graf--h3 graf-after--figure">完整程式</h3><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="02c9" id="02c9" class="graf graf--pre graf-after--h3 graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> UIKit<br /><span class="hljs-keyword">class</span> <span class="hljs-title class_">LoveSongTableViewController</span>: <span class="hljs-title class_">UITableViewController</span> {<br />    <span class="hljs-keyword">let</span> songs <span class="hljs-operator">=</span> [<span class="hljs-string">&quot;為愛往前飛&quot;</span>, <span class="hljs-string">&quot;我愛你這樣深&quot;</span>, <span class="hljs-string">&quot;難以抗拒你容顏&quot;</span>, <span class="hljs-string">&quot;流言&quot;</span>, <span class="hljs-string">&quot;你那麼愛她&quot;</span>, <span class="hljs-string">&quot;我還是愛你到老&quot;</span>, <span class="hljs-string">&quot;我是多麼認真對你&quot;</span>, <span class="hljs-string">&quot;體會&quot;</span>, <span class="hljs-string">&quot;怎麼開始忘了&quot;</span>, <span class="hljs-string">&quot;藏經閣&quot;</span>, <span class="hljs-string">&quot;白天不懂夜的黑&quot;</span>]<br />    <span class="hljs-keyword">lazy</span> <span class="hljs-keyword">var</span> filteredSongs <span class="hljs-operator">=</span> songs<br /><br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {<br />        <span class="hljs-keyword">super</span>.viewDidLoad()<br />        <br />        <span class="hljs-keyword">let</span> searchController <span class="hljs-operator">=</span> <span class="hljs-type">UISearchController</span>()<br />        searchController.searchResultsUpdater <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span><br />        navigationItem.searchController <span class="hljs-operator">=</span> searchController<br />        navigationItem.hidesSearchBarWhenScrolling <span class="hljs-operator">=</span> <span class="hljs-literal">false</span><br />    }<br /><br />    <span class="hljs-comment">// MARK: - Table view data source</span><br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">tableView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">tableView</span>: <span class="hljs-type">UITableView</span>, <span class="hljs-params">numberOfRowsInSection</span> <span class="hljs-params">section</span>: <span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">Int</span> {<br />        <span class="hljs-comment">// #warning Incomplete implementation, return the number of rows</span><br />        <span class="hljs-keyword">return</span> filteredSongs.count<br />    }<br />    <br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">tableView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">tableView</span>: <span class="hljs-type">UITableView</span>, <span class="hljs-params">cellForRowAt</span> <span class="hljs-params">indexPath</span>: <span class="hljs-type">IndexPath</span>) -&gt; <span class="hljs-type">UITableViewCell</span> {<br />        <span class="hljs-keyword">let</span> cell <span class="hljs-operator">=</span> tableView.dequeueReusableCell(withIdentifier: <span class="hljs-string">&quot;LoveSongCell&quot;</span>, for: indexPath)<br />        <span class="hljs-keyword">let</span> song <span class="hljs-operator">=</span> filteredSongs[indexPath.row]<br />        cell.textLabel<span class="hljs-operator">?</span>.text <span class="hljs-operator">=</span> song<br />        <span class="hljs-keyword">return</span> cell<br />    }<br />    <br />}<br /><br /><span class="hljs-keyword">extension</span> <span class="hljs-title class_">LoveSongTableViewController</span>: <span class="hljs-title class_">UISearchResultsUpdating</span> {<br /><br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">updateSearchResults</span>(<span class="hljs-params">for</span> <span class="hljs-params">searchController</span>: <span class="hljs-type">UISearchController</span>) {<br />        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> searchText <span class="hljs-operator">=</span> searchController.searchBar.text,<br />           searchText.isEmpty <span class="hljs-operator">==</span> <span class="hljs-literal">false</span>  {<br />            filteredSongs <span class="hljs-operator">=</span> songs.filter({ song <span class="hljs-keyword">in</span><br />                song.localizedStandardContains(searchText)<br />            })<br />        } <span class="hljs-keyword">else</span> {<br />            filteredSongs <span class="hljs-operator">=</span> songs<br />        }<br />        tableView.reloadData()<br />    }    <br />}</span></pre><h3 name="a0e3" id="a0e3" class="graf graf--h3 graf-after--pre">以另一個 view controller 顯示搜尋結果</h3><p name="fa01" id="fa01" class="graf graf--p graf-after--h3">若是搜尋結果想要呈現不同的畫面，我們可在產生 UISearchController 時傳入顯示結果的 controller。</p><p name="251f" id="251f" class="graf graf--p graf-after--p">比方我們想以 ResultsTableController 顯示搜尋結果，它的 cell 是黃色。</p><figure name="5931" id="5931" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*_OpBta6Xk-pmAcM5cGIJXg.png" data-width="2008" data-height="962" src="https://cdn-images-1.medium.com/max/800/1*_OpBta6Xk-pmAcM5cGIJXg.png"></figure><p name="59bf" id="59bf" class="graf graf--p graf-after--figure">ResultsTableController 的定義如下，儲存搜尋結果的 filteredSongs 改成宣告在 ResultsTableController。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="852d" id="852d" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> UIKit<br /><br /><span class="hljs-keyword">class</span> <span class="hljs-title class_">ResultsTableController</span>: <span class="hljs-title class_">UITableViewController</span> {<br />    <span class="hljs-keyword">var</span> filteredSongs <span class="hljs-operator">=</span> [<span class="hljs-type">String</span>]()<br /><br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {<br />        <span class="hljs-keyword">super</span>.viewDidLoad()<br />    }<br /><br />    <span class="hljs-comment">// MARK: - Table view data source</span><br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">tableView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">tableView</span>: <span class="hljs-type">UITableView</span>, <span class="hljs-params">numberOfRowsInSection</span> <span class="hljs-params">section</span>: <span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">Int</span> {<br />        <span class="hljs-keyword">return</span> filteredSongs.count<br />    }<br /><br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">tableView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">tableView</span>: <span class="hljs-type">UITableView</span>, <span class="hljs-params">cellForRowAt</span> <span class="hljs-params">indexPath</span>: <span class="hljs-type">IndexPath</span>) -&gt; <span class="hljs-type">UITableViewCell</span> {<br />        <span class="hljs-keyword">let</span> cell <span class="hljs-operator">=</span> tableView.dequeueReusableCell(withIdentifier: <span class="hljs-string">&quot;LoveSongCell&quot;</span>, for: indexPath)<br />        <span class="hljs-keyword">let</span> song <span class="hljs-operator">=</span> filteredSongs[indexPath.row]<br />        cell.textLabel<span class="hljs-operator">?</span>.text <span class="hljs-operator">=</span> song<br />        <span class="hljs-keyword">return</span> cell<br />    }<br />}</span></pre><p name="c499" id="c499" class="graf graf--p graf-after--pre">LoveSongTableViewController 的定義如下，產生 UISearchController 時在參數 searchResultsController 傳入 ResultsTableController。</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="swift" name="e14c" id="e14c" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> UIKit<br /><br /><span class="hljs-keyword">class</span> <span class="hljs-title class_">LoveSongTableViewController</span>: <span class="hljs-title class_">UITableViewController</span> {<br />   <span class="hljs-keyword">var</span> resultsTableController: <span class="hljs-type">ResultsTableController</span>!<br />   <span class="hljs-keyword">let</span> songs <span class="hljs-operator">=</span> [<span class="hljs-string">&quot;為愛往前飛&quot;</span>, <span class="hljs-string">&quot;我愛你這樣深&quot;</span>, <span class="hljs-string">&quot;難以抗拒你容顏&quot;</span>, <span class="hljs-string">&quot;流言&quot;</span>, <span class="hljs-string">&quot;你那麼愛她&quot;</span>, <span class="hljs-string">&quot;我還是愛你到老&quot;</span>, <span class="hljs-string">&quot;我是多麼認真對你&quot;</span>, <span class="hljs-string">&quot;體會&quot;</span>, <span class="hljs-string">&quot;怎麼開始忘了&quot;</span>, <span class="hljs-string">&quot;藏經閣&quot;</span>, <span class="hljs-string">&quot;白天不懂夜的黑&quot;</span>]<br />    <br />   <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">viewDidLoad</span>() {<br />        <span class="hljs-keyword">super</span>.viewDidLoad()<br />        <br />        resultsTableController <span class="hljs-operator">=</span> storyboard<span class="hljs-operator">?</span>.instantiateViewController(withIdentifier: <span class="hljs-string">&quot;<span class="hljs-subst">\(ResultsTableController.<span class="hljs-keyword">self</span>)</span>&quot;</span>) <span class="hljs-keyword">as?</span> <span class="hljs-type">ResultsTableController</span><br />        <span class="hljs-keyword">let</span> searchController <span class="hljs-operator">=</span> <span class="hljs-type">UISearchController</span>(searchResultsController: resultsTableController)<br />        searchController.searchResultsUpdater <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span><br />        searchController.obscuresBackgroundDuringPresentation <span class="hljs-operator">=</span> <span class="hljs-literal">false</span><br />        navigationItem.searchController <span class="hljs-operator">=</span> searchController<br />        navigationItem.hidesSearchBarWhenScrolling <span class="hljs-operator">=</span> <span class="hljs-literal">false</span><br />    }<br /><br />    <span class="hljs-comment">// MARK: - Table view data source</span><br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">tableView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">tableView</span>: <span class="hljs-type">UITableView</span>, <span class="hljs-params">numberOfRowsInSection</span> <span class="hljs-params">section</span>: <span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">Int</span> {<br />        <span class="hljs-keyword">return</span> songs.count<br />    }<br />    <br />    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">tableView</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">tableView</span>: <span class="hljs-type">UITableView</span>, <span class="hljs-params">cellForRowAt</span> <span class="hljs-params">indexPath</span>: <span class="hljs-type">IndexPath</span>) -&gt; <span class="hljs-type">UITableViewCell</span> {<br />        <span class="hljs-keyword">let</span> cell <span class="hljs-operator">=</span> tableView.dequeueReusableCell(withIdentifier: <span class="hljs-string">&quot;LoveSongCell&quot;</span>, for: indexPath)<br />        <span class="hljs-keyword">let</span> song <span class="hljs-operator">=</span> songs[indexPath.row]<br />        cell.textLabel<span class="hljs-operator">?</span>.text <span class="hljs-operator">=</span> song<br />        <span class="hljs-keyword">return</span> cell<br />    }<br />    <br />}<br /><br /><span class="hljs-keyword">extension</span> <span class="hljs-title class_">LoveSongTableViewController</span>: <span class="hljs-title class_">UISearchResultsUpdating</span> {<br /><br />    <span class="hljs-keyword">func</span> <span class="hljs-title function_">updateSearchResults</span>(<span class="hljs-params">for</span> <span class="hljs-params">searchController</span>: <span class="hljs-type">UISearchController</span>) {<br />        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> searchText <span class="hljs-operator">=</span> searchController.searchBar.text,<br />           searchText.isEmpty <span class="hljs-operator">==</span> <span class="hljs-literal">false</span>  {<br />            resultsTableController.filteredSongs <span class="hljs-operator">=</span> songs.filter({ song <span class="hljs-keyword">in</span><br />                song.localizedStandardContains(searchText)<br />            })<br />        } <span class="hljs-keyword">else</span> {<br />            resultsTableController.filteredSongs <span class="hljs-operator">=</span> []<br />        }<br />        resultsTableController.tableView.reloadData()<br />    }<br />}</span></pre><figure name="7f0c" id="7f0c" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*6ZwuKx7fcvWFRTVrTODH7w.png" data-width="1170" data-height="2532" src="https://cdn-images-1.medium.com/max/800/1*6ZwuKx7fcvWFRTVrTODH7w.png"></figure><h3 name="800d" id="800d" class="graf graf--h3 graf-after--figure">UISearchController 的其它功能</h3><ul class="postList"><li name="09f9" id="09f9" class="graf graf--li graf-after--h3"><strong class="markup--strong markup--li-strong">automaticallyShowsCancelButton</strong></li></ul><p name="cda8" id="cda8" class="graf graf--p graf-after--li">是否顯示 cancel button。下圖為 automaticallyShowsCancelButton 設為 false，不顯示 cancel button。</p><figure name="73a8" id="73a8" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*pgMyUfVGxrAZw_Z6XZtlmg.png" data-width="1170" data-height="2532" src="https://cdn-images-1.medium.com/max/800/1*pgMyUfVGxrAZw_Z6XZtlmg.png"></figure><ul class="postList"><li name="10e8" id="10e8" class="graf graf--li graf-after--figure"><strong class="markup--strong markup--li-strong">hidesNavigationBarDuringPresentation</strong></li></ul><p name="9d92" id="9d92" class="graf graf--p graf-after--li">在 search bar 輸入文字時，是否隱藏 navigation bar 的標題。下圖為 hidesNavigationBarDuringPresentation 設為 false，在 search bar 輸入文字時顯示 navigation bar 的標題。</p><figure name="efb8" id="efb8" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*O4hwiqzPFSs19_LfcVsS4w.png" data-width="1170" data-height="2532" src="https://cdn-images-1.medium.com/max/800/1*O4hwiqzPFSs19_LfcVsS4w.png"></figure><h3 name="a334" id="a334" class="graf graf--h3 graf-after--figure">利用 debounce 優化 search 時發送的 request</h3><div name="9e4f" id="9e4f" class="graf graf--mixtapeEmbed graf-after--h3"><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-debounce-%E5%84%AA%E5%8C%96-search-%E6%99%82%E7%99%BC%E9%80%81%E7%9A%84-request-783dc4261f27" data-href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-debounce-%E5%84%AA%E5%8C%96-search-%E6%99%82%E7%99%BC%E9%80%81%E7%9A%84-request-783dc4261f27" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-debounce-%E5%84%AA%E5%8C%96-search-%E6%99%82%E7%99%BC%E9%80%81%E7%9A%84-request-783dc4261f27"><strong class="markup--strong markup--mixtapeEmbed-strong">利用 debounce 優化 search 時發送的 request</strong><br><em class="markup--em markup--mixtapeEmbed-em">當我們在 iOS App 搜尋資料時，常見的設計是每打一個字就更新搜尋的結果，比方下圖的 TV App。</em>medium.com</a><a href="https://medium.com/%E5%BD%BC%E5%BE%97%E6%BD%98%E7%9A%84-swift-ios-app-%E9%96%8B%E7%99%BC%E5%95%8F%E9%A1%8C%E8%A7%A3%E7%AD%94%E9%9B%86/%E5%88%A9%E7%94%A8-debounce-%E5%84%AA%E5%8C%96-search-%E6%99%82%E7%99%BC%E9%80%81%E7%9A%84-request-783dc4261f27" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="b9fe686e12f05fee8233ec0737ce5105" data-thumbnail-img-id="1*dY1a5Z-fDcoW5y338dS9tQ.png" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*dY1a5Z-fDcoW5y338dS9tQ.png);"></a></div><h3 name="c080" id="c080" class="graf graf--h3 graf-after--mixtapeEmbed">參考範例</h3><p name="49f7" id="49f7" class="graf graf--p graf-after--h3">Apple 的 Using Suggested Searches with a Search Controller</p><div name="7459" id="7459" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://developer.apple.com/documentation/uikit/view_controllers/using_suggested_searches_with_a_search_controller" data-href="https://developer.apple.com/documentation/uikit/view_controllers/using_suggested_searches_with_a_search_controller" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/uikit/view_controllers/using_suggested_searches_with_a_search_controller"><strong class="markup--strong markup--mixtapeEmbed-strong">Apple Developer Documentation</strong><br><em class="markup--em markup--mixtapeEmbed-em">Edit description</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/uikit/view_controllers/using_suggested_searches_with_a_search_controller" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="d69bdbbd5920e495299a54e72fdc0516"></a></div><p name="b5e7" id="b5e7" class="graf graf--p graf-after--mixtapeEmbed">Apple 的 Displaying Searchable Content by Using a Search Controller</p><div name="f176" id="f176" class="graf graf--mixtapeEmbed graf-after--p graf--trailing"><a href="https://developer.apple.com/documentation/uikit/view_controllers/displaying_searchable_content_by_using_a_search_controller" data-href="https://developer.apple.com/documentation/uikit/view_controllers/displaying_searchable_content_by_using_a_search_controller" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://developer.apple.com/documentation/uikit/view_controllers/displaying_searchable_content_by_using_a_search_controller"><strong class="markup--strong markup--mixtapeEmbed-strong">Apple Developer Documentation</strong><br><em class="markup--em markup--mixtapeEmbed-em">Edit description</em>developer.apple.com</a><a href="https://developer.apple.com/documentation/uikit/view_controllers/displaying_searchable_content_by_using_a_search_controller" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="712c96d20852740737137b8910a41101"></a></div></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@apppeterpan" class="p-author h-card">彼得潘的 iOS App Neverland</a> on <a href="https://medium.com/p/a63aa932d0b9"><time class="dt-published" datetime="2017-09-21T09:40:18.655Z">September 21, 2017</time></a>.</p><p><a href="https://medium.com/@apppeterpan/navigation-bar-%E8%A3%A1%E9%A1%AF%E7%A4%BA-search-bar-a63aa932d0b9" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on September 17, 2025.</p></footer></article></body></html>